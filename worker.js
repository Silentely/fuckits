// --- FUCKIT.SH Cloudflare Worker ---

// This is the content of your main.sh installer script.
// It will be served when a user makes a GET request.
function b64_to_utf8(str) {
  try {
    // This is a more robust way to decode base64 to UTF-8
    const binaryString = atob(str);
    const len = binaryString.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    return new TextDecoder().decode(bytes);
  } catch (e) {
    console.error("Failed to decode base64 string:", e);
    return ""; // Return empty string on failure
  }
}

const INSTALLER_SCRIPT = b64_to_utf8(`IyEvYmluL2Jhc2gKIwojIFRoaXMgc2NyaXB0IGlzIHRoZSBpbnN0YWxsZXIgYW5kIHRlbXBvcmFyeSBydW5uZXIgZm9yIGZ1Y2tpdHMKIwojIC0tLSBSRUNPTU1FTkRFRCBTRUNVUkUgVVNBR0UgLS0tCiMKIyAxLiBEb3dubG9hZDoKIyAgICBjdXJsIC1vIGZ1Y2tpdHMgaHR0cHM6Ly9mdWNraXRzLjI1NTAwNTUyLnh5egojCiMgMi4gSW5zcGVjdDoKIyAgICBsZXNzIGZ1Y2tpdHMKIwojIDMuIFJ1biAoSW5zdGFsbCk6CiMgICAgYmFzaCBmdWNraXRzCiMKIyA0LiBSdW4gKFRlbXBvcmFyeSk6CiMgICAgYmFzaCBmdWNraXRzICJ5b3VyIHByb21wdCIKIwoKc2V0IC1ldW8gcGlwZWZhaWwKCiMgLS0tIENvbG9yIERlZmluaXRpb25zIC0tLQpyZWFkb25seSBDX1JFU0VUPSdcMDMzWzBtJwpyZWFkb25seSBDX1JFRF9CT0xEPSdcMDMzWzE7MzFtJwpyZWFkb25seSBDX1JFRD0nXDAzM1swOzMxbScKcmVhZG9ubHkgQ19HUkVFTj0nXDAzM1swOzMybScKcmVhZG9ubHkgQ19ZRUxMT1c9J1wwMzNbMDszM20nCnJlYWRvbmx5IENfQ1lBTj0nXDAzM1swOzM2bScKcmVhZG9ubHkgQ19CT0xEPSdcMDMzWzFtJwpyZWFkb25seSBDX0RJTT0nXDAzM1sybScKCiMgLS0tIEZVQ0shIC0tLQpyZWFkb25seSBGVUNLPSIke0NfUkVEX0JPTER9RlVDSyEke0NfUkVTRVR9IgpyZWFkb25seSBGQ0tOPSIke0NfUkVEfUYqQ0tJTkcke0NfUkVTRVR9IgoKcmVhZG9ubHkgRlVDS0lUU19MT0NBTEU9ImVuIgoKCiMgLS0tIENvbmZpZ3VyYXRpb24gLS0tCmlmIFsgLXogIiR7SE9NRTotfSIgXTsgdGhlbgogICAgZWNobyAtZSAiXDAzM1sxOzMxbUZVQ0shXDAzM1swbSBcMDMzWzA7MzFtWW91ciBIT01FIHZhcmlhYmxlIGlzbid0IHNldC4gSSBkb24ndCBrbm93IHdoZXJlIHRvIGluc3RhbGwgdGhpcyBzaGl0LiBTZXQgaXQgeW91cnNlbGYgKGUuZy4sIGV4cG9ydCBIT01FPS9yb290KS5cMDMzWzBtIiA+JjIKICAgIGV4aXQgMQpmaQpyZWFkb25seSBJTlNUQUxMX0RJUj0iJEhPTUUvLmZ1Y2siCnJlYWRvbmx5IE1BSU5fU0g9IiRJTlNUQUxMX0RJUi9tYWluLnNoIgpyZWFkb25seSBDT05GSUdfRklMRT0iJElOU1RBTExfRElSL2NvbmZpZy5zaCIKCgojIC0tLSBDb3JlIExvZ2ljIChFbWJlZGRlZCBhcyBhIHN0cmluZykgLS0tCnJlYWQgLXIgLWQgJycgQ09SRV9MT0dJQyA8PCdFT0YnIHx8IHRydWUKCiMgLS0tIEJlZ2luIENvcmUgTG9naWMgZm9yIGZ1Y2tpdHMgLS0tCgojIC0tLSBDb2xvciBEZWZpbml0aW9ucyAtLS0KIyBPbmx5IGRlZmluZSBjb2xvcnMgaWYgdGhleSBoYXZlbid0IGJlZW4gZGVmaW5lZCB5ZXQgKGZvciB0ZW1wIG1vZGUpCmlmIFsgLXogIiR7Q19SRVNFVDotfSIgXTsgdGhlbgogICAgcmVhZG9ubHkgQ19SRVNFVD0nXDAzM1swbScKICAgIHJlYWRvbmx5IENfUkVEX0JPTEQ9J1wwMzNbMTszMW0nCiAgICByZWFkb25seSBDX1JFRD0nXDAzM1swOzMxbScKICAgIHJlYWRvbmx5IENfR1JFRU49J1wwMzNbMDszMm0nCiAgICByZWFkb25seSBDX1lFTExPVz0nXDAzM1swOzMzbScKICAgIHJlYWRvbmx5IENfQ1lBTj0nXDAzM1swOzM2bScKICAgIHJlYWRvbmx5IENfQk9MRD0nXDAzM1sxbScKICAgIHJlYWRvbmx5IENfRElNPSdcMDMzWzJtJwoKICAgICMgLS0tIEZVQ0shIC0tLQogICAgcmVhZG9ubHkgRlVDSz0iJHtDX1JFRF9CT0xEfUZVQ0shJHtDX1JFU0VUfSIKICAgIHJlYWRvbmx5IEZDS049IiR7Q19SRUR9RipDS0lORyR7Q19SRVNFVH0iCmZpCgppZiBbIC16ICIke0lOU1RBTExfRElSK3h9IiBdIHx8IFsgLXogIiR7TUFJTl9TSCt4fSIgXSB8fCBbIC16ICIke0NPTkZJR19GSUxFK3h9IiBdOyB0aGVuCiAgICBpZiBbIC16ICIke0hPTUU6LX0iIF07IHRoZW4KICAgICAgICByZWFkb25seSBJTlNUQUxMX0RJUj0iL3RtcC8uZnVjayIKICAgICAgICByZWFkb25seSBNQUlOX1NIPSIvdG1wLy5mdWNrL21haW4uc2giCiAgICAgICAgcmVhZG9ubHkgQ09ORklHX0ZJTEU9Ii90bXAvLmZ1Y2svY29uZmlnLnNoIgogICAgZWxzZQogICAgICAgIHJlYWRvbmx5IElOU1RBTExfRElSPSIkSE9NRS8uZnVjayIKICAgICAgICByZWFkb25seSBNQUlOX1NIPSIkSU5TVEFMTF9ESVIvbWFpbi5zaCIKICAgICAgICByZWFkb25seSBDT05GSUdfRklMRT0iJElOU1RBTExfRElSL2NvbmZpZy5zaCIKICAgIGZpCmZpCgojIExvYWQgdXNlciBjb25maWd1cmF0aW9uIGlmIGl0IGV4aXN0cwppZiBbIC1mICIkQ09ORklHX0ZJTEUiIF07IHRoZW4KICAgIHNvdXJjZSAiJENPTkZJR19GSUxFIgpmaQoKaWYgWyAteiAiJHtERUZBVUxUX0FQSV9FTkRQT0lOVCt4fSIgXTsgdGhlbgogICAgcmVhZG9ubHkgREVGQVVMVF9BUElfRU5EUE9JTlQ9Imh0dHBzOi8vZnVja2l0cy4yNTUwMDU1Mi54eXovIgpmaQoKIyBIZWxwZXIgdG8gZmluZCB0aGUgdXNlcidzIHNoZWxsIHByb2ZpbGUgZmlsZQpfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKCkgewogICAgaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAienNoIjsgdGhlbgogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAiYmFzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8ucHJvZmlsZSIgXTsgdGhlbgogICAgICAgICMgRmFsbGJhY2sgZm9yIHNoLCBrc2gsIGV0Yy4KICAgICAgICBlY2hvICIkSE9NRS8ucHJvZmlsZSIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLnpzaHJjIiBdOyB0aGVuCiAgICAgICAgIyBGYWxsYmFjayBpZiBTSEVMTCB2YXIgaXNuJ3Qgc2V0CiAgICAgICAgZWNobyAiJEhPTUUvLnpzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8uYmFzaHJjIiBdOyB0aGVuCiAgICAgICAgIyBGYWxsYmFjayBpZiBTSEVMTCB2YXIgaXNuJ3Qgc2V0CiAgICAgICAgZWNobyAiJEhPTUUvLmJhc2hyYyIKICAgIGVsc2UKICAgICAgICBlY2hvICJ1bmtub3duX3Byb2ZpbGUiCiAgICBmaQp9CgojIC0tLSBTeXN0ZW0gSW5mb3JtYXRpb24gQ29sbGVjdGlvbiAtLS0KIyBDYWNoZSBmaWxlIGZvciBzdGF0aWMgc3lzdGVtIGluZm9ybWF0aW9uIChwZXJzaXN0ZWQgYWNyb3NzIHJ1bnMpCiMgT25seSBkZWZpbmUgaWYgbm90IGFscmVhZHkgc2V0IChwcmV2ZW50cyByZWFkLW9ubHkgdmFyaWFibGUgZXJyb3JzKQppZiBbIC16ICIke0ZVQ0tfU1lTSU5GT19DQUNIRV9GSUxFOi19IiBdOyB0aGVuCiAgICByZWFkb25seSBGVUNLX1NZU0lORk9fQ0FDSEVfRklMRT0iJElOU1RBTExfRElSLy5zeXNpbmZvLmNhY2hlIgpmaQojIENhY2hlIHN0YXRlIHRyYWNraW5nIHZhcmlhYmxlcwpfRlVDS19TVEFUSUNfQ0FDSEVfTE9BREVEPTAKX0ZVQ0tfU1RBVElDX0NBQ0hFX0RJUlRZPTAKCiMgTG9hZHMgc3RhdGljIHN5c3RlbSBpbmZvcm1hdGlvbiBmcm9tIGNhY2hlIGZpbGUKIyBHbG9iYWxzOiBfRlVDS19TVEFUSUNfQ0FDSEVfTE9BREVELCBGVUNLX1NZU0lORk9fQ0FDSEVfRklMRQpfZnVja19sb2FkX3N0YXRpY19jYWNoZSgpIHsKICAgICMgUmV0dXJuIGVhcmx5IGlmIGNhY2hlIGlzIGFscmVhZHkgbG9hZGVkCiAgICBpZiBbICIke19GVUNLX1NUQVRJQ19DQUNIRV9MT0FERUQ6LTB9IiAtZXEgMSBdOyB0aGVuCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgX0ZVQ0tfU1RBVElDX0NBQ0hFX0xPQURFRD0xCgogICAgIyBTb3VyY2UgY2FjaGUgZmlsZSBpZiBpdCBleGlzdHMKICAgIGlmIFsgLWYgIiRGVUNLX1NZU0lORk9fQ0FDSEVfRklMRSIgXTsgdGhlbgogICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMTA5MAogICAgICAgIHNvdXJjZSAiJEZVQ0tfU1lTSU5GT19DQUNIRV9GSUxFIiB8fCB0cnVlCiAgICBmaQp9CgojIE1hcmtzIHN0YXRpYyBjYWNoZSBhcyBkaXJ0eSAobmVlZHMgdG8gYmUgcGVyc2lzdGVkKQojIEdsb2JhbHM6IF9GVUNLX1NUQVRJQ19DQUNIRV9ESVJUWQpfZnVja19tYXJrX3N0YXRpY19jYWNoZV9kaXJ0eSgpIHsKICAgIF9GVUNLX1NUQVRJQ19DQUNIRV9ESVJUWT0xCn0KCiMgUGVyc2lzdHMgc3RhdGljIHN5c3RlbSBpbmZvcm1hdGlvbiB0byBjYWNoZSBmaWxlCiMgR2xvYmFsczogX0ZVQ0tfU1RBVElDX0NBQ0hFX0RJUlRZLCBGVUNLX1NZU0lORk9fQ0FDSEVfRklMRQojIFJldHVybnM6IDAgb24gc3VjY2VzcywgMSBvbiBmYWlsdXJlCl9mdWNrX3BlcnNpc3Rfc3RhdGljX2NhY2hlKCkgewogICAgIyBPbmx5IHBlcnNpc3QgaWYgY2FjaGUgaXMgZGlydHkKICAgIGlmIFsgIiR7X0ZVQ0tfU1RBVElDX0NBQ0hFX0RJUlRZOi0wfSIgLW5lIDEgXTsgdGhlbgogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgICMgRW5zdXJlIGNhY2hlIGRpcmVjdG9yeSBleGlzdHMKICAgIGxvY2FsIGNhY2hlX2RpcgogICAgY2FjaGVfZGlyPSQoZGlybmFtZSAiJEZVQ0tfU1lTSU5GT19DQUNIRV9GSUxFIikKICAgIGlmICEgbWtkaXIgLXAgIiRjYWNoZV9kaXIiIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgIyBDcmVhdGUgdGVtcG9yYXJ5IGZpbGUgZm9yIGF0b21pYyB3cml0ZQogICAgbG9jYWwgdG1wX2ZpbGUKICAgIHRtcF9maWxlPSQobWt0ZW1wKSB8fCByZXR1cm4gMQoKICAgICMgV3JpdGUgY2FjaGVkIHZhcmlhYmxlcyB0byB0ZW1wb3JhcnkgZmlsZQogICAgewogICAgICAgIHByaW50ZiAnX0ZVQ0tfQ0FDSEVEX0RJU1RSTz0lcVxcbicgIiR7X0ZVQ0tfQ0FDSEVEX0RJU1RSTzotfSIKICAgICAgICBwcmludGYgJ19GVUNLX0NBQ0hFRF9LRVJORUw9JXFcXG4nICIke19GVUNLX0NBQ0hFRF9LRVJORUw6LX0iCiAgICAgICAgcHJpbnRmICdfRlVDS19DQUNIRURfQVJDSD0lcVxcbicgIiR7X0ZVQ0tfQ0FDSEVEX0FSQ0g6LX0iCiAgICAgICAgcHJpbnRmICdfRlVDS19DQUNIRURfUEtHX01BTkFHRVI9JXFcXG4nICIke19GVUNLX0NBQ0hFRF9QS0dfTUFOQUdFUjotfSIKICAgIH0gPiAiJHRtcF9maWxlIgoKICAgICMgQXRvbWljIG1vdmUgdG8gZmluYWwgbG9jYXRpb24KICAgIGlmIG12ICIkdG1wX2ZpbGUiICIkRlVDS19TWVNJTkZPX0NBQ0hFX0ZJTEUiIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgX0ZVQ0tfU1RBVElDX0NBQ0hFX0RJUlRZPTAKICAgICAgICByZXR1cm4gMAogICAgZWxzZQogICAgICAgICMgQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGUgb24gZmFpbHVyZQogICAgICAgIHJtIC1mICIkdG1wX2ZpbGUiCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCn0KCiMgRGV0ZWN0cyB0aGUgZGlzdHJpYnV0aW9uL09TIGZhbWlseSB3aXRoIGNhY2hpbmcgc3VwcG9ydAojIE91dHB1dHM6IERpc3RyaWJ1dGlvbiBzdHJpbmcgKGUuZy4sICJEZWJpYW4tYmFzZWQgMTIuMDQgKFVidW50dSAyNC4wNCBMVFMpIikKX2Z1Y2tfZGV0ZWN0X2Rpc3RybygpIHsKICAgIF9mdWNrX2xvYWRfc3RhdGljX2NhY2hlCgogICAgIyBSZXR1cm4gY2FjaGVkIHZhbHVlIGlmIGF2YWlsYWJsZQogICAgaWYgWyAtbiAiJHtfRlVDS19DQUNIRURfRElTVFJPOi19IiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICclc1xuJyAiJF9GVUNLX0NBQ0hFRF9ESVNUUk8iCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgbG9jYWwga2VybmVsX25hbWUgZGlzdHJvIGlkIHZlcnNpb24gcHJldHR5IGZhbWlseQogICAga2VybmVsX25hbWU9JCh1bmFtZSAtcyAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQogICAgZGlzdHJvPSJ1bmtub3duIgoKICAgICMgbWFjT1MgZGV0ZWN0aW9uCiAgICBpZiBbICIka2VybmVsX25hbWUiID0gIkRhcndpbiIgXTsgdGhlbgogICAgICAgIGxvY2FsIHByb2R1Y3QgdmVyc2lvbgogICAgICAgIHByb2R1Y3Q9JChzd192ZXJzIC1wcm9kdWN0TmFtZSAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ21hY09TJykKICAgICAgICBwcm9kdWN0PSQocHJpbnRmICclcycgIiRwcm9kdWN0IiB8IHRyIC1kICdcclxuJykKICAgICAgICB2ZXJzaW9uPSQoc3dfdmVycyAtcHJvZHVjdFZlcnNpb24gMj4vZGV2L251bGwgfHwgcHJpbnRmICd1bmtub3duJykKICAgICAgICB2ZXJzaW9uPSQocHJpbnRmICclcycgIiR2ZXJzaW9uIiB8IHRyIC1kICdcclxuJykKICAgICAgICBkaXN0cm89IiRwcm9kdWN0ICR2ZXJzaW9uIgogICAgIyBMaW51eCBkZXRlY3Rpb24gdXNpbmcgL2V0Yy9vcy1yZWxlYXNlCiAgICBlbGlmIFsgLXIgL2V0Yy9vcy1yZWxlYXNlIF07IHRoZW4KICAgICAgICBpZD0kKGdyZXAgLUUgJ15JRD0nIC9ldGMvb3MtcmVsZWFzZSB8IGhlYWQgLW4xIHwgY3V0IC1kPSAtZjIgfCB0ciAtZCAnIicgfCB0ciAnWzp1cHBlcjpdJyAnWzpsb3dlcjpdJykKICAgICAgICB2ZXJzaW9uPSQoZ3JlcCAtRSAnXlZFUlNJT05fSUQ9JyAvZXRjL29zLXJlbGVhc2UgfCBoZWFkIC1uMSB8IGN1dCAtZD0gLWYyIHwgdHIgLWQgJyInKQogICAgICAgIHByZXR0eT0kKGdyZXAgLUUgJ15QUkVUVFlfTkFNRT0nIC9ldGMvb3MtcmVsZWFzZSB8IGhlYWQgLW4xIHwgY3V0IC1kPSAtZjItIHwgdHIgLWQgJyInKQoKICAgICAgICAjIERldGVybWluZSBPUyBmYW1pbHkgZm9yIGJldHRlciBjYXRlZ29yaXphdGlvbgogICAgICAgIGZhbWlseT0iIgogICAgICAgIGNhc2UgIiRpZCIgaW4KICAgICAgICAgICAgdWJ1bnR1fGRlYmlhbikKICAgICAgICAgICAgICAgIGZhbWlseT0iRGViaWFuLWJhc2VkIgogICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgY2VudG9zfHJoZWx8cm9ja3l8YWxtYWxpbnV4fGZlZG9yYSkKICAgICAgICAgICAgICAgIGZhbWlseT0iUkhFTC1iYXNlZCIKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIGFyY2h8bWFuamFyb3xlbmRlYXZvdXJvcykKICAgICAgICAgICAgICAgIGZhbWlseT0iQXJjaC1iYXNlZCIKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgZXNhYwoKICAgICAgICAjIEZvcm1hdCBkaXN0cmlidXRpb24gc3RyaW5nIHdpdGggZmFtaWx5IGFuZCB2ZXJzaW9uCiAgICAgICAgaWYgWyAtbiAiJGZhbWlseSIgXTsgdGhlbgogICAgICAgICAgICBkaXN0cm89IiRmYW1pbHkgJHt2ZXJzaW9uOi19IgogICAgICAgICAgICBpZiBbIC1uICIkcHJldHR5IiBdOyB0aGVuCiAgICAgICAgICAgICAgICBkaXN0cm89IiRkaXN0cm8gKCR7cHJldHR5fSkiCiAgICAgICAgICAgIGZpCiAgICAgICAgZWxzZQogICAgICAgICAgICBkaXN0cm89IiR7cHJldHR5Oi1MaW51eCAkdmVyc2lvbn0iCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBkaXN0cm89IiRrZXJuZWxfbmFtZSIKICAgIGZpCgogICAgIyBDYWNoZSBhbmQgcmV0dXJuIHJlc3VsdAogICAgX0ZVQ0tfQ0FDSEVEX0RJU1RSTz0iJGRpc3RybyIKICAgIF9mdWNrX21hcmtfc3RhdGljX2NhY2hlX2RpcnR5CiAgICBwcmludGYgJyVzXG4nICIkZGlzdHJvIgp9CgojIEdldHMga2VybmVsIHZlcnNpb24gaW5mb3JtYXRpb24gd2l0aCBjYWNoaW5nCiMgT3V0cHV0czogS2VybmVsIHZlcnNpb24gc3RyaW5nIChlLmcuLCAiTGludXggNi44LjAtMzEtZ2VuZXJpYyIpCl9mdWNrX2dldF9rZXJuZWxfdmVyc2lvbigpIHsKICAgIF9mdWNrX2xvYWRfc3RhdGljX2NhY2hlCgogICAgIyBSZXR1cm4gY2FjaGVkIHZhbHVlIGlmIGF2YWlsYWJsZQogICAgaWYgWyAtbiAiJHtfRlVDS19DQUNIRURfS0VSTkVMOi19IiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICclc1xuJyAiJF9GVUNLX0NBQ0hFRF9LRVJORUwiCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgbG9jYWwga2VybmVsCiAgICBrZXJuZWw9JCh1bmFtZSAtc3IgMj4vZGV2L251bGwgfHwgdW5hbWUgLXMgMj4vZGV2L251bGwgfHwgcHJpbnRmICd1bmtub3duJykKICAgIGtlcm5lbD0kKHByaW50ZiAnJXMnICIka2VybmVsIiB8IHRyIC1kICdcclxuJykKCiAgICAjIENhY2hlIGFuZCByZXR1cm4gcmVzdWx0CiAgICBfRlVDS19DQUNIRURfS0VSTkVMPSIka2VybmVsIgogICAgX2Z1Y2tfbWFya19zdGF0aWNfY2FjaGVfZGlydHkKICAgIHByaW50ZiAnJXNcbicgIiRrZXJuZWwiCn0KCiMgR2V0cyBzeXN0ZW0gYXJjaGl0ZWN0dXJlIHdpdGggY2FjaGluZwojIE91dHB1dHM6IEFyY2hpdGVjdHVyZSBzdHJpbmcgKGUuZy4sICJ4ODZfNjQiLCAiYXJtNjQiKQpfZnVja19nZXRfYXJjaGl0ZWN0dXJlKCkgewogICAgX2Z1Y2tfbG9hZF9zdGF0aWNfY2FjaGUKCiAgICAjIFJldHVybiBjYWNoZWQgdmFsdWUgaWYgYXZhaWxhYmxlCiAgICBpZiBbIC1uICIke19GVUNLX0NBQ0hFRF9BUkNIOi19IiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICclc1xuJyAiJF9GVUNLX0NBQ0hFRF9BUkNIIgogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIGxvY2FsIGFyY2gKICAgIGFyY2g9JCh1bmFtZSAtbSAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQogICAgYXJjaD0kKHByaW50ZiAnJXMnICIkYXJjaCIgfCB0ciAtZCAnXHJcbicpCgogICAgIyBDYWNoZSBhbmQgcmV0dXJuIHJlc3VsdAogICAgX0ZVQ0tfQ0FDSEVEX0FSQ0g9IiRhcmNoIgogICAgX2Z1Y2tfbWFya19zdGF0aWNfY2FjaGVfZGlydHkKICAgIHByaW50ZiAnJXNcbicgIiRhcmNoIgp9CgojIENvbGxlY3RzIHVzZXIgaW5mb3JtYXRpb24gaW5jbHVkaW5nIHBlcm1pc3Npb25zCiMgT3V0cHV0czogVXNlciBpbmZvIHN0cmluZyAoZS5nLiwgIlVzZXI9am9obiB1aWQ9MTAwMCBsZXZlbD1zdWRvZXIgR3JvdXBzPWpvaG4gYWRtIHN1ZG8iKQpfZnVja19jb2xsZWN0X3VzZXJfaW5mbygpIHsKICAgIGxvY2FsIGN1cnJlbnRfdXNlciB1aWQgZ3JvdXBzIGxldmVsCiAgICBjdXJyZW50X3VzZXI9IiR7VVNFUjotfSIKCiAgICAjIEZhbGxiYWNrIGlmIFVTRVIgaXMgbm90IHNldAogICAgaWYgWyAteiAiJGN1cnJlbnRfdXNlciIgXTsgdGhlbgogICAgICAgIGN1cnJlbnRfdXNlcj0kKHdob2FtaSAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQogICAgZmkKCiAgICAjIEdldCBVSUQgYW5kIGdyb3VwcyBpZiBpZCBjb21tYW5kIGlzIGF2YWlsYWJsZQogICAgdWlkPSJ1bmtub3duIgogICAgZ3JvdXBzPSJ1bmtub3duIgogICAgaWYgY29tbWFuZCAtdiBpZCA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICB1aWQ9JChpZCAtdSAiJGN1cnJlbnRfdXNlciIgMj4vZGV2L251bGwgfHwgaWQgLXUgMj4vZGV2L251bGwgfHwgcHJpbnRmICd1bmtub3duJykKICAgICAgICBncm91cHM9JChpZCAtR24gIiRjdXJyZW50X3VzZXIiIDI+L2Rldi9udWxsIHx8IGlkIC1HbiAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQogICAgZmkKCiAgICAjIERldGVybWluZSBwZXJtaXNzaW9uIGxldmVsCiAgICBsZXZlbD0idXNlciIKICAgIGlmIFsgIiR1aWQiID0gIjAiIF07IHRoZW4KICAgICAgICBsZXZlbD0icm9vdCIKICAgIGVsaWYgcHJpbnRmICclcycgIiRncm91cHMiIHwgZ3JlcCAtRXEgJyhefFtbOnNwYWNlOl1dKShzdWRvfHdoZWVsfGFkbWluKShbWzpzcGFjZTpdXXwkKSc7IHRoZW4KICAgICAgICBsZXZlbD0ic3Vkb2VyIgogICAgZmkKCiAgICBwcmludGYgJ1VzZXI9JXMgdWlkPSVzIGxldmVsPSVzIEdyb3Vwcz0lcycgIiRjdXJyZW50X3VzZXIiICIkdWlkIiAiJGxldmVsIiAiJGdyb3VwcyIKfQoKIyBDb2xsZWN0cyB2ZXJzaW9uIGluZm9ybWF0aW9uIGZvciBjb21tb24gZGV2ZWxvcG1lbnQgdG9vbHMKIyBPdXRwdXRzOiBUb29sIHZlcnNpb25zIHN0cmluZyAoZS5nLiwgImdpdDpnaXQgdmVyc2lvbiAyLjM0LjE7IGRvY2tlcjpEb2NrZXIgdmVyc2lvbiAyNC4wLjY7IC4uLiIpCl9mdWNrX2NvbGxlY3RfdG9vbF92ZXJzaW9ucygpIHsKICAgIGxvY2FsIHRvb2xzIHRvb2wgdmVyc2lvbiByZXN1bHQKICAgIHRvb2xzPSJnaXQgZG9ja2VyIG5wbSBrdWJlY3RsIGN1cmwgd2dldCIKICAgIHJlc3VsdD0iIgoKICAgIGZvciB0b29sIGluICR0b29sczsgZG8KICAgICAgICB2ZXJzaW9uPSJub3QtaW5zdGFsbGVkIgoKICAgICAgICBpZiBjb21tYW5kIC12ICIkdG9vbCIgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgICAgIGNhc2UgIiR0b29sIiBpbgogICAgICAgICAgICAgICAgZ2l0fGRvY2tlcnxjdXJsfHdnZXQpCiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbj0kKCIkdG9vbCIgLS12ZXJzaW9uIDI+L2Rldi9udWxsIHwgaGVhZCAtbjEpCiAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgIG5wbSkKICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uPSQoIiR0b29sIiAtLXZlcnNpb24gMj4vZGV2L251bGwgfCBoZWFkIC1uMSkKICAgICAgICAgICAgICAgICAgICBbIC1uICIkdmVyc2lvbiIgXSAmJiB2ZXJzaW9uPSJucG0gJHZlcnNpb24iCiAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgIGt1YmVjdGwpCiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbj0kKCIkdG9vbCIgdmVyc2lvbiAtLWNsaWVudCAtLXNob3J0IDI+L2Rldi9udWxsIHwgaGVhZCAtbjEpCiAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgZXNhYwogICAgICAgIGZpCgogICAgICAgICMgQ2xlYW4gdXAgdmVyc2lvbiBzdHJpbmcKICAgICAgICB2ZXJzaW9uPSQocHJpbnRmICclcycgIiR7dmVyc2lvbjotdW5rbm93bn0iIHwgdHIgJ1xyXG4nICcgICcgfCB0ciAtcyAnICcgfCBzZWQgLWUgJ3MvXiAqLy8nIC1lICdzLyAqJC8vJykKICAgICAgICBbIC16ICIkdmVyc2lvbiIgXSAmJiB2ZXJzaW9uPSJ1bmtub3duIgoKICAgICAgICByZXN1bHQ9IiRyZXN1bHQkdG9vbDokdmVyc2lvbjsgIgogICAgZG9uZQoKICAgICMgUmVtb3ZlIHRyYWlsaW5nIHNlbWljb2xvbiBhbmQgc3BhY2UKICAgIHJlc3VsdD0iJHtyZXN1bHQlOyB9IgogICAgcHJpbnRmICclcycgIiRyZXN1bHQiCn0KCiMgRGV0ZWN0cyB0aGUgcGFja2FnZSBtYW5hZ2VyIHdpdGggY2FjaGluZyBzdXBwb3J0CiMgT3V0cHV0czogUGFja2FnZSBtYW5hZ2VyIG5hbWUgKGFwdCwgeXVtLCBkbmYsIHBhY21hbiwgenlwcGVyLCBicmV3LCB1bmtub3duKQpfZnVja19kZXRlY3RfcGtnX21hbmFnZXIoKSB7CiAgICBfZnVja19sb2FkX3N0YXRpY19jYWNoZQoKICAgICMgUmV0dXJuIGNhY2hlZCB2YWx1ZSBpZiBhdmFpbGFibGUKICAgIGlmIFsgLW4gIiR7X0ZVQ0tfQ0FDSEVEX1BLR19NQU5BR0VSOi19IiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICclc1xuJyAiJF9GVUNLX0NBQ0hFRF9QS0dfTUFOQUdFUiIKICAgICAgICByZXR1cm4gMAogICAgZmkKCiAgICBsb2NhbCBtYW5hZ2VyPSJ1bmtub3duIgoKICAgICMgRGV0ZWN0IHBhY2thZ2UgbWFuYWdlciBpbiBvcmRlciBvZiBwcmVmZXJlbmNlCiAgICBpZiBjb21tYW5kIC12IGFwdC1nZXQgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgbWFuYWdlcj0iYXB0IgogICAgZWxpZiBjb21tYW5kIC12IHl1bSAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBtYW5hZ2VyPSJ5dW0iCiAgICBlbGlmIGNvbW1hbmQgLXYgZG5mICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIG1hbmFnZXI9ImRuZiIKICAgIGVsaWYgY29tbWFuZCAtdiBwYWNtYW4gJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgbWFuYWdlcj0icGFjbWFuIgogICAgZWxpZiBjb21tYW5kIC12IHp5cHBlciAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBtYW5hZ2VyPSJ6eXBwZXIiCiAgICBlbGlmIGNvbW1hbmQgLXYgYnJldyAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBtYW5hZ2VyPSJicmV3IgogICAgZmkKCiAgICAjIENhY2hlIGFuZCByZXR1cm4gcmVzdWx0CiAgICBfRlVDS19DQUNIRURfUEtHX01BTkFHRVI9IiRtYW5hZ2VyIgogICAgX2Z1Y2tfbWFya19zdGF0aWNfY2FjaGVfZGlydHkKICAgIHByaW50ZiAnJXNcbicgIiRtYW5hZ2VyIgp9CgojIENvbGxlY3RzIHNpbXBsaWZpZWQgc3lzdGVtIGluZm9ybWF0aW9uIGFzIGEgc3RydWN0dXJlZCBzdHJpbmcKIyBPdXRwdXRzOiBTeXN0ZW0gaW5mbyBzdHJpbmcgZm9yIEFJIHByb2Nlc3NpbmcKX2Z1Y2tfY29sbGVjdF9zeXNpbmZvX3N0cmluZygpIHsKICAgIGxvY2FsIG9zX3R5cGUga2VybmVsX25hbWUgcGtnX21hbmFnZXIgc3VtbWFyeQoKICAgICMgRGV0ZWN0IG9wZXJhdGluZyBzeXN0ZW0gdHlwZQogICAga2VybmVsX25hbWU9JCh1bmFtZSAtcyAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQoKICAgIGNhc2UgIiRrZXJuZWxfbmFtZSIgaW4KICAgICAgICBEYXJ3aW4pCiAgICAgICAgICAgIG9zX3R5cGU9Im1hY09TIgogICAgICAgICAgICBwa2dfbWFuYWdlcj0iYnJldyIKICAgICAgICAgICAgOzsKICAgICAgICBMaW51eCkKICAgICAgICAgICAgaWYgWyAtciAvZXRjL29zLXJlbGVhc2UgXTsgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaWQKICAgICAgICAgICAgICAgIGlkPSQoZ3JlcCAtRSAnXklEPScgL2V0Yy9vcy1yZWxlYXNlIHwgaGVhZCAtbjEgfCBjdXQgLWQ9IC1mMiB8IHRyIC1kICciJyB8IHRyICdbOnVwcGVyOl0nICdbOmxvd2VyOl0nKQogICAgICAgICAgICAgICAgY2FzZSAiJGlkIiBpbgogICAgICAgICAgICAgICAgICAgIHVidW50dXxkZWJpYW4pCiAgICAgICAgICAgICAgICAgICAgICAgIG9zX3R5cGU9IkRlYmlhbiIKICAgICAgICAgICAgICAgICAgICAgICAgcGtnX21hbmFnZXI9ImFwdCIKICAgICAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgICAgICBjZW50b3N8cmhlbHxyb2NreXxhbG1hbGludXh8ZmVkb3JhKQogICAgICAgICAgICAgICAgICAgICAgICBvc190eXBlPSJSSEVMIgogICAgICAgICAgICAgICAgICAgICAgICBwa2dfbWFuYWdlcj0ieXVtIgogICAgICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAgICAgICAgIGFyY2h8bWFuamFybykKICAgICAgICAgICAgICAgICAgICAgICAgb3NfdHlwZT0iQXJjaCIKICAgICAgICAgICAgICAgICAgICAgICAgcGtnX21hbmFnZXI9InBhY21hbiIKICAgICAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgICAgICAqKQogICAgICAgICAgICAgICAgICAgICAgICBvc190eXBlPSJMaW51eCIKICAgICAgICAgICAgICAgICAgICAgICAgcGtnX21hbmFnZXI9InVua25vd24iCiAgICAgICAgICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgICAgICBlc2FjCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG9zX3R5cGU9IkxpbnV4IgogICAgICAgICAgICAgICAgcGtnX21hbmFnZXI9InVua25vd24iCiAgICAgICAgICAgIGZpCiAgICAgICAgICAgIDs7CiAgICAgICAgTUlOR1cqfE1TWVMqfENZR1dJTiopCiAgICAgICAgICAgIG9zX3R5cGU9IldpbmRvd3MiCiAgICAgICAgICAgIHBrZ19tYW5hZ2VyPSJ1bmtub3duIgogICAgICAgICAgICA7OwogICAgICAgICopCiAgICAgICAgICAgIG9zX3R5cGU9IiRrZXJuZWxfbmFtZSIKICAgICAgICAgICAgcGtnX21hbmFnZXI9InVua25vd24iCiAgICAgICAgICAgIDs7CiAgICBlc2FjCgogICAgIyBGb3JtYXQgYXMgc2ltcGxlIHN0cnVjdHVyZWQgc3RyaW5nCiAgICBwcmludGYgLXYgc3VtbWFyeSAnT1M9JXM7IFBrZ01ncj0lcycgIiRvc190eXBlIiAiJHBrZ19tYW5hZ2VyIgogICAgcHJpbnRmICclc1xuJyAiJHN1bW1hcnkiCn0KCiMgRXNjYXBlcyBhIHN0cmluZyBmb3IgdXNlIGluIGEgSlNPTiBwYXlsb2FkCl9mdWNrX2pzb25fZXNjYXBlKCkgewogICAgbG9jYWwgaW5wdXQ9IiQxIgogICAgIyBVc2UgcHJpbnRmIHRvIHByb3Blcmx5IGhhbmRsZSBjb250cm9sIGNoYXJhY3RlcnMKICAgIHByaW50ZiAnJXMnICIkaW5wdXQiIHwgc2VkIC1lICcKICAgICAgICAjIEZpcnN0IGVzY2FwZSBiYWNrc2xhc2hlcyAobXVzdCBiZSBmaXJzdCkKICAgICAgICBzL1xcL1xcXFwvZwogICAgICAgICMgRXNjYXBlIGRvdWJsZSBxdW90ZXMKICAgICAgICBzLyIvXFwiL2cKICAgICAgICAjIEVzY2FwZSBjb250cm9sIGNoYXJhY3RlcnMgKEFTQ0lJIDAtMzEpCiAgICAgICAgcy9ceDAwL1xcdTAwMDAvZwogICAgICAgIHMvXHgwMS9cXHUwMDAxL2cKICAgICAgICBzL1x4MDIvXFx1MDAwMi9nCiAgICAgICAgcy9ceDAzL1xcdTAwMDMvZwogICAgICAgIHMvXHgwNC9cXHUwMDA0L2cKICAgICAgICBzL1x4MDUvXFx1MDAwNS9nCiAgICAgICAgcy9ceDA2L1xcdTAwMDYvZwogICAgICAgIHMvXHgwNy9cXHUwMDA3L2cKICAgICAgICBzL1x4MDgvXFxiL2cKICAgICAgICBzL1x4MDkvXFx0L2cKICAgICAgICBzL1x4MEEvXFxuL2cKICAgICAgICBzL1x4MEIvXFx1MDAwQi9nCiAgICAgICAgcy9ceDBDL1xcZi9nCiAgICAgICAgcy9ceDBEL1xcci9nCiAgICAgICAgcy9ceDBFL1xcdTAwMEUvZwogICAgICAgIHMvXHgwRi9cXHUwMDBGL2cKICAgICAgICBzL1x4MTAvXFx1MDAxMC9nCiAgICAgICAgcy9ceDExL1xcdTAwMTEvZwogICAgICAgIHMvXHgxMi9cXHUwMDEyL2cKICAgICAgICBzL1x4MTMvXFx1MDAxMy9nCiAgICAgICAgcy9ceDE0L1xcdTAwMTQvZwogICAgICAgIHMvXHgxNS9cXHUwMDE1L2cKICAgICAgICBzL1x4MTYvXFx1MDAxNi9nCiAgICAgICAgcy9ceDE3L1xcdTAwMTcvZwogICAgICAgIHMvXHgxOC9cXHUwMDE4L2cKICAgICAgICBzL1x4MTkvXFx1MDAxOS9nCiAgICAgICAgcy9ceDFBL1xcdTAwMUEvZwogICAgICAgIHMvXHgxQi9cXHUwMDFCL2cKICAgICAgICBzL1x4MUMvXFx1MDAxQy9nCiAgICAgICAgcy9ceDFEL1xcdTAwMUQvZwogICAgICAgIHMvXHgxRS9cXHUwMDFFL2cKICAgICAgICBzL1x4MUYvXFx1MDAxRi9nCiAgICAnCn0KCl9mdWNrX3Nob3VsZF91c2VfbG9jYWxfYXBpKCkgewogICAgaWYgWyAtbiAiJHtGVUNLX09QRU5BSV9BUElfS0VZOi19IiBdOyB0aGVuCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCiAgICByZXR1cm4gMQp9CgpfZnVja19sb2NhbF9zeXN0ZW1fcHJvbXB0KCkgewogICAgbG9jYWwgc3lzaW5mbz0iJDEiCiAgICBpZiBbICIkRlVDS0lUU19MT0NBTEUiID0gInpoIiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICfkvaDmmK/kuIDkuKrkuJPkuJrnmoQgc2hlbGwg6ISa5pys55Sf5oiQ5Zmo44CC55So5oi35Lya5o+Q5L6b5LuW5Lus55qE57O757uf5L+h5oGv5ZKM5LiA5Liq5ZG95Luk44CC5L2g55qE5Lu75Yqh5piv6L+U5Zue5LiA5Liq5Y+v5omn6KGM55qE44CB5Y6f5aeL55qEIHNoZWxsIOiEmuacrOadpeWujOaIkOS7luS7rOeahOebruagh+OAguiEmuacrOWPr+S7peaYr+WkmuihjOeahOOAguS4jeimgeaPkOS+m+S7u+S9leino+mHiuOAgeazqOmHiuOAgW1hcmtkb3duIOagvOW8j++8iOavlOWmgiBgYGBiYXNo77yJ5oiWIHNoZWJhbmfvvIjkvovlpoIgIyEvYmluL2Jhc2jvvInjgILlj6rpnIDopoHljp/lp4vnmoTohJrmnKzlhoXlrrnjgILnlKjmiLfnmoTns7vnu5/kv6Hmga/mmK/vvJolcycgIiRzeXNpbmZvIgogICAgZWxzZQogICAgICAgIHByaW50ZiAnWW91IGFyZSBhbiBleHBlcnQgc2hlbGwgc2NyaXB0IGdlbmVyYXRvci4gQSB1c2VyIHdpbGwgcHJvdmlkZSB0aGVpciBzeXN0ZW0gaW5mb3JtYXRpb24gYW5kIGEgcHJvbXB0LiBZb3VyIHRhc2sgaXMgdG8gcmV0dXJuIGEgcmF3LCBleGVjdXRhYmxlIHNoZWxsIHNjcmlwdCB0aGF0IGFjY29tcGxpc2hlcyB0aGVpciBnb2FsLiBUaGUgc2NyaXB0IGNhbiBiZSBtdWx0aS1saW5lLiBEbyBub3QgcHJvdmlkZSBhbnkgZXhwbGFuYXRpb24sIGNvbW1lbnRzLCBtYXJrZG93biBmb3JtYXR0aW5nIChsaWtlIGBgYGJhc2gpLCBvciBhIHNoZWJhbmcgKGUuZy4sICMhL2Jpbi9iYXNoKS4gSnVzdCB0aGUgcmF3IHNjcmlwdCBjb250ZW50LiBUaGUgdXNlciciJyIncyBzeXN0ZW0gaW5mbyBpczogJXMnICIkc3lzaW5mbyIKICAgIGZpCn0KCl9mdWNrX2V4dHJhY3RfY29tbWFuZF9mcm9tX2pzb24oKSB7CiAgICBsb2NhbCBqc29uX2ZpbGU9IiQxIgogICAgaWYgY29tbWFuZCAtdiBweXRob24zID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgIHB5dGhvbjMgLSAiJGpzb25fZmlsZSIgPDwnUFknCmltcG9ydCBqc29uLCBzeXMKcGF0aCA9IHN5cy5hcmd2WzFdCndpdGggb3BlbihwYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICBkYXRhID0ganNvbi5sb2FkKGYpCmNob2ljZXMgPSBkYXRhLmdldCgnY2hvaWNlcycpIG9yIFtdCmlmIG5vdCBjaG9pY2VzOgogICAgc3lzLmV4aXQoMSkKbWVzc2FnZSA9IGNob2ljZXNbMF0uZ2V0KCdtZXNzYWdlJykgb3Ige30KY29udGVudCA9IChtZXNzYWdlLmdldCgnY29udGVudCcpIG9yICcnKS5zdHJpcCgpCmlmIG5vdCBjb250ZW50OgogICAgc3lzLmV4aXQoMSkKcHJpbnQoY29udGVudCkKUFkKICAgICAgICByZXR1cm4KICAgIGZpCgogICAgaWYgY29tbWFuZCAtdiBub2RlID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgIG5vZGUgLSAiJGpzb25fZmlsZSIgPDwnSlMnCmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTsKY29uc3QgcGF0aCA9IHByb2Nlc3MuYXJndlsxXTsKY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHBhdGgsICd1dGY4JykpOwpjb25zdCBjaG9pY2UgPSAoZGF0YS5jaG9pY2VzICYmIGRhdGEuY2hvaWNlc1swXSkgfHwge307CmNvbnN0IG1lc3NhZ2UgPSBjaG9pY2UubWVzc2FnZSB8fCB7fTsKY29uc3QgY29udGVudCA9IChtZXNzYWdlLmNvbnRlbnQgfHwgJycpLnRyaW0oKTsKaWYgKCFjb250ZW50KSB7CiAgcHJvY2Vzcy5leGl0KDEpOwp9CmNvbnNvbGUubG9nKGNvbnRlbnQpOwpKUwogICAgICAgIHJldHVybgogICAgZmkKCiAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfUNhbm5vdCBwYXJzZSBBSSByZXNwb25zZSBiZWNhdXNlIG5laXRoZXIgcHl0aG9uMyBub3Igbm9kZSBpcyBhdmFpbGFibGUuJHtDX1JFU0VUfSIgPiYyCiAgICBlY2hvIC1lICIke0NfWUVMTE9XfVBsZWFzZSBpbnN0YWxsIHB5dGhvbjMgb3Igbm9kZSB0byB1c2UgbG9jYWwgQVBJIG1vZGUuJHtDX1JFU0VUfSIgPiYyCiAgICByZXR1cm4gMQp9CgpfZnVja19yZXF1ZXN0X2xvY2FsX21vZGVsKCkgewogICAgbG9jYWwgcHJvbXB0PSIkMSIKICAgIGxvY2FsIHN5c2luZm89IiQyIgogICAgbG9jYWwgY3VybF90aW1lb3V0PSIkMyIKCiAgICBsb2NhbCBhcGlfa2V5PSIke0ZVQ0tfT1BFTkFJX0FQSV9LRVk6LX0iCiAgICBpZiBbIC16ICIkYXBpX2tleSIgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9TG9jYWwgQVBJIGtleSBub3QgY29uZmlndXJlZC4gU2V0IEZVQ0tfT1BFTkFJX0FQSV9LRVkgaW4gfi8uZnVjay9jb25maWcuc2guJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgbG9jYWwgbW9kZWw9IiR7RlVDS19PUEVOQUlfTU9ERUw6LWdwdC01LW5hbm99IgogICAgbG9jYWwgYXBpX2Jhc2U9IiR7RlVDS19PUEVOQUlfQVBJX0JBU0U6LWh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjF9IgogICAgYXBpX2Jhc2U9JHthcGlfYmFzZSUvfQogICAgbG9jYWwgYXBpX3VybD0iJGFwaV9iYXNlL2NoYXQvY29tcGxldGlvbnMiCgogICAgX2Z1Y2tfZGVidWcgImxvY2FsIGFwaSBiYXNlPSRhcGlfYmFzZSIKICAgIF9mdWNrX2RlYnVnICJsb2NhbCBtb2RlbD0kbW9kZWwiCgogICAgbG9jYWwgc3lzdGVtX3Byb21wdAogICAgc3lzdGVtX3Byb21wdD0kKF9mdWNrX2xvY2FsX3N5c3RlbV9wcm9tcHQgIiRzeXNpbmZvIikKCiAgICBsb2NhbCBlc2NhcGVkX3Byb21wdCBlc2NhcGVkX3N5c3RlbQogICAgZXNjYXBlZF9wcm9tcHQ9JChfZnVja19qc29uX2VzY2FwZSAiJHByb21wdCIpCiAgICBlc2NhcGVkX3N5c3RlbT0kKF9mdWNrX2pzb25fZXNjYXBlICIkc3lzdGVtX3Byb21wdCIpCiAgICBsb2NhbCBwYXlsb2FkCiAgICBwYXlsb2FkPSQocHJpbnRmICd7ICJtb2RlbCI6ICIlcyIsICJtZXNzYWdlcyI6IFsgeyJyb2xlIjoic3lzdGVtIiwiY29udGVudCI6IiVzIn0sIHsicm9sZSI6InVzZXIiLCJjb250ZW50IjoiJXMifSBdLCAibWF4X3Rva2VucyI6IDEwMjQsICJ0ZW1wZXJhdHVyZSI6IDAuMiB9JyBcCiAgICAgICAgIiRtb2RlbCIgIiRlc2NhcGVkX3N5c3RlbSIgIiRlc2NhcGVkX3Byb21wdCIpCgogICAgbG9jYWwgdG1wX2pzb24KICAgIHRtcF9qc29uPSQobWt0ZW1wKSB8fCByZXR1cm4gMQoKICAgIGlmICEgY3VybCAtZnNTIC0tbWF4LXRpbWUgIiRjdXJsX3RpbWVvdXQiICIkYXBpX3VybCIgXAogICAgICAgIC1IICJDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2pzb24iIFwKICAgICAgICAtSCAiQXV0aG9yaXphdGlvbjogQmVhcmVyICRhcGlfa2V5IiBcCiAgICAgICAgLWQgIiRwYXlsb2FkIiA+ICIkdG1wX2pzb24iOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1Mb2NhbCBBUEkgcmVxdWVzdCBmYWlsZWQuJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgY2F0ICIkdG1wX2pzb24iID4mMgogICAgICAgIHJtIC1mICIkdG1wX2pzb24iCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgbG9jYWwgY29tbWFuZF9vdXRwdXQKICAgIGlmICEgY29tbWFuZF9vdXRwdXQ9JChfZnVja19leHRyYWN0X2NvbW1hbmRfZnJvbV9qc29uICIkdG1wX2pzb24iKTsgdGhlbgogICAgICAgIHJtIC1mICIkdG1wX2pzb24iCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1VbmFibGUgdG8gcGFyc2UgbG9jYWwgbW9kZWwgcmVzcG9uc2UuJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgcm0gLWYgIiR0bXBfanNvbiIKICAgIHByaW50ZiAnJXNcbicgIiRjb21tYW5kX291dHB1dCIKfQoKX2Z1Y2tfcmVxdWVzdF93b3JrZXJfbW9kZWwoKSB7CiAgICBsb2NhbCBwcm9tcHQ9IiQxIgogICAgbG9jYWwgc3lzaW5mbz0iJDIiCiAgICBsb2NhbCBjdXJsX3RpbWVvdXQ9IiQzIgoKICAgIGxvY2FsIGFkbWluX2tleT0iJHtGVUNLX0FETUlOX0tFWTotfSIKICAgIGxvY2FsIGFkbWluX3NlZ21lbnQ9IiIKICAgIGlmIFsgLW4gIiRhZG1pbl9rZXkiIF07IHRoZW4KICAgICAgICBhZG1pbl9zZWdtZW50PSQocHJpbnRmICcsICJhZG1pbktleSI6ICIlcyInICIkKCBfZnVja19qc29uX2VzY2FwZSAiJGFkbWluX2tleSIgKSIpCiAgICBmaQoKICAgIGxvY2FsIHBheWxvYWQKICAgIHBheWxvYWQ9JChwcmludGYgJ3sgInN5c2luZm8iOiAiJXMiLCAicHJvbXB0IjogIiVzIiVzIH0nIFwKICAgICAgICAiJCggX2Z1Y2tfanNvbl9lc2NhcGUgIiRzeXNpbmZvIiApIiBcCiAgICAgICAgIiQoIF9mdWNrX2pzb25fZXNjYXBlICIkcHJvbXB0IiApIiBcCiAgICAgICAgIiRhZG1pbl9zZWdtZW50IikKCiAgICBsb2NhbCBhcGlfdXJsPSIke0ZVQ0tfQVBJX0VORFBPSU5UOi0kREVGQVVMVF9BUElfRU5EUE9JTlR9IgoKICAgIF9mdWNrX2RlYnVnICJBUEkgVVJMOiAkYXBpX3VybCIKICAgIF9mdWNrX2RlYnVnICJQYXlsb2FkOiAkcGF5bG9hZCIKICAgIF9mdWNrX2RlYnVnICJUaW1lb3V0OiAkY3VybF90aW1lb3V0IgoKICAgIGxvY2FsIHRtcF9yZXNwb25zZSB0bXBfc3RhdHVzCiAgICB0bXBfcmVzcG9uc2U9JChta3RlbXApCiAgICB0bXBfc3RhdHVzPSQobWt0ZW1wKQoKICAgICgKICAgICAgICBjdXJsIC1zUyAtLW1heC10aW1lICIkY3VybF90aW1lb3V0IiAtWCBQT1NUICIkYXBpX3VybCIgXAogICAgICAgICAgICAtSCAiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uIiBcCiAgICAgICAgICAgIC1kICIkcGF5bG9hZCIgLW8gIiR0bXBfcmVzcG9uc2UiIC13ICIle2h0dHBfY29kZX0iID4gIiR0bXBfc3RhdHVzIgogICAgKSAmCiAgICBsb2NhbCBwaWQ9JCEKCiAgICBpZiBbIC10IDIgXTsgdGhlbgogICAgICAgIF9mdWNrX3NwaW5uZXIgIiRwaWQiID4mMgogICAgZmkKCiAgICBsb2NhbCBjdXJsX2V4aXQ9MAogICAgaWYgISB3YWl0ICIkcGlkIjsgdGhlbgogICAgICAgIGN1cmxfZXhpdD0kPwogICAgZmkKCiAgICBsb2NhbCBodHRwX3N0YXR1cz0iIgogICAgaWYgWyAtZiAiJHRtcF9zdGF0dXMiIF07IHRoZW4KICAgICAgICBodHRwX3N0YXR1cz0kKHRyIC1kICdcclxuJyA8ICIkdG1wX3N0YXR1cyIpCiAgICAgICAgcm0gLWYgIiR0bXBfc3RhdHVzIgogICAgZmkKCiAgICBsb2NhbCByZXNwb25zZT0iIgogICAgaWYgWyAtZiAiJHRtcF9yZXNwb25zZSIgXTsgdGhlbgogICAgICAgIHJlc3BvbnNlPSQoY2F0ICIkdG1wX3Jlc3BvbnNlIikKICAgICAgICBybSAtZiAiJHRtcF9yZXNwb25zZSIKICAgIGZpCgogICAgaWYgWyAkY3VybF9leGl0IC1uZSAwIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfUZhaWxlZCB0byByZWFjaCB0aGUgc2hhcmVkIFdvcmtlci4ke0NfUkVTRVR9IiA+JjIKICAgICAgICBpZiBbIC1uICIkcmVzcG9uc2UiIF07IHRoZW4KICAgICAgICAgICAgZWNobyAtZSAiJHtDX0RJTX0kcmVzcG9uc2Uke0NfUkVTRVR9IiA+JjIKICAgICAgICBmaQogICAgICAgIHJldHVybiAkY3VybF9leGl0CiAgICBmaQoKICAgIGlmIFsgLXogIiRodHRwX3N0YXR1cyIgXTsgdGhlbgogICAgICAgIGh0dHBfc3RhdHVzPTAKICAgIGZpCgogICAgaWYgWyAiJGh0dHBfc3RhdHVzIiAtZXEgNDI5IF0gJiYgcHJpbnRmICclcycgIiRyZXNwb25zZSIgfCBncmVwIC1xICdERU1PX0xJTUlUX0VYQ0VFREVEJzsgdGhlbgogICAgICAgIGxvY2FsIGxpbWl0CiAgICAgICAgbGltaXQ9JChwcmludGYgJyVzJyAiJHJlc3BvbnNlIiB8IHNlZCAtbiAncy8uKiJsaW1pdCI6W1s6c3BhY2U6XV0qXChbMC05XVwrXCkuKi9cMS9wJyB8IGhlYWQgLW4xKQogICAgICAgIGxvY2FsIHJlbWFpbmluZwogICAgICAgIHJlbWFpbmluZz0kKHByaW50ZiAnJXMnICIkcmVzcG9uc2UiIHwgc2VkIC1uICdzLy4qInJlbWFpbmluZyI6W1s6c3BhY2U6XV0qXChbMC05XVwrXCkuKi9cMS9wJyB8IGhlYWQgLW4xKQogICAgICAgIFsgLXogIiRsaW1pdCIgXSAmJiBsaW1pdD0xMAogICAgICAgIF9mdWNrX25vdGlmeV9kZW1vX2xpbWl0ICIkbGltaXQiICIkcmVtYWluaW5nIgogICAgICAgIHJldHVybiAyCiAgICBmaQoKICAgIGlmIFsgIiRodHRwX3N0YXR1cyIgLWdlIDQwMCBdIHx8IFsgLXogIiRyZXNwb25zZSIgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9U2hhcmVkIFdvcmtlciByZXR1cm5lZCBIVFRQICRodHRwX3N0YXR1cy4ke0NfUkVTRVR9IiA+JjIKICAgICAgICBpZiBbIC1uICIkcmVzcG9uc2UiIF07IHRoZW4KICAgICAgICAgICAgZWNobyAtZSAiJHtDX0RJTX0kcmVzcG9uc2Uke0NfUkVTRVR9IiA+JjIKICAgICAgICBmaQogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgIHByaW50ZiAnJXNcbicgIiRyZXNwb25zZSIKfQoKX2Z1Y2tfbm90aWZ5X2RlbW9fbGltaXQoKSB7CiAgICBsb2NhbCBkYWlseV9saW1pdD0iJHsxOi0xMH0iCiAgICBsb2NhbCByZW1haW5pbmc9IiR7MjotMH0iCgogICAgZWNobyAtZSAiJEZVQ0sgJHtDX1lFTExPV31TaGFyZWQgZGVtbyBxdW90YSBleGhhdXN0ZWQgKCR7ZGFpbHlfbGltaXR9IGNhbGxzIHBlciBkYXkpLiR7Q19SRVNFVH0iID4mMgogICAgY2FzZSAiJHJlbWFpbmluZyIgaW4KICAgICAgICAnJ3wqWyEwLTldKikgOzsKICAgICAgICAqKQogICAgICAgICAgICBpZiBbICIkcmVtYWluaW5nIiAtZ3QgMCBdOyB0aGVuCiAgICAgICAgICAgICAgICBlY2hvIC1lICIke0NfRElNfSRyZW1haW5pbmcgY2FsbHMgbGVmdCBmb3IgdG9kYXkuJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgICAgIGZpCiAgICAgICAgICAgIDs7CiAgICBlc2FjCgogICAgX2Z1Y2tfZW5zdXJlX2NvbmZpZ19leGlzdHMKICAgIF9mdWNrX3NlY3VyZV9jb25maWdfZmlsZQoKICAgIGVjaG8gLWUgIiR7Q19DWUFOfVN3aXRjaCB0byB5b3VyIG93biBrZXk6JHtDX1JFU0VUfSBydW4gJHtDX0dSRUVOfWZ1Y2sgY29uZmlnJHtDX1JFU0VUfSBhbmQgc2V0ICR7Q19CT0xEfUZVQ0tfT1BFTkFJX0FQSV9LRVkke0NfUkVTRVR9IChwbHVzIG9wdGlvbmFsICR7Q19CT0xEfUZVQ0tfT1BFTkFJX01PREVMJHtDX1JFU0VUfS8ke0NfQk9MRH1GVUNLX09QRU5BSV9BUElfQkFTRSR7Q19SRVNFVH0pLiIgPiYyCiAgICBlY2hvIC1lICIke0NfQ1lBTn1UcnVzdGVkIG1haW50YWluZXIgb3ZlcnJpZGU6JHtDX1JFU0VUfSBzZXQgJHtDX0JPTER9RlVDS19BRE1JTl9LRVkke0NfUkVTRVR9IGlmIHlvdSB3ZXJlIGlzc3VlZCB0aGUgd29ya2VyJ3MgQURNSU5fQUNDRVNTX0tFWSB0byBieXBhc3MgdGhlIHNoYXJlZCBxdW90YS4iID4mMgogICAgZWNobyAtZSAiJHtDX0NZQU59Q29uZmlnIHBhdGg6JHtDX1JFU0VUfSAke0NfR1JFRU59JENPTkZJR19GSUxFJHtDX1JFU0VUfSIgPiYyCiAgICBpZiBbIC1uICIke0VESVRPUjotfSIgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9SGludDoke0NfUkVTRVR9ICR7RURJVE9SfSBcIiRDT05GSUdfRklMRVwiIiA+JjIKICAgIGZpCiAgICBlY2hvIC1lICIke0NfRElNfVNlY3VyaXR5OiR7Q19SRVNFVH0gdGhlIGZpbGUgcGVybWlzc2lvbnMgYXJlIGxvY2tlZCB0byA2MDAgc28gdGhlIGtleSBzdGF5cyBsb2NhbC4iID4mMgp9CgojIFNpbXBsZSBoZWxwZXIgdG8gcGFyc2UgYm9vbGVhbi1saWtlIHZhbHVlcwpfZnVja190cnV0aHkoKSB7CiAgICBsb2NhbCB2YWx1ZT0iJHsxOi19IgogICAgbG9jYWwgbm9ybWFsaXplZAogICAgbm9ybWFsaXplZD0kKHByaW50ZiAnJXMnICIkdmFsdWUiIHwgdHIgJ1s6dXBwZXI6XScgJ1s6bG93ZXI6XScpCiAgICBjYXNlICIkbm9ybWFsaXplZCIgaW4KICAgICAgICAxfHRydWV8eWVzfHl8b24pCiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIDs7CiAgICAgICAgKikKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgOzsKICAgIGVzYWMKfQoKIyBEZWJ1ZyBoZWxwZXIKX2Z1Y2tfZGVidWcoKSB7CiAgICBpZiBfZnVja190cnV0aHkgIiR7RlVDS19ERUJVRzotMH0iOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJHtDX0RJTX1bZGVidWddICQqJHtDX1JFU0VUfSIgPiYyCiAgICBmaQp9CgojIFNwaW5uZXIgYW5pbWF0aW9uCl9mdWNrX3NwaW5uZXIoKSB7CiAgICBsb2NhbCBwaWQ9JDEKICAgIGxvY2FsIGRlbGF5PTAuMQogICAgbG9jYWwgc3BpbnN0cj0n4qCL4qCZ4qC54qC44qC84qC04qCm4qCn4qCH4qCPJwogICAgCiAgICAjIEhpZGUgY3Vyc29yCiAgICB0cHV0IGNpdmlzIDI+L2Rldi9udWxsIHx8IHByaW50ZiAiXDAzM1s/MjVsIgoKICAgIHdoaWxlIGtpbGwgLTAgIiRwaWQiIDI+L2Rldi9udWxsOyBkbwogICAgICAgIGxvY2FsIHRlbXA9JHtzcGluc3RyIz99CiAgICAgICAgcHJpbnRmICIgJWMgIiAiJHNwaW5zdHIiCiAgICAgICAgbG9jYWwgc3BpbnN0cj0kdGVtcCR7c3BpbnN0ciUiJHRlbXAifQogICAgICAgIHNsZWVwICRkZWxheQogICAgICAgIHByaW50ZiAiXGJcYlxiIgogICAgZG9uZQogICAgcHJpbnRmICIgICBcYlxiXGIiCiAgICAKICAgICMgU2hvdyBjdXJzb3IKICAgIHRwdXQgY25vcm0gMj4vZGV2L251bGwgfHwgcHJpbnRmICJcMDMzWz8yNWgiCn0KCiMgRGV0ZWN0cyBwb3RlbnRpYWxseSBkYW5nZXJvdXMgY29tbWFuZHMgYW5kIHByaW50cyBhIHdhcm5pbmcKIyAtLS0gU2VjdXJpdHkgRGV0ZWN0aW9uIEVuZ2luZSAoUGhhc2UgMikgLS0tCgojIEJsb2NrLWxldmVsIHNlY3VyaXR5IHJ1bGVzIChoaWdoZXN0IHNldmVyaXR5IC0gZXhlY3V0aW9uIGRlbmllZCkKIyBGb3JtYXQ6ICdwYXR0ZXJufHx8cmVhc29uJwppZiBbIC16ICIke19GVUNLX1NFQ1VSSVRZX0JMT0NLX1JVTEVTOi19IiBdOyB0aGVuCiAgICByZWFkb25seSAtYSBfRlVDS19TRUNVUklUWV9CTE9DS19SVUxFUz0oCiAgICAgICAgJyhefFs7JnxbOnNwYWNlOl1dKXJtW1s6c3BhY2U6XV0rLXJmW1s6c3BhY2U6XV0rLyhbWzpzcGFjZTpdXXwkKXx8fFJlY3Vyc2l2ZSBkZWxldGUgdGFyZ2V0aW5nIHJvb3QgZmlsZXN5c3RlbScKICAgICAgICAncm1bWzpzcGFjZTpdXSstcmZbWzpzcGFjZTpdXSsvXCp8fHxSZWN1cnNpdmUgZGVsZXRlIHVzaW5nIC8qIHVuZGVyIHJvb3QnCiAgICAgICAgJ3JtW1s6c3BhY2U6XV0rLXJmW1s6c3BhY2U6XV0rLS1uby1wcmVzZXJ2ZS1yb290fHx8cm0gLS1uby1wcmVzZXJ2ZS1yb290IGFnYWluc3QgLycKICAgICAgICAncm1bWzpzcGFjZTpdXSstcmZbWzpzcGFjZTpdXStcLlwqfHx8UmVjdXJzaXZlIGRlbGV0ZSB0YXJnZXRpbmcgaGlkZGVuL3N5c3RlbSBmaWxlcycKICAgICAgICAnXGJkZFxiW14jXG5dKlxiKG9mfGlmKT0vZGV2L3x8fFJhdyBkaXNrIHdyaXRlIHZpYSBkZCB0YXJnZXRpbmcgL2RldiBkZXZpY2VzJwogICAgICAgICdcYm1rZnMoXC5cdyspP1xifHx8RmlsZXN5c3RlbSBmb3JtYXQgY29tbWFuZCBkZXRlY3RlZCcKICAgICAgICAnXGJmZGlza1xifFxicGFydGVkXGJ8XGJmb3JtYXRcYnxcYndpcGVmc1xifFxic2hyZWRcYnx8fFBhcnRpdGlvbiBvciBkaXNrIHdpcGUgY29tbWFuZCBkZXRlY3RlZCcKICAgICAgICAnOlwoXClccyp7XHMqOlxzKlx8XHMqOjtccyp9XHMqOz9ccyo6fHx8Rm9yayBib21iIGZ1bmN0aW9uIGRldGVjdGVkJwogICAgKQpmaQoKIyBDaGFsbGVuZ2UtbGV2ZWwgc2VjdXJpdHkgcnVsZXMgKHJlcXVpcmVzIGV4cGxpY2l0IHVzZXIgY29uZmlybWF0aW9uKQojIEZvcm1hdDogJ3BhdHRlcm58fHxyZWFzb24nCmlmIFsgLXogIiR7X0ZVQ0tfU0VDVVJJVFlfQ0hBTExFTkdFX1JVTEVTOi19IiBdOyB0aGVuCiAgICByZWFkb25seSAtYSBfRlVDS19TRUNVUklUWV9DSEFMTEVOR0VfUlVMRVM9KAogICAgICAgICdjdXJsW158XSpcfFxzKihiYXNofHNoKXx8fFJlbW90ZSBzY3JpcHQgZXhlY3V0aW9uIHZpYSBjdXJsIHBpcGVsaW5lJwogICAgICAgICd3Z2V0W158XSpcfFxzKihiYXNofHNoKXx8fFJlbW90ZSBzY3JpcHQgZXhlY3V0aW9uIHZpYSB3Z2V0IHBpcGVsaW5lJwogICAgICAgICdcYnNvdXJjZVxzK2h0dHBzPzovL3x8fFNvdXJjaW5nIGEgcmVtb3RlIGZpbGUgb3ZlciBIVFRQKFMpJwogICAgICAgICdcYmV2YWxcYnxcYmV4ZWNcYnx8fEV4cGxpY2l0IGV2YWwvZXhlYyB1c2FnZScKICAgICAgICAnXCRcKFteKV0qXCl8fHxDb21tYW5kIHN1YnN0aXR1dGlvbiB1c2luZyAkKCknCiAgICAgICAgJ2BbXmBdKmB8fHxDb21tYW5kIHN1YnN0aXR1dGlvbiB1c2luZyBiYWNrdGlja3MnCiAgICAgICAgJ1xiKHNofGJhc2h8ZW52KVxzKy1jXGJ8fHxOZXN0ZWQgc2hlbGwgaW52b2NhdGlvbiB0aHJvdWdoIC1jJwogICAgICAgICdcYnB5dGhvblswLTkuXSpccystY1xifHx8SW5saW5lIGludGVycHJldGVyIGV4ZWN1dGlvbiB2aWEgLWMnCiAgICAgICAgJyhefFs7JnxbOnNwYWNlOl1dKShjcHxtdnxybXxjaG1vZHxjaG93bnxzZWR8dGVlfGNhdClbXjsmfF0qXGIvKGV0Y3xib290fHN5c3xwcm9jfGRldilcYnx8fE9wZXJhdGlvbiB0b3VjaGVzIGNyaXRpY2FsIHN5c3RlbSBwYXRocycKICAgICkKZmkKCiMgV2Fybi1sZXZlbCBzZWN1cml0eSBydWxlcyAod2FybmluZyBvbmx5LCB1c2VyIGNhbiBwcm9jZWVkKQojIEZvcm1hdDogJ3BhdHRlcm58fHxyZWFzb24nCmlmIFsgLXogIiR7X0ZVQ0tfU0VDVVJJVFlfV0FSTl9SVUxFUzotfSIgXTsgdGhlbgogICAgcmVhZG9ubHkgLWEgX0ZVQ0tfU0VDVVJJVFlfV0FSTl9SVUxFUz0oCiAgICAgICAgJ3JtW1s6c3BhY2U6XV0rLXJmXGJ8fHxSZWN1cnNpdmUgZGVsZXRlIHJlcXVlc3QgZGV0ZWN0ZWQnCiAgICAgICAgJ2NobW9kW1s6c3BhY2U6XV0rLio3NzdcYnx8fFdvcmxkLXdyaXRhYmxlIHBlcm1pc3Npb24gY2hhbmdlIGRldGVjdGVkJwogICAgICAgICdzdWRvW1s6c3BhY2U6XV0rW147JnxdKnJtW1s6c3BhY2U6XV0rLXJmfHx8c3VkbyBybSAtcmYgZGV0ZWN0ZWQnCiAgICAgICAgJz5bWzpzcGFjZTpdXSovKGV0Yy8ocGFzc3dkfHNoYWRvd3xzdWRvZXJzKXxkZXYvc2RbYS16XSspfHx8T3V0cHV0IHJlZGlyZWN0aW9uIGludG8gc2Vuc2l0aXZlIHN5c3RlbSBmaWxlcycKICAgICkKZmkKCiMgR2V0cyB0aGUgY3VycmVudCBzZWN1cml0eSBtb2RlIGZyb20gY29uZmlndXJhdGlvbgojIE91dHB1dHM6ICJzdHJpY3QiLCAiYmFsYW5jZWQiLCBvciAib2ZmIgpfZnVja19zZWN1cml0eV9tb2RlKCkgewogICAgbG9jYWwgbW9kZT0iJHtGVUNLX1NFQ1VSSVRZX01PREU6LWJhbGFuY2VkfSIKICAgIG1vZGU9JChwcmludGYgJyVzJyAiJG1vZGUiIHwgdHIgJ1s6dXBwZXI6XScgJ1s6bG93ZXI6XScpCgogICAgY2FzZSAiJG1vZGUiIGluCiAgICAgICAgc3RyaWN0KSBwcmludGYgJ3N0cmljdFxuJyA7OwogICAgICAgIG9mZnxkaXNhYmxlZHxub25lKSBwcmludGYgJ29mZlxuJyA7OwogICAgICAgIGJhbGFuY2VkfGRlZmF1bHR8IiIpIHByaW50ZiAnYmFsYW5jZWRcbicgOzsKICAgICAgICAqKSBwcmludGYgJ2JhbGFuY2VkXG4nIDs7CiAgICBlc2FjCn0KCiMgR2V0cyB0aGUgZGVmYXVsdCBjaGFsbGVuZ2UgdGV4dCBmb3Igc2VjdXJpdHkgY29uZmlybWF0aW9ucwojIE91dHB1dHM6IERlZmF1bHQgY2hhbGxlbmdlIHBocmFzZQpfZnVja19zZWN1cml0eV9kZWZhdWx0X2NoYWxsZW5nZV90ZXh0KCkgewogICAgcHJpbnRmICdJIGFjY2VwdCB0aGUgcmlzaycKfQoKIyBDaGVja3MgaWYgYSBjb21tYW5kIG1hdGNoZXMgdGhlIHNlY3VyaXR5IHdoaXRlbGlzdAojIEFyZ3VtZW50czogJDEgLSBjb21tYW5kIHRvIGNoZWNrCiMgUmV0dXJuczogMCBpZiB3aGl0ZWxpc3RlZCwgMSBvdGhlcndpc2UKX2Z1Y2tfc2VjdXJpdHlfaXNfd2hpdGVsaXN0ZWQoKSB7CiAgICBsb2NhbCBjb21tYW5kPSIkMSIKICAgIGxvY2FsIHdoaXRlbGlzdD0iJHtGVUNLX1NFQ1VSSVRZX1dISVRFTElTVDotfSIKCiAgICBpZiBbIC16ICIkd2hpdGVsaXN0IiBdOyB0aGVuCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgbG9jYWwgbm9ybWFsaXplZCBlbnRyeQogICAgbm9ybWFsaXplZD0kKHByaW50ZiAnJXMnICIkd2hpdGVsaXN0IiB8IHRyICcsJyAnXG4nKQoKICAgIHdoaWxlIElGUz0gcmVhZCAtciBlbnRyeTsgZG8KICAgICAgICBlbnRyeT0kKHByaW50ZiAnJXMnICIkZW50cnkiIHwgc2VkIC1lICdzL15bWzpzcGFjZTpdXSovLycgLWUgJ3MvW1s6c3BhY2U6XV0qJC8vJykKICAgICAgICBbIC16ICIkZW50cnkiIF0gJiYgY29udGludWUKCiAgICAgICAgaWYgcHJpbnRmICclcycgIiRjb21tYW5kIiB8IGdyZXAgLUZxICIkZW50cnkiOyB0aGVuCiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgZmkKICAgIGRvbmUgPDw8ICIkbm9ybWFsaXplZCIKCiAgICByZXR1cm4gMQp9CgojIENvbnZlcnRzIHNlY3VyaXR5IGxldmVsIHRvIG51bWVyaWMgdmFsdWUgZm9yIGNvbXBhcmlzb24KIyBBcmd1bWVudHM6ICQxIC0gc2VjdXJpdHkgbGV2ZWwgKGJsb2NrL2NoYWxsZW5nZS93YXJuL29rKQojIE91dHB1dHM6IE51bWVyaWMgdmFsdWUgKDMvMi8xLzApCl9mdWNrX3NlY3VyaXR5X2xldmVsX3ZhbHVlKCkgewogICAgY2FzZSAiJDEiIGluCiAgICAgICAgYmxvY2spIHByaW50ZiAnM1xuJyA7OwogICAgICAgIGNoYWxsZW5nZSkgcHJpbnRmICcyXG4nIDs7CiAgICAgICAgd2FybikgcHJpbnRmICcxXG4nIDs7CiAgICAgICAgKikgcHJpbnRmICcwXG4nIDs7CiAgICBlc2FjCn0KCiMgUHJvbW90ZXMgc2VjdXJpdHkgbGV2ZWwgaWYgY2FuZGlkYXRlIGlzIG1vcmUgc2V2ZXJlCiMgQXJndW1lbnRzOiAkMSAtIGN1cnJlbnQgbGV2ZWwsICQyIC0gY2FuZGlkYXRlIGxldmVsCiMgT3V0cHV0czogVGhlIG1vcmUgc2V2ZXJlIGxldmVsCl9mdWNrX3NlY3VyaXR5X3Byb21vdGUoKSB7CiAgICBsb2NhbCBjdXJyZW50PSIkMSIKICAgIGxvY2FsIGNhbmRpZGF0ZT0iJDIiCiAgICBsb2NhbCBjdXJyZW50X3ZhbCBjYW5kaWRhdGVfdmFsCgogICAgY3VycmVudF92YWw9JChfZnVja19zZWN1cml0eV9sZXZlbF92YWx1ZSAiJGN1cnJlbnQiKQogICAgY2FuZGlkYXRlX3ZhbD0kKF9mdWNrX3NlY3VyaXR5X2xldmVsX3ZhbHVlICIkY2FuZGlkYXRlIikKCiAgICBpZiBbICIkY2FuZGlkYXRlX3ZhbCIgLWd0ICIkY3VycmVudF92YWwiIF07IHRoZW4KICAgICAgICBwcmludGYgJyVzXG4nICIkY2FuZGlkYXRlIgogICAgZWxzZQogICAgICAgIHByaW50ZiAnJXNcbicgIiRjdXJyZW50IgogICAgZmkKfQoKIyBBcHBsaWVzIHNlY3VyaXR5IG1vZGUgYWRqdXN0bWVudHMgdG8gc2V2ZXJpdHkgbGV2ZWwKIyBBcmd1bWVudHM6ICQxIC0gbW9kZSAoc3RyaWN0L2JhbGFuY2VkL29mZiksICQyIC0gc2V2ZXJpdHkgbGV2ZWwKIyBPdXRwdXRzOiBBZGp1c3RlZCBzZXZlcml0eSBsZXZlbApfZnVja19zZWN1cml0eV9hcHBseV9tb2RlKCkgewogICAgbG9jYWwgbW9kZT0iJDEiCiAgICBsb2NhbCBzZXZlcml0eT0iJDIiCgogICAgY2FzZSAiJG1vZGUiIGluCiAgICAgICAgc3RyaWN0KQogICAgICAgICAgICBjYXNlICIkc2V2ZXJpdHkiIGluCiAgICAgICAgICAgICAgICB3YXJuKSBzZXZlcml0eT0iY2hhbGxlbmdlIiA7OwogICAgICAgICAgICAgICAgY2hhbGxlbmdlKSBzZXZlcml0eT0iYmxvY2siIDs7CiAgICAgICAgICAgIGVzYWMKICAgICAgICAgICAgOzsKICAgIGVzYWMKCiAgICBwcmludGYgJyVzXG4nICIkc2V2ZXJpdHkiCn0KCiMgTWF0Y2hlcyBjb21tYW5kIGFnYWluc3QgYSBzZWN1cml0eSBydWxlIHRhYmxlCiMgQXJndW1lbnRzOiAkMSAtIGNvbW1hbmQsICQyIC0gcnVsZSB0YWJsZSBuYW1lCiMgT3V0cHV0czogUmVhc29uIHN0cmluZyBpZiBtYXRjaGVkCiMgUmV0dXJuczogMCBpZiBtYXRjaGVkLCAxIG90aGVyd2lzZQpfZnVja19zZWN1cml0eV9tYXRjaF9ydWxlKCkgewogICAgbG9jYWwgY29tbWFuZD0iJDEiCiAgICBsb2NhbCB0YWJsZT0iJDIiCiAgICBsb2NhbCAtYSBydWxlcz0oKQoKICAgIGV2YWwgInJ1bGVzPShcIlwkeyR7dGFibGV9W0BdfVwiKSIKCiAgICBsb2NhbCBydWxlIHBhdHRlcm4gcmVhc29uCiAgICBmb3IgcnVsZSBpbiAiJHtydWxlc1tAXX0iOyBkbwogICAgICAgIHBhdHRlcm49JHtydWxlJSV8fHwqfQogICAgICAgIHJlYXNvbj0ke3J1bGUjKnx8fH0KICAgICAgICBbIC16ICIkcGF0dGVybiIgXSAmJiBjb250aW51ZQoKICAgICAgICBpZiBwcmludGYgJyVzJyAiJGNvbW1hbmQiIHwgZ3JlcCAtRWlxIC0tICIkcGF0dGVybiI7IHRoZW4KICAgICAgICAgICAgcHJpbnRmICclc1xuJyAiJHJlYXNvbiIKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICBmaQogICAgZG9uZQoKICAgIHJldHVybiAxCn0KCiMgRGlzcGxheXMgd2FybmluZyBtZXNzYWdlIGZvciBwb3RlbnRpYWxseSBkYW5nZXJvdXMgY29tbWFuZHMKIyBBcmd1bWVudHM6ICQxIC0gcmVhc29uIGZvciB3YXJuaW5nCl9mdWNrX3NlY3VyaXR5X3dhcm5fbWVzc2FnZSgpIHsKICAgIGxvY2FsIHJlYXNvbj0iJDEiCiAgICBlY2hvIC1lICIke0NfUkVEX0JPTER94pqg77iPICBTRUNVUklUWSBXQVJOSU5HOiR7Q19SRVNFVH0gJHtyZWFzb259IiA+JjIKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9UmV2aWV3IHRoZSBjb21tYW5kIG1hbnVhbGx5IG9yIGFkZCBhIHdoaXRlbGlzdCBlbnRyeSBpZiB5b3UgZnVsbHkgdHJ1c3QgaXQuJHtDX1JFU0VUfSIgPiYyCn0KCiMgRGlzcGxheXMgYmxvY2sgbWVzc2FnZSBmb3IgcHJvaGliaXRlZCBjb21tYW5kcwojIEFyZ3VtZW50czogJDEgLSByZWFzb24gZm9yIGJsb2NraW5nCl9mdWNrX3NlY3VyaXR5X2Jsb2NrX21lc3NhZ2UoKSB7CiAgICBsb2NhbCByZWFzb249IiQxIgogICAgZWNobyAtZSAiJHtDX1JFRF9CT0xEfeKblCBTRUNVUklUWSBCTE9DSzoke0NfUkVTRVR9ICR7cmVhc29ufSIgPiYyCiAgICBlY2hvIC1lICIke0NfUkVEfUV4ZWN1dGlvbiBkZW5pZWQuIEFkanVzdCBGVUNLX1NFQ1VSSVRZX01PREUgb3Igd2hpdGVsaXN0IHRoZSBjb21tYW5kIGlmIGFic29sdXRlbHkgbmVjZXNzYXJ5LiR7Q19SRVNFVH0iID4mMgp9CgojIERpc3BsYXlzIGNoYWxsZW5nZSBtZXNzYWdlIGZvciBoaWdoLXJpc2sgY29tbWFuZHMKIyBBcmd1bWVudHM6ICQxIC0gcmVhc29uIGZvciBjaGFsbGVuZ2UsICQyIC0gcmVxdWlyZWQgcGhyYXNlCl9mdWNrX3NlY3VyaXR5X2NoYWxsZW5nZV9tZXNzYWdlKCkgewogICAgbG9jYWwgcmVhc29uPSIkMSIKICAgIGxvY2FsIHBocmFzZT0iJDIiCiAgICBlY2hvIC1lICIke0NfUkVEX0JPTER94pqg77iPICBTRUNVUklUWSBDSEFMTEVOR0U6JHtDX1JFU0VUfSAke3JlYXNvbn0iID4mMgogICAgZWNobyAtZSAiJHtDX0NZQU59VHlwZSB0aGUgZm9sbG93aW5nIHBocmFzZSB0byBjb250aW51ZToke0NfUkVTRVR9IiA+JjIKICAgIGVjaG8gLWUgIiR7Q19CT0xEfSR7cGhyYXNlfSR7Q19SRVNFVH0iID4mMgp9CgojIFByb21wdHMgdXNlciB0byBlbnRlciB0aGUgcmVxdWlyZWQgcGhyYXNlIGZvciBzZWN1cml0eSBjaGFsbGVuZ2UKIyBBcmd1bWVudHM6ICQxIC0gcmVxdWlyZWQgcGhyYXNlCiMgUmV0dXJuczogMCBpZiBwaHJhc2UgbWF0Y2hlcywgMSBvdGhlcndpc2UKX2Z1Y2tfc2VjdXJpdHlfcHJvbXB0X3BocmFzZSgpIHsKICAgIGxvY2FsIHBocmFzZT0iJDEiCiAgICBsb2NhbCBpbnB1dD0iIgoKICAgIHByaW50ZiAiJWI+ICViIiAiJENfQk9MRCIgIiRDX1JFU0VUIiA+JjIKCiAgICBpZiBbIC1yIC9kZXYvdHR5IF07IHRoZW4KICAgICAgICBpZiAhIElGUz0gcmVhZCAtciBpbnB1dCA8IC9kZXYvdHR5OyB0aGVuCiAgICAgICAgICAgIHByaW50ZiAiXG4iID4mMgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgaWYgISBJRlM9IHJlYWQgLXIgaW5wdXQ7IHRoZW4KICAgICAgICAgICAgcHJpbnRmICJcbiIgPiYyCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgZmkKICAgIGZpCgogICAgcHJpbnRmICJcbiIgPiYyCiAgICBbICIkaW5wdXQiID0gIiRwaHJhc2UiIF0KfQoKIyBIYW5kbGVzIHNlY3VyaXR5IGRlY2lzaW9uIGJhc2VkIG9uIHNldmVyaXR5IGxldmVsCiMgQXJndW1lbnRzOiAkMSAtIHNldmVyaXR5IGxldmVsLCAkMiAtIHJlYXNvbiwgJDMgLSBjb21tYW5kCiMgUmV0dXJuczogMCB0byBhbGxvdyBleGVjdXRpb24sIDEgdG8gZGVueQpfZnVja19zZWN1cml0eV9oYW5kbGVfZGVjaXNpb24oKSB7CiAgICBsb2NhbCBzZXZlcml0eT0iJDEiCiAgICBsb2NhbCByZWFzb249IiQyIgogICAgbG9jYWwgY29tbWFuZD0iJDMiCgogICAgY2FzZSAiJHNldmVyaXR5IiBpbgogICAgICAgICIifG9rfG9mZikKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgOzsKICAgICAgICB3YXJuKQogICAgICAgICAgICBfZnVja19zZWN1cml0eV93YXJuX21lc3NhZ2UgIiR7cmVhc29uOi1Qb3RlbnRpYWxseSBkYW5nZXJvdXMgY29tbWFuZCBkZXRlY3RlZH0iCiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIDs7CiAgICAgICAgY2hhbGxlbmdlKQogICAgICAgICAgICBsb2NhbCBwaHJhc2U9IiR7RlVDS19TRUNVUklUWV9DSEFMTEVOR0VfVEVYVDotJChfZnVja19zZWN1cml0eV9kZWZhdWx0X2NoYWxsZW5nZV90ZXh0KX0iCiAgICAgICAgICAgIF9mdWNrX3NlY3VyaXR5X2NoYWxsZW5nZV9tZXNzYWdlICIke3JlYXNvbjotSGlnaC1yaXNrIGNvbW1hbmQgZGV0ZWN0ZWR9IiAiJHBocmFzZSIKCiAgICAgICAgICAgIGlmIF9mdWNrX3NlY3VyaXR5X3Byb21wdF9waHJhc2UgIiRwaHJhc2UiOyB0aGVuCiAgICAgICAgICAgICAgICBlY2hvIC1lICIke0NfR1JFRU59U2VjdXJpdHkgY2hhbGxlbmdlIGFja25vd2xlZGdlZC4ke0NfUkVTRVR9IiA+JjIKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIGZpCgogICAgICAgICAgICBlY2hvIC1lICIke0NfUkVEfVNlY3VyaXR5IGNoYWxsZW5nZSBmYWlsZWQuIENvbW1hbmQgYWJvcnRlZC4ke0NfUkVTRVR9IiA+JjIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgOzsKICAgICAgICBibG9jaykKICAgICAgICAgICAgX2Z1Y2tfc2VjdXJpdHlfYmxvY2tfbWVzc2FnZSAiJHtyZWFzb246LUNvbW1hbmQgYmxvY2tlZCBieSBwb2xpY3l9IgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICA7OwogICAgICAgICopCiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIDs7CiAgICBlc2FjCn0KCiMgRXZhbHVhdGVzIGNvbW1hbmQgc2VjdXJpdHkgYW5kIHJldHVybnMgc2V2ZXJpdHkgbGV2ZWwgd2l0aCByZWFzb24KIyBBcmd1bWVudHM6ICQxIC0gY29tbWFuZCB0byBldmFsdWF0ZQojIE91dHB1dHM6ICJzZXZlcml0eXxyZWFzb24iIHN0cmluZwojIFJldHVybnM6IDAgYWx3YXlzIChyZXN1bHQgaXMgaW4gb3V0cHV0KQpfZnVja19zZWN1cml0eV9ldmFsdWF0ZV9jb21tYW5kKCkgewogICAgbG9jYWwgY29tbWFuZD0iJDEiCiAgICBsb2NhbCBtb2RlIHNldmVyaXR5IHJlYXNvbiBtYXRjaCBwcm9tb3RlZCBzdHJ1Y3R1cmFsX3JlYXNvbgoKICAgIG1vZGU9JChfZnVja19zZWN1cml0eV9tb2RlKQoKICAgICMgU2VjdXJpdHkgZW5naW5lIGRpc2FibGVkCiAgICBpZiBbICIkbW9kZSIgPSAib2ZmIiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICdvZmZ8U2VjdXJpdHkgZW5naW5lIGRpc2FibGVkXG4nCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgIyBDaGVjayB3aGl0ZWxpc3QKICAgIGlmIF9mdWNrX3NlY3VyaXR5X2lzX3doaXRlbGlzdGVkICIkY29tbWFuZCI7IHRoZW4KICAgICAgICBwcmludGYgJ29rfENvbW1hbmQgbWF0Y2hlZCB3aGl0ZWxpc3RcbicKICAgICAgICByZXR1cm4gMAogICAgZmkKCiAgICBzZXZlcml0eT0ib2siCiAgICByZWFzb249IiIKICAgIG1hdGNoPSIiCgogICAgIyBDaGVjayBibG9jayBydWxlcyAoaGlnaGVzdCBwcmlvcml0eSkKICAgIGlmIG1hdGNoPSQoX2Z1Y2tfc2VjdXJpdHlfbWF0Y2hfcnVsZSAiJGNvbW1hbmQiICJfRlVDS19TRUNVUklUWV9CTE9DS19SVUxFUyIpOyB0aGVuCiAgICAgICAgc2V2ZXJpdHk9ImJsb2NrIgogICAgICAgIHJlYXNvbj0iJG1hdGNoIgogICAgZmkKCiAgICAjIENoZWNrIGNoYWxsZW5nZSBydWxlcyAobWVkaXVtIHByaW9yaXR5KQogICAgaWYgWyAiJHNldmVyaXR5IiAhPSAiYmxvY2siIF0gJiYgbWF0Y2g9JChfZnVja19zZWN1cml0eV9tYXRjaF9ydWxlICIkY29tbWFuZCIgIl9GVUNLX1NFQ1VSSVRZX0NIQUxMRU5HRV9SVUxFUyIpOyB0aGVuCiAgICAgICAgc2V2ZXJpdHk9ImNoYWxsZW5nZSIKICAgICAgICByZWFzb249IiRtYXRjaCIKICAgIGZpCgogICAgIyBDaGVjayB3YXJuIHJ1bGVzIChsb3cgcHJpb3JpdHkpCiAgICBpZiBbICIkc2V2ZXJpdHkiID0gIm9rIiBdICYmIG1hdGNoPSQoX2Z1Y2tfc2VjdXJpdHlfbWF0Y2hfcnVsZSAiJGNvbW1hbmQiICJfRlVDS19TRUNVUklUWV9XQVJOX1JVTEVTIik7IHRoZW4KICAgICAgICBzZXZlcml0eT0id2FybiIKICAgICAgICByZWFzb249IiRtYXRjaCIKICAgIGZpCgogICAgIyBDaGVjayBmb3IgY29tbWFuZCBjaGFpbmluZy9waXBpbmcgKHN0cnVjdHVyYWwgYW5hbHlzaXMpCiAgICBpZiBwcmludGYgJyVzJyAiJGNvbW1hbmQiIHwgZ3JlcCAtRWlxICcoJiZ8XHxcfHw7fFx8KSc7IHRoZW4KICAgICAgICBzdHJ1Y3R1cmFsX3JlYXNvbj0iQ29tbWFuZCBjaGFpbmluZyBvciBwaXBpbmcgZGV0ZWN0ZWQiCiAgICAgICAgcHJvbW90ZWQ9JChfZnVja19zZWN1cml0eV9wcm9tb3RlICIkc2V2ZXJpdHkiICJ3YXJuIikKCiAgICAgICAgaWYgWyAiJHByb21vdGVkIiAhPSAiJHNldmVyaXR5IiBdOyB0aGVuCiAgICAgICAgICAgIHNldmVyaXR5PSIkcHJvbW90ZWQiCiAgICAgICAgICAgIHJlYXNvbj0iJHN0cnVjdHVyYWxfcmVhc29uIgogICAgICAgIGVsaWYgWyAteiAiJHJlYXNvbiIgXTsgdGhlbgogICAgICAgICAgICByZWFzb249IiRzdHJ1Y3R1cmFsX3JlYXNvbiIKICAgICAgICBmaQogICAgZmkKCiAgICAjIEFwcGx5IHNlY3VyaXR5IG1vZGUgYWRqdXN0bWVudHMKICAgIHNldmVyaXR5PSQoX2Z1Y2tfc2VjdXJpdHlfYXBwbHlfbW9kZSAiJG1vZGUiICIkc2V2ZXJpdHkiKQoKICAgIHByaW50ZiAnJXN8JXNcbicgIiRzZXZlcml0eSIgIiR7cmVhc29uOi1TYWZlIGV4ZWN1dGlvbn0iCn0KCiMgTGVnYWN5IGZ1bmN0aW9uIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5CiMgQXJndW1lbnRzOiAkMSAtIGNvbW1hbmQgdG8gY2hlY2sKIyBPdXRwdXRzOiAic2V2ZXJpdHl8cmVhc29uIiBzdHJpbmcKX2Z1Y2tfZGV0ZWN0X2Rhbmdlcm91c19jb21tYW5kKCkgewogICAgX2Z1Y2tfc2VjdXJpdHlfZXZhbHVhdGVfY29tbWFuZCAiJDEiCn0KCgojIEVuc3VyZSBhIGNvbmZpZyBmaWxlIGV4aXN0cyB0byBoZWxwIHVzZXJzIHR3ZWFrIHRoZSBiZWhhdmlvdXIKX2Z1Y2tfc2VjdXJlX2NvbmZpZ19maWxlKCkgewogICAgaWYgWyAtZiAiJENPTkZJR19GSUxFIiBdOyB0aGVuCiAgICAgICAgY2htb2QgNjAwICIkQ09ORklHX0ZJTEUiIDI+L2Rldi9udWxsIHx8IHRydWUKICAgIGZpCn0KCl9mdWNrX2FwcGVuZF9jb25maWdfaGludCgpIHsKICAgIGxvY2FsIGtleT0iJDEiCiAgICBsb2NhbCBjb21tZW50PSIkMiIKICAgIGxvY2FsIHNhbXBsZT0iJDMiCiAgICBsb2NhbCBxdW90ZWQ9IiR7NDotMX0iCiAgICBbIC1mICIkQ09ORklHX0ZJTEUiIF0gfHwgcmV0dXJuCiAgICBpZiBncmVwIC1FcSAiXlxccyojP1xccypleHBvcnRcXHMrJGtleSIgIiRDT05GSUdfRklMRSI7IHRoZW4KICAgICAgICByZXR1cm4KICAgIGZpCgogICAgbG9jYWwgYXNzaWdubWVudAogICAgaWYgWyAiJHF1b3RlZCIgPSAiMSIgXTsgdGhlbgogICAgICAgIGFzc2lnbm1lbnQ9IiMgZXhwb3J0ICRrZXk9XCIkc2FtcGxlXCIiCiAgICBlbHNlCiAgICAgICAgYXNzaWdubWVudD0iIyBleHBvcnQgJGtleT0kc2FtcGxlIgogICAgZmkKCiAgICB7CiAgICAgICAgcHJpbnRmICdcbicKICAgICAgICBwcmludGYgJyMgJXNcbicgIiRjb21tZW50IgogICAgICAgIHByaW50ZiAnJXNcbicgIiRhc3NpZ25tZW50IgogICAgfSA+PiAiJENPTkZJR19GSUxFIgp9CgpfZnVja19zZWVkX2NvbmZpZ19wbGFjZWhvbGRlcnMoKSB7CiAgICBbIC1mICIkQ09ORklHX0ZJTEUiIF0gfHwgcmV0dXJuCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfT1BFTkFJX0FQSV9LRVkiICJMb2NhbCBPcGVuQUktY29tcGF0aWJsZSBBUEkga2V5IChyZWNvbW1lbmRlZCkiICdzay0uLi4nCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfQURNSU5fS0VZIiAiT3B0aW9uYWw6IGFkbWluIGJ5cGFzcyBrZXkgZm9yIHRydXN0ZWQgbWFpbnRhaW5lcnMiICdhZG0tLi4uJwogICAgX2Z1Y2tfYXBwZW5kX2NvbmZpZ19oaW50ICJGVUNLX09QRU5BSV9NT0RFTCIgIk9wdGlvbmFsOiBvdmVycmlkZSBtb2RlbCB3aGVuIHVzaW5nIHlvdXIgb3duIGtleSIgJ2dwdC00by1taW5pJwogICAgX2Z1Y2tfYXBwZW5kX2NvbmZpZ19oaW50ICJGVUNLX09QRU5BSV9BUElfQkFTRSIgIk9wdGlvbmFsOiBvdmVycmlkZSBBUEkgYmFzZSIgJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEnCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfQUxJQVMiICJBZGQgYW4gZXh0cmEgYWxpYXMgYmVzaWRlcyB0aGUgZGVmYXVsdCAnZnVjayciICdwbHMnCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfQVVUT19FWEVDIiAiU2tpcCBjb25maXJtYXRpb24gcHJvbXB0cyAodXNlIHdpdGggY2F1dGlvbiEpIiAnZmFsc2UnIDAKICAgIF9mdWNrX2FwcGVuZF9jb25maWdfaGludCAiRlVDS19USU1FT1VUIiAiT3ZlcnJpZGUgY3VybCB0aW1lb3V0IChzZWNvbmRzKSIgJzMwJyAwCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfREVCVUciICJFbmFibGUgdmVyYm9zZSBkZWJ1ZyBsb2dzIiAnZmFsc2UnIDAKICAgIF9mdWNrX2FwcGVuZF9jb25maWdfaGludCAiRlVDS19ESVNBQkxFX0RFRkFVTFRfQUxJQVMiICJEaXNhYmxlIHRoZSBidWlsdC1pbiAnZnVjaycgYWxpYXMiICdmYWxzZScgMAogICAgX2Z1Y2tfYXBwZW5kX2NvbmZpZ19oaW50ICJGVUNLX1NFQ1VSSVRZX01PREUiICJTZWN1cml0eSBlbmdpbmUgbW9kZTogc3RyaWN0fGJhbGFuY2VkfG9mZiIgJ2JhbGFuY2VkJwogICAgX2Z1Y2tfYXBwZW5kX2NvbmZpZ19oaW50ICJGVUNLX1NFQ1VSSVRZX1dISVRFTElTVCIgIkNvbW1hL25ld2xpbmUgc2VwYXJhdGVkIGNvbW1hbmQgcGF0dGVybnMgdG8gYnlwYXNzIHNlY3VyaXR5IGNoZWNrcyIgJycKICAgIF9mdWNrX2FwcGVuZF9jb25maWdfaGludCAiRlVDS19TRUNVUklUWV9DSEFMTEVOR0VfVEVYVCIgIlBocmFzZSByZXF1aXJlZCBmb3IgaGlnaC1yaXNrIGNvbW1hbmQgY29uZmlybWF0aW9uIiAnSSBhY2NlcHQgdGhlIHJpc2snCn0KCl9mdWNrX2Vuc3VyZV9jb25maWdfZXhpc3RzKCkgewogICAgaWYgWyAtZiAiJENPTkZJR19GSUxFIiBdOyB0aGVuCiAgICAgICAgX2Z1Y2tfc2VlZF9jb25maWdfcGxhY2Vob2xkZXJzCiAgICAgICAgX2Z1Y2tfc2VjdXJlX2NvbmZpZ19maWxlCiAgICAgICAgcmV0dXJuCiAgICBmaQoKICAgIG1rZGlyIC1wICIkKGRpcm5hbWUgIiRDT05GSUdfRklMRSIpIgogICAgY2F0IDw8J0NGRycgPiAiJENPTkZJR19GSUxFIgojIGZ1Y2tpdHMgY29uZmlndXJhdGlvbgojIFRvZ2dsZSB0aGUgZXhwb3J0cyBiZWxvdyB0byBjdXN0b21pc2UgeW91ciBleHBlcmllbmNlLgoKIyBDdXN0b20gQVBJIGVuZHBvaW50IHRoYXQgcG9pbnRzIHRvIHlvdXIgc2VsZi1ob3N0ZWQgd29ya2VyCiMgZXhwb3J0IEZVQ0tfQVBJX0VORFBPSU5UPSJodHRwczovL3lvdXItZG9tYWluLndvcmtlcnMuZGV2LyIKCiMgTG9jYWwgT3BlbkFJLWNvbXBhdGlibGUgQVBJIGtleSAocmVjb21tZW5kZWQpCiMgZXhwb3J0IEZVQ0tfT1BFTkFJX0FQSV9LRVk9InNrLS4uLiIKCiMgT3B0aW9uYWw6IGFkbWluIGJ5cGFzcyBrZXkgZm9yIHRydXN0ZWQgbWFpbnRhaW5lcnMKIyBleHBvcnQgRlVDS19BRE1JTl9LRVk9ImFkbS0uLi4iCgojIE9wdGlvbmFsOiBvdmVycmlkZSBtb2RlbC9iYXNlIHdoZW4gdXNpbmcgeW91ciBvd24ga2V5CiMgZXhwb3J0IEZVQ0tfT1BFTkFJX01PREVMPSJncHQtNG8tbWluaSIKIyBleHBvcnQgRlVDS19PUEVOQUlfQVBJX0JBU0U9Imh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEiCgojIEFkZCBhbiBleHRyYSBhbGlhcyBiZXNpZGVzIHRoZSBkZWZhdWx0ICdmdWNrJwojIGV4cG9ydCBGVUNLX0FMSUFTPSJwbHMiCgojIFNraXAgY29uZmlybWF0aW9uIHByb21wdHMgKHVzZSB3aXRoIGNhdXRpb24hKQojIGV4cG9ydCBGVUNLX0FVVE9fRVhFQz1mYWxzZQoKIyBPdmVycmlkZSBjdXJsIHRpbWVvdXQgKHNlY29uZHMpCiMgZXhwb3J0IEZVQ0tfVElNRU9VVD0zMAoKIyBFbmFibGUgdmVyYm9zZSBkZWJ1ZyBsb2dzCiMgZXhwb3J0IEZVQ0tfREVCVUc9ZmFsc2UKCiMgRGlzYWJsZSB0aGUgYnVpbHQtaW4gJ2Z1Y2snIGFsaWFzCiMgZXhwb3J0IEZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTPWZhbHNlCkNGRwoKICAgIF9mdWNrX3NlZWRfY29uZmlnX3BsYWNlaG9sZGVycwogICAgX2Z1Y2tfc2VjdXJlX2NvbmZpZ19maWxlCn0KCl9mdWNrX3Nob3dfY29uZmlnX2hlbHAoKSB7CiAgICBfZnVja19lbnN1cmVfY29uZmlnX2V4aXN0cwogICAgZWNobyAtZSAiJHtDX1lFTExPV31Db25maWd1cmF0aW9uIGZpbGU6JHtDX1JFU0VUfSAke0NfQ1lBTn0kQ09ORklHX0ZJTEUke0NfUkVTRVR9IgogICAgaWYgWyAtbiAiJHtFRElUT1I6LX0iIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfUVkaXQgd2l0aDoke0NfUkVTRVR9ICR7Q19DWUFOfSR7RURJVE9SfSBcIiRDT05GSUdfRklMRVwiJHtDX1JFU0VUfSIKICAgIGVsc2UKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfU9wZW4gdGhpcyBmaWxlIGluIHlvdXIgZmF2b3VyaXRlIGVkaXRvciB0byBjdXN0b21pc2UgZnVja2l0cy4ke0NfUkVTRVR9IgogICAgZmkKICAgIGVjaG8gLWUgIiR7Q19DWUFOfUF2YWlsYWJsZSB0b2dnbGVzOiR7Q19SRVNFVH0gRlVDS19BUElfRU5EUE9JTlQsIEZVQ0tfT1BFTkFJX0FQSV9LRVksIEZVQ0tfQURNSU5fS0VZLCBGVUNLX09QRU5BSV9NT0RFTCwgRlVDS19PUEVOQUlfQVBJX0JBU0UsIEZVQ0tfQUxJQVMsIEZVQ0tfQVVUT19FWEVDLCBGVUNLX1RJTUVPVVQsIEZVQ0tfREVCVUcsIEZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTIgogICAgZWNobyAtZSAiJHtDX0RJTX1Qcm8gdGlwOiR7Q19SRVNFVH0gd2UgbG9jayAke0NPTkZJR19GSUxFfSB0byBjaG1vZCA2MDAgc28geW91ciBBUEkga2V5IHN0YXlzIGxvY2FsLiIKfQoKIyBVbmluc3RhbGxzIHRoZSBzY3JpcHQKX3VuaW5zdGFsbF9zY3JpcHQoKSB7CiAgICBlY2hvIC1lICIkRlVDSyAke0NfWUVMTE9XfVNvIHlvdSdyZSBraWNraW5nIG1lIG91dD8gRmluZS4ke0NfUkVTRVR9IgoKICAgICMgRmluZCB0aGUgcHJvZmlsZSBmaWxlCiAgICBsb2NhbCBwcm9maWxlX2ZpbGUKICAgIHByb2ZpbGVfZmlsZT0kKF9pbnN0YWxsZXJfZGV0ZWN0X3Byb2ZpbGUpCiAgICBsb2NhbCBzb3VyY2VfbGluZT0ic291cmNlICRNQUlOX1NIIgoKICAgIGlmIFsgIiRwcm9maWxlX2ZpbGUiICE9ICJ1bmtub3duX3Byb2ZpbGUiIF0gJiYgWyAtZiAiJHByb2ZpbGVfZmlsZSIgXTsgdGhlbgogICAgICAgIGlmIGdyZXAgLXFGICIkc291cmNlX2xpbmUiICIkcHJvZmlsZV9maWxlIjsgdGhlbgogICAgICAgICAgICAjIFVzZSBzZWQgdG8gcmVtb3ZlIHRoZSBsaW5lcy4gQ3JlYXRlIGEgYmFja3VwLgogICAgICAgICAgICBpZiBzZWQgLS12ZXJzaW9uID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgICAgICAgICAgIyBHTlUgc2VkIChMaW51eCkKICAgICAgICAgICAgICAgIHNlZCAtaS5iYWsgIlx8JHNvdXJjZV9saW5lXHxkIiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICAgICAgICAgIHNlZCAtaS5iYWsgIlx8IyBBZGRlZCBieSBmdWNraXRzIGluc3RhbGxlclx8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICMgQlNEL21hY09TIHNlZCByZXF1aXJlcyBhcmd1bWVudCBsZXR0ZXIgYWZ0ZXIgLWkKICAgICAgICAgICAgICAgIHNlZCAtaS5iYWsgIiIgLWUgIlx8JHNvdXJjZV9saW5lXHxkIiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICAgICAgICAgIHNlZCAtaS5iYWsgIiIgLWUgIlx8IyBBZGRlZCBieSBmdWNraXRzIGluc3RhbGxlclx8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfUNvdWxkIG5vdCBmaW5kIGEgc2hlbGwgcHJvZmlsZSBmaWxlIHRvIG1vZGlmeS4gWW91ciBwcm9ibGVtIG5vdy4ke0NfUkVTRVR9IgogICAgZmkKCiAgICBpZiBbIC1kICIkSU5TVEFMTF9ESVIiIF07IHRoZW4KICAgICAgICBybSAtcmYgIiRJTlNUQUxMX0RJUiIKICAgIGZpCgogICAgZWNobyAtZSAiJEZVQ0sgJHtDX0dSRUVOfUknbSBnb25lLiBEb24ndCBjb21lIGNyeWluZyBiYWNrLiR7Q19SRVNFVH0iCiAgICBlY2hvIC1lICIke0NfQ1lBTn1Ob3cgcmVzdGFydCB5b3VyIGRhbW4gc2hlbGwuJHtDX1JFU0VUfSIKfQoKIyBUaGUgbWFpbiBmdW5jdGlvbiB0aGF0IGNvbnRhY3RzIHRoZSBBUEkKIyBUYWtlcyA+MCBhcmd1bWVudHMgYXMgdGhlIHByb21wdApfZnVja19leGVjdXRlX3Byb21wdCgpIHsKICAgICMgSWYgdGhlIHVzZXIgdHlwZXMgKm9ubHkqICJmdWNrIHVuaW5zdGFsbCIKICAgIGlmIFsgIiQxIiA9ICJ1bmluc3RhbGwiIF0gJiYgWyAiJCMiIC1lcSAxIF07IHRoZW4KICAgICAgICBfdW5pbnN0YWxsX3NjcmlwdAogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgICMgSWYgdGhlIHVzZXIgdHlwZXMgImZ1Y2sgY29uZmlnIgogICAgaWYgWyAiJDEiID0gImNvbmZpZyIgXSAmJiBbICIkIyIgLWVxIDEgXTsgdGhlbgogICAgICAgIF9mdWNrX3Nob3dfY29uZmlnX2hlbHAKICAgICAgICByZXR1cm4gMAogICAgZmkKCiAgICBpZiAhIGNvbW1hbmQgLXYgY3VybCAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfSdmdWNrJyBjb21tYW5kIG5lZWRzICdjdXJsJy4gUGxlYXNlIGluc3RhbGwgaXQuJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgaWYgWyAiJCMiIC1lcSAwIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfVlvdSBmb3Jnb3QgdG8gYXNrIG1lIHdoYXQgdG8gZG8uJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgbG9jYWwgcHJvbXB0PSIkKiIKICAgIGxvY2FsIGF1dG9fbW9kZT0iJHtGVUNLX0FVVE9fRVhFQzotMH0iCiAgICBsb2NhbCBjdXJsX3RpbWVvdXQ9IiR7RlVDS19USU1FT1VUOi0zMH0iCiAgICBsb2NhbCBzeXNpbmZvX3N0cmluZwogICAgc3lzaW5mb19zdHJpbmc9JChfZnVja19jb2xsZWN0X3N5c2luZm9fc3RyaW5nKQoKICAgIGxvY2FsIHJlc3BvbnNlPSIiCiAgICBsb2NhbCBleGl0X2NvZGU9MAogICAgaWYgX2Z1Y2tfc2hvdWxkX3VzZV9sb2NhbF9hcGk7IHRoZW4KICAgICAgICBlY2hvIC1uZSAiJHtDX1lFTExPV31Vc2luZyB5b3VyIGxvY2FsIEFQSSBrZXkuLi4ke0NfUkVTRVR9ICIKICAgICAgICByZXNwb25zZT0kKF9mdWNrX3JlcXVlc3RfbG9jYWxfbW9kZWwgIiRwcm9tcHQiICIkc3lzaW5mb19zdHJpbmciICIkY3VybF90aW1lb3V0IikKICAgICAgICBleGl0X2NvZGU9JD8KICAgIGVsc2UKICAgICAgICBlY2hvIC1uZSAiJHtDX1lFTExPV31UaGlua2luZy4uLiR7Q19SRVNFVH0gIgogICAgICAgIHJlc3BvbnNlPSQoX2Z1Y2tfcmVxdWVzdF93b3JrZXJfbW9kZWwgIiRwcm9tcHQiICIkc3lzaW5mb19zdHJpbmciICIkY3VybF90aW1lb3V0IikKICAgICAgICBleGl0X2NvZGU9JD8KICAgIGZpCgogICAgZWNobyAiIgoKICAgIGlmIFsgJGV4aXRfY29kZSAtbmUgMCBdIHx8IFsgLXogIiRyZXNwb25zZSIgXTsgdGhlbgogICAgICAgIHJldHVybiAkZXhpdF9jb2RlCiAgICBmaQoKICAgIGVjaG8gLWUgIiR7Q19DWUFOfUhlcmUgaXMgd2hhdCBJIGNhbWUgdXAgd2l0aDoke0NfUkVTRVR9IgogICAgZWNobyAtZSAiJHtDX0RJTX0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJHtDX1JFU0VUfSIKICAgIHByaW50ZiAnJXNcbicgIiRyZXNwb25zZSIKICAgIGVjaG8gLWUgIiR7Q19ESU19LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSR7Q19SRVNFVH0iCgogICAgIyBTZWN1cml0eSBjaGVjayBmb3IgZGFuZ2Vyb3VzIGNvbW1hbmRzCiAgICBsb2NhbCBzZWN1cml0eV9yZXN1bHQgc2VjdXJpdHlfbGV2ZWwgc2VjdXJpdHlfcmVhc29uCiAgICBzZWN1cml0eV9yZXN1bHQ9JChfZnVja19kZXRlY3RfZGFuZ2Vyb3VzX2NvbW1hbmQgIiRyZXNwb25zZSIpCiAgICBzZWN1cml0eV9sZXZlbD0ke3NlY3VyaXR5X3Jlc3VsdCUlfCp9CiAgICBzZWN1cml0eV9yZWFzb249JHtzZWN1cml0eV9yZXN1bHQjKnx9CgogICAgIyBIYW5kbGUgc2VjdXJpdHkgZGVjaXNpb24gYmFzZWQgb24gc2V2ZXJpdHkKICAgIGlmICEgX2Z1Y2tfc2VjdXJpdHlfaGFuZGxlX2RlY2lzaW9uICIkc2VjdXJpdHlfbGV2ZWwiICIkc2VjdXJpdHlfcmVhc29uIiAiJHJlc3BvbnNlIjsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19SRUR94p2MIENvbW1hbmQgYWJvcnRlZCBkdWUgdG8gc2VjdXJpdHkgcG9saWN5LiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgIGxvY2FsIHNob3VsZF9leGVjPWZhbHNlCgogICAgaWYgX2Z1Y2tfdHJ1dGh5ICIkYXV0b19tb2RlIjsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d94pqhIEF1dG8tZXhlYyBlbmFibGVkLiBSdW5uaW5nLi4uJHtDX1JFU0VUfSIKICAgICAgICBzaG91bGRfZXhlYz10cnVlCiAgICBlbHNlCiAgICAgICAgIyBJbnRlcmFjdGl2ZSBjb25maXJtYXRpb24KICAgICAgICB3aGlsZSB0cnVlOyBkbwogICAgICAgICAgICBwcmludGYgIiR7Q19CT0xEfUV4ZWN1dGU/IFtZL25dICR7Q19SRVNFVH0iCiAgICAgICAgICAgIGxvY2FsIGNvbmZpcm1hdGlvbiBub3JtYWxpemVkCiAgICAgICAgICAgIGlmIFsgLXIgL2Rldi90dHkgXTsgdGhlbgogICAgICAgICAgICAgICAgSUZTPSByZWFkIC1yIGNvbmZpcm1hdGlvbiA8IC9kZXYvdHR5CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgZm9yIG5vIFRUWQogICAgICAgICAgICAgICAgSUZTPSByZWFkIC1yIGNvbmZpcm1hdGlvbgogICAgICAgICAgICBmaQoKICAgICAgICAgICAgY29uZmlybWF0aW9uPSQocHJpbnRmICclcycgIiR7Y29uZmlybWF0aW9uOi19IiB8IHRyIC1kICcgXHRccicpCiAgICAgICAgICAgIG5vcm1hbGl6ZWQ9JChwcmludGYgJyVzJyAiJGNvbmZpcm1hdGlvbiIgfCB0ciAnWzp1cHBlcjpdJyAnWzpsb3dlcjpdJykKCiAgICAgICAgICAgIGNhc2UgIiRub3JtYWxpemVkIiBpbgogICAgICAgICAgICAgICAgIiJ8InkifCJ5ZXMiKQogICAgICAgICAgICAgICAgICAgIHNob3VsZF9leGVjPXRydWUKICAgICAgICAgICAgICAgICAgICBlY2hvIC1lICIke0NfR1JFRU594pyFIEV4ZWN1dGluZy4uLiR7Q19SRVNFVH0iCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAgICAgIm4ifCJubyIpCiAgICAgICAgICAgICAgICAgICAgc2hvdWxkX2V4ZWM9ZmFsc2UKICAgICAgICAgICAgICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfeKdjCBBYm9ydGVkLiR7Q19SRVNFVH0iID4mMgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgICopCiAgICAgICAgICAgICAgICAgICAgIyBMb29wIGFnYWluCiAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgZXNhYwogICAgICAgIGRvbmUKICAgIGZpCgogICAgaWYgWyAiJHNob3VsZF9leGVjIiA9ICJ0cnVlIiBdOyB0aGVuCiAgICAgICAgZXZhbCAiJHJlc3BvbnNlIgogICAgICAgIGxvY2FsIGV4aXRfY29kZT0kPwogICAgICAgIGlmIFsgJGV4aXRfY29kZSAtbmUgMCBdOyB0aGVuCiAgICAgICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9Q29tbWFuZCBmYWlsZWQgd2l0aCBleGl0IGNvZGUgJGV4aXRfY29kZS4ke0NfUkVTRVR9IiA+JjIKICAgICAgICBmaQogICAgICAgIHJldHVybiAkZXhpdF9jb2RlCiAgICBlbHNlCiAgICAgICAgIyBUaGUgJ0Fib3J0ZWQuJyBtZXNzYWdlIGlzIG5vdyBwcmludGVkIHdpdGhpbiB0aGUgbG9vcCwKICAgICAgICAjIHNvIHdlIGp1c3QgcmV0dXJuIDEgaGVyZSBpZiBzaG91bGRfZXhlYyBpcyBmYWxzZS4KICAgICAgICByZXR1cm4gMQogICAgZmkKfQoKIyBEZWZpbmUgdGhlIGFsaWFzIGZvciBpbnRlcmFjdGl2ZSB1c2UgKHN1cHBvcnRzIGN1c3RvbSBhbGlhc2VzKQpfZnVja19kZWZpbmVfYWxpYXNlcygpIHsKICAgIGxvY2FsIGRlZmF1bHRfYWxpYXM9ImZ1Y2siCgogICAgaWYgISBfZnVja190cnV0aHkgIiR7RlVDS19ESVNBQkxFX0RFRkFVTFRfQUxJQVM6LTB9IjsgdGhlbgogICAgICAgIGFsaWFzICIkZGVmYXVsdF9hbGlhcyI9J19mdWNrX2V4ZWN1dGVfcHJvbXB0JwogICAgZmkKCiAgICBpZiBbIC1uICIke0ZVQ0tfQUxJQVM6LX0iIF0gJiYgWyAiJEZVQ0tfQUxJQVMiICE9ICIkZGVmYXVsdF9hbGlhcyIgXTsgdGhlbgogICAgICAgIGFsaWFzICIkRlVDS19BTElBUyI9J19mdWNrX2V4ZWN1dGVfcHJvbXB0JwogICAgZmkKfQoKX2Z1Y2tfZGVmaW5lX2FsaWFzZXMKCiMgLS0tIEVuZCBDb3JlIExvZ2ljIC0tLQpFT0YKCiMgLS0tIEVuZCBvZiBDb3JlIExvZ2ljIEhlcmVkb2MgLS0tCgojIEhlbHBlciB0byBtYXRlcmlhbGl6ZSB0aGUgZW1iZWRkZWQgY29yZSBsb2dpYyBpbnRvIGEgZmlsZSAodXNlZCBmb3IgaW5zdGFsbC90ZW1wIGV4ZWN1dGlvbikKX2Z1Y2tfd3JpdGVfY29yZSgpIHsKICAgIGxvY2FsIHRhcmdldD0iJDEiCiAgICBwcmludGYgJyVzXG4nICIkQ09SRV9MT0dJQyIgPiAiJHRhcmdldCIKfQoKIyBIZWxwZXIgdG8gc291cmNlIHRoZSBjb3JlIGxvZ2ljIGludG8gdGhlIGN1cnJlbnQgc2hlbGwKX2Z1Y2tfc291cmNlX2NvcmUoKSB7CiAgIGxvY2FsIHRtcF9jb3JlCiAgIHRtcF9jb3JlPSQobWt0ZW1wKQogICBfZnVja193cml0ZV9jb3JlICIkdG1wX2NvcmUiCiAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMTA5MAogICBzb3VyY2UgIiR0bXBfY29yZSIKICAgcm0gLWYgIiR0bXBfY29yZSIKfQoKCiMgLS0tIEluc3RhbGxlciBGdW5jdGlvbnMgKFJ1biBieSB0aGUgb3V0ZXIgc2NyaXB0KSAtLS0KCiMgSGVscGVyIHRvIGZpbmQgdGhlIHVzZXIncyBzaGVsbCBwcm9maWxlIGZpbGUKX2luc3RhbGxlcl9kZXRlY3RfcHJvZmlsZSgpIHsKICAgIGlmIFsgLW4gIiR7U0hFTEw6LX0iIF0gJiYgZWNobyAiJFNIRUxMIiB8IGdyZXAgLXEgInpzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uenNocmMiCiAgICBlbGlmIFsgLW4gIiR7U0hFTEw6LX0iIF0gJiYgZWNobyAiJFNIRUxMIiB8IGdyZXAgLXEgImJhc2giOyB0aGVuCiAgICAgICAgZWNobyAiJEhPTUUvLmJhc2hyYyIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLnByb2ZpbGUiIF07IHRoZW4KICAgICAgICAjIEZhbGxiYWNrIGZvciBzaCwga3NoLCBldGMuCiAgICAgICAgZWNobyAiJEhPTUUvLnByb2ZpbGUiCiAgICBlbGlmIFsgLWYgIiRIT01FLy56c2hyYyIgXTsgdGhlbgogICAgICAgICMgRmFsbGJhY2sgaWYgU0hFTEwgdmFyIGlzbid0IHNldAogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLmJhc2hyYyIgXTsgdGhlbgogICAgICAgICMgRmFsbGJhY2sgaWYgU0hFTEwgdmFyIGlzbid0IHNldAogICAgICAgIGVjaG8gIiRIT01FLy5iYXNocmMiCiAgICBlbHNlCiAgICAgICAgZWNobyAidW5rbm93bl9wcm9maWxlIgogICAgZmkKfQoKIyBNYWluIGluc3RhbGxhdGlvbiBmdW5jdGlvbgpfaW5zdGFsbGVyX3NlY3VyZV9jb25maWdfZmlsZSgpIHsKICAgICAgICBpZiBbIC1mICIkQ09ORklHX0ZJTEUiIF07IHRoZW4KICAgICAgICBjaG1vZCA2MDAgIiRDT05GSUdfRklMRSIgMj4vZGV2L251bGwgfHwgdHJ1ZQogICAgZmkKfQoKX2luc3RhbGxfc2NyaXB0KCkgewogICAgZWNobyAtZSAiJEZDS04gJHtDX0JPTER9QWxyaWdodCwgbGV0J3MgZ2V0IHRoaXMgc2hpdCBpbnN0YWxsZWQuLi4ke0NfUkVTRVR9IgogICAgbWtkaXIgLXAgIiRJTlNUQUxMX0RJUiIKICAgIAogICAgIyBXcml0ZSB0aGUgZW1iZWRkZWQgY29yZSBsb2dpYyB0byB0aGUgbWFpbi5zaCBmaWxlCiAgICBfZnVja193cml0ZV9jb3JlICIkTUFJTl9TSCIKICAgIAogICAgaWYgWyAkPyAtbmUgMCBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1DYW4ndCB3cml0ZSB0byB0aGUgZmlsZS4gQ2hlY2sgeW91ciBkYW1uIHBlcm1pc3Npb25zLiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgICMgQ3JlYXRlIGEgZGVmYXVsdCBjb25maWcgZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0CiAgICBpZiBbICEgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgICAgIGNhdCA8PCdDRkcnID4gIiRDT05GSUdfRklMRSIKIyBmdWNraXRzIGNvbmZpZ3VyYXRpb24KIyBUb2dnbGUgdGhlIGV4cG9ydHMgYmVsb3cgdG8gY3VzdG9taXNlIHlvdXIgZXhwZXJpZW5jZS4KCiMgQ3VzdG9tIEFQSSBlbmRwb2ludCB0aGF0IHBvaW50cyB0byB5b3VyIHNlbGYtaG9zdGVkIHdvcmtlcgojIGV4cG9ydCBGVUNLX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly95b3VyLWRvbWFpbi53b3JrZXJzLmRldi8iCgojIExvY2FsIE9wZW5BSS1jb21wYXRpYmxlIEFQSSBrZXkgKHJlY29tbWVuZGVkKQojIGV4cG9ydCBGVUNLX09QRU5BSV9BUElfS0VZPSJzay0uLi4iCgojIE9wdGlvbmFsOiBvdmVycmlkZSBtb2RlbC9iYXNlIHdoZW4gdXNpbmcgeW91ciBvd24ga2V5CiMgZXhwb3J0IEZVQ0tfT1BFTkFJX01PREVMPSJncHQtNG8tbWluaSIKIyBleHBvcnQgRlVDS19PUEVOQUlfQVBJX0JBU0U9Imh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEiCgojIEFkZCBhbiBleHRyYSBhbGlhcyBiZXNpZGVzIHRoZSBkZWZhdWx0ICdmdWNrJwojIGV4cG9ydCBGVUNLX0FMSUFTPSJwbHMiCgojIFNraXAgY29uZmlybWF0aW9uIHByb21wdHMgKHVzZSB3aXRoIGNhdXRpb24hKQojIGV4cG9ydCBGVUNLX0FVVE9fRVhFQz1mYWxzZQoKIyBPdmVycmlkZSBjdXJsIHRpbWVvdXQgKHNlY29uZHMpCiMgZXhwb3J0IEZVQ0tfVElNRU9VVD0zMAoKIyBFbmFibGUgdmVyYm9zZSBkZWJ1ZyBsb2dzCiMgZXhwb3J0IEZVQ0tfREVCVUc9ZmFsc2UKCiMgRGlzYWJsZSB0aGUgYnVpbHQtaW4gJ2Z1Y2snIGFsaWFzCiMgZXhwb3J0IEZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTPWZhbHNlCkNGRwogICAgICAgIF9pbnN0YWxsZXJfc2VjdXJlX2NvbmZpZ19maWxlCiAgICBmaQoKICAgICMgQWRkIHNvdXJjZSBsaW5lIHRvIHNoZWxsIHByb2ZpbGUKICAgIGxvY2FsIHByb2ZpbGVfZmlsZQogICAgcHJvZmlsZV9maWxlPSQoX2luc3RhbGxlcl9kZXRlY3RfcHJvZmlsZSkKICAgIAogICAgaWYgWyAiJHByb2ZpbGVfZmlsZSIgPSAidW5rbm93bl9wcm9maWxlIiBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1JIGNhbid0IGZpbmQgLmJhc2hyYywgLnpzaHJjLCBvciAucHJvZmlsZS4gWW91J3JlIG9uIHlvdXIgb3duLiR7Q19SRVNFVH0iID4mMgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9TWFudWFsbHkgYWRkIHRoaXMgbGluZSB0byB3aGF0ZXZlciBzdGFydHVwIGZpbGUgeW91IHVzZToke0NfUkVTRVR9IiA+JjIKICAgICAgICBlY2hvIC1lICJcbiAgJHtDX0NZQU59c291cmNlICRNQUlOX1NIJHtDX1JFU0VUfVxuIiA+JjIKICAgICAgICByZXR1cm4KICAgIGZpCiAgICAKICAgIGxvY2FsIHNvdXJjZV9saW5lPSJzb3VyY2UgJE1BSU5fU0giCiAgICBpZiAhIGdyZXAgLXFGICIkc291cmNlX2xpbmUiICIkcHJvZmlsZV9maWxlIjsgdGhlbgogICAgICAgICMgRW5zdXJlIHRoZSBmaWxlIGVuZHMgd2l0aCBhIG5ld2xpbmUgYmVmb3JlIHdlIGFkZCBvdXIgbGluZXMKICAgICAgICBpZiBbIC1uICIkKHRhaWwgLWMxICIkcHJvZmlsZV9maWxlIikiIF07IHRoZW4KICAgICAgICAgICAgZWNobyAiIiA+PiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICBmaQogICAgICAgIGVjaG8gIiMgQWRkZWQgYnkgZnVja2l0cyBpbnN0YWxsZXIiID4+ICIkcHJvZmlsZV9maWxlIgogICAgICAgIGVjaG8gIiRzb3VyY2VfbGluZSIgPj4gIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX0dSRUVOfUl0J3MgaW5zdGFsbGVkLiBOb3cgZ2V0IHRvIHdvcmsuJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfVJlc3RhcnQgeW91ciBzaGVsbCwgb3IgcnVuICR7Q19CT0xEfXNvdXJjZSAkcHJvZmlsZV9maWxlJHtDX1lFTExPV30gdG8gc3RhcnQuJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICJcbiR7Q19CT0xEfS0tLSBIT1cgVE8gVVNFIC0tLSR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiSnVzdCB0eXBlICR7Q19SRURfQk9MRH1mdWNrJHtDX1JFU0VUfSBmb2xsb3dlZCBieSB3aGF0IHlvdSB3YW50IHRvIGRvLiIKICAgICAgICBlY2hvIC1lICJFeGFtcGxlczoiCiAgICAgICAgZWNobyAtZSAiICAke0NfQ1lBTn1mdWNrIGluc3RhbGwgZ2l0JHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19DWUFOfWZ1Y2sgdW5pbnN0YWxsIGdpdCR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiICAke0NfQ1lBTn1mdWNrIGZpbmQgYWxsIGZpbGVzIGxhcmdlciB0aGFuIDEwTUIgaW4gdGhlIGN1cnJlbnQgZGlyZWN0b3J5JHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19SRURfQk9MRH1mdWNrIHVuaW5zdGFsbCR7Q19SRVNFVH0gJHtDX0dSRUVOfSMgVW5pbnN0YWxscyAke0NfUkVTRVR9JHtDX1JFRH1mdWNrJHtDX1JFU0VUfSR7Q19HUkVFTn0gaXRzZWxmJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19SRURfQk9MRH1mdWNrIGNvbmZpZyR7Q19SRVNFVH0gJHtDX0dSRUVOfSMgU2hvdyBjb25maWd1cmF0aW9uIGhlbHAke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIlxuJHtDX1lFTExPV31SZW1lbWJlciB0byByZXN0YXJ0IHlvdXIgc2hlbGwgdG8gYmVnaW4hJHtDX1JFU0VUfSIKICAgIGVsc2UKICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfWUVMTE9XfUl0J3MgYWxyZWFkeSBpbnN0YWxsZWQsIGdlbml1cy4gSnVzdCB1cGRhdGVkIHRoZSBzY3JpcHQgZm9yIHlvdS4ke0NfUkVTRVR9IgogICAgZmkKfQoKCiMgLS0tIE1haW4gU2NyaXB0IEVudHJ5cG9pbnQgLS0tCgojIElmIGFyZ3VtZW50cyBhcmUgcGFzc2VkIChlLmcuLCAiYmFzaCAtcyAuLi4iKQppZiBbICIkIyIgLWd0IDAgXTsgdGhlbgogICAgaWYgWyAiJDEiID0gImluc3RhbGwiIF0gJiYgWyAiJCMiIC1lcSAxIF07IHRoZW4KICAgICAgICBfaW5zdGFsbF9zY3JpcHQKICAgICAgICBleGl0IDAKICAgIGZpCgogICAgX2Z1Y2tfc291cmNlX2NvcmUKICAgIF9mdWNrX2V4ZWN1dGVfcHJvbXB0ICIkQCIKZWxzZQogICAgX2luc3RhbGxfc2NyaXB0CmZpCg==`);
const INSTALLER_SCRIPT_ZH = b64_to_utf8(`IyEvYmluL2Jhc2gKIwojIOi/meaYryBmdWNraXRzIOeahOWuieijheWSjOS4tOaXtui/kOihjOiEmuacrAojIOasoui/juS9v+eUqAojCiMgLS0tIOWuieWFqOS9v+eUqOaWueazlSAtLS0KIwojIDEuIOS4i+i9vToKIyAgICBjdXJsIC1vIGZ1Y2tpdHMgaHR0cHM6Ly9mdWNraXRzLjI1NTAwNTUyLnh5ei96aAojCiMgMi4g5p+l55yL5Luj56CBOgojICAgIGxlc3MgZnVja2l0cwojCiMgMy4g6L+Q6KGMICjlronoo4UpOgojICAgIGJhc2ggZnVja2l0cwojCiMgNC4g6L+Q6KGMICjkuLTml7bkvb/nlKgpOgojICAgIGJhc2ggZnVja2l0cyAi5L2g55qE5ZG95LukIgojCgpzZXQgLWV1byBwaXBlZmFpbAoKIyAtLS0g6aKc6Imy5a6a5LmJIC0tLQpyZWFkb25seSBDX1JFU0VUPSdcMDMzWzBtJwpyZWFkb25seSBDX1JFRF9CT0xEPSdcMDMzWzE7MzFtJwpyZWFkb25seSBDX1JFRD0nXDAzM1swOzMxbScKcmVhZG9ubHkgQ19HUkVFTj0nXDAzM1swOzMybScKcmVhZG9ubHkgQ19ZRUxMT1c9J1wwMzNbMDszM20nCnJlYWRvbmx5IENfQ1lBTj0nXDAzM1swOzM2bScKcmVhZG9ubHkgQ19CT0xEPSdcMDMzWzFtJwpyZWFkb25seSBDX0RJTT0nXDAzM1sybScKCnJlYWRvbmx5IEZVQ0tJVFNfTE9DQUxFPSJ6aCIKCiMgLS0tIOaPkOekuuespiAtLS0KcmVhZG9ubHkgRlVDSz0iJHtDX1JFRF9CT0xEfVshXSR7Q19SRVNFVH0iCnJlYWRvbmx5IEZDS049IiR7Q19SRUR9W+aPkOekul0ke0NfUkVTRVR9IgoKCiMgLS0tIOmFjee9riAtLS0KaWYgWyAteiAiJHtIT01FOi19IiBdOyB0aGVuCiAgICBlY2hvIC1lICJcMDMzWzE7MzFt6ZSZ6K+vIVwwMzNbMG0gXDAzM1swOzMxbeaCqOeahCBIT01FIOeOr+Wig+WPmOmHj+acquiuvue9ru+8jOaXoOazleehruWumuWuieijheS9jee9ru+8jOivt+WFiOiuvue9ruivpeWPmOmHj+OAgiAo5L6L5aaCOiBleHBvcnQgSE9NRT0vcm9vdClcMDMzWzBtIiA+JjIKICAgIGV4aXQgMQpmaQpyZWFkb25seSBJTlNUQUxMX0RJUj0iJEhPTUUvLmZ1Y2siCnJlYWRvbmx5IE1BSU5fU0g9IiRJTlNUQUxMX0RJUi9tYWluLnNoIgpyZWFkb25seSBDT05GSUdfRklMRT0iJElOU1RBTExfRElSL2NvbmZpZy5zaCIKCgojIC0tLSDmoLjlv4PpgLvovpEgKOWhnui/m+S4gOS4quWtl+espuS4sumHjCkgLS0tCnJlYWQgLXIgLWQgJycgQ09SRV9MT0dJQyA8PCdFT0YnIHx8IHRydWUKCiMgLS0tIGZ1Y2tpdHMg5qC45b+D6YC76L6R5byA5aeLIC0tLQoKIyAtLS0g6aKc6Imy5a6a5LmJIC0tLQojIOWPquacieWcqOayoeWumuS5iei/h+minOiJsueahOaDheWGteS4i+aJjeWumuS5iSAo5Li05pe25qih5byP55SoKQppZiBbIC16ICIke0NfUkVTRVQ6LX0iIF07IHRoZW4KICAgIHJlYWRvbmx5IENfUkVTRVQ9J1wwMzNbMG0nCiAgICByZWFkb25seSBDX1JFRF9CT0xEPSdcMDMzWzE7MzFtJwogICAgcmVhZG9ubHkgQ19SRUQ9J1wwMzNbMDszMW0nCiAgICByZWFkb25seSBDX0dSRUVOPSdcMDMzWzA7MzJtJwogICAgcmVhZG9ubHkgQ19ZRUxMT1c9J1wwMzNbMDszM20nCiAgICByZWFkb25seSBDX0NZQU49J1wwMzNbMDszNm0nCiAgICByZWFkb25seSBDX0JPTEQ9J1wwMzNbMW0nCiAgICByZWFkb25seSBDX0RJTT0nXDAzM1sybScKCiAgICAjIC0tLSDmj5DnpLrnrKYgLS0tCiAgICByZWFkb25seSBGVUNLPSIke0NfUkVEX0JPTER9WyFdJHtDX1JFU0VUfSIKICAgIHJlYWRvbmx5IEZDS049IiR7Q19SRUR9W+aPkOekul0ke0NfUkVTRVR9IgoKZmkKCmlmIFsgLXogIiR7SU5TVEFMTF9ESVIreH0iIF0gfHwgWyAteiAiJHtNQUlOX1NIK3h9IiBdIHx8IFsgLXogIiR7Q09ORklHX0ZJTEUreH0iIF07IHRoZW4KICAgIGlmIFsgLXogIiR7SE9NRTotfSIgXTsgdGhlbgogICAgICAgIHJlYWRvbmx5IElOU1RBTExfRElSPSIvdG1wLy5mdWNrIgogICAgICAgIHJlYWRvbmx5IE1BSU5fU0g9Ii90bXAvLmZ1Y2svbWFpbi5zaCIKICAgICAgICByZWFkb25seSBDT05GSUdfRklMRT0iL3RtcC8uZnVjay9jb25maWcuc2giCiAgICBlbHNlCiAgICAgICAgcmVhZG9ubHkgSU5TVEFMTF9ESVI9IiRIT01FLy5mdWNrIgogICAgICAgIHJlYWRvbmx5IE1BSU5fU0g9IiRJTlNUQUxMX0RJUi9tYWluLnNoIgogICAgICAgIHJlYWRvbmx5IENPTkZJR19GSUxFPSIkSU5TVEFMTF9ESVIvY29uZmlnLnNoIgogICAgZmkKZmkKCiMg5aaC5p6c5a2Y5Zyo6YWN572u5paH5Lu25YiZ5Yqg6L29CmlmIFsgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgc291cmNlICIkQ09ORklHX0ZJTEUiCmZpCgppZiBbIC16ICIke0RFRkFVTFRfQVBJX0VORFBPSU5UK3h9IiBdOyB0aGVuCiAgICByZWFkb25seSBERUZBVUxUX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly9mdWNraXRzLjI1NTAwNTUyLnh5ei96aCIKZmkKCiMg5om+55So5oi3IHNoZWxsIOmFjee9ruaWh+S7tueahOi+heWKqeWHveaVsApfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKCkgewogICAgaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAienNoIjsgdGhlbgogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAiYmFzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8ucHJvZmlsZSIgXTsgdGhlbgogICAgICAgICMg5YW85a65IHNoLCBrc2gg562JCiAgICAgICAgZWNobyAiJEhPTUUvLnByb2ZpbGUiCiAgICBlbGlmIFsgLWYgIiRIT01FLy56c2hyYyIgXTsgdGhlbgogICAgICAgICMgU0hFTEwg5Y+Y6YeP5rKh6K6+572u5pe255qE5aSH55So5pa55qGICiAgICAgICAgZWNobyAiJEhPTUUvLnpzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8uYmFzaHJjIiBdOyB0aGVuCiAgICAgICAgIyBTSEVMTCDlj5jph4/msqHorr7nva7ml7bnmoTlpIfnlKjmlrnmoYgKICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxzZQogICAgICAgIGVjaG8gInVua25vd25fcHJvZmlsZSIKICAgIGZpCn0KCiMgLS0tIOezu+e7n+S/oeaBr+aUtumbhuaooeWdlyAtLS0KIyDpnZnmgIHns7vnu5/kv6Hmga/nvJPlrZjmlofku7bvvIjot6jov5DooYzmjIHkuYXljJbvvIkKIyDku4XlnKjmnKrlrprkuYnml7borr7nva7vvIjpmLLmraIgcmVhZC1vbmx5IOWPmOmHj+mUmeivr++8iQppZiBbIC16ICIke0ZVQ0tfU1lTSU5GT19DQUNIRV9GSUxFOi19IiBdOyB0aGVuCiAgICByZWFkb25seSBGVUNLX1NZU0lORk9fQ0FDSEVfRklMRT0iJElOU1RBTExfRElSLy5zeXNpbmZvLmNhY2hlIgpmaQojIOe8k+WtmOeKtuaAgei3n+i4quWPmOmHjwpfRlVDS19TVEFUSUNfQ0FDSEVfTE9BREVEPTAKX0ZVQ0tfU1RBVElDX0NBQ0hFX0RJUlRZPTAKCiMg5LuO57yT5a2Y5paH5Lu25Yqg6L296Z2Z5oCB57O757uf5L+h5oGvCiMg5YWo5bGA5Y+Y6YePOiBfRlVDS19TVEFUSUNfQ0FDSEVfTE9BREVELCBGVUNLX1NZU0lORk9fQ0FDSEVfRklMRQpfZnVja19sb2FkX3N0YXRpY19jYWNoZSgpIHsKICAgICMg5aaC5p6c57yT5a2Y5bey5Yqg6L295YiZ55u05o6l6L+U5ZueCiAgICBpZiBbICIke19GVUNLX1NUQVRJQ19DQUNIRV9MT0FERUQ6LTB9IiAtZXEgMSBdOyB0aGVuCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgX0ZVQ0tfU1RBVElDX0NBQ0hFX0xPQURFRD0xCgogICAgIyDlpoLmnpznvJPlrZjmlofku7blrZjlnKjliJnliqDovb0KICAgIGlmIFsgLWYgIiRGVUNLX1NZU0lORk9fQ0FDSEVfRklMRSIgXTsgdGhlbgogICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMTA5MAogICAgICAgIHNvdXJjZSAiJEZVQ0tfU1lTSU5GT19DQUNIRV9GSUxFIiB8fCB0cnVlCiAgICBmaQp9CgojIOagh+iusOmdmeaAgee8k+WtmOS4uuiEj++8iOmcgOimgeaMgeS5heWMlu+8iQojIOWFqOWxgOWPmOmHjzogX0ZVQ0tfU1RBVElDX0NBQ0hFX0RJUlRZCl9mdWNrX21hcmtfc3RhdGljX2NhY2hlX2RpcnR5KCkgewogICAgX0ZVQ0tfU1RBVElDX0NBQ0hFX0RJUlRZPTEKfQoKIyDlsIbpnZnmgIHns7vnu5/kv6Hmga/mjIHkuYXljJbliLDnvJPlrZjmlofku7YKIyDlhajlsYDlj5jph486IF9GVUNLX1NUQVRJQ19DQUNIRV9ESVJUWSwgRlVDS19TWVNJTkZPX0NBQ0hFX0ZJTEUKIyDov5Tlm57lgLw6IOaIkOWKn+i/lOWbniAw77yM5aSx6LSl6L+U5ZueIDEKX2Z1Y2tfcGVyc2lzdF9zdGF0aWNfY2FjaGUoKSB7CiAgICAjIOS7heWcqOe8k+WtmOiEj+aXtuaJjeaMgeS5heWMlgogICAgaWYgWyAiJHtfRlVDS19TVEFUSUNfQ0FDSEVfRElSVFk6LTB9IiAtbmUgMSBdOyB0aGVuCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgIyDnoa7kv53nvJPlrZjnm67lvZXlrZjlnKgKICAgIGxvY2FsIGNhY2hlX2RpcgogICAgY2FjaGVfZGlyPSQoZGlybmFtZSAiJEZVQ0tfU1lTSU5GT19DQUNIRV9GSUxFIikKICAgIGlmICEgbWtkaXIgLXAgIiRjYWNoZV9kaXIiIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgIyDliJvlu7rkuLTml7bmlofku7bov5vooYzljp/lrZDlhpnlhaUKICAgIGxvY2FsIHRtcF9maWxlCiAgICB0bXBfZmlsZT0kKG1rdGVtcCkgfHwgcmV0dXJuIDEKCiAgICAjIOWwhue8k+WtmOWPmOmHj+WGmeWFpeS4tOaXtuaWh+S7tgogICAgewogICAgICAgIHByaW50ZiAnX0ZVQ0tfQ0FDSEVEX0RJU1RSTz0lcVxcbicgIiR7X0ZVQ0tfQ0FDSEVEX0RJU1RSTzotfSIKICAgICAgICBwcmludGYgJ19GVUNLX0NBQ0hFRF9LRVJORUw9JXFcXG4nICIke19GVUNLX0NBQ0hFRF9LRVJORUw6LX0iCiAgICAgICAgcHJpbnRmICdfRlVDS19DQUNIRURfQVJDSD0lcVxcbicgIiR7X0ZVQ0tfQ0FDSEVEX0FSQ0g6LX0iCiAgICAgICAgcHJpbnRmICdfRlVDS19DQUNIRURfUEtHX01BTkFHRVI9JXFcXG4nICIke19GVUNLX0NBQ0hFRF9QS0dfTUFOQUdFUjotfSIKICAgIH0gPiAiJHRtcF9maWxlIgoKICAgICMg5Y6f5a2Q56e75Yqo5Yiw5pyA57uI5L2N572uCiAgICBpZiBtdiAiJHRtcF9maWxlIiAiJEZVQ0tfU1lTSU5GT19DQUNIRV9GSUxFIiAyPi9kZXYvbnVsbDsgdGhlbgogICAgICAgIF9GVUNLX1NUQVRJQ19DQUNIRV9ESVJUWT0wCiAgICAgICAgcmV0dXJuIDAKICAgIGVsc2UKICAgICAgICAjIOWksei0peaXtua4heeQhuS4tOaXtuaWh+S7tgogICAgICAgIHJtIC1mICIkdG1wX2ZpbGUiCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCn0KCiMg5qOA5rWL5Y+R6KGM54mIL+ezu+e7n+WutuaXj++8iOaUr+aMgee8k+WtmO+8iQojIOi+k+WHujog5Y+R6KGM54mI5a2X56ym5Liy77yI5aaC77yaIkRlYmlhbiDns7sgMTIuMDQgKFVidW50dSAyNC4wNCBMVFMpIu+8iQpfZnVja19kZXRlY3RfZGlzdHJvKCkgewogICAgX2Z1Y2tfbG9hZF9zdGF0aWNfY2FjaGUKCiAgICAjIOWmguaenOaciee8k+WtmOWAvOWImeebtOaOpei/lOWbngogICAgaWYgWyAtbiAiJHtfRlVDS19DQUNIRURfRElTVFJPOi19IiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICclc1xuJyAiJF9GVUNLX0NBQ0hFRF9ESVNUUk8iCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgbG9jYWwga2VybmVsX25hbWUgZGlzdHJvIGlkIHZlcnNpb24gcHJldHR5IGZhbWlseQogICAga2VybmVsX25hbWU9JCh1bmFtZSAtcyAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQogICAgZGlzdHJvPSJ1bmtub3duIgoKICAgICMgbWFjT1Mg5qOA5rWLCiAgICBpZiBbICIka2VybmVsX25hbWUiID0gIkRhcndpbiIgXTsgdGhlbgogICAgICAgIGxvY2FsIHByb2R1Y3QgdmVyc2lvbgogICAgICAgIHByb2R1Y3Q9JChzd192ZXJzIC1wcm9kdWN0TmFtZSAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ21hY09TJykKICAgICAgICBwcm9kdWN0PSQocHJpbnRmICclcycgIiRwcm9kdWN0IiB8IHRyIC1kICdcclxuJykKICAgICAgICB2ZXJzaW9uPSQoc3dfdmVycyAtcHJvZHVjdFZlcnNpb24gMj4vZGV2L251bGwgfHwgcHJpbnRmICd1bmtub3duJykKICAgICAgICB2ZXJzaW9uPSQocHJpbnRmICclcycgIiR2ZXJzaW9uIiB8IHRyIC1kICdcclxuJykKICAgICAgICBkaXN0cm89IiRwcm9kdWN0ICR2ZXJzaW9uIgogICAgIyBMaW51eCDkvb/nlKggL2V0Yy9vcy1yZWxlYXNlIOajgOa1iwogICAgZWxpZiBbIC1yIC9ldGMvb3MtcmVsZWFzZSBdOyB0aGVuCiAgICAgICAgaWQ9JChncmVwIC1FICdeSUQ9JyAvZXRjL29zLXJlbGVhc2UgfCBoZWFkIC1uMSB8IGN1dCAtZD0gLWYyIHwgdHIgLWQgJyInIHwgdHIgJ1s6dXBwZXI6XScgJ1s6bG93ZXI6XScpCiAgICAgICAgdmVyc2lvbj0kKGdyZXAgLUUgJ15WRVJTSU9OX0lEPScgL2V0Yy9vcy1yZWxlYXNlIHwgaGVhZCAtbjEgfCBjdXQgLWQ9IC1mMiB8IHRyIC1kICciJykKICAgICAgICBwcmV0dHk9JChncmVwIC1FICdeUFJFVFRZX05BTUU9JyAvZXRjL29zLXJlbGVhc2UgfCBoZWFkIC1uMSB8IGN1dCAtZD0gLWYyLSB8IHRyIC1kICciJykKCiAgICAgICAgIyDnoa7lrprns7vnu5/lrrbml4/ku6Xkvr/mm7Tlpb3lnLDliIbnsbsKICAgICAgICBmYW1pbHk9IiIKICAgICAgICBjYXNlICIkaWQiIGluCiAgICAgICAgICAgIHVidW50dXxkZWJpYW4pCiAgICAgICAgICAgICAgICBmYW1pbHk9IkRlYmlhbiDns7siCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICBjZW50b3N8cmhlbHxyb2NreXxhbG1hbGludXh8ZmVkb3JhKQogICAgICAgICAgICAgICAgZmFtaWx5PSJSSEVMIOezuyIKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIGFyY2h8bWFuamFyb3xlbmRlYXZvdXJvcykKICAgICAgICAgICAgICAgIGZhbWlseT0iQXJjaCDns7siCiAgICAgICAgICAgICAgICA7OwogICAgICAgIGVzYWMKCiAgICAgICAgIyDmoLzlvI/ljJblj5HooYzniYjlrZfnrKbkuLLvvIzljIXlkKvlrrbml4/lkozniYjmnKzkv6Hmga8KICAgICAgICBpZiBbIC1uICIkZmFtaWx5IiBdOyB0aGVuCiAgICAgICAgICAgIGRpc3Rybz0iJGZhbWlseSAke3ZlcnNpb246LX0iCiAgICAgICAgICAgIGlmIFsgLW4gIiRwcmV0dHkiIF07IHRoZW4KICAgICAgICAgICAgICAgIGRpc3Rybz0iJGRpc3RybyAoJHtwcmV0dHl9KSIKICAgICAgICAgICAgZmkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRpc3Rybz0iJHtwcmV0dHk6LUxpbnV4ICR2ZXJzaW9ufSIKICAgICAgICBmaQogICAgZWxzZQogICAgICAgIGRpc3Rybz0iJGtlcm5lbF9uYW1lIgogICAgZmkKCiAgICAjIOe8k+WtmOW5tui/lOWbnue7k+aenAogICAgX0ZVQ0tfQ0FDSEVEX0RJU1RSTz0iJGRpc3RybyIKICAgIF9mdWNrX21hcmtfc3RhdGljX2NhY2hlX2RpcnR5CiAgICBwcmludGYgJyVzXG4nICIkZGlzdHJvIgp9CgojIOiOt+WPluWGheaguOeJiOacrOS/oeaBr++8iOaUr+aMgee8k+WtmO+8iQojIOi+k+WHujog5YaF5qC454mI5pys5a2X56ym5Liy77yI5aaC77yaIkxpbnV4IDYuOC4wLTMxLWdlbmVyaWMi77yJCl9mdWNrX2dldF9rZXJuZWxfdmVyc2lvbigpIHsKICAgIF9mdWNrX2xvYWRfc3RhdGljX2NhY2hlCgogICAgIyDlpoLmnpzmnInnvJPlrZjlgLzliJnnm7TmjqXov5Tlm54KICAgIGlmIFsgLW4gIiR7X0ZVQ0tfQ0FDSEVEX0tFUk5FTDotfSIgXTsgdGhlbgogICAgICAgIHByaW50ZiAnJXNcbicgIiRfRlVDS19DQUNIRURfS0VSTkVMIgogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIGxvY2FsIGtlcm5lbAogICAga2VybmVsPSQodW5hbWUgLXNyIDI+L2Rldi9udWxsIHx8IHVuYW1lIC1zIDI+L2Rldi9udWxsIHx8IHByaW50ZiAndW5rbm93bicpCiAgICBrZXJuZWw9JChwcmludGYgJyVzJyAiJGtlcm5lbCIgfCB0ciAtZCAnXHJcbicpCgogICAgIyDnvJPlrZjlubbov5Tlm57nu5PmnpwKICAgIF9GVUNLX0NBQ0hFRF9LRVJORUw9IiRrZXJuZWwiCiAgICBfZnVja19tYXJrX3N0YXRpY19jYWNoZV9kaXJ0eQogICAgcHJpbnRmICclc1xuJyAiJGtlcm5lbCIKfQoKIyDojrflj5bns7vnu5/mnrbmnoTvvIjmlK/mjIHnvJPlrZjvvIkKIyDovpPlh7o6IOaetuaehOWtl+espuS4su+8iOWmgu+8miJ4ODZfNjQiLCAiYXJtNjQi77yJCl9mdWNrX2dldF9hcmNoaXRlY3R1cmUoKSB7CiAgICBfZnVja19sb2FkX3N0YXRpY19jYWNoZQoKICAgICMg5aaC5p6c5pyJ57yT5a2Y5YC85YiZ55u05o6l6L+U5ZueCiAgICBpZiBbIC1uICIke19GVUNLX0NBQ0hFRF9BUkNIOi19IiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICclc1xuJyAiJF9GVUNLX0NBQ0hFRF9BUkNIIgogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIGxvY2FsIGFyY2gKICAgIGFyY2g9JCh1bmFtZSAtbSAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQogICAgYXJjaD0kKHByaW50ZiAnJXMnICIkYXJjaCIgfCB0ciAtZCAnXHJcbicpCgogICAgIyDnvJPlrZjlubbov5Tlm57nu5PmnpwKICAgIF9GVUNLX0NBQ0hFRF9BUkNIPSIkYXJjaCIKICAgIF9mdWNrX21hcmtfc3RhdGljX2NhY2hlX2RpcnR5CiAgICBwcmludGYgJyVzXG4nICIkYXJjaCIKfQoKIyDmlLbpm4bnlKjmiLfkv6Hmga/ljIXmi6zmnYPpmZDnuqfliKsKIyDovpPlh7o6IOeUqOaIt+S/oeaBr+Wtl+espuS4su+8iOWmgu+8miJVc2VyPWpvaG4gdWlkPTEwMDAgbGV2ZWw9c3Vkb2VyIEdyb3Vwcz1qb2huIGFkbSBzdWRvIu+8iQpfZnVja19jb2xsZWN0X3VzZXJfaW5mbygpIHsKICAgIGxvY2FsIGN1cnJlbnRfdXNlciB1aWQgZ3JvdXBzIGxldmVsCiAgICBjdXJyZW50X3VzZXI9IiR7VVNFUjotfSIKCiAgICAjIOWmguaenCBVU0VSIOacquiuvue9ruWImeS9v+eUqOWkh+eUqOaWueazlQogICAgaWYgWyAteiAiJGN1cnJlbnRfdXNlciIgXTsgdGhlbgogICAgICAgIGN1cnJlbnRfdXNlcj0kKHdob2FtaSAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQogICAgZmkKCiAgICAjIOWmguaenCBpZCDlkb3ku6Tlj6/nlKjliJnojrflj5YgVUlEIOWSjOeUqOaIt+e7hAogICAgdWlkPSJ1bmtub3duIgogICAgZ3JvdXBzPSJ1bmtub3duIgogICAgaWYgY29tbWFuZCAtdiBpZCA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICB1aWQ9JChpZCAtdSAiJGN1cnJlbnRfdXNlciIgMj4vZGV2L251bGwgfHwgaWQgLXUgMj4vZGV2L251bGwgfHwgcHJpbnRmICd1bmtub3duJykKICAgICAgICBncm91cHM9JChpZCAtR24gIiRjdXJyZW50X3VzZXIiIDI+L2Rldi9udWxsIHx8IGlkIC1HbiAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQogICAgZmkKCiAgICAjIOehruWumuadg+mZkOe6p+WIqwogICAgbGV2ZWw9InVzZXIiCiAgICBpZiBbICIkdWlkIiA9ICIwIiBdOyB0aGVuCiAgICAgICAgbGV2ZWw9InJvb3QiCiAgICBlbGlmIHByaW50ZiAnJXMnICIkZ3JvdXBzIiB8IGdyZXAgLUVxICcoXnxbWzpzcGFjZTpdXSkoc3Vkb3x3aGVlbHxhZG1pbikoW1s6c3BhY2U6XV18JCknOyB0aGVuCiAgICAgICAgbGV2ZWw9InN1ZG9lciIKICAgIGZpCgogICAgcHJpbnRmICdVc2VyPSVzIHVpZD0lcyBsZXZlbD0lcyBHcm91cHM9JXMnICIkY3VycmVudF91c2VyIiAiJHVpZCIgIiRsZXZlbCIgIiRncm91cHMiCn0KCiMg5pS26ZuG5bi455So5byA5Y+R5bel5YW355qE54mI5pys5L+h5oGvCiMg6L6T5Ye6OiDlt6XlhbfniYjmnKzlrZfnrKbkuLLvvIjlpoLvvJoiZ2l0OmdpdCB2ZXJzaW9uIDIuMzQuMTsgZG9ja2VyOkRvY2tlciB2ZXJzaW9uIDI0LjAuNjsgLi4uIu+8iQpfZnVja19jb2xsZWN0X3Rvb2xfdmVyc2lvbnMoKSB7CiAgICBsb2NhbCB0b29scyB0b29sIHZlcnNpb24gcmVzdWx0CiAgICB0b29scz0iZ2l0IGRvY2tlciBucG0ga3ViZWN0bCBjdXJsIHdnZXQiCiAgICByZXN1bHQ9IiIKCiAgICBmb3IgdG9vbCBpbiAkdG9vbHM7IGRvCiAgICAgICAgdmVyc2lvbj0ibm90LWluc3RhbGxlZCIKCiAgICAgICAgaWYgY29tbWFuZCAtdiAiJHRvb2wiID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgICAgICBjYXNlICIkdG9vbCIgaW4KICAgICAgICAgICAgICAgIGdpdHxkb2NrZXJ8Y3VybHx3Z2V0KQogICAgICAgICAgICAgICAgICAgIHZlcnNpb249JCgiJHRvb2wiIC0tdmVyc2lvbiAyPi9kZXYvbnVsbCB8IGhlYWQgLW4xKQogICAgICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgICAgICBucG0pCiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbj0kKCIkdG9vbCIgLS12ZXJzaW9uIDI+L2Rldi9udWxsIHwgaGVhZCAtbjEpCiAgICAgICAgICAgICAgICAgICAgWyAtbiAiJHZlcnNpb24iIF0gJiYgdmVyc2lvbj0ibnBtICR2ZXJzaW9uIgogICAgICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgICAgICBrdWJlY3RsKQogICAgICAgICAgICAgICAgICAgIHZlcnNpb249JCgiJHRvb2wiIHZlcnNpb24gLS1jbGllbnQgLS1zaG9ydCAyPi9kZXYvbnVsbCB8IGhlYWQgLW4xKQogICAgICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIGVzYWMKICAgICAgICBmaQoKICAgICAgICAjIOa4heeQhueJiOacrOWtl+espuS4sgogICAgICAgIHZlcnNpb249JChwcmludGYgJyVzJyAiJHt2ZXJzaW9uOi11bmtub3dufSIgfCB0ciAnXHJcbicgJyAgJyB8IHRyIC1zICcgJyB8IHNlZCAtZSAncy9eICovLycgLWUgJ3MvICokLy8nKQogICAgICAgIFsgLXogIiR2ZXJzaW9uIiBdICYmIHZlcnNpb249InVua25vd24iCgogICAgICAgIHJlc3VsdD0iJHJlc3VsdCR0b29sOiR2ZXJzaW9uOyAiCiAgICBkb25lCgogICAgIyDnp7vpmaTmnKvlsL7nmoTliIblj7flkoznqbrmoLwKICAgIHJlc3VsdD0iJHtyZXN1bHQlOyB9IgogICAgcHJpbnRmICclcycgIiRyZXN1bHQiCn0KCiMg5qOA5rWL5YyF566h55CG5Zmo77yI5pSv5oyB57yT5a2Y77yJCiMg6L6T5Ye6OiDljIXnrqHnkIblmajlkI3np7DvvIhhcHQsIHl1bSwgZG5mLCBwYWNtYW4sIHp5cHBlciwgYnJldywgdW5rbm93bu+8iQpfZnVja19kZXRlY3RfcGtnX21hbmFnZXIoKSB7CiAgICBfZnVja19sb2FkX3N0YXRpY19jYWNoZQoKICAgICMg5aaC5p6c5pyJ57yT5a2Y5YC85YiZ55u05o6l6L+U5ZueCiAgICBpZiBbIC1uICIke19GVUNLX0NBQ0hFRF9QS0dfTUFOQUdFUjotfSIgXTsgdGhlbgogICAgICAgIHByaW50ZiAnJXNcbicgIiRfRlVDS19DQUNIRURfUEtHX01BTkFHRVIiCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgbG9jYWwgbWFuYWdlcj0idW5rbm93biIKCiAgICAjIOaMieS8mOWFiOe6p+ajgOa1i+WMheeuoeeQhuWZqAogICAgaWYgY29tbWFuZCAtdiBhcHQtZ2V0ICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIG1hbmFnZXI9ImFwdCIKICAgIGVsaWYgY29tbWFuZCAtdiB5dW0gJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgbWFuYWdlcj0ieXVtIgogICAgZWxpZiBjb21tYW5kIC12IGRuZiAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBtYW5hZ2VyPSJkbmYiCiAgICBlbGlmIGNvbW1hbmQgLXYgcGFjbWFuICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIG1hbmFnZXI9InBhY21hbiIKICAgIGVsaWYgY29tbWFuZCAtdiB6eXBwZXIgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgbWFuYWdlcj0ienlwcGVyIgogICAgZWxpZiBjb21tYW5kIC12IGJyZXcgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgbWFuYWdlcj0iYnJldyIKICAgIGZpCgogICAgIyDnvJPlrZjlubbov5Tlm57nu5PmnpwKICAgIF9GVUNLX0NBQ0hFRF9QS0dfTUFOQUdFUj0iJG1hbmFnZXIiCiAgICBfZnVja19tYXJrX3N0YXRpY19jYWNoZV9kaXJ0eQogICAgcHJpbnRmICclc1xuJyAiJG1hbmFnZXIiCn0KCiMg5pS26ZuG566A5YyW55qE57O757uf5L+h5oGv5bm25qC85byP5YyW5Li657uT5p6E5YyW5a2X56ym5LiyCiMg6L6T5Ye6OiDnlKjkuo4gQUkg5aSE55CG55qE57O757uf5L+h5oGv5a2X56ym5LiyCl9mdWNrX2NvbGxlY3Rfc3lzaW5mb19zdHJpbmcoKSB7CiAgICBsb2NhbCBvc190eXBlIGtlcm5lbF9uYW1lIHBrZ19tYW5hZ2VyIHN1bW1hcnkKCiAgICAjIOajgOa1i+aTjeS9nOezu+e7n+exu+WeiwogICAga2VybmVsX25hbWU9JCh1bmFtZSAtcyAyPi9kZXYvbnVsbCB8fCBwcmludGYgJ3Vua25vd24nKQoKICAgIGNhc2UgIiRrZXJuZWxfbmFtZSIgaW4KICAgICAgICBEYXJ3aW4pCiAgICAgICAgICAgIG9zX3R5cGU9Im1hY09TIgogICAgICAgICAgICBwa2dfbWFuYWdlcj0iYnJldyIKICAgICAgICAgICAgOzsKICAgICAgICBMaW51eCkKICAgICAgICAgICAgaWYgWyAtciAvZXRjL29zLXJlbGVhc2UgXTsgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaWQKICAgICAgICAgICAgICAgIGlkPSQoZ3JlcCAtRSAnXklEPScgL2V0Yy9vcy1yZWxlYXNlIHwgaGVhZCAtbjEgfCBjdXQgLWQ9IC1mMiB8IHRyIC1kICciJyB8IHRyICdbOnVwcGVyOl0nICdbOmxvd2VyOl0nKQogICAgICAgICAgICAgICAgY2FzZSAiJGlkIiBpbgogICAgICAgICAgICAgICAgICAgIHVidW50dXxkZWJpYW4pCiAgICAgICAgICAgICAgICAgICAgICAgIG9zX3R5cGU9IkRlYmlhbiIKICAgICAgICAgICAgICAgICAgICAgICAgcGtnX21hbmFnZXI9ImFwdCIKICAgICAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgICAgICBjZW50b3N8cmhlbHxyb2NreXxhbG1hbGludXh8ZmVkb3JhKQogICAgICAgICAgICAgICAgICAgICAgICBvc190eXBlPSJSSEVMIgogICAgICAgICAgICAgICAgICAgICAgICBwa2dfbWFuYWdlcj0ieXVtIgogICAgICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAgICAgICAgIGFyY2h8bWFuamFybykKICAgICAgICAgICAgICAgICAgICAgICAgb3NfdHlwZT0iQXJjaCIKICAgICAgICAgICAgICAgICAgICAgICAgcGtnX21hbmFnZXI9InBhY21hbiIKICAgICAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgICAgICAqKQogICAgICAgICAgICAgICAgICAgICAgICBvc190eXBlPSJMaW51eCIKICAgICAgICAgICAgICAgICAgICAgICAgcGtnX21hbmFnZXI9InVua25vd24iCiAgICAgICAgICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgICAgICBlc2FjCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG9zX3R5cGU9IkxpbnV4IgogICAgICAgICAgICAgICAgcGtnX21hbmFnZXI9InVua25vd24iCiAgICAgICAgICAgIGZpCiAgICAgICAgICAgIDs7CiAgICAgICAgTUlOR1cqfE1TWVMqfENZR1dJTiopCiAgICAgICAgICAgIG9zX3R5cGU9IldpbmRvd3MiCiAgICAgICAgICAgIHBrZ19tYW5hZ2VyPSJ1bmtub3duIgogICAgICAgICAgICA7OwogICAgICAgICopCiAgICAgICAgICAgIG9zX3R5cGU9IiRrZXJuZWxfbmFtZSIKICAgICAgICAgICAgcGtnX21hbmFnZXI9InVua25vd24iCiAgICAgICAgICAgIDs7CiAgICBlc2FjCgogICAgIyDmoLzlvI/ljJbkuLrnroDljZXnmoTnu5PmnoTljJblrZfnrKbkuLIKICAgIHByaW50ZiAtdiBzdW1tYXJ5ICdPUz0lczsgUGtnTWdyPSVzJyAiJG9zX3R5cGUiICIkcGtnX21hbmFnZXIiCiAgICBwcmludGYgJyVzXG4nICIkc3VtbWFyeSIKfQoKX2Z1Y2tfanNvbl9lc2NhcGUoKSB7CiAgICBsb2NhbCBpbnB1dD0iJDEiCiAgICAjIOS9v+eUqCBwcmludGYg5q2j56Gu5aSE55CG5o6n5Yi25a2X56ymCiAgICBwcmludGYgJyVzJyAiJGlucHV0IiB8IHNlZCAtZSAnCiAgICAgICAgIyDpppblhYjovazkuYnlj43mlpzmnaDvvIjlv4XpobvmmK/nrKzkuIDkuKrvvIkKICAgICAgICBzL1xcL1xcXFwvZwogICAgICAgICMg6L2s5LmJ5Y+M5byV5Y+3CiAgICAgICAgcy8iL1xcIi9nCiAgICAgICAgIyDovazkuYnmjqfliLblrZfnrKbvvIhBU0NJSSAwLTMx77yJCiAgICAgICAgcy9ceDAwL1xcdTAwMDAvZwogICAgICAgIHMvXHgwMS9cXHUwMDAxL2cKICAgICAgICBzL1x4MDIvXFx1MDAwMi9nCiAgICAgICAgcy9ceDAzL1xcdTAwMDMvZwogICAgICAgIHMvXHgwNC9cXHUwMDA0L2cKICAgICAgICBzL1x4MDUvXFx1MDAwNS9nCiAgICAgICAgcy9ceDA2L1xcdTAwMDYvZwogICAgICAgIHMvXHgwNy9cXHUwMDA3L2cKICAgICAgICBzL1x4MDgvXFxiL2cKICAgICAgICBzL1x4MDkvXFx0L2cKICAgICAgICBzL1x4MEEvXFxuL2cKICAgICAgICBzL1x4MEIvXFx1MDAwQi9nCiAgICAgICAgcy9ceDBDL1xcZi9nCiAgICAgICAgcy9ceDBEL1xcci9nCiAgICAgICAgcy9ceDBFL1xcdTAwMEUvZwogICAgICAgIHMvXHgwRi9cXHUwMDBGL2cKICAgICAgICBzL1x4MTAvXFx1MDAxMC9nCiAgICAgICAgcy9ceDExL1xcdTAwMTEvZwogICAgICAgIHMvXHgxMi9cXHUwMDEyL2cKICAgICAgICBzL1x4MTMvXFx1MDAxMy9nCiAgICAgICAgcy9ceDE0L1xcdTAwMTQvZwogICAgICAgIHMvXHgxNS9cXHUwMDE1L2cKICAgICAgICBzL1x4MTYvXFx1MDAxNi9nCiAgICAgICAgcy9ceDE3L1xcdTAwMTcvZwogICAgICAgIHMvXHgxOC9cXHUwMDE4L2cKICAgICAgICBzL1x4MTkvXFx1MDAxOS9nCiAgICAgICAgcy9ceDFBL1xcdTAwMUEvZwogICAgICAgIHMvXHgxQi9cXHUwMDFCL2cKICAgICAgICBzL1x4MUMvXFx1MDAxQy9nCiAgICAgICAgcy9ceDFEL1xcdTAwMUQvZwogICAgICAgIHMvXHgxRS9cXHUwMDFFL2cKICAgICAgICBzL1x4MUYvXFx1MDAxRi9nCiAgICAnCn0KCl9mdWNrX3Nob3VsZF91c2VfbG9jYWxfYXBpKCkgewogICAgaWYgWyAtbiAiJHtGVUNLX09QRU5BSV9BUElfS0VZOi19IiBdOyB0aGVuCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCiAgICByZXR1cm4gMQp9CgpfZnVja19sb2NhbF9zeXN0ZW1fcHJvbXB0KCkgewogICAgbG9jYWwgc3lzaW5mbz0iJDEiCiAgICBpZiBbICIkRlVDS0lUU19MT0NBTEUiID0gInpoIiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICfkvaDmmK/kuIDkuKrkuJPkuJrnmoQgc2hlbGwg6ISa5pys55Sf5oiQ5Zmo44CC55So5oi35Lya5o+Q5L6b5LuW5Lus55qE57O757uf5L+h5oGv5ZKM5LiA5Liq5ZG95Luk44CC5L2g55qE5Lu75Yqh5piv6L+U5Zue5LiA5Liq5Y+v5omn6KGM55qE44CB5Y6f5aeL55qEIHNoZWxsIOiEmuacrOadpeWujOaIkOS7luS7rOeahOebruagh+OAguiEmuacrOWPr+S7peaYr+WkmuihjOeahOOAguS4jeimgeaPkOS+m+S7u+S9leino+mHiuOAgeazqOmHiuOAgW1hcmtkb3duIOagvOW8j++8iOavlOWmgiBgYGBiYXNo77yJ5oiWIHNoZWJhbmfvvIjkvovlpoIgIyEvYmluL2Jhc2jvvInjgILlj6rpnIDopoHljp/lp4vnmoTohJrmnKzlhoXlrrnjgILnlKjmiLfnmoTns7vnu5/kv6Hmga/mmK/vvJolcycgIiRzeXNpbmZvIgogICAgZWxzZQogICAgICAgIHByaW50ZiAnWW91IGFyZSBhbiBleHBlcnQgc2hlbGwgc2NyaXB0IGdlbmVyYXRvci4gQSB1c2VyIHdpbGwgcHJvdmlkZSB0aGVpciBzeXN0ZW0gaW5mb3JtYXRpb24gYW5kIGEgcHJvbXB0LiBZb3VyIHRhc2sgaXMgdG8gcmV0dXJuIGEgcmF3LCBleGVjdXRhYmxlIHNoZWxsIHNjcmlwdCB0aGF0IGFjY29tcGxpc2hlcyB0aGVpciBnb2FsLiBUaGUgc2NyaXB0IGNhbiBiZSBtdWx0aS1saW5lLiBEbyBub3QgcHJvdmlkZSBhbnkgZXhwbGFuYXRpb24sIGNvbW1lbnRzLCBtYXJrZG93biBmb3JtYXR0aW5nIChsaWtlIGBgYGJhc2gpLCBvciBhIHNoZWJhbmcgKGUuZy4sICMhL2Jpbi9iYXNoKS4gSnVzdCB0aGUgcmF3IHNjcmlwdCBjb250ZW50LiBUaGUgdXNlciciJyIncyBzeXN0ZW0gaW5mbyBpczogJXMnICIkc3lzaW5mbyIKICAgIGZpCn0KCl9mdWNrX2V4dHJhY3RfY29tbWFuZF9mcm9tX2pzb24oKSB7CiAgICBsb2NhbCBqc29uX2ZpbGU9IiQxIgogICAgaWYgY29tbWFuZCAtdiBweXRob24zID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgIHB5dGhvbjMgLSAiJGpzb25fZmlsZSIgPDwnUFkyJwppbXBvcnQganNvbiwgc3lzCnBhdGggPSBzeXMuYXJndlsxXQp3aXRoIG9wZW4ocGF0aCwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgZGF0YSA9IGpzb24ubG9hZChmKQpjaG9pY2VzID0gZGF0YS5nZXQoJ2Nob2ljZXMnKSBvciBbXQppZiBub3QgY2hvaWNlczoKICAgIHN5cy5leGl0KDEpCm1lc3NhZ2UgPSBjaG9pY2VzWzBdLmdldCgnbWVzc2FnZScpIG9yIHt9CmNvbnRlbnQgPSAobWVzc2FnZS5nZXQoJ2NvbnRlbnQnKSBvciAnJykuc3RyaXAoKQppZiBub3QgY29udGVudDoKICAgIHN5cy5leGl0KDEpCnByaW50KGNvbnRlbnQpClBZMgogICAgICAgIHJldHVybgogICAgZmkKCiAgICBpZiBjb21tYW5kIC12IG5vZGUgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgbm9kZSAtICIkanNvbl9maWxlIiA8PCdKUzInCmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTsKY29uc3QgcGF0aCA9IHByb2Nlc3MuYXJndlsxXTsKY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHBhdGgsICd1dGY4JykpOwpjb25zdCBjaG9pY2UgPSAoZGF0YS5jaG9pY2VzICYmIGRhdGEuY2hvaWNlc1swXSkgfHwge307CmNvbnN0IG1lc3NhZ2UgPSBjaG9pY2UubWVzc2FnZSB8fCB7fTsKY29uc3QgY29udGVudCA9IChtZXNzYWdlLmNvbnRlbnQgfHwgJycpLnRyaW0oKTsKaWYgKCFjb250ZW50KSB7CiAgcHJvY2Vzcy5leGl0KDEpOwp9CmNvbnNvbGUubG9nKGNvbnRlbnQpOwpKUzIKICAgICAgICByZXR1cm4KICAgIGZpCgogICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH3ml6Dms5Xop6PmnpDmqKHlnovov5Tlm57nmoTmlbDmja7vvIzor7flronoo4UgcHl0aG9uMyDmiJYgbm9kZeOAgiR7Q19SRVNFVH0iID4mMgogICAgcmV0dXJuIDEKfQoKX2Z1Y2tfcmVxdWVzdF9sb2NhbF9tb2RlbCgpIHsKICAgIGxvY2FsIHByb21wdD0iJDEiCiAgICBsb2NhbCBzeXNpbmZvPSIkMiIKICAgIGxvY2FsIGN1cmxfdGltZW91dD0iJDMiCgogICAgbG9jYWwgYXBpX2tleT0iJHtGVUNLX09QRU5BSV9BUElfS0VZOi19IgogICAgaWYgWyAteiAiJGFwaV9rZXkiIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeacqumFjee9ruacrOWcsCBBUEkgS2V577yM6K+35ZyoIH4vLmZ1Y2svY29uZmlnLnNoIOS4reiuvue9riBGVUNLX09QRU5BSV9BUElfS0VZ44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgbG9jYWwgbW9kZWw9IiR7RlVDS19PUEVOQUlfTU9ERUw6LWdwdC01LW5hbm99IgogICAgbG9jYWwgYXBpX2Jhc2U9IiR7RlVDS19PUEVOQUlfQVBJX0JBU0U6LWh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjF9IgogICAgYXBpX2Jhc2U9JHthcGlfYmFzZSUvfQogICAgbG9jYWwgYXBpX3VybD0iJGFwaV9iYXNlL2NoYXQvY29tcGxldGlvbnMiCgogICAgX2Z1Y2tfZGVidWcgIuacrOWcsCBBUEkg5Z+65Z2AOiAkYXBpX2Jhc2UiCiAgICBfZnVja19kZWJ1ZyAi5pys5Zyw5qih5Z6LOiAkbW9kZWwiCgogICAgbG9jYWwgc3lzdGVtX3Byb21wdAogICAgc3lzdGVtX3Byb21wdD0kKF9mdWNrX2xvY2FsX3N5c3RlbV9wcm9tcHQgIiRzeXNpbmZvIikKCiAgICBsb2NhbCBwYXlsb2FkCiAgICBwYXlsb2FkPSQocHJpbnRmICd7ICJtb2RlbCI6ICIlcyIsICJtZXNzYWdlcyI6IFsgeyJyb2xlIjoic3lzdGVtIiwiY29udGVudCI6IiVzIn0sIHsicm9sZSI6InVzZXIiLCJjb250ZW50IjoiJXMifSBdLCAibWF4X3Rva2VucyI6IDEwMjQsICJ0ZW1wZXJhdHVyZSI6IDAuMiB9JyBcCiAgICAgICAgIiRtb2RlbCIgIiQoX2Z1Y2tfanNvbl9lc2NhcGUgIiRzeXN0ZW1fcHJvbXB0IikiICIkKF9mdWNrX2pzb25fZXNjYXBlICIkcHJvbXB0IikiKQoKICAgIGxvY2FsIHRtcF9qc29uCiAgICB0bXBfanNvbj0kKG1rdGVtcCkgfHwgcmV0dXJuIDEKCiAgICBpZiAhIGN1cmwgLWZzUyAtLW1heC10aW1lICIkY3VybF90aW1lb3V0IiAiJGFwaV91cmwiIFwKICAgICAgICAtSCAiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uIiBcCiAgICAgICAgLUggIkF1dGhvcml6YXRpb246IEJlYXJlciAkYXBpX2tleSIgXAogICAgICAgIC1kICIkcGF5bG9hZCIgPiAiJHRtcF9qc29uIjsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR95pys5ZywIEFQSSDor7fmsYLlpLHotKXjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICBjYXQgIiR0bXBfanNvbiIgPiYyCiAgICAgICAgcm0gLWYgIiR0bXBfanNvbiIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBsb2NhbCBjb21tYW5kX291dHB1dAogICAgaWYgISBjb21tYW5kX291dHB1dD0kKF9mdWNrX2V4dHJhY3RfY29tbWFuZF9mcm9tX2pzb24gIiR0bXBfanNvbiIpOyB0aGVuCiAgICAgICAgcm0gLWYgIiR0bXBfanNvbiIKICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeaXoOazleino+aekOaooeWei+i/lOWbnuWGheWuueOAgiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgIHJtIC1mICIkdG1wX2pzb24iCiAgICBwcmludGYgJyVzXG4nICIkY29tbWFuZF9vdXRwdXQiCn0KCl9mdWNrX3JlcXVlc3Rfd29ya2VyX21vZGVsKCkgewogICAgbG9jYWwgcHJvbXB0PSIkMSIKICAgIGxvY2FsIHN5c2luZm89IiQyIgogICAgbG9jYWwgY3VybF90aW1lb3V0PSIkMyIKCiAgICBsb2NhbCBhZG1pbl9rZXk9IiR7RlVDS19BRE1JTl9LRVk6LX0iCiAgICBsb2NhbCBhZG1pbl9zZWdtZW50PSIiCiAgICBpZiBbIC1uICIkYWRtaW5fa2V5IiBdOyB0aGVuCiAgICAgICAgYWRtaW5fc2VnbWVudD0kKHByaW50ZiAnLCAiYWRtaW5LZXkiOiAiJXMiJyAiJCggX2Z1Y2tfanNvbl9lc2NhcGUgIiRhZG1pbl9rZXkiICkiKQogICAgZmkKCiAgICBsb2NhbCBwYXlsb2FkCiAgICBwYXlsb2FkPSQocHJpbnRmICd7ICJzeXNpbmZvIjogIiVzIiwgInByb21wdCI6ICIlcyIlcyB9JyBcCiAgICAgICAgIiQoIF9mdWNrX2pzb25fZXNjYXBlICIkc3lzaW5mbyIgKSIgXAogICAgICAgICIkKCBfZnVja19qc29uX2VzY2FwZSAiJHByb21wdCIgKSIgXAogICAgICAgICIkYWRtaW5fc2VnbWVudCIpCgogICAgbG9jYWwgYXBpX3VybD0iJHtGVUNLX0FQSV9FTkRQT0lOVDotJERFRkFVTFRfQVBJX0VORFBPSU5UfSIKCiAgICBfZnVja19kZWJ1ZyAiQVBJIFVSTDogJGFwaV91cmwiCiAgICBfZnVja19kZWJ1ZyAiUGF5bG9hZDogJHBheWxvYWQiCiAgICBfZnVja19kZWJ1ZyAiVGltZW91dDogJGN1cmxfdGltZW91dCIKCiAgICBsb2NhbCB0bXBfcmVzcG9uc2UgdG1wX3N0YXR1cwogICAgdG1wX3Jlc3BvbnNlPSQobWt0ZW1wKQogICAgdG1wX3N0YXR1cz0kKG1rdGVtcCkKCiAgICAoCiAgICAgICAgY3VybCAtc1MgLS1tYXgtdGltZSAiJGN1cmxfdGltZW91dCIgLVggUE9TVCAiJGFwaV91cmwiIFwKICAgICAgICAgICAgLUggIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbiIgXAogICAgICAgICAgICAtZCAiJHBheWxvYWQiIC1vICIkdG1wX3Jlc3BvbnNlIiAtdyAiJXtodHRwX2NvZGV9IiA+ICIkdG1wX3N0YXR1cyIKICAgICkgJgogICAgbG9jYWwgcGlkPSQhCgogICAgaWYgWyAtdCAyIF07IHRoZW4KICAgICAgICBfZnVja19zcGlubmVyICIkcGlkIiA+JjIKICAgIGZpCgogICAgbG9jYWwgY3VybF9leGl0PTAKICAgIGlmICEgd2FpdCAiJHBpZCI7IHRoZW4KICAgICAgICBjdXJsX2V4aXQ9JD8KICAgIGZpCgogICAgbG9jYWwgaHR0cF9zdGF0dXM9IiIKICAgIGlmIFsgLWYgIiR0bXBfc3RhdHVzIiBdOyB0aGVuCiAgICAgICAgaHR0cF9zdGF0dXM9JCh0ciAtZCAnXHJcbicgPCAiJHRtcF9zdGF0dXMiKQogICAgICAgIHJtIC1mICIkdG1wX3N0YXR1cyIKICAgIGZpCgogICAgbG9jYWwgcmVzcG9uc2U9IiIKICAgIGlmIFsgLWYgIiR0bXBfcmVzcG9uc2UiIF07IHRoZW4KICAgICAgICByZXNwb25zZT0kKGNhdCAiJHRtcF9yZXNwb25zZSIpCiAgICAgICAgcm0gLWYgIiR0bXBfcmVzcG9uc2UiCiAgICBmaQoKICAgIGlmIFsgJGN1cmxfZXhpdCAtbmUgMCBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH3ml6Dms5Xov57mjqXliLDlhbHkuqsgV29ya2Vy44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgaWYgWyAtbiAiJHJlc3BvbnNlIiBdOyB0aGVuCiAgICAgICAgICAgIGVjaG8gLWUgIiR7Q19ESU19JHJlc3BvbnNlJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgZmkKICAgICAgICByZXR1cm4gJGN1cmxfZXhpdAogICAgZmkKCiAgICBpZiBbIC16ICIkaHR0cF9zdGF0dXMiIF07IHRoZW4KICAgICAgICBodHRwX3N0YXR1cz0wCiAgICBmaQoKICAgIGlmIFsgIiRodHRwX3N0YXR1cyIgLWVxIDQyOSBdICYmIHByaW50ZiAnJXMnICIkcmVzcG9uc2UiIHwgZ3JlcCAtcSAnREVNT19MSU1JVF9FWENFRURFRCc7IHRoZW4KICAgICAgICBsb2NhbCBsaW1pdAogICAgICAgIGxpbWl0PSQocHJpbnRmICclcycgIiRyZXNwb25zZSIgfCBzZWQgLW4gJ3MvLioibGltaXQiOltbOnNwYWNlOl1dKlwoWzAtOV1cK1wpLiovXDEvcCcgfCBoZWFkIC1uMSkKICAgICAgICBsb2NhbCByZW1haW5pbmcKICAgICAgICByZW1haW5pbmc9JChwcmludGYgJyVzJyAiJHJlc3BvbnNlIiB8IHNlZCAtbiAncy8uKiJyZW1haW5pbmciOltbOnNwYWNlOl1dKlwoWzAtOV1cK1wpLiovXDEvcCcgfCBoZWFkIC1uMSkKICAgICAgICBbIC16ICIkbGltaXQiIF0gJiYgbGltaXQ9MTAKICAgICAgICBfZnVja19ub3RpZnlfZGVtb19saW1pdCAiJGxpbWl0IiAiJHJlbWFpbmluZyIKICAgICAgICByZXR1cm4gMgogICAgZmkKCiAgICBpZiBbICIkaHR0cF9zdGF0dXMiIC1nZSA0MDAgXSB8fCBbIC16ICIkcmVzcG9uc2UiIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeWFseS6qyBXb3JrZXIg6L+U5ZueIEhUVFAgJGh0dHBfc3RhdHVz44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgaWYgWyAtbiAiJHJlc3BvbnNlIiBdOyB0aGVuCiAgICAgICAgICAgIGVjaG8gLWUgIiR7Q19ESU19JHJlc3BvbnNlJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgZmkKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBwcmludGYgJyVzXG4nICIkcmVzcG9uc2UiCn0KCl9mdWNrX25vdGlmeV9kZW1vX2xpbWl0KCkgewogICAgbG9jYWwgZGFpbHlfbGltaXQ9IiR7MTotMTB9IgogICAgbG9jYWwgcmVtYWluaW5nPSIkezI6LTB9IgoKICAgIGVjaG8gLWUgIiRGVUNLICR7Q19ZRUxMT1d95YWx5Lqr5L2T6aqM6aKd5bqm5bey55So5YWJ77yI5q+P5aSp5pyA5aSaICR7ZGFpbHlfbGltaXR9IOasoe+8ieOAgiR7Q19SRVNFVH0iID4mMgogICAgY2FzZSAiJHJlbWFpbmluZyIgaW4KICAgICAgICAnJ3wqWyEwLTldKikgOzsKICAgICAgICAqKQogICAgICAgICAgICBpZiBbICIkcmVtYWluaW5nIiAtZ3QgMCBdOyB0aGVuCiAgICAgICAgICAgICAgICBlY2hvIC1lICIke0NfRElNfeS7iuaXpeWJqeS9memineW6pu+8miRyZW1haW5pbmcg5qyh44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgICAgIGZpCiAgICAgICAgICAgIDs7CiAgICBlc2FjCgogICAgX2Z1Y2tfZW5zdXJlX2NvbmZpZ19leGlzdHMKICAgIF9mdWNrX3NlY3VyZV9jb25maWdfZmlsZQoKICAgIGVjaG8gLWUgIiR7Q19DWUFOfeino+WGs+aWueahiO+8miR7Q19SRVNFVH3ov5DooYwgJHtDX0dSRUVOfWZ1Y2sgY29uZmlnJHtDX1JFU0VUfe+8jOWcqCAke0NfR1JFRU59JENPTkZJR19GSUxFJHtDX1JFU0VUfSDkuK3orr7nva4gJHtDX0JPTER9RlVDS19PUEVOQUlfQVBJX0tFWSR7Q19SRVNFVH3vvIzlv4XopoHml7blkIzml7bphY3nva4gJHtDX0JPTER9RlVDS19PUEVOQUlfTU9ERUwke0NfUkVTRVR9LyR7Q19CT0xEfUZVQ0tfT1BFTkFJX0FQSV9CQVNFJHtDX1JFU0VUfeOAgiIgPiYyCiAgICBlY2hvIC1lICIke0NfQ1lBTn3oi6XkvaDmjIHmnInnrqHnkIblkZjlhY3pop3lr4bpkqXvvJoke0NfUkVTRVR95ZCM5qC35Zyo6K+l5paH5Lu25Lit6YWN572uICR7Q19CT0xEfUZVQ0tfQURNSU5fS0VZJHtDX1JFU0VUfe+8iOmcgOS4jiBXb3JrZXIg5L6n55qEIEFETUlOX0FDQ0VTU19LRVkg5Yy56YWN77yJ5Y2z5Y+v6Lez6L+H5YWx5Lqr6aKd5bqm6ZmQ5Yi244CCIiA+JjIKICAgIGlmIFsgLW4gIiR7RURJVE9SOi19IiBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33mj5DnpLrvvJoke0NfUkVTRVR9JHtFRElUT1J9IFwiJENPTkZJR19GSUxFXCIiID4mMgogICAgZmkKICAgIGVjaG8gLWUgIiR7Q19ESU195a6J5YWo5o+Q56S677ya6YWN572u5paH5Lu26Ieq5YqoIGNobW9kIDYwMO+8jOS7hemZkOW9k+WJjeeUqOaIt+ivu+WPluOAgiR7Q19SRVNFVH0iID4mMgp9CgoKIyDliKTmlq3mmK/lkKbkuLogdHJ1ZS95ZXMvb24g562JCl9mdWNrX3RydXRoeSgpIHsKICAgIGxvY2FsIHZhbHVlPSIkezE6LX0iCiAgICBsb2NhbCBub3JtYWxpemVkCiAgICBub3JtYWxpemVkPSQocHJpbnRmICclcycgIiR2YWx1ZSIgfCB0ciAnWzp1cHBlcjpdJyAnWzpsb3dlcjpdJykKICAgIGNhc2UgIiRub3JtYWxpemVkIiBpbgogICAgICAgIDF8dHJ1ZXx5ZXN8eXxvbnzmmK985byAfOecnykKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgOzsKICAgICAgICAqKQogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICA7OwogICAgZXNhYwp9CgojIOiwg+ivleaXpeW/lwpfZnVja19kZWJ1ZygpIHsKICAgIGlmIF9mdWNrX3RydXRoeSAiJHtGVUNLX0RFQlVHOi0wfSI7IHRoZW4KICAgICAgICBlY2hvIC1lICIke0NfRElNfVvosIPor5VdICQqJHtDX1JFU0VUfSIgPiYyCiAgICBmaQp9CgojIFNwaW5uZXIg5Yqo55S7Cl9mdWNrX3NwaW5uZXIoKSB7CiAgICBsb2NhbCBwaWQ9JDEKICAgIGxvY2FsIGRlbGF5PTAuMQogICAgbG9jYWwgc3BpbnN0cj0n4qCL4qCZ4qC54qC44qC84qC04qCm4qCn4qCH4qCPJwogICAgCiAgICAjIOmakOiXj+WFieaghwogICAgdHB1dCBjaXZpcyAyPi9kZXYvbnVsbCB8fCBwcmludGYgIlwwMzNbPzI1bCIKCiAgICB3aGlsZSBraWxsIC0wICIkcGlkIiAyPi9kZXYvbnVsbDsgZG8KICAgICAgICBsb2NhbCB0ZW1wPSR7c3BpbnN0ciM/fQogICAgICAgIHByaW50ZiAiICVjICIgIiRzcGluc3RyIgogICAgICAgIGxvY2FsIHNwaW5zdHI9JHRlbXAke3NwaW5zdHIlIiR0ZW1wIn0KICAgICAgICBzbGVlcCAkZGVsYXkKICAgIGRvbmUKICAgIHByaW50ZiAiICAgXGJcYlxiIgogICAgCiAgICAjIOaBouWkjeWFieaghwogICAgdHB1dCBjbm9ybSAyPi9kZXYvbnVsbCB8fCBwcmludGYgIlwwMzNbPzI1aCIKfQoKIyAtLS0g5a6J5YWo5qOA5rWL5byV5pOOIChQaGFzZSAyKSAtLS0KCiMg6Zi75q2i57qn5a6J5YWo6KeE5YiZ77yI5pyA6auY5Lil6YeN5oCnIC0g5ouS57ud5omn6KGM77yJCiMg5qC85byP77yaJ+aooeW8j3x8fOWOn+WboCcKaWYgWyAteiAiJHtfRlVDS19TRUNVUklUWV9CTE9DS19SVUxFUzotfSIgXTsgdGhlbgogICAgcmVhZG9ubHkgLWEgX0ZVQ0tfU0VDVVJJVFlfQkxPQ0tfUlVMRVM9KAogICAgICAgICcoXnxbOyZ8WzpzcGFjZTpdXSlybVtbOnNwYWNlOl1dKy1yZltbOnNwYWNlOl1dKy8oW1s6c3BhY2U6XV18JCl8fHzmo4DmtYvliLAgcm0gLXJmIC/vvIzkvJrnm7TmjqXliKDpmaTmoLnnm67lvZUnCiAgICAgICAgJ3JtW1s6c3BhY2U6XV0rLXJmW1s6c3BhY2U6XV0rL1wqfHx85qOA5rWL5YiwIHJtIC1yZiAvKu+8jOWPr+iDvea4heepuuagueebruW9lScKICAgICAgICAncm1bWzpzcGFjZTpdXSstcmZbWzpzcGFjZTpdXSstLW5vLXByZXNlcnZlLXJvb3R8fHzmo4DmtYvliLAgLS1uby1wcmVzZXJ2ZS1yb29077yM6aOO6Zmp5p6B6auYJwogICAgICAgICdybVtbOnNwYWNlOl1dKy1yZltbOnNwYWNlOl1dK1wuXCp8fHzmo4DmtYvliLAgcm0gLXJmIC4q77yM5Y+v6IO95Yig6Zmk5YWo6YOo6ZqQ6JeP5paH5Lu2JwogICAgICAgICdcYmRkXGJbXiNcbl0qXGIob2Z8aWYpPS9kZXYvfHx85qOA5rWL5YiwIGRkIOato+WcqOWGmeWFpSAvZGV2IOiuvuWkhycKICAgICAgICAnXGJta2ZzKFwuXHcrKT9cYnx8fOajgOa1i+WIsCBta2ZzL+agvOW8j+WMluaTjeS9nCcKICAgICAgICAnXGJmZGlza1xifFxicGFydGVkXGJ8XGJmb3JtYXRcYnxcYndpcGVmc1xifFxic2hyZWRcYnx8fOajgOa1i+WIsOWIhuWMuuaIluejgeebmOaTpumZpOWRveS7pCcKICAgICAgICAnOlwoXClccyp7XHMqOlxzKlx8XHMqOjtccyp9XHMqOz9ccyo6fHx85qOA5rWL5YiwIEZvcmsg54K45by55qih5byPJwogICAgKQpmaQoKIyDmjJHmiJjnuqflronlhajop4TliJnvvIjpnIDopoHmmI7noa7nlKjmiLfnoa7orqTvvIkKIyDmoLzlvI/vvJon5qih5byPfHx85Y6f5ZugJwppZiBbIC16ICIke19GVUNLX1NFQ1VSSVRZX0NIQUxMRU5HRV9SVUxFUzotfSIgXTsgdGhlbgogICAgcmVhZG9ubHkgLWEgX0ZVQ0tfU0VDVVJJVFlfQ0hBTExFTkdFX1JVTEVTPSgKICAgICAgICAnY3VybFtefF0qXHxccyooYmFzaHxzaCl8fHxjdXJsIOeuoemBkyBiYXNoL3No77yM5Y+v6IO96L+c56iL5omn6KGM6ISa5pysJwogICAgICAgICd3Z2V0W158XSpcfFxzKihiYXNofHNoKXx8fHdnZXQg566h6YGTIGJhc2gvc2jvvIzlj6/og73ov5znqIvmiafooYzohJrmnKwnCiAgICAgICAgJ1xic291cmNlXHMraHR0cHM/Oi8vfHx8c291cmNlIOi/nOeoi+iEmuacrCcKICAgICAgICAnXGJldmFsXGJ8XGJleGVjXGJ8fHzkvb/nlKggZXZhbC9leGVjIOWKqOaAgeaJp+ihjCcKICAgICAgICAnXCRcKFteKV0qXCl8fHzmo4DmtYvliLAgJCguLi4pIOWRveS7pOabv+aNoicKICAgICAgICAnYFteYF0qYHx8fOajgOa1i+WIsOWPjeW8leWPt+WRveS7pOabv+aNoicKICAgICAgICAnXGIoc2h8YmFzaHxlbnYpXHMrLWNcYnx8fOajgOa1i+WIsCBzaC9iYXNoIC1jIOWMheijheWRveS7pCcKICAgICAgICAnXGJweXRob25bMC05Ll0qXHMrLWNcYnx8fOajgOa1i+WIsCBweXRob24gLWMg5YaF6IGU6ISa5pysJwogICAgICAgICcoXnxbOyZ8WzpzcGFjZTpdXSkoY3B8bXZ8cm18Y2htb2R8Y2hvd258c2VkfHRlZXxjYXQpW147JnxdKlxiLyhldGN8Ym9vdHxzeXN8cHJvY3xkZXYpXGJ8fHzlkb3ku6Tmk43kvZzlhbPplK7ns7vnu5/ot6/lvoQnCiAgICApCmZpCgojIOitpuWRiue6p+WuieWFqOinhOWIme+8iOS7heitpuWRiu+8jOeUqOaIt+WPr+e7p+e7re+8iQojIOagvOW8j++8mifmqKHlvI98fHzljp/lm6AnCmlmIFsgLXogIiR7X0ZVQ0tfU0VDVVJJVFlfV0FSTl9SVUxFUzotfSIgXTsgdGhlbgogICAgcmVhZG9ubHkgLWEgX0ZVQ0tfU0VDVVJJVFlfV0FSTl9SVUxFUz0oCiAgICAgICAgJ3JtW1s6c3BhY2U6XV0rLXJmXGJ8fHzlj5HnjrAgcm0gLXJm77yM5omn6KGM5YmN6K+35YaN5qyh56Gu6K6kJwogICAgICAgICdjaG1vZFtbOnNwYWNlOl1dKy4qNzc3XGJ8fHzmo4DmtYvliLAgY2htb2QgNzc3IOadg+mZkCcKICAgICAgICAnc3Vkb1tbOnNwYWNlOl1dK1teOyZ8XSpybVtbOnNwYWNlOl1dKy1yZnx8fHN1ZG8gcm0gLXJmIOmjjumZqScKICAgICAgICAnPltbOnNwYWNlOl1dKi8oZXRjLyhwYXNzd2R8c2hhZG93fHN1ZG9lcnMpfGRldi9zZFthLXpdKyl8fHzph43lrprlkJHovpPlh7rliLDmlY/mhJ/ns7vnu5/mlofku7YnCiAgICApCmZpCgojIOS7jumFjee9ruiOt+WPluW9k+WJjeWuieWFqOaooeW8jwojIOi+k+WHuu+8miJzdHJpY3Qi44CBImJhbGFuY2VkIiDmiJYgIm9mZiIKX2Z1Y2tfc2VjdXJpdHlfbW9kZSgpIHsKICAgIGxvY2FsIG1vZGU9IiR7RlVDS19TRUNVUklUWV9NT0RFOi1iYWxhbmNlZH0iCiAgICBtb2RlPSQocHJpbnRmICclcycgIiRtb2RlIiB8IHRyICdbOnVwcGVyOl0nICdbOmxvd2VyOl0nKQoKICAgIGNhc2UgIiRtb2RlIiBpbgogICAgICAgIHN0cmljdCkgcHJpbnRmICdzdHJpY3RcbicgOzsKICAgICAgICBvZmZ8ZGlzYWJsZWR8bm9uZSkgcHJpbnRmICdvZmZcbicgOzsKICAgICAgICBiYWxhbmNlZHxkZWZhdWx0fCIiKSBwcmludGYgJ2JhbGFuY2VkXG4nIDs7CiAgICAgICAgKikgcHJpbnRmICdiYWxhbmNlZFxuJyA7OwogICAgZXNhYwp9CgojIOiOt+WPluWuieWFqOehruiupOeahOm7mOiupOaMkeaImOaWh+acrAojIOi+k+WHuu+8mum7mOiupOaMkeaImOefreivrQpfZnVja19zZWN1cml0eV9kZWZhdWx0X2NoYWxsZW5nZV90ZXh0KCkgewogICAgcHJpbnRmICfmiJHnoa7orqTmib/mi4Xpo47pmaknCn0KCiMg5qOA5p+l5ZG95Luk5piv5ZCm5Yy56YWN5a6J5YWo55m95ZCN5Y2VCiMg5Y+C5pWw77yaJDEgLSDopoHmo4Dmn6XnmoTlkb3ku6QKIyDov5Tlm57vvJowIOWmguaenOWcqOeZveWQjeWNleS4re+8jDEg5ZCm5YiZCl9mdWNrX3NlY3VyaXR5X2lzX3doaXRlbGlzdGVkKCkgewogICAgbG9jYWwgY29tbWFuZD0iJDEiCiAgICBsb2NhbCB3aGl0ZWxpc3Q9IiR7RlVDS19TRUNVUklUWV9XSElURUxJU1Q6LX0iCgogICAgaWYgWyAteiAiJHdoaXRlbGlzdCIgXTsgdGhlbgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgIGxvY2FsIG5vcm1hbGl6ZWQgZW50cnkKICAgIG5vcm1hbGl6ZWQ9JChwcmludGYgJyVzJyAiJHdoaXRlbGlzdCIgfCB0ciAnLCcgJ1xuJykKCiAgICB3aGlsZSBJRlM9IHJlYWQgLXIgZW50cnk7IGRvCiAgICAgICAgZW50cnk9JChwcmludGYgJyVzJyAiJGVudHJ5IiB8IHNlZCAtZSAncy9eW1s6c3BhY2U6XV0qLy8nIC1lICdzL1tbOnNwYWNlOl1dKiQvLycpCiAgICAgICAgWyAteiAiJGVudHJ5IiBdICYmIGNvbnRpbnVlCgogICAgICAgIGlmIHByaW50ZiAnJXMnICIkY29tbWFuZCIgfCBncmVwIC1GcSAiJGVudHJ5IjsgdGhlbgogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIGZpCiAgICBkb25lIDw8PCAiJG5vcm1hbGl6ZWQiCgogICAgcmV0dXJuIDEKfQoKIyDlsIblronlhajnuqfliKvovazmjaLkuLrmlbDlgLzku6Xkvr/mr5TovoMKIyDlj4LmlbDvvJokMSAtIOWuieWFqOe6p+WIq++8iGJsb2NrL2NoYWxsZW5nZS93YXJuL29r77yJCiMg6L6T5Ye677ya5pWw5YC877yIMy8yLzEvMO+8iQpfZnVja19zZWN1cml0eV9sZXZlbF92YWx1ZSgpIHsKICAgIGNhc2UgIiQxIiBpbgogICAgICAgIGJsb2NrKSBwcmludGYgJzNcbicgOzsKICAgICAgICBjaGFsbGVuZ2UpIHByaW50ZiAnMlxuJyA7OwogICAgICAgIHdhcm4pIHByaW50ZiAnMVxuJyA7OwogICAgICAgICopIHByaW50ZiAnMFxuJyA7OwogICAgZXNhYwp9CgojIOWmguaenOWAmemAiee6p+WIq+abtOS4pemHjeWImeaPkOWNh+WuieWFqOe6p+WIqwojIOWPguaVsO+8miQxIC0g5b2T5YmN57qn5Yir77yMJDIgLSDlgJnpgInnuqfliKsKIyDovpPlh7rvvJrmm7TkuKXph43nmoTnuqfliKsKX2Z1Y2tfc2VjdXJpdHlfcHJvbW90ZSgpIHsKICAgIGxvY2FsIGN1cnJlbnQ9IiQxIgogICAgbG9jYWwgY2FuZGlkYXRlPSIkMiIKICAgIGxvY2FsIGN1cnJlbnRfdmFsIGNhbmRpZGF0ZV92YWwKCiAgICBjdXJyZW50X3ZhbD0kKF9mdWNrX3NlY3VyaXR5X2xldmVsX3ZhbHVlICIkY3VycmVudCIpCiAgICBjYW5kaWRhdGVfdmFsPSQoX2Z1Y2tfc2VjdXJpdHlfbGV2ZWxfdmFsdWUgIiRjYW5kaWRhdGUiKQoKICAgIGlmIFsgIiRjYW5kaWRhdGVfdmFsIiAtZ3QgIiRjdXJyZW50X3ZhbCIgXTsgdGhlbgogICAgICAgIHByaW50ZiAnJXNcbicgIiRjYW5kaWRhdGUiCiAgICBlbHNlCiAgICAgICAgcHJpbnRmICclc1xuJyAiJGN1cnJlbnQiCiAgICBmaQp9CgojIOagueaNruWuieWFqOaooeW8j+iwg+aVtOS4pemHjeaAp+e6p+WIqwojIOWPguaVsO+8miQxIC0g5qih5byP77yIc3RyaWN0L2JhbGFuY2VkL29mZu+8ie+8jCQyIC0g5Lil6YeN5oCn57qn5YirCiMg6L6T5Ye677ya6LCD5pW05ZCO55qE5Lil6YeN5oCn57qn5YirCl9mdWNrX3NlY3VyaXR5X2FwcGx5X21vZGUoKSB7CiAgICBsb2NhbCBtb2RlPSIkMSIKICAgIGxvY2FsIHNldmVyaXR5PSIkMiIKCiAgICBjYXNlICIkbW9kZSIgaW4KICAgICAgICBzdHJpY3QpCiAgICAgICAgICAgIGNhc2UgIiRzZXZlcml0eSIgaW4KICAgICAgICAgICAgICAgIHdhcm4pIHNldmVyaXR5PSJjaGFsbGVuZ2UiIDs7CiAgICAgICAgICAgICAgICBjaGFsbGVuZ2UpIHNldmVyaXR5PSJibG9jayIgOzsKICAgICAgICAgICAgZXNhYwogICAgICAgICAgICA7OwogICAgZXNhYwoKICAgIHByaW50ZiAnJXNcbicgIiRzZXZlcml0eSIKfQoKIyDlsIblkb3ku6TkuI7lronlhajop4TliJnooajljLnphY0KIyDlj4LmlbDvvJokMSAtIOWRveS7pO+8jCQyIC0g6KeE5YiZ6KGo5ZCN56ewCiMg6L6T5Ye677ya5aaC5p6c5Yy56YWN5YiZ6L6T5Ye65Y6f5Zug5a2X56ym5LiyCiMg6L+U5Zue77yaMCDlpoLmnpzljLnphY3vvIwxIOWQpuWImQpfZnVja19zZWN1cml0eV9tYXRjaF9ydWxlKCkgewogICAgbG9jYWwgY29tbWFuZD0iJDEiCiAgICBsb2NhbCB0YWJsZT0iJDIiCiAgICBsb2NhbCAtYSBydWxlcz0oKQoKICAgIGV2YWwgInJ1bGVzPShcIlwkeyR7dGFibGV9W0BdfVwiKSIKCiAgICBsb2NhbCBydWxlIHBhdHRlcm4gcmVhc29uCiAgICBmb3IgcnVsZSBpbiAiJHtydWxlc1tAXX0iOyBkbwogICAgICAgIHBhdHRlcm49JHtydWxlJSV8fHwqfQogICAgICAgIHJlYXNvbj0ke3J1bGUjKnx8fH0KICAgICAgICBbIC16ICIkcGF0dGVybiIgXSAmJiBjb250aW51ZQoKICAgICAgICBpZiBwcmludGYgJyVzJyAiJGNvbW1hbmQiIHwgZ3JlcCAtRWlxIC0tICIkcGF0dGVybiI7IHRoZW4KICAgICAgICAgICAgcHJpbnRmICclc1xuJyAiJHJlYXNvbiIKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICBmaQogICAgZG9uZQoKICAgIHJldHVybiAxCn0KCiMg5pi+56S65r2c5Zyo5Y2x6Zmp5ZG95Luk55qE6K2m5ZGK5raI5oGvCiMg5Y+C5pWw77yaJDEgLSDorablkYrljp/lm6AKX2Z1Y2tfc2VjdXJpdHlfd2Fybl9tZXNzYWdlKCkgewogICAgbG9jYWwgcmVhc29uPSIkMSIKICAgIGVjaG8gLWUgIiR7Q19SRURfQk9MRH3imqDvuI8gIOWuieWFqOitpuWRiu+8miR7Q19SRVNFVH0ke3JlYXNvbn0iID4mMgogICAgZWNobyAtZSAiJHtDX1lFTExPV33or7fku5Tnu4blrqHmn6XvvIzoi6Xnoa7orqTlj6/kv6Hlj6/phY3nva4gRlVDS19TRUNVUklUWV9XSElURUxJU1TjgIIke0NfUkVTRVR9IiA+JjIKfQoKIyDmmL7npLrooqvnpoHmraLlkb3ku6TnmoTpmLvmraLmtojmga8KIyDlj4LmlbDvvJokMSAtIOmYu+atouWOn+WboApfZnVja19zZWN1cml0eV9ibG9ja19tZXNzYWdlKCkgewogICAgbG9jYWwgcmVhc29uPSIkMSIKICAgIGVjaG8gLWUgIiR7Q19SRURfQk9MRH3im5Qg5bey6Zi75q2i77yaJHtDX1JFU0VUfSR7cmVhc29ufSIgPiYyCiAgICBlY2hvIC1lICIke0NfUkVEfeaJp+ihjOiiq+aLkue7ne+8jOWPr+iwg+aVtCBGVUNLX1NFQ1VSSVRZX01PREUg5oiW5Yqg5YWl55m95ZCN5Y2V5ZCO6YeN6K+V44CCJHtDX1JFU0VUfSIgPiYyCn0KCiMg5pi+56S66auY6aOO6Zmp5ZG95Luk55qE5oyR5oiY5raI5oGvCiMg5Y+C5pWw77yaJDEgLSDmjJHmiJjljp/lm6DvvIwkMiAtIOmcgOimgeeahOefreivrQpfZnVja19zZWN1cml0eV9jaGFsbGVuZ2VfbWVzc2FnZSgpIHsKICAgIGxvY2FsIHJlYXNvbj0iJDEiCiAgICBsb2NhbCBwaHJhc2U9IiQyIgogICAgZWNobyAtZSAiJHtDX1JFRF9CT0xEfeKaoO+4jyAg6auY5Y2x5oyR5oiY77yaJHtDX1JFU0VUfSR7cmVhc29ufSIgPiYyCiAgICBlY2hvIC1lICIke0NfQ1lBTn3lpoLpnIDnu6fnu63vvIzor7fovpPlhaXkuIvmlrnnn63or63vvJoke0NfUkVTRVR9IiA+JjIKICAgIGVjaG8gLWUgIiR7Q19CT0xEfSR7cGhyYXNlfSR7Q19SRVNFVH0iID4mMgp9CgojIOaPkOekuueUqOaIt+i+k+WFpeWuieWFqOaMkeaImOaJgOmcgOeahOefreivrQojIOWPguaVsO+8miQxIC0g6ZyA6KaB55qE55+t6K+tCiMg6L+U5Zue77yaMCDlpoLmnpznn63or63ljLnphY3vvIwxIOWQpuWImQpfZnVja19zZWN1cml0eV9wcm9tcHRfcGhyYXNlKCkgewogICAgbG9jYWwgcGhyYXNlPSIkMSIKICAgIGxvY2FsIGlucHV0PSIiCgogICAgcHJpbnRmICIlYj4gJWIiICIkQ19CT0xEIiAiJENfUkVTRVQiID4mMgoKICAgIGlmIFsgLXIgL2Rldi90dHkgXTsgdGhlbgogICAgICAgIGlmICEgSUZTPSByZWFkIC1yIGlucHV0IDwgL2Rldi90dHk7IHRoZW4KICAgICAgICAgICAgcHJpbnRmICJcbiIgPiYyCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBpZiAhIElGUz0gcmVhZCAtciBpbnB1dDsgdGhlbgogICAgICAgICAgICBwcmludGYgIlxuIiA+JjIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICBmaQogICAgZmkKCiAgICBwcmludGYgIlxuIiA+JjIKICAgIFsgIiRpbnB1dCIgPSAiJHBocmFzZSIgXQp9CgojIOagueaNruS4pemHjeaAp+e6p+WIq+WkhOeQhuWuieWFqOWGs+etlgojIOWPguaVsO+8miQxIC0g5Lil6YeN5oCn57qn5Yir77yMJDIgLSDljp/lm6DvvIwkMyAtIOWRveS7pAojIOi/lOWbnu+8mjAg5YWB6K645omn6KGM77yMMSDmi5Lnu50KX2Z1Y2tfc2VjdXJpdHlfaGFuZGxlX2RlY2lzaW9uKCkgewogICAgbG9jYWwgc2V2ZXJpdHk9IiQxIgogICAgbG9jYWwgcmVhc29uPSIkMiIKICAgIGxvY2FsIGNvbW1hbmQ9IiQzIgoKICAgIGNhc2UgIiRzZXZlcml0eSIgaW4KICAgICAgICAiInxva3xvZmYpCiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIDs7CiAgICAgICAgd2FybikKICAgICAgICAgICAgX2Z1Y2tfc2VjdXJpdHlfd2Fybl9tZXNzYWdlICIke3JlYXNvbjot5qOA5rWL5Yiw5r2c5Zyo6aOO6ZmpfSIKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgOzsKICAgICAgICBjaGFsbGVuZ2UpCiAgICAgICAgICAgIGxvY2FsIHBocmFzZT0iJHtGVUNLX1NFQ1VSSVRZX0NIQUxMRU5HRV9URVhUOi0kKF9mdWNrX3NlY3VyaXR5X2RlZmF1bHRfY2hhbGxlbmdlX3RleHQpfSIKICAgICAgICAgICAgX2Z1Y2tfc2VjdXJpdHlfY2hhbGxlbmdlX21lc3NhZ2UgIiR7cmVhc29uOi3pq5jljbHlkb3ku6TvvIzor7flho3mrKHnoa7orqR9IiAiJHBocmFzZSIKCiAgICAgICAgICAgIGlmIF9mdWNrX3NlY3VyaXR5X3Byb21wdF9waHJhc2UgIiRwaHJhc2UiOyB0aGVuCiAgICAgICAgICAgICAgICBlY2hvIC1lICIke0NfR1JFRU595bey6YCa6L+H5a6J5YWo5oyR5oiY44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICBmaQoKICAgICAgICAgICAgZWNobyAtZSAiJHtDX1JFRH3lronlhajmjJHmiJjlpLHotKXvvIzlkb3ku6Tooqvlj5bmtojjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgOzsKICAgICAgICBibG9jaykKICAgICAgICAgICAgX2Z1Y2tfc2VjdXJpdHlfYmxvY2tfbWVzc2FnZSAiJHtyZWFzb246LeWRveS7pOiiq+WuieWFqOetlueVpemYu+aton0iCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIDs7CiAgICAgICAgKikKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgOzsKICAgIGVzYWMKfQoKIyDor4TkvLDlkb3ku6TlronlhajmgKflubbov5Tlm57kuKXph43mgKfnuqfliKvlkozljp/lm6AKIyDlj4LmlbDvvJokMSAtIOimgeivhOS8sOeahOWRveS7pAojIOi+k+WHuu+8miLkuKXph43mgKd85Y6f5ZugIiDlrZfnrKbkuLIKIyDov5Tlm57vvJrlp4vnu4jov5Tlm54gMO+8iOe7k+aenOWcqOi+k+WHuuS4re+8iQpfZnVja19zZWN1cml0eV9ldmFsdWF0ZV9jb21tYW5kKCkgewogICAgbG9jYWwgY29tbWFuZD0iJDEiCiAgICBsb2NhbCBtb2RlIHNldmVyaXR5IHJlYXNvbiBtYXRjaCBwcm9tb3RlZCBzdHJ1Y3R1cmFsX3JlYXNvbgoKICAgIG1vZGU9JChfZnVja19zZWN1cml0eV9tb2RlKQoKICAgICMg5a6J5YWo5byV5pOO5bey56aB55SoCiAgICBpZiBbICIkbW9kZSIgPSAib2ZmIiBdOyB0aGVuCiAgICAgICAgcHJpbnRmICdvZmZ85a6J5YWo5byV5pOO5bey5YWz6ZetXG4nCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgIyDmo4Dmn6Xnmb3lkI3ljZUKICAgIGlmIF9mdWNrX3NlY3VyaXR5X2lzX3doaXRlbGlzdGVkICIkY29tbWFuZCI7IHRoZW4KICAgICAgICBwcmludGYgJ29rfOWRveS7pOWRveS4reeZveWQjeWNlVxuJwogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIHNldmVyaXR5PSJvayIKICAgIHJlYXNvbj0iIgogICAgbWF0Y2g9IiIKCiAgICAjIOajgOafpemYu+atouinhOWIme+8iOacgOmrmOS8mOWFiOe6p++8iQogICAgaWYgbWF0Y2g9JChfZnVja19zZWN1cml0eV9tYXRjaF9ydWxlICIkY29tbWFuZCIgIl9GVUNLX1NFQ1VSSVRZX0JMT0NLX1JVTEVTIik7IHRoZW4KICAgICAgICBzZXZlcml0eT0iYmxvY2siCiAgICAgICAgcmVhc29uPSIkbWF0Y2giCiAgICBmaQoKICAgICMg5qOA5p+l5oyR5oiY6KeE5YiZ77yI5Lit562J5LyY5YWI57qn77yJCiAgICBpZiBbICIkc2V2ZXJpdHkiICE9ICJibG9jayIgXSAmJiBtYXRjaD0kKF9mdWNrX3NlY3VyaXR5X21hdGNoX3J1bGUgIiRjb21tYW5kIiAiX0ZVQ0tfU0VDVVJJVFlfQ0hBTExFTkdFX1JVTEVTIik7IHRoZW4KICAgICAgICBzZXZlcml0eT0iY2hhbGxlbmdlIgogICAgICAgIHJlYXNvbj0iJG1hdGNoIgogICAgZmkKCiAgICAjIOajgOafpeitpuWRiuinhOWIme+8iOS9juS8mOWFiOe6p++8iQogICAgaWYgWyAiJHNldmVyaXR5IiA9ICJvayIgXSAmJiBtYXRjaD0kKF9mdWNrX3NlY3VyaXR5X21hdGNoX3J1bGUgIiRjb21tYW5kIiAiX0ZVQ0tfU0VDVVJJVFlfV0FSTl9SVUxFUyIpOyB0aGVuCiAgICAgICAgc2V2ZXJpdHk9Indhcm4iCiAgICAgICAgcmVhc29uPSIkbWF0Y2giCiAgICBmaQoKICAgICMg5qOA5p+l5ZG95Luk6ZO+5o6lL+euoemBk++8iOe7k+aehOWIhuaekO+8iQogICAgaWYgcHJpbnRmICclcycgIiRjb21tYW5kIiB8IGdyZXAgLUVpcSAnKCYmfFx8XHx8O3xcfCknOyB0aGVuCiAgICAgICAgc3RydWN0dXJhbF9yZWFzb249IuajgOa1i+WIsOWRveS7pOWIhumalOespi/nrqHpgZMiCiAgICAgICAgcHJvbW90ZWQ9JChfZnVja19zZWN1cml0eV9wcm9tb3RlICIkc2V2ZXJpdHkiICJ3YXJuIikKCiAgICAgICAgaWYgWyAiJHByb21vdGVkIiAhPSAiJHNldmVyaXR5IiBdOyB0aGVuCiAgICAgICAgICAgIHNldmVyaXR5PSIkcHJvbW90ZWQiCiAgICAgICAgICAgIHJlYXNvbj0iJHN0cnVjdHVyYWxfcmVhc29uIgogICAgICAgIGVsaWYgWyAteiAiJHJlYXNvbiIgXTsgdGhlbgogICAgICAgICAgICByZWFzb249IiRzdHJ1Y3R1cmFsX3JlYXNvbiIKICAgICAgICBmaQogICAgZmkKCiAgICAjIOW6lOeUqOWuieWFqOaooeW8j+iwg+aVtAogICAgc2V2ZXJpdHk9JChfZnVja19zZWN1cml0eV9hcHBseV9tb2RlICIkbW9kZSIgIiRzZXZlcml0eSIpCgogICAgcHJpbnRmICclc3wlc1xuJyAiJHNldmVyaXR5IiAiJHtyZWFzb246LeW9k+WJjeWRveS7pOacquWRveS4reWuieWFqOinhOWImX0iCn0KCiMg5ZCR5ZCO5YW85a6555qE6YGX55WZ5Ye95pWwCiMg5Y+C5pWw77yaJDEgLSDopoHmo4Dmn6XnmoTlkb3ku6QKIyDovpPlh7rvvJoi5Lil6YeN5oCnfOWOn+WboCIg5a2X56ym5LiyCl9mdWNrX2RldGVjdF9kYW5nZXJvdXNfY29tbWFuZCgpIHsKICAgIF9mdWNrX3NlY3VyaXR5X2V2YWx1YXRlX2NvbW1hbmQgIiQxIgp9CgoKIyDnoa7kv53phY3nva7mlofku7blrZjlnKgKX2Z1Y2tfc2VjdXJlX2NvbmZpZ19maWxlKCkgewogICAgaWYgWyAtZiAiJENPTkZJR19GSUxFIiBdOyB0aGVuCiAgICAgICAgY2htb2QgNjAwICIkQ09ORklHX0ZJTEUiIDI+L2Rldi9udWxsIHx8IHRydWUKICAgIGZpCn0KCl9mdWNrX2FwcGVuZF9jb25maWdfaGludCgpIHsKICAgIGxvY2FsIGtleT0iJDEiCiAgICBsb2NhbCBjb21tZW50PSIkMiIKICAgIGxvY2FsIHNhbXBsZT0iJDMiCiAgICBsb2NhbCBxdW90ZWQ9IiR7NDotMX0iCiAgICBbIC1mICIkQ09ORklHX0ZJTEUiIF0gfHwgcmV0dXJuCiAgICBpZiBncmVwIC1FcSAiXlxccyojP1xccypleHBvcnRcXHMrJGtleSIgIiRDT05GSUdfRklMRSI7IHRoZW4KICAgICAgICByZXR1cm4KICAgIGZpCgogICAgbG9jYWwgYXNzaWdubWVudAogICAgaWYgWyAiJHF1b3RlZCIgPSAiMSIgXTsgdGhlbgogICAgICAgIGFzc2lnbm1lbnQ9IiMgZXhwb3J0ICRrZXk9XCIkc2FtcGxlXCIiCiAgICBlbHNlCiAgICAgICAgYXNzaWdubWVudD0iIyBleHBvcnQgJGtleT0kc2FtcGxlIgogICAgZmkKCiAgICB7CiAgICAgICAgcHJpbnRmICdcbicKICAgICAgICBwcmludGYgJyMgJXNcbicgIiRjb21tZW50IgogICAgICAgIHByaW50ZiAnJXNcbicgIiRhc3NpZ25tZW50IgogICAgfSA+PiAiJENPTkZJR19GSUxFIgp9CgpfZnVja19zZWVkX2NvbmZpZ19wbGFjZWhvbGRlcnMoKSB7CiAgICBbIC1mICIkQ09ORklHX0ZJTEUiIF0gfHwgcmV0dXJuCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfT1BFTkFJX0FQSV9LRVkiICLmnKzlnLAgT3BlbkFJIOWFvOWuuSBLZXnvvIjmjqjojZDvvIkiICdzay0uLi4nCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfQURNSU5fS0VZIiAi566h55CG5ZGY5YWN6aKd5bqm5a+G6ZKl77yI5LuF5YiG5Lqr57uZ5L+h5Lu755qE5Lq677yJIiAnYWRtLS4uLicKICAgIF9mdWNrX2FwcGVuZF9jb25maWdfaGludCAiRlVDS19PUEVOQUlfTU9ERUwiICLopobnm5bpu5jorqTmqKHlnosiICdncHQtNG8tbWluaScKICAgIF9mdWNrX2FwcGVuZF9jb25maWdfaGludCAiRlVDS19PUEVOQUlfQVBJX0JBU0UiICLoh6rlrprkuYkgQVBJIOWfuuWdgCIgJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEnCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfQUxJQVMiICLpop3lpJbliKvlkI3vvIjkuI3lvbHlk43pu5jorqQgZnVja++8iSIgJ+i/kOihjCcKICAgIF9mdWNrX2FwcGVuZF9jb25maWdfaGludCAiRlVDS19BVVRPX0VYRUMiICLoh6rliqjmiafooYzov5Tlm57lkb3ku6TvvIjljbHpmanmk43kvZzvvIkiICdmYWxzZScgMAogICAgX2Z1Y2tfYXBwZW5kX2NvbmZpZ19oaW50ICJGVUNLX1RJTUVPVVQiICLor7fmsYLotoXml7bml7bpl7TvvIjnp5LvvIkiICczMCcgMAogICAgX2Z1Y2tfYXBwZW5kX2NvbmZpZ19oaW50ICJGVUNLX0RFQlVHIiAi5piv5ZCm6L6T5Ye66LCD6K+V5L+h5oGvIiAnZmFsc2UnIDAKICAgIF9mdWNrX2FwcGVuZF9jb25maWdfaGludCAiRlVDS19ESVNBQkxFX0RFRkFVTFRfQUxJQVMiICLnpoHnlKjlhoXnva4gZnVjayDliKvlkI0iICdmYWxzZScgMAogICAgX2Z1Y2tfYXBwZW5kX2NvbmZpZ19oaW50ICJGVUNLX1NFQ1VSSVRZX01PREUiICLlronlhajlvJXmk47mqKHlvI/vvJpzdHJpY3R8YmFsYW5jZWR8b2ZmIiAnYmFsYW5jZWQnCiAgICBfZnVja19hcHBlbmRfY29uZmlnX2hpbnQgIkZVQ0tfU0VDVVJJVFlfV0hJVEVMSVNUIiAi5Lul6YCX5Y+35oiW5o2i6KGM5YiG6ZqU55qE5L+h5Lu75ZG95Luk54mH5q61IiAnJwogICAgX2Z1Y2tfYXBwZW5kX2NvbmZpZ19oaW50ICJGVUNLX1NFQ1VSSVRZX0NIQUxMRU5HRV9URVhUIiAi6auY5Y2x5ZG95Luk6ZyA6KaB6L6T5YWl55qE56Gu6K6k55+t6K+tIiAn5oiR56Gu6K6k5om/5ouF6aOO6ZmpJwp9CgpfZnVja19lbnN1cmVfY29uZmlnX2V4aXN0cygpIHsKICAgIGlmIFsgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgICAgIF9mdWNrX3NlZWRfY29uZmlnX3BsYWNlaG9sZGVycwogICAgICAgIF9mdWNrX3NlY3VyZV9jb25maWdfZmlsZQogICAgICAgIHJldHVybgogICAgZmkKCiAgICBta2RpciAtcCAiJChkaXJuYW1lICIkQ09ORklHX0ZJTEUiKSIKICAgIGNhdCA8PCdDRkcnID4gIiRDT05GSUdfRklMRSIKIyBmdWNraXRzIOmFjee9ruekuuS+iwojIOWOu+aOieihjOmmlueahCAj77yM5pS55oiQ5L2g6Ieq5bex55qE5YC85Y2z5Y+v44CCCgojIOiHquW7ui/oh6rlrprkuYkgV29ya2VyIOWFpeWPowojIGV4cG9ydCBGVUNLX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly95b3VyLWRvbWFpbi53b3JrZXJzLmRldi8iCgojIOacrOWcsCBPcGVuQUkg5YW85a65IEtlee+8iOW8uueDiOaOqOiNkO+8iQojIGV4cG9ydCBGVUNLX09QRU5BSV9BUElfS0VZPSJzay0uLi4iCgojIOeuoeeQhuWRmOS4k+eUqOWFjemineW6puWvhumSpe+8iOS7heWIhuS6q+e7meS/oeS7u+eahOS6uu+8iQojIGV4cG9ydCBGVUNLX0FETUlOX0tFWT0iYWRtLS4uLiIKCiMg6KaG55uW6buY6K6k5qih5Z6L5oiWIEFQSSDln7rlnYAKIyBleHBvcnQgRlVDS19PUEVOQUlfTU9ERUw9ImdwdC00by1taW5pIgojIGV4cG9ydCBGVUNLX09QRU5BSV9BUElfQkFTRT0iaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MSIKCiMg6aKd5aSW5Yir5ZCN77yI5LiN5Lya5b2x5ZON6buY6K6kIGZ1Y2vvvIkKIyBleHBvcnQgRlVDS19BTElBUz0i6L+Q6KGMIgoKIyDoh6rliqjmiafooYzov5Tlm57lkb3ku6TvvIjljbHpmanvvIzosKjmhY7lvIDlkK/vvIkKIyBleHBvcnQgRlVDS19BVVRPX0VYRUM9ZmFsc2UKCiMg6K+35rGC6LaF5pe25pe26Ze077yI56eS77yJCiMgZXhwb3J0IEZVQ0tfVElNRU9VVD0zMAoKIyDmmK/lkKbovpPlh7rosIPor5Xkv6Hmga8KIyBleHBvcnQgRlVDS19ERUJVRz1mYWxzZQoKIyDnpoHnlKjlhoXnva4gZnVjayDliKvlkI0KIyBleHBvcnQgRlVDS19ESVNBQkxFX0RFRkFVTFRfQUxJQVM9ZmFsc2UKQ0ZHCgogICAgX2Z1Y2tfc2VlZF9jb25maWdfcGxhY2Vob2xkZXJzCiAgICBfZnVja19zZWN1cmVfY29uZmlnX2ZpbGUKfQoKIyDmmL7npLrphY3nva7mj5DnpLoKX2Z1Y2tfc2hvd19jb25maWdfaGVscCgpIHsKICAgIF9mdWNrX2Vuc3VyZV9jb25maWdfZXhpc3RzCiAgICBlY2hvIC1lICIke0NfWUVMTE9XfemFjee9ruaWh+S7tu+8miR7Q19SRVNFVH0gJHtDX0NZQU59JENPTkZJR19GSUxFJHtDX1JFU0VUfSIKICAgIGlmIFsgLW4gIiR7RURJVE9SOi19IiBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33lj6/ku6Xkvb/nlKjvvJoke0NfUkVTRVR9ICR7Q19DWUFOfSR7RURJVE9SfSAkQ09ORklHX0ZJTEUke0NfUkVTRVR9IgogICAgZWxzZQogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d955So5Lu75oSP57yW6L6R5Zmo5omT5byA6K+l5paH5Lu25Y2z5Y+v5L+u5pS56YWN572u44CCJHtDX1JFU0VUfSIKICAgIGZpCiAgICBlY2hvIC1lICIke0NfQ1lBTn3lj6/nlKjpgInpobnvvJoke0NfUkVTRVR9RlVDS19BUElfRU5EUE9JTlQsIEZVQ0tfT1BFTkFJX0FQSV9LRVksIEZVQ0tfQURNSU5fS0VZLCBGVUNLX09QRU5BSV9NT0RFTCwgRlVDS19PUEVOQUlfQVBJX0JBU0UsIEZVQ0tfQUxJQVMsIEZVQ0tfQVVUT19FWEVDLCBGVUNLX1RJTUVPVVQsIEZVQ0tfREVCVUcsIEZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTIgogICAgZWNobyAtZSAiJHtDX0RJTX3lronlhajor7TmmI7vvJrphY3nva7mlofku7bkvJroh6rliqggY2htb2QgNjAw77yM6Ziy5q2iIEtleSDms4TpnLLjgIIke0NfUkVTRVR9Igp9CgojIOWNuOi9veiEmuacrApfdW5pbnN0YWxsX3NjcmlwdCgpIHsKICAgIGVjaG8gLWUgIiR7Q19SRURfQk9MRH3lpb3lpb3lpb3vvIEke0NfUkVTRVR9JHtDX1lFTExPV33mgI7kuYjnnYDvvIzopoHljbjno6jmnYDpqbTllYrvvJ/ooYzllYrkvaDkuKrogIHlha3vvIzmiJHnnJ/osKLosKLkvaDkuobjgIIke0NfUkVTRVR9IgoKICAgICMg5om+6YWN572u5paH5Lu2CiAgICBsb2NhbCBwcm9maWxlX2ZpbGUKICAgIHByb2ZpbGVfZmlsZT0kKF9pbnN0YWxsZXJfZGV0ZWN0X3Byb2ZpbGUpCiAgICBsb2NhbCBzb3VyY2VfbGluZT0ic291cmNlICRNQUlOX1NIIgoKICAgIGlmIFsgIiRwcm9maWxlX2ZpbGUiICE9ICJ1bmtub3duX3Byb2ZpbGUiIF0gJiYgWyAtZiAiJHByb2ZpbGVfZmlsZSIgXTsgdGhlbgogICAgICAgIGlmIGdyZXAgLXFGICIkc291cmNlX2xpbmUiICIkcHJvZmlsZV9maWxlIjsgdGhlbgogICAgICAgICAgICAjIOeUqCBzZWQg5oqK6YKj5Yeg6KGM5Yig5LqG77yM6aG65L6/5aSH5Liq5Lu9CiAgICAgICAgICAgIGlmIHNlZCAtLXZlcnNpb24gPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgICAgICAgICBzZWQgLWkuYmFrICJcfCRzb3VyY2VfbGluZVx8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgICAgICAgICBzZWQgLWkuYmFrICJcfCMgQWRkZWQgYnkgZnVja2l0cyBpbnN0YWxsZXJcfGQiICIkcHJvZmlsZV9maWxlIgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZWQgLWkuYmFrICIiIC1lICJcfCRzb3VyY2VfbGluZVx8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgICAgICAgICBzZWQgLWkuYmFrICIiIC1lICJcfCMgQWRkZWQgYnkgZnVja2l0cyBpbnN0YWxsZXJcfGQiICIkcHJvZmlsZV9maWxlIgogICAgICAgICAgICBmaQogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33mib7kuI3liLAgc2hlbGwg6YWN572u5paH5Lu277yM5oKo5Y+v5Lul5omL5Yqo5Yig6Zmk55u45YWz6YWN572u44CCJHtDX1JFU0VUfSIKICAgIGZpCgogICAgaWYgWyAtZCAiJElOU1RBTExfRElSIiBdOyB0aGVuCiAgICAgICAgcm0gLXJmICIkSU5TVEFMTF9ESVIiCiAgICBmaQoKICAgIHNsZWVwIDMKICAgIGVjaG8gLWUgIiR7Q19HUkVFTn3ooYzvvIzmiJHlhYjotbDkuIDmraXvvIzlkYrovp7jgIIke0NfQ1lBTn3otbbntKfph43lkK/kvaDpgqPnu4jnq6/lkKfvvIzkuI3nhLbkvJrliKvlkI3msaHmn5PjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgMwogICAgZWNobyAtZSAiJHtDX1lFTExPV33kuLTliKvkuYvpmYXvvIznjK7kuIrkuIDpppblsI/or5fvvIznpZ3mgqjliY3nqIvkvLzplKbvvJoke0NfUkVTRVR9IgogICAgc2xlZXAgMgogICAgZWNobyAtZSAiXG4ke0NfUkVEfeOAiuivl+e7j8K35b286Ziz44CLJHtDX1JFU0VUfSIKICAgIHNsZWVwIDIKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d95b286Ziz6Iul6Iez77yM5Yid5Y2H5Lic5pum44CCJHtDX1JFU0VUfSIKICAgIHNsZWVwIDIKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d957uv6Zu+6aOS6JS977yM5Ly85bmV57uh57u444CCJHtDX1JFU0VUfSIKICAgIHNsZWVwIDMKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d95b286Ziz56+d56Kn77yM6Zu+6ZyC5ran5ruB44CCJHtDX1JFU0VUfSIKICAgIHNsZWVwIDQKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d96LWk55+z5Yas5rqq77yM5Ly8546b55GZ5r2t44CCJHtDX1JFU0VUfSIKICAgIHNsZWVwIDQKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d95b286Ziz5pma5oSP77yM5pqW5qKm5Ly85LmQ44CCJHtDX1JFU0VUfSIKICAgIHNsZWVwIDMKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d95a+Q5ri45rWu5rKQ77yM6Iul6ZuJ6aOe6Iie44CCJHtDX1JFU0VUfSIKfQoKIyDot58gQVBJIOmAmuS/oeeahOS4u+WHveaVsAojIOWPguaVsOWwseaYr+imgeaJp+ihjOeahOWRveS7pApfZnVja19leGVjdXRlX3Byb21wdCgpIHsKICAgICMg5aaC5p6c55So5oi35Y+q6L6T5YWlICJmdWNrIHVuaW5zdGFsbCIKICAgIGlmIFsgIiQxIiA9ICJ1bmluc3RhbGwiIF0gJiYgWyAiJCMiIC1lcSAxIF07IHRoZW4KICAgICAgICBfdW5pbnN0YWxsX3NjcmlwdAogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgICMg5aaC5p6c55So5oi36L6T5YWlICJmdWNrIGNvbmZpZyIKICAgIGlmIFsgIiQxIiA9ICJjb25maWciIF0gJiYgWyAiJCMiIC1lcSAxIF07IHRoZW4KICAgICAgICBfZnVja19zaG93X2NvbmZpZ19oZWxwCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgaWYgISBjb21tYW5kIC12IGN1cmwgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH0nZnVjaycg5ZG95Luk6ZyA6KaBICdjdXJsJ++8jOivt+WFiOWuieijhSBjdXJs44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgaWYgWyAiJCMiIC1lcSAwIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeivt+aPkOS+m+imgeaJp+ihjOeahOWRveS7pOOAgiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgIGxvY2FsIHByb21wdD0iJCoiCiAgICBsb2NhbCBhdXRvX21vZGU9IiR7RlVDS19BVVRPX0VYRUM6LTB9IgogICAgbG9jYWwgY3VybF90aW1lb3V0PSIke0ZVQ0tfVElNRU9VVDotMzB9IgogICAgbG9jYWwgc3lzaW5mb19zdHJpbmcKICAgIHN5c2luZm9fc3RyaW5nPSQoX2Z1Y2tfY29sbGVjdF9zeXNpbmZvX3N0cmluZykKCiAgICBsb2NhbCByZXNwb25zZT0iIgogICAgbG9jYWwgZXhpdF9jb2RlPTAKICAgIGlmIF9mdWNrX3Nob3VsZF91c2VfbG9jYWxfYXBpOyB0aGVuCiAgICAgICAgcHJpbnRmICIke0NfWUVMTE9XfeS9v+eUqOacrOWcsCBBUEkgS2V5Li4uICR7Q19SRVNFVH0iCiAgICAgICAgcmVzcG9uc2U9JChfZnVja19yZXF1ZXN0X2xvY2FsX21vZGVsICIkcHJvbXB0IiAiJHN5c2luZm9fc3RyaW5nIiAiJGN1cmxfdGltZW91dCIpCiAgICAgICAgZXhpdF9jb2RlPSQ/CiAgICBlbHNlCiAgICAgICAgcHJpbnRmICIke0NfWUVMTE9XfeaAneiAg+S4rS4uLiAke0NfUkVTRVR9IgogICAgICAgIHJlc3BvbnNlPSQoX2Z1Y2tfcmVxdWVzdF93b3JrZXJfbW9kZWwgIiRwcm9tcHQiICIkc3lzaW5mb19zdHJpbmciICIkY3VybF90aW1lb3V0IikKICAgICAgICBleGl0X2NvZGU9JD8KICAgIGZpCgogICAgcHJpbnRmICJcciIgIyBDbGVhciB0aGUgbGluZSBiZWZvcmUgcHJpbnRpbmcgYSBuZXdsaW5lCiAgICBlY2hvICIiCgogICAgaWYgWyAkZXhpdF9jb2RlIC1uZSAwIF0gfHwgWyAteiAiJHJlc3BvbnNlIiBdOyB0aGVuCiAgICAgICAgcmV0dXJuICRleGl0X2NvZGUKICAgIGZpCgogICAgZWNobyAtZSAiJHtDX0NZQU595Li65oKo55Sf5oiQ5LqG5Lul5LiL5ZG95Luk77yaJHtDX1JFU0VUfSIKICAgIGVjaG8gLWUgIiR7Q19ESU19LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSR7Q19SRVNFVH0iCiAgICBwcmludGYgJyVzXG4nICIkcmVzcG9uc2UiCiAgICBlY2hvIC1lICIke0NfRElNfS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0ke0NfUkVTRVR9IgoKICAgICMg5a6J5YWo5qOA5p+l5Y2x6Zmp5ZG95LukCiAgICBsb2NhbCBzZWN1cml0eV9yZXN1bHQgc2VjdXJpdHlfbGV2ZWwgc2VjdXJpdHlfcmVhc29uCiAgICBzZWN1cml0eV9yZXN1bHQ9JChfZnVja19kZXRlY3RfZGFuZ2Vyb3VzX2NvbW1hbmQgIiRyZXNwb25zZSIpCiAgICBzZWN1cml0eV9sZXZlbD0ke3NlY3VyaXR5X3Jlc3VsdCUlfCp9CiAgICBzZWN1cml0eV9yZWFzb249JHtzZWN1cml0eV9yZXN1bHQjKnx9CgogICAgIyDmoLnmja7kuKXph43mgKfnuqfliKvlpITnkIblronlhajlhrPnrZYKICAgIGlmICEgX2Z1Y2tfc2VjdXJpdHlfaGFuZGxlX2RlY2lzaW9uICIkc2VjdXJpdHlfbGV2ZWwiICIkc2VjdXJpdHlfcmVhc29uIiAiJHJlc3BvbnNlIjsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19SRUR94p2MIOWRveS7pOWboOWuieWFqOetlueVpeiiq+S4reatouOAgiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgIGxvY2FsIHNob3VsZF9leGVjPWZhbHNlCgogICAgaWYgX2Z1Y2tfdHJ1dGh5ICIkYXV0b19tb2RlIjsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d94pqhIOW3suW8gOWQr+iHquWKqOaJp+ihjOaooeW8j++8jOeri+WNs+i/kOihjC4uLiR7Q19SRVNFVH0iCiAgICAgICAgc2hvdWxkX2V4ZWM9dHJ1ZQogICAgZWxzZQogICAgICAgIHdoaWxlIHRydWU7IGRvCiAgICAgICAgICAgIHByaW50ZiAiJHtDX0JPTER95piv5ZCm5omn6KGM77yfW1kvbl0gJHtDX1JFU0VUfSIKICAgICAgICAgICAgbG9jYWwgY29uZmlybWF0aW9uIG5vcm1hbGl6ZWQKICAgICAgICAgICAgaWYgWyAtciAvZGV2L3R0eSBdOyB0aGVuCiAgICAgICAgICAgICAgICBJRlM9IHJlYWQgLXIgY29uZmlybWF0aW9uIDwgL2Rldi90dHkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmVhZCAtciBjb25maXJtYXRpb24KICAgICAgICAgICAgZmkKCiAgICAgICAgICAgIGNvbmZpcm1hdGlvbj0kKHByaW50ZiAnJXMnICIke2NvbmZpcm1hdGlvbjotfSIgfCB0ciAtZCAnIFx0XHInKQogICAgICAgICAgICBub3JtYWxpemVkPSQocHJpbnRmICclcycgIiRjb25maXJtYXRpb24iIHwgdHIgJ1s6dXBwZXI6XScgJ1s6bG93ZXI6XScpCgogICAgICAgICAgICBjYXNlICIkbm9ybWFsaXplZCIgaW4KICAgICAgICAgICAgICAgICIifCJ5InwieWVzInwi5pivIikKICAgICAgICAgICAgICAgICAgICBzaG91bGRfZXhlYz10cnVlCiAgICAgICAgICAgICAgICAgICAgZWNobyAtZSAiJHtDX0dSRUVOfeKchSDmiafooYzkuK0uLi4ke0NfUkVTRVR9IgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgICJuInwibm8ifCLlkKYiKQogICAgICAgICAgICAgICAgICAgIHNob3VsZF9leGVjPWZhbHNlCiAgICAgICAgICAgICAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33inYwg5bey5Y+W5raI44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAgICAgKikKICAgICAgICAgICAgICAgICAgICAjIExvb3AKICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICBlc2FjCiAgICAgICAgZG9uZQogICAgZmkKCiAgICBpZiBbICIkc2hvdWxkX2V4ZWMiID0gInRydWUiIF07IHRoZW4KICAgICAgICBldmFsICIkcmVzcG9uc2UiCiAgICAgICAgbG9jYWwgZXhpdF9jb2RlPSQ/CiAgICAgICAgaWYgWyAkZXhpdF9jb2RlIC1uZSAwIF07IHRoZW4KICAgICAgICAgICAgZWNobyAtZSAiJHtDX1JFRF9CT0xEfemUmeivr++8gSR7Q19SRUR95ZG95Luk5omn6KGM5aSx6LSl77yM6YCA5Ye656CBICRleGl0X2NvZGXjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICBmaQogICAgICAgIHJldHVybiAkZXhpdF9jb2RlCiAgICBlbHNlCiAgICAgICAgIyAi5bey5Y+W5raI44CCIiDmtojmga/njrDlnKjlnKjlvqrnjq/lhoXmiZPljbDvvIwKICAgICAgICAjIOaJgOS7peWmguaenCBzaG91bGRfZXhlYyDkuLogZmFsc2XvvIznm7TmjqXov5Tlm54gMSDljbPlj6/jgIIKICAgICAgICByZXR1cm4gMQogICAgZmkKfQoKIyDlrprkuYnliKvlkI3vvIjmlK/mjIHoh6rlrprkuYnliKvlkI3vvIkKX2Z1Y2tfZGVmaW5lX2FsaWFzZXMoKSB7CiAgICBsb2NhbCBkZWZhdWx0X2FsaWFzPSJmdWNrIgoKICAgIGlmICEgX2Z1Y2tfdHJ1dGh5ICIke0ZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTOi0wfSI7IHRoZW4KICAgICAgICBhbGlhcyAiJGRlZmF1bHRfYWxpYXMiPSdfZnVja19leGVjdXRlX3Byb21wdCcKICAgIGZpCgogICAgaWYgWyAtbiAiJHtGVUNLX0FMSUFTOi19IiBdICYmIFsgIiRGVUNLX0FMSUFTIiAhPSAiJGRlZmF1bHRfYWxpYXMiIF07IHRoZW4KICAgICAgICBhbGlhcyAiJEZVQ0tfQUxJQVMiPSdfZnVja19leGVjdXRlX3Byb21wdCcKICAgIGZpCn0KCl9mdWNrX2RlZmluZV9hbGlhc2VzCgojIC0tLSDmoLjlv4PpgLvovpHnu5PmnZ8gLS0tCkVPRgoKIyAtLS0g5qC45b+D6YC76L6RIEhlcmVkb2Mg57uT5p2fIC0tLQoKIyDlsIblhoXltYzmoLjlv4PpgLvovpHlhpnliLDmlofku7bkuK3vvIjlronoo4Uv5Li05pe25qih5byP6YO95Lya55So5Yiw77yJCl9mdWNrX3dyaXRlX2NvcmUoKSB7CiAgICBsb2NhbCB0YXJnZXQ9IiQxIgogICAgcHJpbnRmICclc1xuJyAiJENPUkVfTE9HSUMiID4gIiR0YXJnZXQiCn0KCiMg5bCG5qC45b+D6YC76L6R6L295YWl5b2T5YmNIHNoZWxsCl9mdWNrX3NvdXJjZV9jb3JlKCkgewogICAgbG9jYWwgdG1wX2NvcmUKICAgIHRtcF9jb3JlPSQobWt0ZW1wKQogICAgX2Z1Y2tfd3JpdGVfY29yZSAiJHRtcF9jb3JlIgogICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MxMDkwCiAgICBzb3VyY2UgIiR0bXBfY29yZSIKICAgIHJtIC1mICIkdG1wX2NvcmUiCn0KCiMg5bCG5YaF5bWM5qC45b+D6YC76L6R5YaZ5YWl5oyH5a6a5paH5Lu277yI5a6J6KOF5LiO5Li05pe25omn6KGM5Lya55So5Yiw77yJCl9mdWNrX3dyaXRlX2NvcmUoKSB7CiAgICBsb2NhbCB0YXJnZXQ9IiQxIgogICAgcHJpbnRmICclc1xuJyAiJENPUkVfTE9HSUMiID4gIiR0YXJnZXQiCn0KCgojIC0tLSDlronoo4Xlh73mlbAgKOeUseWklumDqOiEmuacrOi/kOihjCkgLS0tCgojIOaJvueUqOaItyBzaGVsbCDphY3nva7mlofku7bnmoTovoXliqnlh73mlbAKX2luc3RhbGxlcl9kZXRlY3RfcHJvZmlsZSgpIHsKICAgIGlmIFsgLW4gIiR7U0hFTEw6LX0iIF0gJiYgZWNobyAiJFNIRUxMIiB8IGdyZXAgLXEgInpzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uenNocmMiCiAgICBlbGlmIFsgLW4gIiR7U0hFTEw6LX0iIF0gJiYgZWNobyAiJFNIRUxMIiB8IGdyZXAgLXEgImJhc2giOyB0aGVuCiAgICAgICAgZWNobyAiJEhPTUUvLmJhc2hyYyIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLnByb2ZpbGUiIF07IHRoZW4KICAgICAgICAjIOWFvOWuuSBzaCwga3NoIOetiQogICAgICAgIGVjaG8gIiRIT01FLy5wcm9maWxlIgogICAgZWxpZiBbIC1mICIkSE9NRS8uenNocmMiIF07IHRoZW4KICAgICAgICAjIFNIRUxMIOWPmOmHj+ayoeiuvue9ruaXtueahOWkh+eUqOaWueahiAogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLmJhc2hyYyIgXTsgdGhlbgogICAgICAgICMgU0hFTEwg5Y+Y6YeP5rKh6K6+572u5pe255qE5aSH55So5pa55qGICiAgICAgICAgZWNobyAiJEhPTUUvLmJhc2hyYyIKICAgIGVsc2UKICAgICAgICBlY2hvICJ1bmtub3duX3Byb2ZpbGUiCiAgICBmaQp9CgojIOS4u+WuieijheWHveaVsApfaW5zdGFsbGVyX3NlY3VyZV9jb25maWdfZmlsZSgpIHsKICAgIGlmIFsgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgICAgIGNobW9kIDYwMCAiJENPTkZJR19GSUxFIiAyPi9kZXYvbnVsbCB8fCB0cnVlCiAgICBmaQp9CgpfaW5zdGFsbF9zY3JpcHQoKSB7CiAgICBlY2hvIC1lICIke0NfQk9MRH3lvIDlp4vlronoo4UgZnVja2l0cy4uLiR7Q19SRVNFVH0iCiAgICBta2RpciAtcCAiJElOU1RBTExfRElSIgogICAgCiAgICAjIOaKiuaguOW/g+mAu+i+keWGmei/myBtYWluLnNoCiAgICBfZnVja193cml0ZV9jb3JlICIkTUFJTl9TSCIKICAgIAogICAgaWYgWyAkPyAtbmUgMCBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH3ml6Dms5XlhpnlhaXmlofku7bvvIzor7fmo4Dmn6Xnm67lvZXmnYPpmZDjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICAjIOWmguaenOayoeaciemFjee9ruaWh+S7tuWImeeUn+aIkOS4gOS4quekuuS+iwogICAgaWYgWyAhIC1mICIkQ09ORklHX0ZJTEUiIF07IHRoZW4KICAgICAgICBjYXQgPDwnQ0ZHJyA+ICIkQ09ORklHX0ZJTEUiCiMgZnVja2l0cyDphY3nva7npLrkvosKIyDljrvmjonooYzpppbnmoQgI++8jOaUueaIkOS9oOiHquW3seeahOWAvOWNs+WPr+OAggoKIyDoh6rlu7ov6Ieq5a6a5LmJIFdvcmtlciDlhaXlj6MKIyBleHBvcnQgRlVDS19BUElfRU5EUE9JTlQ9Imh0dHBzOi8veW91ci1kb21haW4ud29ya2Vycy5kZXYvIgoKIyDmnKzlnLAgT3BlbkFJIOWFvOWuuSBLZXnvvIjlvLrng4jmjqjojZDvvIkKIyBleHBvcnQgRlVDS19PUEVOQUlfQVBJX0tFWT0ic2stLi4uIgoKIyDopobnm5bpu5jorqTmqKHlnovmiJYgQVBJIOWfuuWdgAojIGV4cG9ydCBGVUNLX09QRU5BSV9NT0RFTD0iZ3B0LTRvLW1pbmkiCiMgZXhwb3J0IEZVQ0tfT1BFTkFJX0FQSV9CQVNFPSJodHRwczovL2FwaS5vcGVuYWkuY29tL3YxIgoKIyDpop3lpJbliKvlkI3vvIjkuI3kvJrlvbHlk43pu5jorqQgZnVja++8iQojIGV4cG9ydCBGVUNLX0FMSUFTPSLov5DooYwiCgojIOiHquWKqOaJp+ihjOi/lOWbnueahOWRveS7pO+8iOWNsemZqe+8jOiwqOaFjuW8gOWQr++8iQojIGV4cG9ydCBGVUNLX0FVVE9fRVhFQz1mYWxzZQoKIyDor7fmsYLotoXml7bml7bpl7TvvIjnp5LvvIkKIyBleHBvcnQgRlVDS19USU1FT1VUPTMwCgojIOaYr+WQpui+k+WHuuiwg+ivleS/oeaBrwojIGV4cG9ydCBGVUNLX0RFQlVHPWZhbHNlCgojIOemgeeUqOWGhee9riBmdWNrIOWIq+WQjQojIGV4cG9ydCBGVUNLX0RJU0FCTEVfREVGQVVMVF9BTElBUz1mYWxzZQpDRkcKICAgICAgICBfaW5zdGFsbGVyX3NlY3VyZV9jb25maWdfZmlsZQogICAgZmkKCiAgICAjIOaKiiBzb3VyY2Ug6YKj6KGM5Yqg5YiwIHNoZWxsIOmFjee9ruaWh+S7tumHjAogICAgbG9jYWwgcHJvZmlsZV9maWxlCiAgICBwcm9maWxlX2ZpbGU9JChfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKQogICAgCiAgICBpZiBbICIkcHJvZmlsZV9maWxlIiA9ICJ1bmtub3duX3Byb2ZpbGUiIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeaJvuS4jeWIsCAuYmFzaHJjLCAuenNocmMg5oiWIC5wcm9maWxl77yM5peg5rOV6Ieq5Yqo6YWN572u44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33or7fmiYvliqjlsIbku6XkuIvlhoXlrrnmt7vliqDliLDmgqjnmoQgc2hlbGwg6YWN572u5paH5Lu25Lit77yaJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgZWNobyAtZSAiXG4gICR7Q19DWUFOfXNvdXJjZSAkTUFJTl9TSCR7Q19SRVNFVH1cbiIgPiYyCiAgICAgICAgcmV0dXJuCiAgICBmaQogICAgCiAgICBsb2NhbCBzb3VyY2VfbGluZT0ic291cmNlICRNQUlOX1NIIgogICAgaWYgISBncmVwIC1xRiAiJHNvdXJjZV9saW5lIiAiJHByb2ZpbGVfZmlsZSI7IHRoZW4KICAgICAgICAjIOS/neivgeaWh+S7tuacgOWQjuacieaNouihjAogICAgICAgIGlmIFsgLW4gIiQodGFpbCAtYzEgIiRwcm9maWxlX2ZpbGUiKSIgXTsgdGhlbgogICAgICAgICAgICBlY2hvICIiID4+ICIkcHJvZmlsZV9maWxlIgogICAgICAgIGZpCiAgICAgICAgZWNobyAiIyBBZGRlZCBieSBmdWNraXRzIGluc3RhbGxlciIgPj4gIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgZWNobyAiJHNvdXJjZV9saW5lIiA+PiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICBlY2hvIC1lICIke0NfR1JFRU595a6J6KOF5a6M5oiQ77yBJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9Xfeivt+mHjeWQr+e7iOerr+aIluaJp+ihjCAke0NfQk9MRH1zb3VyY2UgJHByb2ZpbGVfZmlsZSR7Q19ZRUxMT1d9IOS7peS9v+abtOaUueeUn+aViOOAgiR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiXG4ke0NfQk9MRH0tLS0g5L2/55So5pa55rOVIC0tLSR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAi5L2/55SoICR7Q19SRURfQk9MRH1mdWNrJHtDX1JFU0VUfSDlkb3ku6TlkI7ot5/mgqjmg7PmiafooYznmoTmk43kvZzljbPlj6/jgIIiCiAgICAgICAgZWNobyAtZSAi56S65L6LOiIKICAgICAgICBlY2hvIC1lICIgICR7Q19DWUFOfWZ1Y2sgaW5zdGFsbCBnaXQke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiAgJHtDX0NZQU59ZnVjayB1bmluc3RhbGwgZ2l0JHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19DWUFOfWZ1Y2sg5om+5Ye65b2T5YmN55uu5b2V5omA5pyJ5aSn5LqOMTBNQueahOaWh+S7tiR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiICAke0NfUkVEX0JPTER9ZnVjayB1bmluc3RhbGwke0NfUkVTRVR9ICR7Q19HUkVFTn0jIOWNuOi9vSBmdWNraXRzJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19SRURfQk9MRH1mdWNrIGNvbmZpZyR7Q19SRVNFVH0gJHtDX0dSRUVOfSMg5pi+56S66YWN572u5biu5YqpJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICJcbiR7Q19ZRUxMT1d96K6w5b6X6YeN5ZCv57uI56uv5Lul5L2/55So5paw5ZG95Luk77yBJHtDX1JFU0VUfSIKICAgIGVsc2UKICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfWUVMTE9XfeajgOa1i+WIsOW3suWuieijhe+8jOW3suS4uuaCqOabtOaWsOiEmuacrOOAgiR7Q19SRVNFVH0iCiAgICBmaQp9CgoKIyAtLS0g5Li76ISa5pys5YWl5Y+jIC0tLQoKIyDlpoLmnpzmnInlj4LmlbDkvKDov5vmnaUgKOavlOWmgiAiYmFzaCAtcyAuLi4iKQppZiBbICIkIyIgLWd0IDAgXTsgdGhlbgogICAgaWYgWyAiJDEiID0gImluc3RhbGwiIF0gJiYgWyAiJCMiIC1lcSAxIF07IHRoZW4KICAgICAgICBfaW5zdGFsbF9zY3JpcHQKICAgICAgICBleGl0IDAKICAgIGZpCgogICAgX2Z1Y2tfc291cmNlX2NvcmUKICAgIF9mdWNrX2V4ZWN1dGVfcHJvbXB0ICIkQCIKZWxzZQogICAgX2luc3RhbGxfc2NyaXB0CmZpCg==`);

const README_URL_EN = 'https://github.com/Silentely/fuckits/blob/main/README.en.md';
const README_URL_ZH = 'https://github.com/Silentely/fuckits';
const INSTALLER_FILENAME_EN = 'fuckits.sh';
const INSTALLER_FILENAME_ZH = 'fuckits-zh.sh';
const SHARED_DEFAULT_LIMIT = 10;
const SECONDS_IN_DAY = 24 * 60 * 60;

let lastQuotaDate = null;
const sharedUsage = new Map();

function resolveSharedLimit(env) {
  const raw = Number(env?.SHARED_DAILY_LIMIT ?? env?.SHARED_DEFAULT_LIMIT);
  if (Number.isFinite(raw) && raw > 0) {
    return Math.floor(raw);
  }
  return SHARED_DEFAULT_LIMIT;
}

function resolveQuotaStore(env) {
  if (env?.QUOTA_KV && typeof env.QUOTA_KV.get === 'function') {
    return env.QUOTA_KV;
  }

  const alias = env?.QUOTA_KV_BINDING;
  if (alias && env?.[alias] && typeof env[alias].get === 'function') {
    return env[alias];
  }

  if (env?.fuckits && typeof env.fuckits.get === 'function') {
    return env.fuckits;
  }

  return null;
}

async function checkSharedQuota(ip, limit, env) {
  const quotaStore = resolveQuotaStore(env);
  if (quotaStore) {
    return checkSharedQuotaKV(quotaStore, ip, limit);
  }
  return checkSharedQuotaInMemory(ip, limit);
}

function checkSharedQuotaInMemory(ip, limit) {
  const today = new Date().toISOString().slice(0, 10);
  if (lastQuotaDate !== today) {
    sharedUsage.clear();
    lastQuotaDate = today;
  }
  const key = ip || 'anonymous';
  const current = (sharedUsage.get(key) || 0) + 1;
  sharedUsage.set(key, current);
  return {
    allowed: current <= limit,
    remaining: Math.max(limit - current, 0),
    count: current,
  };
}

async function checkSharedQuotaKV(kv, ip, limit) {
  const today = new Date().toISOString().slice(0, 10);
  const key = `quota:${today}:${ip || 'anonymous'}`;
  const ttl = secondsUntilNextUtcMidnight();

  try {
    const raw = await kv.get(key);
    let count = Number(raw) || 0;
    count += 1;
    await kv.put(key, String(count), { expirationTtl: ttl > 0 ? ttl : SECONDS_IN_DAY });
    return {
      allowed: count <= limit,
      remaining: Math.max(limit - count, 0),
      count,
    };
  } catch (error) {
    console.error('Failed to persist quota counter, falling back to in-memory map', error);
    return checkSharedQuotaInMemory(ip, limit);
  }
}

function secondsUntilNextUtcMidnight() {
  const now = new Date();
  const midnight = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + 1);
  return Math.ceil((midnight - now.getTime()) / 1000);
}

function isBrowserRequest(userAgent = '') {
  return /Mozilla|Chrome|Safari|Firefox|Edg/.test(userAgent);
}

function resolveLocale(url, headers) {
  const pathname = url.pathname.toLowerCase();
  if (pathname === '/zh' || pathname.startsWith('/zh/')) {
    return 'zh';
  }

  const langParam = (url.searchParams.get('lang') || '').toLowerCase();
  if (langParam) {
    //  lang  URL 
    if (langParam.startsWith('zh')) {
      return 'zh';
    }
    if (langParam.startsWith('en')) {
      return 'en';
    }
  }

  const acceptLanguage = (headers.get('Accept-Language') || '').toLowerCase();
  if (acceptLanguage.split(',').some((token) => token.trim().startsWith('zh'))) {
    return 'zh';
  }

  return 'en';
}


export default {
  async fetch(request, env, ctx) {
    const url = new URL(request.url);

    if (request.method === 'OPTIONS') {
      return addCorsHeaders(handleOptionsRequest());
    }

    if (request.method === 'GET' && url.pathname === '/health') {
      return addCorsHeaders(handleHealthCheck(env));
    }

    if (request.method === 'GET') {
      return addCorsHeaders(await handleGetRequest(request));
    } else if (request.method === 'POST') {
      return addCorsHeaders(await handlePostRequest(request, env));
    } else {
      return addCorsHeaders(new Response('Expected GET or POST', { status: 405 }));
    }
  },
};

function handleOptionsRequest() {
  return new Response(null, {
    status: 204,
    headers: {
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type',
    },
  });
}

function addCorsHeaders(response) {
  const newHeaders = new Headers(response.headers);
  newHeaders.set('Access-Control-Allow-Origin', '*');
  return new Response(response.body, {
    status: response.status,
    statusText: response.statusText,
    headers: newHeaders,
  });
}

function handleHealthCheck(env) {
  const payload = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    hasApiKey: Boolean(env?.OPENAI_API_KEY),
  };

  return new Response(JSON.stringify(payload), {
    status: 200,
    headers: { 'Content-Type': 'application/json; charset=utf-8' },
  });
}

/**
 * Handles GET requests to serve the installer script or redirect browsers to GitHub.
 * @param {Request} request The incoming request.
 * @returns {Response} A response with the shell script or a redirect.
 */
function handleGetRequest(request) {
  const userAgent = request.headers.get('User-Agent') || '';
  console.log('[DEBUG] User-Agent received:', userAgent);
  console.log('[DEBUG] User-Agent type:', typeof userAgent);

  const url = new URL(request.url);
  const locale = resolveLocale(url, request.headers);
  const isBrowser = isBrowserRequest(userAgent);
  console.log('[DEBUG] isBrowser result:', isBrowser);

  // If the request comes from a browser, redirect to the appropriate README.
  if (isBrowser) {
    console.log('[DEBUG] Taking redirect branch');
    const docsUrl = locale === 'zh' ? README_URL_ZH : README_URL_EN;
    console.log('[DEBUG] Redirecting to:', docsUrl);
    return Response.redirect(docsUrl, 302);
  }

  console.log('[DEBUG] Taking script serving branch');
  // Otherwise, serve the installer script based on the resolved locale.
  const script = locale === 'zh' ? INSTALLER_SCRIPT_ZH : INSTALLER_SCRIPT;
  const filename = locale === 'zh' ? INSTALLER_FILENAME_ZH : INSTALLER_FILENAME_EN;

  return new Response(script, {
    headers: {
      'Content-Type': 'text/plain; charset=utf-8',
      'Content-Disposition': `attachment; filename="${filename}"`,
    },
  });
}

/**
 * Handles POST requests by forwarding the prompt to an AI model.
 * @param {Request} request The incoming request.
 * @param {object} env The environment variables.
 * @returns {Promise<Response>} A promise that resolves to the AI's response.
 */
async function handlePostRequest(request, env) {
  try {
    const { sysinfo, prompt, adminKey } = await request.json();

    //  sysinfo
    if (!sysinfo || sysinfo.trim() === '') {
      return new Response(
        JSON.stringify({ error: 'Missing or empty "sysinfo" in request body' }),
        {
          status: 400,
          headers: { 'Content-Type': 'application/json' }
        }
      );
    }

    //  prompt
    if (!prompt || prompt.trim() === '') {
      return new Response(
        JSON.stringify({ error: 'Missing or empty "prompt" in request body' }),
        {
          status: 400,
          headers: { 'Content-Type': 'application/json' }
        }
      );
    }
    if (!env.OPENAI_API_KEY) {
      return new Response('Missing OPENAI_API_KEY secret', { status: 500 });
    }

    const normalizedAdminKey = typeof adminKey === 'string' ? adminKey.trim() : '';
    const hasAdminBypass = Boolean(
      normalizedAdminKey && env?.ADMIN_ACCESS_KEY && normalizedAdminKey === env.ADMIN_ACCESS_KEY,
    );

    const clientIp = request.headers.get('CF-Connecting-IP') ||
      request.headers.get('X-Forwarded-For') ||
      'anonymous';
    if (!hasAdminBypass) {
      const sharedLimit = resolveSharedLimit(env);
      const quota = await checkSharedQuota(clientIp, sharedLimit, env);
      if (!quota.allowed) {
        const message = {
          error: 'DEMO_LIMIT_EXCEEDED',
          message: `Shared demo quota exceeded (max ${sharedLimit} calls per day).`,
          hint: 'Configure FUCK_OPENAI_API_KEY in ~/.fuck/config.sh to use your own key.',
          remaining: quota.remaining,
          limit: sharedLimit,
        };
        return new Response(JSON.stringify(message), {
          status: 429,
          headers: { 'Content-Type': 'application/json', 'Cache-Control': 'no-store' },
        });
      }
    }

    const model = env.OPENAI_API_MODEL || 'gpt-5-nano';
    const apiBase = (env.OPENAI_API_BASE || 'https://api.openai.com/v1').replace(/\/$/, '');
    const apiUrl = `${apiBase}/chat/completions`;

    const url = new URL(request.url);
    const locale = resolveLocale(url, request.headers);
    const isChinese = locale === 'zh';

    const system_prompt = isChinese
      ? ` shell  shell markdown  \`\`\`bash shebang #!/bin/bash${sysinfo}`
      : `You are an expert shell script generator. A user will provide their system information and a prompt. Your task is to return a raw, executable shell script that accomplishes their goal. The script can be multi-line. Do not provide any explanation, comments, markdown formatting (like \`\`\`bash), or a shebang (e.g., #!/bin/bash). Just the raw script content. The user's system info is: ${sysinfo}`;

    const aiRequestPayload = {
      model: model,
      messages: [
        {
          role: 'system',
          content: system_prompt,
        },
        {
          role: 'user',
          content: prompt,
        },
      ],
      max_tokens: 1024,
      temperature: 0.2,
    };

    const aiResponse = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${env.OPENAI_API_KEY}`,
      },
      body: JSON.stringify(aiRequestPayload),
    });

    if (!aiResponse.ok) {
      const errorText = await aiResponse.text();
      return new Response(`AI API Error: ${errorText}`, { status: aiResponse.status });
    }

    const aiJson = await aiResponse.json();
    const command = aiJson.choices[0]?.message?.content.trim();

    if (!command) {
      return new Response('The AI returned an empty command.', { status: 500 });
    }

    return new Response(command, {
      headers: { 'Content-Type': 'text/plain' },
    });
  } catch (error) {
    return new Response(`Error: ${error.message}`, { status: 500 });
  }
}
