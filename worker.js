// --- FUCKIT.SH Cloudflare Worker ---

// This is the content of your main.sh installer script.
// It will be served when a user makes a GET request.
function b64_to_utf8(str) {
  try {
    // This is a more robust way to decode base64 to UTF-8
    const binaryString = atob(str);
    const len = binaryString.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    return new TextDecoder().decode(bytes);
  } catch (e) {
    console.error("Failed to decode base64 string:", e);
    return ""; // Return empty string on failure
  }
}

const INSTALLER_SCRIPT = b64_to_utf8(`IyEvYmluL2Jhc2gKIwojIFRoaXMgc2NyaXB0IGlzIHRoZSBpbnN0YWxsZXIgYW5kIHRlbXBvcmFyeSBydW5uZXIgZm9yIGZ1Y2tpdC5zaAojCiMgLS0tIFJFQ09NTUVOREVEIFNFQ1VSRSBVU0FHRSAtLS0KIwojIDEuIERvd25sb2FkOgojICAgIGN1cmwgLW8gZnVja2l0LnNoIGh0dHBzOi8vZnVja2l0LnNoCiMKIyAyLiBJbnNwZWN0OgojICAgIGxlc3MgZnVja2l0LnNoCiMKIyAzLiBSdW4gKEluc3RhbGwpOgojICAgIGJhc2ggZnVja2l0LnNoCiMKIyA0LiBSdW4gKFRlbXBvcmFyeSk6CiMgICAgYmFzaCBmdWNraXQuc2ggInlvdXIgcHJvbXB0IgojCgpzZXQgLWV1byBwaXBlZmFpbAoKIyAtLS0gQ29sb3IgRGVmaW5pdGlvbnMgLS0tCnJlYWRvbmx5IENfUkVTRVQ9J1wwMzNbMG0nCnJlYWRvbmx5IENfUkVEX0JPTEQ9J1wwMzNbMTszMW0nCnJlYWRvbmx5IENfUkVEPSdcMDMzWzA7MzFtJwpyZWFkb25seSBDX0dSRUVOPSdcMDMzWzA7MzJtJwpyZWFkb25seSBDX1lFTExPVz0nXDAzM1swOzMzbScKcmVhZG9ubHkgQ19DWUFOPSdcMDMzWzA7MzZtJwpyZWFkb25seSBDX0JPTEQ9J1wwMzNbMW0nCgojIC0tLSBGVUNLISAtLS0KcmVhZG9ubHkgRlVDSz0iJHtDX1JFRF9CT0xEfUZVQ0shJHtDX1JFU0VUfSIKcmVhZG9ubHkgRkNLTj0iJHtDX1JFRH1GKkNLSU5HJHtDX1JFU0VUfSIKCgojIC0tLSBDb25maWd1cmF0aW9uIC0tLQppZiBbIC16ICIke0hPTUU6LX0iIF07IHRoZW4KICAgIGVjaG8gLWUgIlwwMzNbMTszMW1GVUNLIVwwMzNbMG0gXDAzM1swOzMxbVlvdXIgSE9NRSB2YXJpYWJsZSBpc24ndCBzZXQuIEkgZG9uJ3Qga25vdyB3aGVyZSB0byBpbnN0YWxsIHRoaXMgc2hpdC4gU2V0IGl0IHlvdXJzZWxmIChlLmcuLCBleHBvcnQgSE9NRT0vcm9vdCkuXDAzM1swbSIgPiYyCiAgICBleGl0IDEKZmkKcmVhZG9ubHkgSU5TVEFMTF9ESVI9IiRIT01FLy5mdWNrIgpyZWFkb25seSBNQUlOX1NIPSIkSU5TVEFMTF9ESVIvbWFpbi5zaCIKcmVhZG9ubHkgQ09ORklHX0ZJTEU9IiRJTlNUQUxMX0RJUi9jb25maWcuc2giCnJlYWRvbmx5IERFRkFVTFRfQVBJX0VORFBPSU5UPSJodHRwczovL2Z1Y2tpdC5zaC8iCgoKIyAtLS0gQ29yZSBMb2dpYyAoRW1iZWRkZWQgYXMgYSBzdHJpbmcpIC0tLQpDT1JFX0xPR0lDPSQoY2F0IDw8J0VPRicKCiMgLS0tIEJlZ2luIENvcmUgTG9naWMgZm9yIGZ1Y2tpdC5zaCAtLS0KCiMgLS0tIENvbG9yIERlZmluaXRpb25zIC0tLQojIE9ubHkgZGVmaW5lIGNvbG9ycyBpZiB0aGV5IGhhdmVuJ3QgYmVlbiBkZWZpbmVkIHlldCAoZm9yIHRlbXAgbW9kZSkKaWYgWyAteiAiJHtDX1JFU0VUOi19IiBdOyB0aGVuCiAgICByZWFkb25seSBDX1JFU0VUPSdcMDMzWzBtJwogICAgcmVhZG9ubHkgQ19SRURfQk9MRD0nXDAzM1sxOzMxbScKICAgIHJlYWRvbmx5IENfUkVEPSdcMDMzWzA7MzFtJwogICAgcmVhZG9ubHkgQ19HUkVFTj0nXDAzM1swOzMybScKICAgIHJlYWRvbmx5IENfWUVMTE9XPSdcMDMzWzA7MzNtJwogICAgcmVhZG9ubHkgQ19DWUFOPSdcMDMzWzA7MzZtJwogICAgcmVhZG9ubHkgQ19CT0xEPSdcMDMzWzFtJwoKICAgICMgLS0tIEZVQ0shIC0tLQogICAgcmVhZG9ubHkgRlVDSz0iJHtDX1JFRF9CT0xEfUZVQ0shJHtDX1JFU0VUfSIKICAgIHJlYWRvbmx5IEZDS049IiR7Q19SRUR9RipDS0lORyR7Q19SRVNFVH0iCgogICAgIyAtLS0gQ29uZmlndXJhdGlvbiAtLS0KICAgIGlmIFsgLXogIiR7SE9NRTotfSIgXTsgdGhlbgogICAgICAgICMgVGhpcyBwYXJ0IGlzIGZvciB0aGUgdGVtcG9yYXJ5IHJ1bm5lciwgd2hpY2ggZG9lc24ndCBpbnN0YWxsLAogICAgICAgICMgYnV0IHdlIG5lZWQgdGhlIHZhcmlhYmxlcyBkZWZpbmVkIHRvIGF2b2lkIHVuYm91bmQgZXJyb3JzLgogICAgICAgICMgVGhlIGluc3RhbGwgY2hlY2sgd2lsbCBoYXBwZW4gaW4gdGhlIGluc3RhbGxlciBwYXJ0IG9mIHRoZSBzY3JpcHQuCiAgICAgICAgcmVhZG9ubHkgSU5TVEFMTF9ESVI9Ii90bXAvLmZ1Y2siCiAgICAgICAgcmVhZG9ubHkgTUFJTl9TSD0iL3RtcC8uZnVjay9tYWluLnNoIgogICAgICAgIHJlYWRvbmx5IENPTkZJR19GSUxFPSIvdG1wLy5mdWNrL2NvbmZpZy5zaCIKICAgIGVsc2UKICAgICAgICByZWFkb25seSBJTlNUQUxMX0RJUj0iJEhPTUUvLmZ1Y2siCiAgICAgICAgcmVhZG9ubHkgTUFJTl9TSD0iJElOU1RBTExfRElSL21haW4uc2giCiAgICAgICAgcmVhZG9ubHkgQ09ORklHX0ZJTEU9IiRJTlNUQUxMX0RJUi9jb25maWcuc2giCiAgICBmaQpmaQoKIyBMb2FkIHVzZXIgY29uZmlndXJhdGlvbiBpZiBpdCBleGlzdHMKaWYgWyAtZiAiJENPTkZJR19GSUxFIiBdOyB0aGVuCiAgICBzb3VyY2UgIiRDT05GSUdfRklMRSIKZmkKCnJlYWRvbmx5IERFRkFVTFRfQVBJX0VORFBPSU5UPSJodHRwczovL2Z1Y2tpdC5zaC8iCgojIEhlbHBlciB0byBmaW5kIHRoZSB1c2VyJ3Mgc2hlbGwgcHJvZmlsZSBmaWxlCl9pbnN0YWxsZXJfZGV0ZWN0X3Byb2ZpbGUoKSB7CiAgICBpZiBbIC1uICIke1NIRUxMOi19IiBdICYmIGVjaG8gIiRTSEVMTCIgfCBncmVwIC1xICJ6c2giOyB0aGVuCiAgICAgICAgZWNobyAiJEhPTUUvLnpzaHJjIgogICAgZWxpZiBbIC1uICIke1NIRUxMOi19IiBdICYmIGVjaG8gIiRTSEVMTCIgfCBncmVwIC1xICJiYXNoIjsgdGhlbgogICAgICAgIGVjaG8gIiRIT01FLy5iYXNocmMiCiAgICBlbGlmIFsgLWYgIiRIT01FLy5wcm9maWxlIiBdOyB0aGVuCiAgICAgICAgIyBGYWxsYmFjayBmb3Igc2gsIGtzaCwgZXRjLgogICAgICAgIGVjaG8gIiRIT01FLy5wcm9maWxlIgogICAgZWxpZiBbIC1mICIkSE9NRS8uenNocmMiIF07IHRoZW4KICAgICAgICAjIEZhbGxiYWNrIGlmIFNIRUxMIHZhciBpc24ndCBzZXQKICAgICAgICBlY2hvICIkSE9NRS8uenNocmMiCiAgICBlbGlmIFsgLWYgIiRIT01FLy5iYXNocmMiIF07IHRoZW4KICAgICAgICAjIEZhbGxiYWNrIGlmIFNIRUxMIHZhciBpc24ndCBzZXQKICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxzZQogICAgICAgIGVjaG8gInVua25vd25fcHJvZmlsZSIKICAgIGZpCn0KCiMgRGV0ZWN0cyB0aGUgcGFja2FnZSBtYW5hZ2VyCl9mdWNrX2RldGVjdF9wa2dfbWFuYWdlcigpIHsKICAgIGlmIGNvbW1hbmQgLXYgYXB0LWdldCAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvICJhcHQiCiAgICBlbGlmIGNvbW1hbmQgLXYgeXVtICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gInl1bSIKICAgIGVsaWYgY29tbWFuZCAtdiBkbmYgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAiZG5mIgogICAgZWxpZiBjb21tYW5kIC12IHBhY21hbiAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvICJwYWNtYW4iCiAgICBlbGlmIGNvbW1hbmQgLXYgenlwcGVyICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gInp5cHBlciIKICAgIGVsaWYgY29tbWFuZCAtdiBicmV3ICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gImJyZXciCiAgICBlbHNlCiAgICAgICAgZWNobyAidW5rbm93biIKICAgIGZpCn0KCiMgQ29sbGVjdHMgc3lzdGVtIGluZm8gYXMgYSBzaW1wbGUgc3RyaW5nCl9mdWNrX2NvbGxlY3Rfc3lzaW5mb19zdHJpbmcoKSB7CiAgICBsb2NhbCBwa2dfbWFuYWdlcgogICAgcGtnX21hbmFnZXI9JChfZnVja19kZXRlY3RfcGtnX21hbmFnZXIpCiAgICAjIFRoZSBzZXJ2ZXItc2lkZSBMTE0gcHJvbXB0IHdpbGwgbmVlZCB0byBwYXJzZSB0aGlzIHN0cmluZwogICAgZWNobyAiT1M6ICQodW5hbWUgLXMpLCBBcmNoOiAkKHVuYW1lIC1tKSwgU2hlbGw6ICR7U0hFTEw6LXVua25vd259LCBQa2dNZ3I6ICRwa2dfbWFuYWdlciwgQ1dEOiAkKHB3ZCkiCn0KCiMgRXNjYXBlcyBhIHN0cmluZyBmb3IgdXNlIGluIGEgSlNPTiBwYXlsb2FkCl9mdWNrX2pzb25fZXNjYXBlKCkgewogICAgIyBCYXNpYyBlc2NhcGUgZm9yIHF1b3RlcywgYmFja3NsYXNoZXMsIGFuZCBjb250cm9sIGNoYXJhY3RlcnMKICAgIHByaW50ZiAnJXMnICIkMSIgfCBzZWQgLWUgJ3MvXFwvXFxcXC9nJyAtZSAncy8iL1xcIi9nJyAtZSAncy9cbi9cXG4vZycgLWUgJ3MvXHIvXFxyL2cnIC1lICdzL1x0L1xcdC9nJwp9CgojIFNpbXBsZSBoZWxwZXIgdG8gcGFyc2UgYm9vbGVhbi1saWtlIHZhbHVlcwpfZnVja190cnV0aHkoKSB7CiAgICBsb2NhbCB2YWx1ZT0iJHsxOi19IgogICAgbG9jYWwgbm9ybWFsaXplZAogICAgbm9ybWFsaXplZD0kKHByaW50ZiAnJXMnICIkdmFsdWUiIHwgdHIgJ1s6dXBwZXI6XScgJ1s6bG93ZXI6XScpCiAgICBjYXNlICIkbm9ybWFsaXplZCIgaW4KICAgICAgICAxfHRydWV8eWVzfHl8b24pCiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIDs7CiAgICAgICAgKikKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgOzsKICAgIGVzYWMKfQoKIyBEZWJ1ZyBoZWxwZXIKX2Z1Y2tfZGVidWcoKSB7CiAgICBpZiBfZnVja190cnV0aHkgIiR7RlVDS19ERUJVRzotMH0iOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJHtDX0NZQU59W2RlYnVnXSAkKiR7Q19SRVNFVH0iID4mMgogICAgZmkKfQoKIyBFbnN1cmUgYSBjb25maWcgZmlsZSBleGlzdHMgdG8gaGVscCB1c2VycyB0d2VhayB0aGUgYmVoYXZpb3VyCl9mdWNrX2Vuc3VyZV9jb25maWdfZXhpc3RzKCkgewogICAgaWYgWyAtZiAiJENPTkZJR19GSUxFIiBdOyB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBmaQoKICAgIG1rZGlyIC1wICIkKGRpcm5hbWUgIiRDT05GSUdfRklMRSIpIgogICAgY2F0IDw8J0NGRycgPiAiJENPTkZJR19GSUxFIgojIGZ1Y2tpdC5zaCBjb25maWd1cmF0aW9uCiMgVG9nZ2xlIHRoZSBleHBvcnRzIGJlbG93IHRvIGN1c3RvbWlzZSB5b3VyIGV4cGVyaWVuY2UuCgojIEN1c3RvbSBBUEkgZW5kcG9pbnQgdGhhdCBwb2ludHMgdG8geW91ciBzZWxmLWhvc3RlZCB3b3JrZXIKIyBleHBvcnQgRlVDS19BUElfRU5EUE9JTlQ9Imh0dHBzOi8veW91ci1kb21haW4ud29ya2Vycy5kZXYvIgoKIyBBZGQgYW4gZXh0cmEgYWxpYXMgYmVzaWRlcyB0aGUgZGVmYXVsdCAnZnVjaycKIyBleHBvcnQgRlVDS19BTElBUz0icGxzIgoKIyBTa2lwIGNvbmZpcm1hdGlvbiBwcm9tcHRzICh1c2Ugd2l0aCBjYXV0aW9uISkKIyBleHBvcnQgRlVDS19BVVRPX0VYRUM9ZmFsc2UKCiMgT3ZlcnJpZGUgY3VybCB0aW1lb3V0IChzZWNvbmRzKQojIGV4cG9ydCBGVUNLX1RJTUVPVVQ9MzAKCiMgRW5hYmxlIHZlcmJvc2UgZGVidWcgbG9ncwojIGV4cG9ydCBGVUNLX0RFQlVHPWZhbHNlCgojIERpc2FibGUgdGhlIGJ1aWx0LWluICdmdWNrJyBhbGlhcwojIGV4cG9ydCBGVUNLX0RJU0FCTEVfREVGQVVMVF9BTElBUz1mYWxzZQpDRkcKfQoKX2Z1Y2tfc2hvd19jb25maWdfaGVscCgpIHsKICAgIF9mdWNrX2Vuc3VyZV9jb25maWdfZXhpc3RzCiAgICBlY2hvIC1lICIke0NfWUVMTE9XfUNvbmZpZ3VyYXRpb24gZmlsZToke0NfUkVTRVR9ICR7Q19DWUFOfSRDT05GSUdfRklMRSR7Q19SRVNFVH0iCiAgICBpZiBbIC1uICIke0VESVRPUjotfSIgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9RWRpdCB3aXRoOiR7Q19SRVNFVH0gJHtDX0NZQU59JHtFRElUT1J9IFwiJENPTkZJR19GSUxFXCIke0NfUkVTRVR9IgogICAgZWxzZQogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9T3BlbiB0aGlzIGZpbGUgaW4geW91ciBmYXZvdXJpdGUgZWRpdG9yIHRvIGN1c3RvbWlzZSBmdWNraXQuc2guJHtDX1JFU0VUfSIKICAgIGZpCiAgICBlY2hvIC1lICIke0NfQ1lBTn1BdmFpbGFibGUgdG9nZ2xlczoke0NfUkVTRVR9IEZVQ0tfQVBJX0VORFBPSU5ULCBGVUNLX0FMSUFTLCBGVUNLX0FVVE9fRVhFQywgRlVDS19USU1FT1VULCBGVUNLX0RFQlVHIgp9CgojIFVuaW5zdGFsbHMgdGhlIHNjcmlwdApfdW5pbnN0YWxsX3NjcmlwdCgpIHsKICAgIGVjaG8gLWUgIiRGVUNLICR7Q19ZRUxMT1d9U28geW91J3JlIGtpY2tpbmcgbWUgb3V0PyBGaW5lLiR7Q19SRVNFVH0iCgogICAgIyBGaW5kIHRoZSBwcm9maWxlIGZpbGUKICAgIGxvY2FsIHByb2ZpbGVfZmlsZQogICAgcHJvZmlsZV9maWxlPSQoX2luc3RhbGxlcl9kZXRlY3RfcHJvZmlsZSkKICAgIGxvY2FsIHNvdXJjZV9saW5lPSJzb3VyY2UgJE1BSU5fU0giCgogICAgaWYgWyAiJHByb2ZpbGVfZmlsZSIgIT0gInVua25vd25fcHJvZmlsZSIgXSAmJiBbIC1mICIkcHJvZmlsZV9maWxlIiBdOyB0aGVuCiAgICAgICAgaWYgZ3JlcCAtcUYgIiRzb3VyY2VfbGluZSIgIiRwcm9maWxlX2ZpbGUiOyB0aGVuCiAgICAgICAgICAgICMgVXNlIHNlZCB0byByZW1vdmUgdGhlIGxpbmVzLiBDcmVhdGUgYSBiYWNrdXAuCiAgICAgICAgICAgIHNlZCAtaS5iYWsgIlx8JHNvdXJjZV9saW5lfGQiICIkcHJvZmlsZV9maWxlIgogICAgICAgICAgICBzZWQgLWkuYmFrICJcfCMgQWRkZWQgYnkgZnVja2l0LnNoIGluc3RhbGxlcnxkIiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICBmaQogICAgZWxzZQogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9Q291bGQgbm90IGZpbmQgYSBzaGVsbCBwcm9maWxlIGZpbGUgdG8gbW9kaWZ5LiBZb3VyIHByb2JsZW0gbm93LiR7Q19SRVNFVH0iCiAgICBmaQoKICAgIGlmIFsgLWQgIiRJTlNUQUxMX0RJUiIgXTsgdGhlbgogICAgICAgIHJtIC1yZiAiJElOU1RBTExfRElSIgogICAgZmkKCiAgICBlY2hvIC1lICIkRlVDSyAke0NfR1JFRU59SSdtIGdvbmUuIERvbid0IGNvbWUgY3J5aW5nIGJhY2suJHtDX1JFU0VUfSIKICAgIGVjaG8gLWUgIiR7Q19DWUFOfU5vdyByZXN0YXJ0IHlvdXIgZGFtbiBzaGVsbC4ke0NfUkVTRVR9Igp9CgojIFRoZSBtYWluIGZ1bmN0aW9uIHRoYXQgY29udGFjdHMgdGhlIEFQSQojIFRha2VzID4wIGFyZ3VtZW50cyBhcyB0aGUgcHJvbXB0Cl9mdWNrX2V4ZWN1dGVfcHJvbXB0KCkgewogICAgIyBJZiB0aGUgdXNlciB0eXBlcyAqb25seSogImZ1Y2sgdW5pbnN0YWxsIgogICAgaWYgWyAiJDEiID0gInVuaW5zdGFsbCIgXSAmJiBbICIkIyIgLWVxIDEgXTsgdGhlbgogICAgICAgIF91bmluc3RhbGxfc2NyaXB0CiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgIyBJZiB0aGUgdXNlciB0eXBlcyAiZnVjayBjb25maWciCiAgICBpZiBbICIkMSIgPSAiY29uZmlnIiBdICYmIFsgIiQjIiAtZXEgMSBdOyB0aGVuCiAgICAgICAgX2Z1Y2tfc2hvd19jb25maWdfaGVscAogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIGlmICEgY29tbWFuZCAtdiBjdXJsICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9J2Z1Y2snIGNvbW1hbmQgbmVlZHMgJ2N1cmwnLiBQbGVhc2UgaW5zdGFsbCBpdC4ke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBpZiBbICIkIyIgLWVxIDAgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9WW91IGZvcmdvdCB0byBhc2sgbWUgd2hhdCB0byBkby4ke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBsb2NhbCBwcm9tcHQ9IiQqIgogICAgbG9jYWwgYXV0b19tb2RlPSIke0ZVQ0tfQVVUT19FWEVDOi0wfSIKICAgIGxvY2FsIGN1cmxfdGltZW91dD0iJHtGVUNLX1RJTUVPVVQ6LTMwfSIKICAgIGxvY2FsIHN5c2luZm9fc3RyaW5nCiAgICBzeXNpbmZvX3N0cmluZz0kKF9mdWNrX2NvbGxlY3Rfc3lzaW5mb19zdHJpbmcpCiAgICAKICAgIGxvY2FsIGVzY2FwZWRfcHJvbXB0CiAgICBlc2NhcGVkX3Byb21wdD0kKF9mdWNrX2pzb25fZXNjYXBlICIkcHJvbXB0IikKICAgIAogICAgbG9jYWwgZXNjYXBlZF9zeXNpbmZvCiAgICBlc2NhcGVkX3N5c2luZm89JChfZnVja19qc29uX2VzY2FwZSAiJHN5c2luZm9fc3RyaW5nIikKCiAgICAjIENvbnN0cnVjdCB0aGUgSlNPTiBwYXlsb2FkCiAgICBsb2NhbCBwYXlsb2FkCiAgICBwYXlsb2FkPSQocHJpbnRmICd7ICJzeXNpbmZvIjogIiVzIiwgInByb21wdCI6ICIlcyIgfScgIiRlc2NhcGVkX3N5c2luZm8iICIkZXNjYXBlZF9wcm9tcHQiKQoKICAgICMgVXNlIGNvbmZpZ3VyZWQgQVBJIGVuZHBvaW50IG9yIGRlZmF1bHQKICAgIGxvY2FsIGFwaV91cmw9IiR7RlVDS19BUElfRU5EUE9JTlQ6LSRERUZBVUxUX0FQSV9FTkRQT0lOVH0iCgogICAgX2Z1Y2tfZGVidWcgIkFQSSBVUkw6ICRhcGlfdXJsIgogICAgX2Z1Y2tfZGVidWcgIlBheWxvYWQ6ICRwYXlsb2FkIgoKICAgIGxvY2FsIHJlc3BvbnNlCiAgICBpZiAhIHJlc3BvbnNlPSQoY3VybCAtc1MgLS1tYXgtdGltZSAiJGN1cmxfdGltZW91dCIgLVggUE9TVCAiJGFwaV91cmwiIFwKICAgICAgICAtSCAiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uIiBcCiAgICAgICAgLWQgIiRwYXlsb2FkIik7IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfUNvdWxkbid0IHJlYWNoIHRoZSBBSSBzZXJ2aWNlIGF0ICRhcGlfdXJsLiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgIGlmIFsgLXogIiRyZXNwb25zZSIgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9VGhlIEFJIGlzIGdob3N0aW5nIG1lLiBHb3Qgbm90aGluZyBiYWNrLiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgICMgLS0tIFVzZXIgQ29uZmlybWF0aW9uIChhcyByZXF1ZXN0ZWQpIC0tLQogICAgZWNobyAtZSAiJHtDX1lFTExPV30tLS0gVGhlIEFJIG11bWJsZWQgdGhpcywgaG9wZSBpdCdzIHJpZ2h0IC0tLSR7Q19SRVNFVH0iCiAgICBlY2hvIC1lICIke0NfQ1lBTn0kcmVzcG9uc2Uke0NfUkVTRVR9IgogICAgZWNobyAtZSAiJHtDX1lFTExPV30tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0ke0NfUkVTRVR9IgogICAgCiAgICAjIENoZWNrIGlmIGF1dG8tZXhlYyBtb2RlIGlzIGVuYWJsZWQKICAgIGxvY2FsIHNob3VsZF9leGVjPWZhbHNlCiAgICBpZiBfZnVja190cnV0aHkgIiRhdXRvX21vZGUiOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33imqEgQXV0by1leGVjIG1vZGUgZW5hYmxlZCwgZXhlY3V0aW5nIGltbWVkaWF0ZWx5Li4uJHtDX1JFU0VUfSIKICAgICAgICBzaG91bGRfZXhlYz10cnVlCiAgICBlbHNlCiAgICAgICAgIyBTZWNvbmRhcnkgY29uZmlybWF0aW9uIHByb21wdAogICAgICAgIHByaW50ZiAiJEZDS04gJHtDX0JPTER9JHtDX1lFTExPV31leGVjdXRlIGl0PyBbeS9OXSR7Q19SRVNFVH0gIgogICAgICAgIGxvY2FsIGNvbmZpcm1hdGlvbgogICAgICAgIGlmIFsgLXIgL2Rldi90dHkgXTsgdGhlbgogICAgICAgICAgICByZWFkIC1yIGNvbmZpcm1hdGlvbiA8IC9kZXYvdHR5CiAgICAgICAgZWxzZQogICAgICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfU5vIFRUWSBhdmFpbGFibGUgZm9yIGNvbmZpcm1hdGlvbi4gQWJvcnRpbmcuJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgZmkKCiAgICAgICAgaWYgW1sgIiRjb25maXJtYXRpb24iID1+IF5beVldKFtlRV1bc1NdKT8kIF1dOyB0aGVuCiAgICAgICAgICAgIHNob3VsZF9leGVjPXRydWUKICAgICAgICBmaQogICAgZmkKCiAgICBpZiBbICIkc2hvdWxkX2V4ZWMiID0gInRydWUiIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEX0JPTER9SVQsJHtDX0NZQU59IFdFIERPIElUIExJVkUhJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgIyBFeGVjdXRlIHRoZSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIgYW5kIGNoZWNrIGl0cyBleGl0IGNvZGUKICAgICAgICBpZiBldmFsICIkcmVzcG9uc2UiOyB0aGVuCiAgICAgICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19HUkVFTn1JdCdzIGRvbmUuIFByb2JhYmx5LiR7Q19SRVNFVH0iCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbCBleGl0X2NvZGU9JD8KICAgICAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1UaGF0IHNoaXQgZmFpbGVkIHdpdGggZXhpdCBjb2RlICRleGl0X2NvZGUuIE5vdCBteSBwcm9ibGVtLiR7Q19SRVNFVH0iID4mMgogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1GaW5lLCBkbyBpdCB5b3Vyc2VsZi4ke0NfUkVTRVR9IiA+JjIKICAgIGZpCn0KCiMgRGVmaW5lIHRoZSBhbGlhcyBmb3IgaW50ZXJhY3RpdmUgdXNlIChzdXBwb3J0cyBjdXN0b20gYWxpYXNlcykKX2Z1Y2tfZGVmaW5lX2FsaWFzZXMoKSB7CiAgICBsb2NhbCBkZWZhdWx0X2FsaWFzPSJmdWNrIgoKICAgIGlmICEgX2Z1Y2tfdHJ1dGh5ICIke0ZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTOi0wfSI7IHRoZW4KICAgICAgICBhbGlhcyAiJGRlZmF1bHRfYWxpYXMiPSdfZnVja19leGVjdXRlX3Byb21wdCcKICAgIGZpCgogICAgaWYgWyAtbiAiJHtGVUNLX0FMSUFTOi19IiBdICYmIFsgIiRGVUNLX0FMSUFTIiAhPSAiJGRlZmF1bHRfYWxpYXMiIF07IHRoZW4KICAgICAgICBhbGlhcyAiJEZVQ0tfQUxJQVMiPSdfZnVja19leGVjdXRlX3Byb21wdCcKICAgIGZpCn0KCl9mdWNrX2RlZmluZV9hbGlhc2VzCgojIC0tLSBFbmQgQ29yZSBMb2dpYyAtLS0KRU9GCikKIyAtLS0gRW5kIG9mIENvcmUgTG9naWMgSGVyZWRvYyAtLS0KCgojIC0tLSBJbnN0YWxsZXIgRnVuY3Rpb25zIChSdW4gYnkgdGhlIG91dGVyIHNjcmlwdCkgLS0tCgojIEhlbHBlciB0byBmaW5kIHRoZSB1c2VyJ3Mgc2hlbGwgcHJvZmlsZSBmaWxlCl9pbnN0YWxsZXJfZGV0ZWN0X3Byb2ZpbGUoKSB7CiAgICBpZiBbIC1uICIke1NIRUxMOi19IiBdICYmIGVjaG8gIiRTSEVMTCIgfCBncmVwIC1xICJ6c2giOyB0aGVuCiAgICAgICAgZWNobyAiJEhPTUUvLnpzaHJjIgogICAgZWxpZiBbIC1uICIke1NIRUxMOi19IiBdICYmIGVjaG8gIiRTSEVMTCIgfCBncmVwIC1xICJiYXNoIjsgdGhlbgogICAgICAgIGVjaG8gIiRIT01FLy5iYXNocmMiCiAgICBlbGlmIFsgLWYgIiRIT01FLy5wcm9maWxlIiBdOyB0aGVuCiAgICAgICAgIyBGYWxsYmFjayBmb3Igc2gsIGtzaCwgZXRjLgogICAgICAgIGVjaG8gIiRIT01FLy5wcm9maWxlIgogICAgZWxpZiBbIC1mICIkSE9NRS8uenNocmMiIF07IHRoZW4KICAgICAgICAjIEZhbGxiYWNrIGlmIFNIRUxMIHZhciBpc24ndCBzZXQKICAgICAgICBlY2hvICIkSE9NRS8uenNocmMiCiAgICBlbGlmIFsgLWYgIiRIT01FLy5iYXNocmMiIF07IHRoZW4KICAgICAgICAjIEZhbGxiYWNrIGlmIFNIRUxMIHZhciBpc24ndCBzZXQKICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxzZQogICAgICAgIGVjaG8gInVua25vd25fcHJvZmlsZSIKICAgIGZpCn0KCiMgTWFpbiBpbnN0YWxsYXRpb24gZnVuY3Rpb24KX2luc3RhbGxfc2NyaXB0KCkgewogICAgZWNobyAtZSAiJEZDS04gJHtDX0JPTER9QWxyaWdodCwgbGV0J3MgZ2V0IHRoaXMgc2hpdCBpbnN0YWxsZWQuLi4ke0NfUkVTRVR9IgogICAgbWtkaXIgLXAgIiRJTlNUQUxMX0RJUiIKICAgIAogICAgIyBXcml0ZSB0aGUgZW1iZWRkZWQgY29yZSBsb2dpYyB0byB0aGUgbWFpbi5zaCBmaWxlCiAgICBlY2hvICIkQ09SRV9MT0dJQyIgPiAiJE1BSU5fU0giCiAgICAKICAgIGlmIFsgJD8gLW5lIDAgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9Q2FuJ3Qgd3JpdGUgdG8gdGhlIGZpbGUuIENoZWNrIHlvdXIgZGFtbiBwZXJtaXNzaW9ucy4ke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICAjIENyZWF0ZSBhIGRlZmF1bHQgY29uZmlnIGZpbGUgaWYgaXQgZG9lc24ndCBleGlzdAogICAgaWYgWyAhIC1mICIkQ09ORklHX0ZJTEUiIF07IHRoZW4KICAgICAgICBjYXQgPDwnQ0ZHJyA+ICIkQ09ORklHX0ZJTEUiCiMgZnVja2l0LnNoIGNvbmZpZ3VyYXRpb24KIyBUb2dnbGUgdGhlIGV4cG9ydHMgYmVsb3cgdG8gY3VzdG9taXNlIHlvdXIgZXhwZXJpZW5jZS4KCiMgQ3VzdG9tIEFQSSBlbmRwb2ludCB0aGF0IHBvaW50cyB0byB5b3VyIHNlbGYtaG9zdGVkIHdvcmtlcgojIGV4cG9ydCBGVUNLX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly95b3VyLWRvbWFpbi53b3JrZXJzLmRldi8iCgojIFNraXAgY29uZmlybWF0aW9uIHByb21wdHMgKHVzZSB3aXRoIGNhdXRpb24hKQojIGV4cG9ydCBGVUNLX0FVVE9fRVhFQz0wCgojIE92ZXJyaWRlIGN1cmwgdGltZW91dCAoc2Vjb25kcykKIyBleHBvcnQgRlVDS19USU1FT1VUPTMwCgojIEVuYWJsZSB2ZXJib3NlIGRlYnVnIGxvZ3MKIyBleHBvcnQgRlVDS19ERUJVRz0wCkNGRwogICAgZmkKCiAgICAjIEFkZCBzb3VyY2UgbGluZSB0byBzaGVsbCBwcm9maWxlCiAgICBsb2NhbCBwcm9maWxlX2ZpbGUKICAgIHByb2ZpbGVfZmlsZT0kKF9pbnN0YWxsZXJfZGV0ZWN0X3Byb2ZpbGUpCiAgICAKICAgIGlmIFsgIiRwcm9maWxlX2ZpbGUiID0gInVua25vd25fcHJvZmlsZSIgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9SSBjYW4ndCBmaW5kIC5iYXNocmMsIC56c2hyYywgb3IgLnByb2ZpbGUuIFlvdSdyZSBvbiB5b3VyIG93bi4ke0NfUkVTRVR9IiA+JjIKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfU1hbnVhbGx5IGFkZCB0aGlzIGxpbmUgdG8gd2hhdGV2ZXIgc3RhcnR1cCBmaWxlIHlvdSB1c2U6JHtDX1JFU0VUfSIgPiYyCiAgICAgICAgZWNobyAtZSAiXG4gICR7Q19DWUFOfXNvdXJjZSAkTUFJTl9TSCR7Q19SRVNFVH1cbiIgPiYyCiAgICAgICAgcmV0dXJuCiAgICBmaQogICAgCiAgICBsb2NhbCBzb3VyY2VfbGluZT0ic291cmNlICRNQUlOX1NIIgogICAgaWYgISBncmVwIC1xRiAiJHNvdXJjZV9saW5lIiAiJHByb2ZpbGVfZmlsZSI7IHRoZW4KICAgICAgICAjIEVuc3VyZSB0aGUgZmlsZSBlbmRzIHdpdGggYSBuZXdsaW5lIGJlZm9yZSB3ZSBhZGQgb3VyIGxpbmVzCiAgICAgICAgaWYgWyAtbiAiJCh0YWlsIC1jMSAiJHByb2ZpbGVfZmlsZSIpIiBdOyB0aGVuCiAgICAgICAgICAgIGVjaG8gIiIgPj4gIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgZmkKICAgICAgICBlY2hvICIjIEFkZGVkIGJ5IGZ1Y2tpdC5zaCBpbnN0YWxsZXIiID4+ICIkcHJvZmlsZV9maWxlIgogICAgICAgIGVjaG8gIiRzb3VyY2VfbGluZSIgPj4gIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX0dSRUVOfUl0J3MgaW5zdGFsbGVkLiBOb3cgZ2V0IHRvIHdvcmsuJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfVJlc3RhcnQgeW91ciBzaGVsbCwgb3IgcnVuICR7Q19CT0xEfXNvdXJjZSAkcHJvZmlsZV9maWxlJHtDX1lFTExPV30gdG8gc3RhcnQuJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICJcbiR7Q19CT0xEfS0tLSBIT1cgVE8gVVNFIC0tLSR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiSnVzdCB0eXBlICR7Q19SRURfQk9MRH1mdWNrJHtDX1JFU0VUfSBmb2xsb3dlZCBieSB3aGF0IHlvdSB3YW50IHRvIGRvLiIKICAgICAgICBlY2hvIC1lICJFeGFtcGxlczoiCiAgICAgICAgZWNobyAtZSAiICAke0NfQ1lBTn1mdWNrIGluc3RhbGwgZ2l0JHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19DWUFOfWZ1Y2sgdW5pbnN0YWxsIGdpdCR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiICAke0NfQ1lBTn1mdWNrIGZpbmQgYWxsIGZpbGVzIGxhcmdlciB0aGFuIDEwTUIgaW4gdGhlIGN1cnJlbnQgZGlyZWN0b3J5JHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19SRURfQk9MRH1mdWNrIHVuaW5zdGFsbCR7Q19SRVNFVH0gJHtDX0dSRUVOfSMgVW5pbnN0YWxscyAke0NfUkVTRVR9JHtDX1JFRH1mdWNrJHtDX1JFU0VUfSR7Q19HUkVFTn0gaXRzZWxmJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19SRURfQk9MRH1mdWNrIGNvbmZpZyR7Q19SRVNFVH0gJHtDX0dSRUVOfSMgU2hvdyBjb25maWd1cmF0aW9uIGhlbHAke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIlxuJHtDX1lFTExPV31SZW1lbWJlciB0byByZXN0YXJ0IHlvdXIgc2hlbGwgdG8gYmVnaW4hJHtDX1JFU0VUfSIKICAgIGVsc2UKICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfWUVMTE9XfUl0J3MgYWxyZWFkeSBpbnN0YWxsZWQsIGdlbml1cy4gSnVzdCB1cGRhdGVkIHRoZSBzY3JpcHQgZm9yIHlvdS4ke0NfUkVTRVR9IgogICAgZmkKfQoKCiMgLS0tIE1haW4gU2NyaXB0IEVudHJ5cG9pbnQgLS0tCgojIElmIGFyZ3VtZW50cyBhcmUgcGFzc2VkIChlLmcuLCAiYmFzaCAtcyAuLi4iKQppZiBbICIkIyIgLWd0IDAgXTsgdGhlbgogICAgIyBUZW1wb3JhcnkgTW9kZQogICAgIyBFdmFsdWF0ZSB0aGUgY29yZSBsb2dpYyB0byBkZWZpbmUgZnVuY3Rpb25zIGluIHRoaXMgc2hlbGwKICAgIGV2YWwgIiRDT1JFX0xPR0lDIgogICAgIyBDYWxsIHRoZSBtYWluIGZ1bmN0aW9uIGRpcmVjdGx5IChhbGlhcyB3b24ndCB3b3JrIGhlcmUpCiAgICBfZnVja19leGVjdXRlX3Byb21wdCAiJEAiCmVsc2UKICAgICMgSW5zdGFsbCBNb2RlCiAgICBfaW5zdGFsbF9zY3JpcHQKZmkK`);
const INSTALLER_SCRIPT_ZH = b64_to_utf8(`IyEvYmluL2Jhc2gKIwojIOi/meaYryBmdWNraXQuc2gg55qE5a6J6KOF5ZKM5Li05pe26L+Q6KGM6ISa5pysCiMg5qyi6L+O5L2/55SoCiMKIyAtLS0g5a6J5YWo5L2/55So5pa55rOVIC0tLQojCiMgMS4g5LiL6L29OgojICAgIGN1cmwgLW8gZnVja2l0LnNoIGh0dHBzOi8vZnVja2l0LnNoCiMKIyAyLiDmn6XnnIvku6PnoIE6CiMgICAgbGVzcyBmdWNraXQuc2gKIwojIDMuIOi/kOihjCAo5a6J6KOFKToKIyAgICBiYXNoIGZ1Y2tpdC5zaAojCiMgNC4g6L+Q6KGMICjkuLTml7bkvb/nlKgpOgojICAgIGJhc2ggZnVja2l0LnNoICLkvaDnmoTlkb3ku6QiCiMKCnNldCAtZXVvIHBpcGVmYWlsCgojIC0tLSDpopzoibLlrprkuYkgLS0tCnJlYWRvbmx5IENfUkVTRVQ9J1wwMzNbMG0nCnJlYWRvbmx5IENfUkVEX0JPTEQ9J1wwMzNbMTszMW0nCnJlYWRvbmx5IENfUkVEPSdcMDMzWzA7MzFtJwpyZWFkb25seSBDX0dSRUVOPSdcMDMzWzA7MzJtJwpyZWFkb25seSBDX1lFTExPVz0nXDAzM1swOzMzbScKcmVhZG9ubHkgQ19DWUFOPSdcMDMzWzA7MzZtJwpyZWFkb25seSBDX0JPTEQ9J1wwMzNbMW0nCgojIC0tLSDmj5DnpLrnrKYgLS0tCnJlYWRvbmx5IEZVQ0s9IiR7Q19SRURfQk9MRH1bIV0ke0NfUkVTRVR9IgpyZWFkb25seSBGQ0tOPSIke0NfUkVEfVvmj5DnpLpdJHtDX1JFU0VUfSIKCgojIC0tLSDphY3nva4gLS0tCmlmIFsgLXogIiR7SE9NRTotfSIgXTsgdGhlbgogICAgZWNobyAtZSAiXDAzM1sxOzMxbemUmeivryFcMDMzWzBtIFwwMzNbMDszMW3mgqjnmoQgSE9NRSDnjq/looPlj5jph4/mnKrorr7nva7vvIzml6Dms5Xnoa7lrprlronoo4XkvY3nva7vvIzor7flhYjorr7nva7or6Xlj5jph4/jgIIgKOS+i+WmgjogZXhwb3J0IEhPTUU9L3Jvb3QpXDAzM1swbSIgPiYyCiAgICBleGl0IDEKZmkKcmVhZG9ubHkgSU5TVEFMTF9ESVI9IiRIT01FLy5mdWNrIgpyZWFkb25seSBNQUlOX1NIPSIkSU5TVEFMTF9ESVIvbWFpbi5zaCIKcmVhZG9ubHkgQ09ORklHX0ZJTEU9IiRJTlNUQUxMX0RJUi9jb25maWcuc2giCnJlYWRvbmx5IERFRkFVTFRfQVBJX0VORFBPSU5UPSJodHRwczovL3poLmZ1Y2tpdC5zaC8iCgoKIyAtLS0g5qC45b+D6YC76L6RICjloZ7ov5vkuIDkuKrlrZfnrKbkuLLph4wpIC0tLQpDT1JFX0xPR0lDPSQoY2F0IDw8J0VPRicKCiMgLS0tIGZ1Y2tpdC5zaCDmoLjlv4PpgLvovpHlvIDlp4sgLS0tCgojIC0tLSDpopzoibLlrprkuYkgLS0tCiMg5Y+q5pyJ5Zyo5rKh5a6a5LmJ6L+H6aKc6Imy55qE5oOF5Ya15LiL5omN5a6a5LmJICjkuLTml7bmqKHlvI/nlKgpCmlmIFsgLXogIiR7Q19SRVNFVDotfSIgXTsgdGhlbgogICAgcmVhZG9ubHkgQ19SRVNFVD0nXDAzM1swbScKICAgIHJlYWRvbmx5IENfUkVEX0JPTEQ9J1wwMzNbMTszMW0nCiAgICByZWFkb25seSBDX1JFRD0nXDAzM1swOzMxbScKICAgIHJlYWRvbmx5IENfR1JFRU49J1wwMzNbMDszMm0nCiAgICByZWFkb25seSBDX1lFTExPVz0nXDAzM1swOzMzbScKICAgIHJlYWRvbmx5IENfQ1lBTj0nXDAzM1swOzM2bScKICAgIHJlYWRvbmx5IENfQk9MRD0nXDAzM1sxbScKCiAgICAjIC0tLSDmj5DnpLrnrKYgLS0tCiAgICByZWFkb25seSBGVUNLPSIke0NfUkVEX0JPTER9WyFdJHtDX1JFU0VUfSIKICAgIHJlYWRvbmx5IEZDS049IiR7Q19SRUR9W+aPkOekul0ke0NfUkVTRVR9IgoKICAgICMgLS0tIOmFjee9riAtLS0KICAgIGlmIFsgLXogIiR7SE9NRTotfSIgXTsgdGhlbgogICAgICAgICMg6L+Z6YOo5YiG5piv57uZ5Li05pe26L+Q6KGM5qih5byP55So55qE77yM5a6D5LiN5a6J6KOF5Lu75L2V5Lic6KW/CiAgICAgICAgIyDkvYbmiJHku6zov5jmmK/pnIDopoHlrprkuYnov5nkupvlj5jph4/vvIzlhY3lvpfohJrmnKzmiqXplJkKICAgICAgICAjIOWuieijheeoi+W6j+mDqOWIhuS8mui/m+ihjOecn+ato+eahOajgOafpQogICAgICAgIHJlYWRvbmx5IElOU1RBTExfRElSPSIvdG1wLy5mdWNrIgogICAgICAgIHJlYWRvbmx5IE1BSU5fU0g9Ii90bXAvLmZ1Y2svbWFpbi5zaCIKICAgICAgICByZWFkb25seSBDT05GSUdfRklMRT0iL3RtcC8uZnVjay9jb25maWcuc2giCiAgICBlbHNlCiAgICAgICAgcmVhZG9ubHkgSU5TVEFMTF9ESVI9IiRIT01FLy5mdWNrIgogICAgICAgIHJlYWRvbmx5IE1BSU5fU0g9IiRJTlNUQUxMX0RJUi9tYWluLnNoIgogICAgICAgIHJlYWRvbmx5IENPTkZJR19GSUxFPSIkSU5TVEFMTF9ESVIvY29uZmlnLnNoIgogICAgZmkKZmkKCiMg5aaC5p6c5a2Y5Zyo6YWN572u5paH5Lu25YiZ5Yqg6L29CmlmIFsgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgc291cmNlICIkQ09ORklHX0ZJTEUiCmZpCgpyZWFkb25seSBERUZBVUxUX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly96aC5mdWNraXQuc2gvIgoKIyDmib7nlKjmiLcgc2hlbGwg6YWN572u5paH5Lu255qE6L6F5Yqp5Ye95pWwCl9pbnN0YWxsZXJfZGV0ZWN0X3Byb2ZpbGUoKSB7CiAgICBpZiBbIC1uICIke1NIRUxMOi19IiBdICYmIGVjaG8gIiRTSEVMTCIgfCBncmVwIC1xICJ6c2giOyB0aGVuCiAgICAgICAgZWNobyAiJEhPTUUvLnpzaHJjIgogICAgZWxpZiBbIC1uICIke1NIRUxMOi19IiBdICYmIGVjaG8gIiRTSEVMTCIgfCBncmVwIC1xICJiYXNoIjsgdGhlbgogICAgICAgIGVjaG8gIiRIT01FLy5iYXNocmMiCiAgICBlbGlmIFsgLWYgIiRIT01FLy5wcm9maWxlIiBdOyB0aGVuCiAgICAgICAgIyDlhbzlrrkgc2gsIGtzaCDnrYkKICAgICAgICBlY2hvICIkSE9NRS8ucHJvZmlsZSIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLnpzaHJjIiBdOyB0aGVuCiAgICAgICAgIyBTSEVMTCDlj5jph4/msqHorr7nva7ml7bnmoTlpIfnlKjmlrnmoYgKICAgICAgICBlY2hvICIkSE9NRS8uenNocmMiCiAgICBlbGlmIFsgLWYgIiRIT01FLy5iYXNocmMiIF07IHRoZW4KICAgICAgICAjIFNIRUxMIOWPmOmHj+ayoeiuvue9ruaXtueahOWkh+eUqOaWueahiAogICAgICAgIGVjaG8gIiRIT01FLy5iYXNocmMiCiAgICBlbHNlCiAgICAgICAgZWNobyAidW5rbm93bl9wcm9maWxlIgogICAgZmkKfQoKIyDmo4DmtYvljIXnrqHnkIblmagKX2Z1Y2tfZGV0ZWN0X3BrZ19tYW5hZ2VyKCkgewogICAgaWYgY29tbWFuZCAtdiBhcHQtZ2V0ICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gImFwdCIKICAgIGVsaWYgY29tbWFuZCAtdiB5dW0gJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAieXVtIgogICAgZWxpZiBjb21tYW5kIC12IGRuZiAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvICJkbmYiCiAgICBlbGlmIGNvbW1hbmQgLXYgcGFjbWFuICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gInBhY21hbiIKICAgIGVsaWYgY29tbWFuZCAtdiB6eXBwZXIgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAienlwcGVyIgogICAgZWxpZiBjb21tYW5kIC12IGJyZXcgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAiYnJldyIKICAgIGVsc2UKICAgICAgICBlY2hvICJ1bmtub3duIgogICAgZmkKfQoKIyDmiorns7vnu5/kv6Hmga/mlbTmiJDkuIDkuKrlrZfnrKbkuLIKX2Z1Y2tfY29sbGVjdF9zeXNpbmZvX3N0cmluZygpIHsKICAgIGxvY2FsIHBrZ19tYW5hZ2VyCiAgICBwa2dfbWFuYWdlcj0kKF9mdWNrX2RldGVjdF9wa2dfbWFuYWdlcikKICAgICMg5pyN5Yqh56uv55qEIExMTSDlvpfog73nnIvmh4Lov5nkuKrlrZfnrKbkuLIKICAgIGVjaG8gIk9TOiAkKHVuYW1lIC1zKSwgQXJjaDogJCh1bmFtZSAtbSksIFNoZWxsOiAke1NIRUxMOi11bmtub3dufSwgUGtnTWdyOiAkcGtnX21hbmFnZXIsIENXRDogJChwd2QpIgp9CgojIEpTT04g6L2s5LmJ77yM5YWN5b6X5Ye66Zeu6aKYCl9mdWNrX2pzb25fZXNjYXBlKCkgewogICAgIyDlsLHovazkuYnpgqPlh6DkuKrnibnmrorlrZfnrKYKICAgIHByaW50ZiAnJXMnICIkMSIgfCBzZWQgLWUgJ3MvXFwvXFxcXC9nJyAtZSAncy8iL1xcIi9nJyAtZSAncy9cbi9cXG4vZycgLWUgJ3MvXHIvXFxyL2cnIC1lICdzL1x0L1xcdC9nJwp9CgojIOWIpOaWreaYr+WQpuS4uiB0cnVlL3llcy9vbiDnrYkKX2Z1Y2tfdHJ1dGh5KCkgewogICAgbG9jYWwgdmFsdWU9IiR7MTotfSIKICAgIGxvY2FsIG5vcm1hbGl6ZWQKICAgIG5vcm1hbGl6ZWQ9JChwcmludGYgJyVzJyAiJHZhbHVlIiB8IHRyICdbOnVwcGVyOl0nICdbOmxvd2VyOl0nKQogICAgY2FzZSAiJG5vcm1hbGl6ZWQiIGluCiAgICAgICAgMXx0cnVlfHllc3x5fG9ufOaYr3zlvIB855yfKQogICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICA7OwogICAgICAgICopCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIDs7CiAgICBlc2FjCn0KCiMg6LCD6K+V5pel5b+XCl9mdWNrX2RlYnVnKCkgewogICAgaWYgX2Z1Y2tfdHJ1dGh5ICIke0ZVQ0tfREVCVUc6LTB9IjsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19DWUFOfVvosIPor5VdICQqJHtDX1JFU0VUfSIgPiYyCiAgICBmaQp9CgojIOehruS/nemFjee9ruaWh+S7tuWtmOWcqApfZnVja19lbnN1cmVfY29uZmlnX2V4aXN0cygpIHsKICAgIGlmIFsgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgICAgIHJldHVybgogICAgZmkKCiAgICBta2RpciAtcCAiJChkaXJuYW1lICIkQ09ORklHX0ZJTEUiKSIKICAgIGNhdCA8PCdDRkcnID4gIiRDT05GSUdfRklMRSIKIyBmdWNraXQuc2gg6YWN572u5paH5Lu256S65L6LCiMg5Y675o6J6KGM6aaW55qEICMg5bm25L+u5pS55Li65L2g5oOz6KaB55qE5YC85Y2z5Y+v44CCCgojIOiHquWumuS5iSBBUEkg5YWl5Y+j77yI5aaC6Ieq5bu6IFdvcmtlcu+8iQojIGV4cG9ydCBGVUNLX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly95b3VyLWRvbWFpbi53b3JrZXJzLmRldi8iCgojIOmineWkluWIq+WQje+8iOm7mOiupOaPkOS+myBmdWNr77yJCiMgZXhwb3J0IEZVQ0tfQUxJQVM9Iui/kOihjCIKCiMg6Ieq5Yqo5omn6KGM6L+U5Zue55qE5ZG95Luk77yM6Lez6L+H56Gu6K6k77yI6LCo5oWO5byA5ZCv77yJCiMgZXhwb3J0IEZVQ0tfQVVUT19FWEVDPWZhbHNlCgojIOivt+axgui2heaXtuaXtumXtO+8iOenku+8iQojIGV4cG9ydCBGVUNLX1RJTUVPVVQ9MzAKCiMg5piv5ZCm5omT5Y2w6LCD6K+V5L+h5oGvCiMgZXhwb3J0IEZVQ0tfREVCVUc9ZmFsc2UKCiMg5LiN5YaN6Ieq5Yqo5rOo5YWl6buY6K6k5Yir5ZCNCiMgZXhwb3J0IEZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTPWZhbHNlCkNGRwp9CgojIOaYvuekuumFjee9ruaPkOekugpfZnVja19zaG93X2NvbmZpZ19oZWxwKCkgewogICAgX2Z1Y2tfZW5zdXJlX2NvbmZpZ19leGlzdHMKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d96YWN572u5paH5Lu277yaJHtDX1JFU0VUfSAke0NfQ1lBTn0kQ09ORklHX0ZJTEUke0NfUkVTRVR9IgogICAgaWYgWyAtbiAiJHtFRElUT1I6LX0iIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfeWPr+S7peS9v+eUqO+8miR7Q19SRVNFVH0gJHtDX0NZQU59JHtFRElUT1J9ICRDT05GSUdfRklMRSR7Q19SRVNFVH0iCiAgICBlbHNlCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33nlKjku7vmhI/nvJbovpHlmajmiZPlvIDor6Xmlofku7bljbPlj6/kv67mlLnphY3nva7jgIIke0NfUkVTRVR9IgogICAgZmkKICAgIGVjaG8gLWUgIiR7Q19DWUFOfeWPr+eUqOmAiemhue+8miR7Q19SRVNFVH1GVUNLX0FQSV9FTkRQT0lOVCwgRlVDS19BTElBUywgRlVDS19BVVRPX0VYRUMsIEZVQ0tfVElNRU9VVCwgRlVDS19ERUJVRyIKfQoKIyDljbjovb3ohJrmnKwKX3VuaW5zdGFsbF9zY3JpcHQoKSB7CiAgICBlY2hvIC1lICIke0NfUkVEX0JPTER95aW95aW95aW977yBJHtDX1JFU0VUfSR7Q19ZRUxMT1d95oCO5LmI552A77yM6KaB5Y2456Oo5p2A6am05ZWK77yf6KGM5ZWK5L2g5Liq6ICB5YWt77yM5oiR55yf6LCi6LCi5L2g5LqG44CCJHtDX1JFU0VUfSIKCiAgICAjIOaJvumFjee9ruaWh+S7tgogICAgbG9jYWwgcHJvZmlsZV9maWxlCiAgICBwcm9maWxlX2ZpbGU9JChfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKQogICAgbG9jYWwgc291cmNlX2xpbmU9InNvdXJjZSAkTUFJTl9TSCIKCiAgICBpZiBbICIkcHJvZmlsZV9maWxlIiAhPSAidW5rbm93bl9wcm9maWxlIiBdICYmIFsgLWYgIiRwcm9maWxlX2ZpbGUiIF07IHRoZW4KICAgICAgICBpZiBncmVwIC1xRiAiJHNvdXJjZV9saW5lIiAiJHByb2ZpbGVfZmlsZSI7IHRoZW4KICAgICAgICAgICAgIyDnlKggc2VkIOaKiumCo+WHoOihjOWIoOS6hu+8jOmhuuS+v+Wkh+S4quS7vQogICAgICAgICAgICBzZWQgLWkuYmFrICJcfCRzb3VyY2VfbGluZXxkIiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICAgICAgc2VkIC1pLmJhayAiXHwjIEFkZGVkIGJ5IGZ1Y2tpdC5zaCBpbnN0YWxsZXJ8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfeaJvuS4jeWIsCBzaGVsbCDphY3nva7mlofku7bvvIzmgqjlj6/ku6XmiYvliqjliKDpmaTnm7jlhbPphY3nva7jgIIke0NfUkVTRVR9IgogICAgZmkKCiAgICBpZiBbIC1kICIkSU5TVEFMTF9ESVIiIF07IHRoZW4KICAgICAgICBybSAtcmYgIiRJTlNUQUxMX0RJUiIKICAgIGZpCgogICAgc2xlZXAgMwogICAgZWNobyAtZSAiJHtDX0dSRUVOfeihjO+8jOaIkeWFiOi1sOS4gOatpe+8jOWRiui+nuOAgiR7Q19DWUFOfei1tue0p+mHjeWQr+S9oOmCo+e7iOerr+WQp++8jOS4jeeEtuS8muWIq+WQjeaxoeafk+OAgiR7Q19SRVNFVH0iCiAgICBzbGVlcCAzCiAgICBlY2hvIC1lICIke0NfWUVMTE9XfeS4tOWIq+S5i+mZhe+8jOeMruS4iuS4gOmmluWwj+ivl++8jOelneaCqOWJjeeoi+S8vOmUpu+8miR7Q19SRVNFVH0iCiAgICBzbGVlcCAyCiAgICBlY2hvIC1lICJcbiR7Q19SRUR944CK6K+X57uPwrflvbzpmLPjgIske0NfUkVTRVR9IgogICAgc2xlZXAgMgogICAgZWNobyAtZSAiJHtDX1lFTExPV33lvbzpmLPoi6Xoh7PvvIzliJ3ljYfkuJzmm6bjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgMgogICAgZWNobyAtZSAiJHtDX1lFTExPV33nu6/pm77po5LolL3vvIzkvLzluZXnu6Hnu7jjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgMwogICAgZWNobyAtZSAiJHtDX1lFTExPV33lvbzpmLPnr53noqfvvIzpm77pnILmtqfmu4HjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgNAogICAgZWNobyAtZSAiJHtDX1lFTExPV33otaTnn7PlhqzmuqrvvIzkvLznjpvnkZnmva3jgIIke0NfUkVTRVR9IgogICAgc2xlZXAgNAogICAgZWNobyAtZSAiJHtDX1lFTExPV33lvbzpmLPmmZrmhI/vvIzmmpbmoqbkvLzkuZDjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgMwogICAgZWNobyAtZSAiJHtDX1lFTExPV33lr5DmuLjmta7mspDvvIzoi6Xpm4npo57oiJ7jgIIke0NfUkVTRVR9Igp9CgojIOi3nyBBUEkg6YCa5L+h55qE5Li75Ye95pWwCiMg5Y+C5pWw5bCx5piv6KaB5omn6KGM55qE5ZG95LukCl9mdWNrX2V4ZWN1dGVfcHJvbXB0KCkgewogICAgIyDlpoLmnpznlKjmiLflj6rovpPlhaUgImZ1Y2sgdW5pbnN0YWxsIgogICAgaWYgWyAiJDEiID0gInVuaW5zdGFsbCIgXSAmJiBbICIkIyIgLWVxIDEgXTsgdGhlbgogICAgICAgIF91bmluc3RhbGxfc2NyaXB0CiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgIyDlpoLmnpznlKjmiLfovpPlhaUgImZ1Y2sgY29uZmlnIgogICAgaWYgWyAiJDEiID0gImNvbmZpZyIgXSAmJiBbICIkIyIgLWVxIDEgXTsgdGhlbgogICAgICAgIF9mdWNrX3Nob3dfY29uZmlnX2hlbHAKICAgICAgICByZXR1cm4gMAogICAgZmkKCiAgICBpZiAhIGNvbW1hbmQgLXYgY3VybCAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfSdmdWNrJyDlkb3ku6TpnIDopoEgJ2N1cmwn77yM6K+35YWI5a6J6KOFIGN1cmzjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBpZiBbICIkIyIgLWVxIDAgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR96K+35o+Q5L6b6KaB5omn6KGM55qE5ZG95Luk44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgbG9jYWwgcHJvbXB0PSIkKiIKICAgIGxvY2FsIGF1dG9fbW9kZT0iJHtGVUNLX0FVVE9fRVhFQzotMH0iCiAgICBsb2NhbCBjdXJsX3RpbWVvdXQ9IiR7RlVDS19USU1FT1VUOi0zMH0iCiAgICBsb2NhbCBzeXNpbmZvX3N0cmluZwogICAgc3lzaW5mb19zdHJpbmc9JChfZnVja19jb2xsZWN0X3N5c2luZm9fc3RyaW5nKQogICAgCiAgICBsb2NhbCBlc2NhcGVkX3Byb21wdAogICAgZXNjYXBlZF9wcm9tcHQ9JChfZnVja19qc29uX2VzY2FwZSAiJHByb21wdCIpCiAgICAKICAgIGxvY2FsIGVzY2FwZWRfc3lzaW5mbwogICAgZXNjYXBlZF9zeXNpbmZvPSQoX2Z1Y2tfanNvbl9lc2NhcGUgIiRzeXNpbmZvX3N0cmluZyIpCgogICAgIyDmnoTlu7ogSlNPTgogICAgbG9jYWwgcGF5bG9hZAogICAgcGF5bG9hZD0kKHByaW50ZiAneyAic3lzaW5mbyI6ICIlcyIsICJwcm9tcHQiOiAiJXMiIH0nICIkZXNjYXBlZF9zeXNpbmZvIiAiJGVzY2FwZWRfcHJvbXB0IikKCiAgICAjIOS9v+eUqOmFjee9rueahCBBUEkg5Zyw5Z2A5oiW6buY6K6k5Zyw5Z2ACiAgICBsb2NhbCBhcGlfdXJsPSIke0ZVQ0tfQVBJX0VORFBPSU5UOi0kREVGQVVMVF9BUElfRU5EUE9JTlR9IgoKICAgIF9mdWNrX2RlYnVnICJBUEkg5Zyw5Z2AOiAkYXBpX3VybCIKICAgIF9mdWNrX2RlYnVnICLor7fmsYLkvZM6ICRwYXlsb2FkIgoKICAgIGxvY2FsIHJlc3BvbnNlCiAgICBpZiAhIHJlc3BvbnNlPSQoY3VybCAtc1MgLS1tYXgtdGltZSAiJGN1cmxfdGltZW91dCIgLVggUE9TVCAiJGFwaV91cmwiIFwKICAgICAgICAtSCAiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uIiBcCiAgICAgICAgLWQgIiRwYXlsb2FkIik7IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeaXoOazlei/nuaOpeWIsCBBSSDmnI3liqE6ICRhcGlfdXJsJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgaWYgWyAteiAiJHJlc3BvbnNlIiBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1BSSDmsqHmnInlk43lupTvvIzor7fph43or5XjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICAjIC0tLSDnlKjmiLfnoa7orqQgLS0tCiAgICBlY2hvIC1lICIke0NfWUVMTE9XfS0tLS0tLSBBSSDnlJ/miJDkuobku6XkuIvlkb3ku6TvvIzor7fmgqjmn6XnnIsgLS0tLS0tJHtDX1JFU0VUfSIKICAgIGVjaG8gLWUgIiR7Q19DWUFOfSRyZXNwb25zZSR7Q19SRVNFVH0iCiAgICBlY2hvIC1lICIke0NfWUVMTE9XfS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSR7Q19SRVNFVH0iCgogICAgbG9jYWwgc2hvdWxkX2V4ZWM9ZmFsc2UKICAgIGlmIF9mdWNrX3RydXRoeSAiJGF1dG9fbW9kZSI7IHRoZW4KICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfeKaoSDlt7LlvIDlkK/oh6rliqjmiafooYzmqKHlvI/vvIznq4vljbPov5DooYwuLi4ke0NfUkVTRVR9IgogICAgICAgIHNob3VsZF9leGVjPXRydWUKICAgIGVsc2UKICAgICAgICBwcmludGYgIiR7Q19CT0xEfSR7Q19ZRUxMT1d95p+l55yL5a6M5q+V77yM5piv5ZCm5omn6KGM77yfW3kvTl0ke0NfUkVTRVR9ICIKICAgICAgICBsb2NhbCBjb25maXJtYXRpb24KICAgICAgICBpZiBbIC1yIC9kZXYvdHR5IF07IHRoZW4KICAgICAgICAgICAgcmVhZCAtciBjb25maXJtYXRpb24gPCAvZGV2L3R0eQogICAgICAgIGVsc2UKICAgICAgICAgICAgZWNobyAtZSAiJHtDX1JFRH3msqHmnInmib7liLDlj6/or7vnmoTnu4jnq6/ovpPlhaXvvIzmk43kvZzlt7Llj5bmtojjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICBmaQoKICAgICAgICBpZiBbWyAiJGNvbmZpcm1hdGlvbiIgPX4gXlt5WV0oW2VFXVtzU10pPyQgXV07IHRoZW4KICAgICAgICAgICAgc2hvdWxkX2V4ZWM9dHJ1ZQogICAgICAgIGZpCiAgICBmaQoKICAgIGlmIFsgIiRzaG91bGRfZXhlYyIgPSAidHJ1ZSIgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19DWUFOfSDov5jnrYnllaXlkaLvvIzotbDotbfvvIEke0NfUkVTRVR9IiA+JjIKICAgICAgICAjIOaJp+ihjOacjeWKoeWZqOi/lOWbnueahOWRveS7pOW5tuajgOafpemAgOWHuueggQogICAgICAgIGlmIGV2YWwgIiRyZXNwb25zZSI7IHRoZW4KICAgICAgICAgICAgZWNobyAtZSAiJHtDX0dSRUVOfeWujOS6i+S6hu+8jOW6lOivpeayoeWVpemXrumimOOAgiR7Q19SRVNFVH0iCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbCBleGl0X2NvZGU9JD8KICAgICAgICAgICAgZWNobyAtZSAiJHtDX1JFRF9CT0xEfemUmeivr++8gSR7Q19SRUR96L+Z5ZG95Luk5omn6KGM5aSx6LSl5LqG77yM6YCA5Ye656CB5pivICRleGl0X2NvZGXjgILor7fmo4Dmn6Xlkb3ku6TmmK/lkKbmraPnoa7jgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICBmaQogICAgZWxzZQogICAgICAgIGVjaG8gLWUgIiR7Q19SRUR95aW955qE77yM5bey5pKk6ZSAJHtDX1JFU0VUfSIgPiYyCiAgICBmaQp9CgojIOWumuS5ieWIq+WQje+8iOaUr+aMgeiHquWumuS5ieWIq+WQje+8iQpfZnVja19kZWZpbmVfYWxpYXNlcygpIHsKICAgIGxvY2FsIGRlZmF1bHRfYWxpYXM9ImZ1Y2siCgogICAgaWYgISBfZnVja190cnV0aHkgIiR7RlVDS19ESVNBQkxFX0RFRkFVTFRfQUxJQVM6LTB9IjsgdGhlbgogICAgICAgIGFsaWFzICIkZGVmYXVsdF9hbGlhcyI9J19mdWNrX2V4ZWN1dGVfcHJvbXB0JwogICAgZmkKCiAgICBpZiBbIC1uICIke0ZVQ0tfQUxJQVM6LX0iIF0gJiYgWyAiJEZVQ0tfQUxJQVMiICE9ICIkZGVmYXVsdF9hbGlhcyIgXTsgdGhlbgogICAgICAgIGFsaWFzICIkRlVDS19BTElBUyI9J19mdWNrX2V4ZWN1dGVfcHJvbXB0JwogICAgZmkKfQoKX2Z1Y2tfZGVmaW5lX2FsaWFzZXMKCiMgLS0tIOaguOW/g+mAu+i+kee7k+adnyAtLS0KRU9GCikKIyAtLS0g5qC45b+D6YC76L6RIEhlcmVkb2Mg57uT5p2fIC0tLQoKCiMgLS0tIOWuieijheWHveaVsCAo55Sx5aSW6YOo6ISa5pys6L+Q6KGMKSAtLS0KCiMg5om+55So5oi3IHNoZWxsIOmFjee9ruaWh+S7tueahOi+heWKqeWHveaVsApfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKCkgewogICAgaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAienNoIjsgdGhlbgogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAiYmFzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8ucHJvZmlsZSIgXTsgdGhlbgogICAgICAgICMg5YW85a65IHNoLCBrc2gg562JCiAgICAgICAgZWNobyAiJEhPTUUvLnByb2ZpbGUiCiAgICBlbGlmIFsgLWYgIiRIT01FLy56c2hyYyIgXTsgdGhlbgogICAgICAgICMgU0hFTEwg5Y+Y6YeP5rKh6K6+572u5pe255qE5aSH55So5pa55qGICiAgICAgICAgZWNobyAiJEhPTUUvLnpzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8uYmFzaHJjIiBdOyB0aGVuCiAgICAgICAgIyBTSEVMTCDlj5jph4/msqHorr7nva7ml7bnmoTlpIfnlKjmlrnmoYgKICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxzZQogICAgICAgIGVjaG8gInVua25vd25fcHJvZmlsZSIKICAgIGZpCn0KCiMg5Li75a6J6KOF5Ye95pWwCl9pbnN0YWxsX3NjcmlwdCgpIHsKICAgIGVjaG8gLWUgIiR7Q19CT0xEfeW8gOWni+WuieijhSBmdWNraXQuc2guLi4ke0NfUkVTRVR9IgogICAgbWtkaXIgLXAgIiRJTlNUQUxMX0RJUiIKICAgIAogICAgIyDmiormoLjlv4PpgLvovpHlhpnov5sgbWFpbi5zaAogICAgZWNobyAiJENPUkVfTE9HSUMiID4gIiRNQUlOX1NIIgogICAgCiAgICBpZiBbICQ/IC1uZSAwIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeaXoOazleWGmeWFpeaWh+S7tu+8jOivt+ajgOafpeebruW9leadg+mZkOOAgiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgICMg5aaC5p6c5rKh5pyJ6YWN572u5paH5Lu25YiZ55Sf5oiQ5LiA5Liq56S65L6LCiAgICBpZiBbICEgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgICAgIGNhdCA8PCdDRkcnID4gIiRDT05GSUdfRklMRSIKIyBmdWNraXQuc2gg6YWN572u5paH5Lu256S65L6LCiMg5Y675o6J6KGM6aaW55qEICMg5bm25L+u5pS55Li65L2g5oOz6KaB55qE5YC85Y2z5Y+v44CCCgojIOiHquWumuS5iSBBUEkg5YWl5Y+j77yI5aaC6Ieq5bu6IFdvcmtlcu+8iQojIGV4cG9ydCBGVUNLX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly95b3VyLWRvbWFpbi53b3JrZXJzLmRldi8iCgojIOiHquWKqOaJp+ihjOi/lOWbnueahOWRveS7pO+8jOi3s+i/h+ehruiupO+8iOiwqOaFjuW8gOWQr++8iQojIGV4cG9ydCBGVUNLX0FVVE9fRVhFQz1mYWxzZQoKIyDor7fmsYLotoXml7bml7bpl7TvvIjnp5LvvIkKIyBleHBvcnQgRlVDS19USU1FT1VUPTMwCgojIOaYr+WQpuaJk+WNsOiwg+ivleS/oeaBrwojIGV4cG9ydCBGVUNLX0RFQlVHPWZhbHNlCkNGRwogICAgZmkKCiAgICAjIOaKiiBzb3VyY2Ug6YKj6KGM5Yqg5YiwIHNoZWxsIOmFjee9ruaWh+S7tumHjAogICAgbG9jYWwgcHJvZmlsZV9maWxlCiAgICBwcm9maWxlX2ZpbGU9JChfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKQogICAgCiAgICBpZiBbICIkcHJvZmlsZV9maWxlIiA9ICJ1bmtub3duX3Byb2ZpbGUiIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeaJvuS4jeWIsCAuYmFzaHJjLCAuenNocmMg5oiWIC5wcm9maWxl77yM5peg5rOV6Ieq5Yqo6YWN572u44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33or7fmiYvliqjlsIbku6XkuIvlhoXlrrnmt7vliqDliLDmgqjnmoQgc2hlbGwg6YWN572u5paH5Lu25Lit77yaJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgZWNobyAtZSAiXG4gICR7Q19DWUFOfXNvdXJjZSAkTUFJTl9TSCR7Q19SRVNFVH1cbiIgPiYyCiAgICAgICAgcmV0dXJuCiAgICBmaQogICAgCiAgICBsb2NhbCBzb3VyY2VfbGluZT0ic291cmNlICRNQUlOX1NIIgogICAgaWYgISBncmVwIC1xRiAiJHNvdXJjZV9saW5lIiAiJHByb2ZpbGVfZmlsZSI7IHRoZW4KICAgICAgICAjIOS/neivgeaWh+S7tuacgOWQjuacieaNouihjAogICAgICAgIGlmIFsgLW4gIiQodGFpbCAtYzEgIiRwcm9maWxlX2ZpbGUiKSIgXTsgdGhlbgogICAgICAgICAgICBlY2hvICIiID4+ICIkcHJvZmlsZV9maWxlIgogICAgICAgIGZpCiAgICAgICAgZWNobyAiIyBBZGRlZCBieSBmdWNraXQuc2ggaW5zdGFsbGVyIiA+PiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICBlY2hvICIkc291cmNlX2xpbmUiID4+ICIkcHJvZmlsZV9maWxlIgogICAgICAgIGVjaG8gLWUgIiR7Q19HUkVFTn3lronoo4XlrozmiJDvvIEke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d96K+36YeN5ZCv57uI56uv5oiW5omn6KGMICR7Q19CT0xEfXNvdXJjZSAkcHJvZmlsZV9maWxlJHtDX1lFTExPV30g5Lul5L2/5pu05pS555Sf5pWI44CCJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICJcbiR7Q19CT0xEfS0tLSDkvb/nlKjmlrnms5UgLS0tJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICLkvb/nlKggJHtDX1JFRF9CT0xEfWZ1Y2ske0NfUkVTRVR9IOWRveS7pOWQjui3n+aCqOaDs+aJp+ihjOeahOaTjeS9nOWNs+WPr+OAgiIKICAgICAgICBlY2hvIC1lICLnpLrkvos6IgogICAgICAgIGVjaG8gLWUgIiAgJHtDX0NZQU59ZnVjayBpbnN0YWxsIGdpdCR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiICAke0NfQ1lBTn1mdWNrIHVuaW5zdGFsbCBnaXQke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiAgJHtDX0NZQU59ZnVjayDmib7lh7rlvZPliY3nm67lvZXmiYDmnInlpKfkuo4xME1C55qE5paH5Lu2JHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19SRURfQk9MRH1mdWNrIHVuaW5zdGFsbCR7Q19SRVNFVH0gJHtDX0dSRUVOfSMg5Y246L29IGZ1Y2tpdC5zaCR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiICAke0NfUkVEX0JPTER9ZnVjayBjb25maWcke0NfUkVTRVR9ICR7Q19HUkVFTn0jIOaYvuekuumFjee9ruW4ruWKqSR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiXG4ke0NfWUVMTE9XfeiusOW+l+mHjeWQr+e7iOerr+S7peS9v+eUqOaWsOWRveS7pO+8gSR7Q19SRVNFVH0iCiAgICBlbHNlCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1lFTExPV33mo4DmtYvliLDlt7Llronoo4XvvIzlt7LkuLrmgqjmm7TmlrDohJrmnKzjgIIke0NfUkVTRVR9IgogICAgZmkKfQoKCiMgLS0tIOS4u+iEmuacrOWFpeWPoyAtLS0KCiMg5aaC5p6c5pyJ5Y+C5pWw5Lyg6L+b5p2lICjmr5TlpoIgImJhc2ggLXMgLi4uIikKaWYgWyAiJCMiIC1ndCAwIF07IHRoZW4KICAgICMg5Li05pe25qih5byPCiAgICAjIOi/kOihjOaguOW/g+mAu+i+ke+8jOWumuS5ieWHveaVsAogICAgZXZhbCAiJENPUkVfTE9HSUMiCiAgICAjIOebtOaOpeiwg+eUqOS4u+WHveaVsCAo5Yir5ZCN5Zyo6L+Z5YS/5LiN5aW95L2/KQogICAgX2Z1Y2tfZXhlY3V0ZV9wcm9tcHQgIiRAIgplbHNlCiAgICAjIOWuieijheaooeW8jwogICAgX2luc3RhbGxfc2NyaXB0CmZpCg==`);

export default {
  async fetch(request, env, ctx) {
    if (request.method === 'GET') {
      return handleGetRequest(request);
    } else if (request.method === 'POST') {
      return handlePostRequest(request, env);
    } else {
      return new Response('Expected GET or POST', { status: 405 });
    }
  },
};

/**
 * Handles GET requests to serve the installer script or redirect browsers to GitHub.
 * @param {Request} request The incoming request.
 * @returns {Response} A response with the shell script or a redirect.
 */
function handleGetRequest(request) {
  const userAgent = request.headers.get('User-Agent') || '';
  const isBrowser = /Mozilla|Chrome|Safari|Firefox|Edg/.test(userAgent);
  const url = new URL(request.url);
  const isChineseDomain = url.hostname === 'zh.fuckit.sh';

  // If the request comes from a browser, redirect to the appropriate README.
  if (isBrowser) {
    // Prioritize the domain: if user visits zh.fuckit.sh, always show Chinese README.
    if (isChineseDomain) {
      return Response.redirect('https://github.com/faithleysath/fuckit.sh', 302);
    }

    // Otherwise, check browser language for the main domain.
    const acceptLanguage = request.headers.get('Accept-Language') || '';
    const isChineseUser = acceptLanguage.toLowerCase().startsWith('zh');
    
    const repoUrl = isChineseUser
      ? 'https://github.com/faithleysath/fuckit.sh'
      : 'https://github.com/faithleysath/fuckit.sh/blob/main/README.en.md';
      
    return Response.redirect(repoUrl, 302);
  }

  // Otherwise, serve the installer script based on the domain.
  const script = isChineseDomain ? INSTALLER_SCRIPT_ZH : INSTALLER_SCRIPT;
  const filename = 'fuckit.sh'; // Keep filename consistent

  return new Response(script, {
    headers: {
      'Content-Type': 'text/plain; charset=utf-8',
      'Content-Disposition': `attachment; filename="${filename}"`,
    },
  });
}

/**
 * Handles POST requests by forwarding the prompt to an AI model.
 * @param {Request} request The incoming request.
 * @param {object} env The environment variables.
 * @returns {Promise<Response>} A promise that resolves to the AI's response.
 */
async function handlePostRequest(request, env) {
  try {
    const { sysinfo, prompt } = await request.json();

    if (!prompt) {
      return new Response('Missing "prompt" in request body', { status: 400 });
    }
    if (!env.OPENAI_API_KEY) {
      return new Response('Missing OPENAI_API_KEY secret', { status: 500 });
    }

    const model = env.OPENAI_API_MODEL || 'gpt-4-turbo';
    const apiBase = (env.OPENAI_API_BASE || 'https://api.openai.com/v1').replace(/\/$/, '');
    const apiUrl = `${apiBase}/chat/completions`;

    const url = new URL(request.url);
    const isChinese = url.hostname === 'zh.fuckit.sh';

    const system_prompt = isChinese
      ? `你是一个专业的 shell 脚本生成器。用户会提供他们的系统信息和一个命令。你的任务是返回一个可执行的、原始的 shell 脚本来完成他们的目标。脚本可以是多行的。不要提供任何解释、注释、markdown 格式（比如 \`\`\`bash）或 shebang（例如 #!/bin/bash）。只需要原始的脚本内容。用户的系统信息是：${sysinfo}`
      : `You are an expert shell script generator. A user will provide their system information and a prompt. Your task is to return a raw, executable shell script that accomplishes their goal. The script can be multi-line. Do not provide any explanation, comments, markdown formatting (like \`\`\`bash), or a shebang (e.g., #!/bin/bash). Just the raw script content. The user's system info is: ${sysinfo}`;

    const aiRequestPayload = {
      model: model,
      messages: [
        {
          role: 'system',
          content: system_prompt,
        },
        {
          role: 'user',
          content: prompt,
        },
      ],
      max_tokens: 1024,
      temperature: 0.2,
    };

    const aiResponse = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${env.OPENAI_API_KEY}`,
      },
      body: JSON.stringify(aiRequestPayload),
    });

    if (!aiResponse.ok) {
      const errorText = await aiResponse.text();
      return new Response(`AI API Error: ${errorText}`, { status: aiResponse.status });
    }

    const aiJson = await aiResponse.json();
    const command = aiJson.choices[0]?.message?.content.trim();

    if (!command) {
      return new Response('The AI returned an empty command.', { status: 500 });
    }

    return new Response(command, {
      headers: { 'Content-Type': 'text/plain' },
    });
  } catch (error) {
    return new Response(`Error: ${error.message}`, { status: 500 });
  }
}
