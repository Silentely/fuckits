// --- FUCKIT.SH Cloudflare Worker ---

// This is the content of your main.sh installer script.
// It will be served when a user makes a GET request.
function b64_to_utf8(str) {
  try {
    // This is a more robust way to decode base64 to UTF-8
    const binaryString = atob(str);
    const len = binaryString.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    return new TextDecoder().decode(bytes);
  } catch (e) {
    console.error("Failed to decode base64 string:", e);
    return ""; // Return empty string on failure
  }
}

const INSTALLER_SCRIPT = b64_to_utf8(`IyEvYmluL2Jhc2gKIwojIFRoaXMgc2NyaXB0IGlzIHRoZSBpbnN0YWxsZXIgYW5kIHRlbXBvcmFyeSBydW5uZXIgZm9yIGZ1Y2tpdC5zaAojCiMgLS0tIFJFQ09NTUVOREVEIFNFQ1VSRSBVU0FHRSAtLS0KIwojIDEuIERvd25sb2FkOgojICAgIGN1cmwgLW8gZnVja2l0LnNoIGh0dHBzOi8vZnVja2l0cy4yNTUwMDU1Mi54eXoKIwojIDIuIEluc3BlY3Q6CiMgICAgbGVzcyBmdWNraXQuc2gKIwojIDMuIFJ1biAoSW5zdGFsbCk6CiMgICAgYmFzaCBmdWNraXQuc2gKIwojIDQuIFJ1biAoVGVtcG9yYXJ5KToKIyAgICBiYXNoIGZ1Y2tpdC5zaCAieW91ciBwcm9tcHQiCiMKCnNldCAtZXVvIHBpcGVmYWlsCgojIC0tLSBDb2xvciBEZWZpbml0aW9ucyAtLS0KcmVhZG9ubHkgQ19SRVNFVD0nXDAzM1swbScKcmVhZG9ubHkgQ19SRURfQk9MRD0nXDAzM1sxOzMxbScKcmVhZG9ubHkgQ19SRUQ9J1wwMzNbMDszMW0nCnJlYWRvbmx5IENfR1JFRU49J1wwMzNbMDszMm0nCnJlYWRvbmx5IENfWUVMTE9XPSdcMDMzWzA7MzNtJwpyZWFkb25seSBDX0NZQU49J1wwMzNbMDszNm0nCnJlYWRvbmx5IENfQk9MRD0nXDAzM1sxbScKcmVhZG9ubHkgQ19ESU09J1wwMzNbMm0nCgojIC0tLSBGVUNLISAtLS0KcmVhZG9ubHkgRlVDSz0iJHtDX1JFRF9CT0xEfUZVQ0shJHtDX1JFU0VUfSIKcmVhZG9ubHkgRkNLTj0iJHtDX1JFRH1GKkNLSU5HJHtDX1JFU0VUfSIKCgojIC0tLSBDb25maWd1cmF0aW9uIC0tLQppZiBbIC16ICIke0hPTUU6LX0iIF07IHRoZW4KICAgIGVjaG8gLWUgIlwwMzNbMTszMW1GVUNLIVwwMzNbMG0gXDAzM1swOzMxbVlvdXIgSE9NRSB2YXJpYWJsZSBpc24ndCBzZXQuIEkgZG9uJ3Qga25vdyB3aGVyZSB0byBpbnN0YWxsIHRoaXMgc2hpdC4gU2V0IGl0IHlvdXJzZWxmIChlLmcuLCBleHBvcnQgSE9NRT0vcm9vdCkuXDAzM1swbSIgPiYyCiAgICBleGl0IDEKZmkKcmVhZG9ubHkgSU5TVEFMTF9ESVI9IiRIT01FLy5mdWNrIgpyZWFkb25seSBNQUlOX1NIPSIkSU5TVEFMTF9ESVIvbWFpbi5zaCIKcmVhZG9ubHkgQ09ORklHX0ZJTEU9IiRJTlNUQUxMX0RJUi9jb25maWcuc2giCgoKIyAtLS0gQ29yZSBMb2dpYyAoRW1iZWRkZWQgYXMgYSBzdHJpbmcpIC0tLQpyZWFkIC1yIC1kICcnIENPUkVfTE9HSUMgPDwnRU9GJyB8fCB0cnVlCgojIC0tLSBCZWdpbiBDb3JlIExvZ2ljIGZvciBmdWNraXQuc2ggLS0tCgojIC0tLSBDb2xvciBEZWZpbml0aW9ucyAtLS0KIyBPbmx5IGRlZmluZSBjb2xvcnMgaWYgdGhleSBoYXZlbid0IGJlZW4gZGVmaW5lZCB5ZXQgKGZvciB0ZW1wIG1vZGUpCmlmIFsgLXogIiR7Q19SRVNFVDotfSIgXTsgdGhlbgogICAgcmVhZG9ubHkgQ19SRVNFVD0nXDAzM1swbScKICAgIHJlYWRvbmx5IENfUkVEX0JPTEQ9J1wwMzNbMTszMW0nCiAgICByZWFkb25seSBDX1JFRD0nXDAzM1swOzMxbScKICAgIHJlYWRvbmx5IENfR1JFRU49J1wwMzNbMDszMm0nCiAgICByZWFkb25seSBDX1lFTExPVz0nXDAzM1swOzMzbScKICAgIHJlYWRvbmx5IENfQ1lBTj0nXDAzM1swOzM2bScKICAgIHJlYWRvbmx5IENfQk9MRD0nXDAzM1sxbScKICAgIHJlYWRvbmx5IENfRElNPSdcMDMzWzJtJwoKICAgICMgLS0tIEZVQ0shIC0tLQogICAgcmVhZG9ubHkgRlVDSz0iJHtDX1JFRF9CT0xEfUZVQ0shJHtDX1JFU0VUfSIKICAgIHJlYWRvbmx5IEZDS049IiR7Q19SRUR9RipDS0lORyR7Q19SRVNFVH0iCmZpCgppZiBbIC16ICIke0lOU1RBTExfRElSK3h9IiBdIHx8IFsgLXogIiR7TUFJTl9TSCt4fSIgXSB8fCBbIC16ICIke0NPTkZJR19GSUxFK3h9IiBdOyB0aGVuCiAgICBpZiBbIC16ICIke0hPTUU6LX0iIF07IHRoZW4KICAgICAgICByZWFkb25seSBJTlNUQUxMX0RJUj0iL3RtcC8uZnVjayIKICAgICAgICByZWFkb25seSBNQUlOX1NIPSIvdG1wLy5mdWNrL21haW4uc2giCiAgICAgICAgcmVhZG9ubHkgQ09ORklHX0ZJTEU9Ii90bXAvLmZ1Y2svY29uZmlnLnNoIgogICAgZWxzZQogICAgICAgIHJlYWRvbmx5IElOU1RBTExfRElSPSIkSE9NRS8uZnVjayIKICAgICAgICByZWFkb25seSBNQUlOX1NIPSIkSU5TVEFMTF9ESVIvbWFpbi5zaCIKICAgICAgICByZWFkb25seSBDT05GSUdfRklMRT0iJElOU1RBTExfRElSL2NvbmZpZy5zaCIKICAgIGZpCmZpCgojIExvYWQgdXNlciBjb25maWd1cmF0aW9uIGlmIGl0IGV4aXN0cwppZiBbIC1mICIkQ09ORklHX0ZJTEUiIF07IHRoZW4KICAgIHNvdXJjZSAiJENPTkZJR19GSUxFIgpmaQoKaWYgWyAteiAiJHtERUZBVUxUX0FQSV9FTkRQT0lOVCt4fSIgXTsgdGhlbgogICAgcmVhZG9ubHkgREVGQVVMVF9BUElfRU5EUE9JTlQ9Imh0dHBzOi8vZnVja2l0cy4yNTUwMDU1Mi54eXovIgpmaQoKIyBIZWxwZXIgdG8gZmluZCB0aGUgdXNlcidzIHNoZWxsIHByb2ZpbGUgZmlsZQpfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKCkgewogICAgaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAienNoIjsgdGhlbgogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAiYmFzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8ucHJvZmlsZSIgXTsgdGhlbgogICAgICAgICMgRmFsbGJhY2sgZm9yIHNoLCBrc2gsIGV0Yy4KICAgICAgICBlY2hvICIkSE9NRS8ucHJvZmlsZSIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLnpzaHJjIiBdOyB0aGVuCiAgICAgICAgIyBGYWxsYmFjayBpZiBTSEVMTCB2YXIgaXNuJ3Qgc2V0CiAgICAgICAgZWNobyAiJEhPTUUvLnpzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8uYmFzaHJjIiBdOyB0aGVuCiAgICAgICAgIyBGYWxsYmFjayBpZiBTSEVMTCB2YXIgaXNuJ3Qgc2V0CiAgICAgICAgZWNobyAiJEhPTUUvLmJhc2hyYyIKICAgIGVsc2UKICAgICAgICBlY2hvICJ1bmtub3duX3Byb2ZpbGUiCiAgICBmaQp9CgojIERldGVjdHMgdGhlIHBhY2thZ2UgbWFuYWdlcgpfZnVja19kZXRlY3RfcGtnX21hbmFnZXIoKSB7CiAgICBpZiBjb21tYW5kIC12IGFwdC1nZXQgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAiYXB0IgogICAgZWxpZiBjb21tYW5kIC12IHl1bSAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvICJ5dW0iCiAgICBlbGlmIGNvbW1hbmQgLXYgZG5mICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gImRuZiIKICAgIGVsaWYgY29tbWFuZCAtdiBwYWNtYW4gJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAicGFjbWFuIgogICAgZWxpZiBjb21tYW5kIC12IHp5cHBlciAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvICJ6eXBwZXIiCiAgICBlbGlmIGNvbW1hbmQgLXYgYnJldyAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvICJicmV3IgogICAgZWxzZQogICAgICAgIGVjaG8gInVua25vd24iCiAgICBmaQp9CgojIENvbGxlY3RzIHN5c3RlbSBpbmZvIGFzIGEgc2ltcGxlIHN0cmluZwpfZnVja19jb2xsZWN0X3N5c2luZm9fc3RyaW5nKCkgewogICAgbG9jYWwgcGtnX21hbmFnZXIKICAgIHBrZ19tYW5hZ2VyPSQoX2Z1Y2tfZGV0ZWN0X3BrZ19tYW5hZ2VyKQogICAgIyBUaGUgc2VydmVyLXNpZGUgTExNIHByb21wdCB3aWxsIG5lZWQgdG8gcGFyc2UgdGhpcyBzdHJpbmcKICAgIGVjaG8gIk9TOiAkKHVuYW1lIC1zKSwgQXJjaDogJCh1bmFtZSAtbSksIFNoZWxsOiAke1NIRUxMOi11bmtub3dufSwgUGtnTWdyOiAkcGtnX21hbmFnZXIsIENXRDogJChwd2QpIgp9CgojIEVzY2FwZXMgYSBzdHJpbmcgZm9yIHVzZSBpbiBhIEpTT04gcGF5bG9hZApfZnVja19qc29uX2VzY2FwZSgpIHsKICAgICMgQmFzaWMgZXNjYXBlIGZvciBxdW90ZXMsIGJhY2tzbGFzaGVzLCBhbmQgY29udHJvbCBjaGFyYWN0ZXJzCiAgICBwcmludGYgJyVzJyAiJDEiIHwgc2VkIC1lICdzL1xcL1xcXFwvZycgLWUgJ3MvIi9cIi9nJyAtZSAncy9cbi9cXG4vZycgLWUgJ3MvXHIvXFxyL2cnIC1lICdzL1x0L1xcdC9nJwp9CgojIFNpbXBsZSBoZWxwZXIgdG8gcGFyc2UgYm9vbGVhbi1saWtlIHZhbHVlcwpfZnVja190cnV0aHkoKSB7CiAgICBsb2NhbCB2YWx1ZT0iJHsxOi19IgogICAgbG9jYWwgbm9ybWFsaXplZAogICAgbm9ybWFsaXplZD0kKHByaW50ZiAnJXMnICIkdmFsdWUiIHwgdHIgJ1s6dXBwZXI6XScgJ1s6bG93ZXI6XScpCiAgICBjYXNlICIkbm9ybWFsaXplZCIgaW4KICAgICAgICAxfHRydWV8eWVzfHl8b24pCiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIDs7CiAgICAgICAgKikKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgOzsKICAgIGVzYWMKfQoKIyBEZWJ1ZyBoZWxwZXIKX2Z1Y2tfZGVidWcoKSB7CiAgICBpZiBfZnVja190cnV0aHkgIiR7RlVDS19ERUJVRzotMH0iOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJHtDX0RJTX1bZGVidWddICQqJHtDX1JFU0VUfSIgPiYyCiAgICBmaQp9CgojIFNwaW5uZXIgYW5pbWF0aW9uCl9mdWNrX3NwaW5uZXIoKSB7CiAgICBsb2NhbCBwaWQ9JDEKICAgIGxvY2FsIGRlbGF5PTAuMQogICAgbG9jYWwgc3BpbnN0cj0nfC8tXCcKICAgIAogICAgIyBIaWRlIGN1cnNvcgogICAgdHB1dCBjaXZpcyAyPi9kZXYvbnVsbCB8fCBwcmludGYgIlwwMzNbPzI1bCIKCiAgICB3aGlsZSBraWxsIC0wICIkcGlkIiAyPi9kZXYvbnVsbDsgZG8KICAgICAgICBsb2NhbCB0ZW1wPSR7c3BpbnN0ciM/fQogICAgICAgIHByaW50ZiAiIFslY10gICIgIiRzcGluc3RyIgogICAgICAgIGxvY2FsIHNwaW5zdHI9JHRlbXAke3NwaW5zdHIlIiR0ZW1wIn0KICAgICAgICBzbGVlcCAkZGVsYXkKICAgICAgICBwcmludGYgIlxiXGJcYlxiXGJcYiIKICAgIGRvbmUKICAgIHByaW50ZiAiICAgIFxiXGJcYlxiIgogICAgCiAgICAjIFNob3cgY3Vyc29yCiAgICB0cHV0IGNub3JtIDI+L2Rldi9udWxsIHx8IHByaW50ZiAiXDAzM1s/MjVoIgp9CgojIEVuc3VyZSBhIGNvbmZpZyBmaWxlIGV4aXN0cyB0byBoZWxwIHVzZXJzIHR3ZWFrIHRoZSBiZWhhdmlvdXIKX2Z1Y2tfZW5zdXJlX2NvbmZpZ19leGlzdHMoKSB7CiAgICBpZiBbIC1mICIkQ09ORklHX0ZJTEUiIF07IHRoZW4KICAgICAgICByZXR1cm4KICAgIGZpCgogICAgbWtkaXIgLXAgIiQoZGlybmFtZSAiJENPTkZJR19GSUxFIikiCiAgICBjYXQgPDwnQ0ZHJyA+ICIkQ09ORklHX0ZJTEUiCiMgZnVja2l0LnNoIGNvbmZpZ3VyYXRpb24KIyBUb2dnbGUgdGhlIGV4cG9ydHMgYmVsb3cgdG8gY3VzdG9taXNlIHlvdXIgZXhwZXJpZW5jZS4KCiMgQ3VzdG9tIEFQSSBlbmRwb2ludCB0aGF0IHBvaW50cyB0byB5b3VyIHNlbGYtaG9zdGVkIHdvcmtlcgojIGV4cG9ydCBGVUNLX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly95b3VyLWRvbWFpbi53b3JrZXJzLmRldi8iCgojIEFkZCBhbiBleHRyYSBhbGlhcyBiZXNpZGVzIHRoZSBkZWZhdWx0ICdmdWNrJwojIGV4cG9ydCBGVUNLX0FMSUFTPSJwbHMiCgojIFNraXAgY29uZmlybWF0aW9uIHByb21wdHMgKHVzZSB3aXRoIGNhdXRpb24hKQojIGV4cG9ydCBGVUNLX0FVVE9fRVhFQz1mYWxzZQoKIyBPdmVycmlkZSBjdXJsIHRpbWVvdXQgKHNlY29uZHMpCiMgZXhwb3J0IEZVQ0tfVElNRU9VVD0zMAoKIyBFbmFibGUgdmVyYm9zZSBkZWJ1ZyBsb2dzCiMgZXhwb3J0IEZVQ0tfREVCVUc9ZmFsc2UKCiMgRGlzYWJsZSB0aGUgYnVpbHQtaW4gJ2Z1Y2snIGFsaWFzCiMgZXhwb3J0IEZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTPWZhbHNlCkNGRwp9CgpfZnVja19zaG93X2NvbmZpZ19oZWxwKCkgewogICAgX2Z1Y2tfZW5zdXJlX2NvbmZpZ19leGlzdHMKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9Q29uZmlndXJhdGlvbiBmaWxlOiR7Q19SRVNFVH0gJHtDX0NZQU59JENPTkZJR19GSUxFJHtDX1JFU0VUfSIKICAgIGlmIFsgLW4gIiR7RURJVE9SOi19IiBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV31FZGl0IHdpdGg6JHtDX1JFU0VUfSAke0NfQ1lBTn0ke0VESVRPUn0gXCIkQ09ORklHX0ZJTEVcIiR7Q19SRVNFVH0iCiAgICBlbHNlCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV31PcGVuIHRoaXMgZmlsZSBpbiB5b3VyIGZhdm91cml0ZSBlZGl0b3IgdG8gY3VzdG9taXNlIGZ1Y2tpdC5zaC4ke0NfUkVTRVR9IgogICAgZmkKICAgIGVjaG8gLWUgIiR7Q19DWUFOfUF2YWlsYWJsZSB0b2dnbGVzOiR7Q19SRVNFVH0gRlVDS19BUElfRU5EUE9JTlQsIEZVQ0tfQUxJQVMsIEZVQ0tfQVVUT19FWEVDLCBGVUNLX1RJTUVPVVQsIEZVQ0tfREVCVUciCn0KCiMgVW5pbnN0YWxscyB0aGUgc2NyaXB0Cl91bmluc3RhbGxfc2NyaXB0KCkgewogICAgZWNobyAtZSAiJEZVQ0sgJHtDX1lFTExPV31TbyB5b3UncmUga2lja2luZyBtZSBvdXQ/IEZpbmUuJHtDX1JFU0VUfSIKCiAgICAjIEZpbmQgdGhlIHByb2ZpbGUgZmlsZQogICAgbG9jYWwgcHJvZmlsZV9maWxlCiAgICBwcm9maWxlX2ZpbGU9JChfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKQogICAgbG9jYWwgc291cmNlX2xpbmU9InNvdXJjZSAkTUFJTl9TSCIKCiAgICBpZiBbICIkcHJvZmlsZV9maWxlIiAhPSAidW5rbm93bl9wcm9maWxlIiBdICYmIFsgLWYgIiRwcm9maWxlX2ZpbGUiIF07IHRoZW4KICAgICAgICBpZiBncmVwIC1xRiAiJHNvdXJjZV9saW5lIiAiJHByb2ZpbGVfZmlsZSI7IHRoZW4KICAgICAgICAgICAgIyBVc2Ugc2VkIHRvIHJlbW92ZSB0aGUgbGluZXMuIENyZWF0ZSBhIGJhY2t1cC4KICAgICAgICAgICAgaWYgc2VkIC0tdmVyc2lvbiA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgICAgICAgICAgICAgICMgR05VIHNlZCAoTGludXgpCiAgICAgICAgICAgICAgICBzZWQgLWkuYmFrICJcfCRzb3VyY2VfbGluZVx8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgICAgICAgICBzZWQgLWkuYmFrICJcfCMgQWRkZWQgYnkgZnVja2l0LnNoIGluc3RhbGxlclx8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICMgQlNEL21hY09TIHNlZCByZXF1aXJlcyBhcmd1bWVudCBsZXR0ZXIgYWZ0ZXIgLWkKICAgICAgICAgICAgICAgIHNlZCAtaS5iYWsgIiIgLWUgIlx8JHNvdXJjZV9saW5lXHxkIiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICAgICAgICAgIHNlZCAtaS5iYWsgIiIgLWUgIlx8IyBBZGRlZCBieSBmdWNraXQuc2ggaW5zdGFsbGVyXHxkIiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICAgICAgZmkKICAgICAgICBmaQogICAgZWxzZQogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9Q291bGQgbm90IGZpbmQgYSBzaGVsbCBwcm9maWxlIGZpbGUgdG8gbW9kaWZ5LiBZb3VyIHByb2JsZW0gbm93LiR7Q19SRVNFVH0iCiAgICBmaQoKICAgIGlmIFsgLWQgIiRJTlNUQUxMX0RJUiIgXTsgdGhlbgogICAgICAgIHJtIC1yZiAiJElOU1RBTExfRElSIgogICAgZmkKCiAgICBlY2hvIC1lICIkRlVDSyAke0NfR1JFRU59SSdtIGdvbmUuIERvbid0IGNvbWUgY3J5aW5nIGJhY2suJHtDX1JFU0VUfSIKICAgIGVjaG8gLWUgIiR7Q19DWUFOfU5vdyByZXN0YXJ0IHlvdXIgZGFtbiBzaGVsbC4ke0NfUkVTRVR9Igp9CgojIFRoZSBtYWluIGZ1bmN0aW9uIHRoYXQgY29udGFjdHMgdGhlIEFQSQojIFRha2VzID4wIGFyZ3VtZW50cyBhcyB0aGUgcHJvbXB0Cl9mdWNrX2V4ZWN1dGVfcHJvbXB0KCkgewogICAgIyBJZiB0aGUgdXNlciB0eXBlcyAqb25seSogImZ1Y2sgdW5pbnN0YWxsIgogICAgaWYgWyAiJDEiID0gInVuaW5zdGFsbCIgXSAmJiBbICIkIyIgLWVxIDEgXTsgdGhlbgogICAgICAgIF91bmluc3RhbGxfc2NyaXB0CiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgIyBJZiB0aGUgdXNlciB0eXBlcyAiZnVjayBjb25maWciCiAgICBpZiBbICIkMSIgPSAiY29uZmlnIiBdICYmIFsgIiQjIiAtZXEgMSBdOyB0aGVuCiAgICAgICAgX2Z1Y2tfc2hvd19jb25maWdfaGVscAogICAgICAgIHJldHVybiAwCiAgICBmaQoKICAgIGlmICEgY29tbWFuZCAtdiBjdXJsICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9J2Z1Y2snIGNvbW1hbmQgbmVlZHMgJ2N1cmwnLiBQbGVhc2UgaW5zdGFsbCBpdC4ke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBpZiBbICIkIyIgLWVxIDAgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9WW91IGZvcmdvdCB0byBhc2sgbWUgd2hhdCB0byBkby4ke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBsb2NhbCBwcm9tcHQ9IiQqIgogICAgbG9jYWwgYXV0b19tb2RlPSIke0ZVQ0tfQVVUT19FWEVDOi0wfSIKICAgIGxvY2FsIGN1cmxfdGltZW91dD0iJHtGVUNLX1RJTUVPVVQ6LTMwfSIKICAgIGxvY2FsIHN5c2luZm9fc3RyaW5nCiAgICBzeXNpbmZvX3N0cmluZz0kKF9mdWNrX2NvbGxlY3Rfc3lzaW5mb19zdHJpbmcpCiAgICAKICAgIGxvY2FsIGVzY2FwZWRfcHJvbXB0CiAgICBlc2NhcGVkX3Byb21wdD0kKF9mdWNrX2pzb25fZXNjYXBlICIkcHJvbXB0IikKICAgIAogICAgbG9jYWwgZXNjYXBlZF9zeXNpbmZvCiAgICBlc2NhcGVkX3N5c2luZm89JChfZnVja19qc29uX2VzY2FwZSAiJHN5c2luZm9fc3RyaW5nIikKCiAgICAjIENvbnN0cnVjdCB0aGUgSlNPTiBwYXlsb2FkCiAgICBsb2NhbCBwYXlsb2FkCiAgICBwYXlsb2FkPSQocHJpbnRmICd7ICJzeXNpbmZvIjogIiVzIiwgInByb21wdCI6ICIlcyIgfScgIiRlc2NhcGVkX3N5c2luZm8iICIkZXNjYXBlZF9wcm9tcHQiKQoKICAgICMgVXNlIGNvbmZpZ3VyZWQgQVBJIGVuZHBvaW50IG9yIGRlZmF1bHQKICAgIGxvY2FsIGFwaV91cmw9IiR7RlVDS19BUElfRU5EUE9JTlQ6LSRERUZBVUxUX0FQSV9FTkRQT0lOVH0iCgogICAgX2Z1Y2tfZGVidWcgIkFQSSBVUkw6ICRhcGlfdXJsIgogICAgX2Z1Y2tfZGVidWcgIlBheWxvYWQ6ICRwYXlsb2FkIgoKICAgIGVjaG8gLW5lICIke0NfWUVMTE9XfVRoaW5raW5nLi4uJHtDX1JFU0VUfSIKICAgIAogICAgbG9jYWwgdG1wX3Jlc3BvbnNlCiAgICB0bXBfcmVzcG9uc2U9JChta3RlbXApCiAgICAKICAgICMgQ2FsbCBBUEkgaW4gYmFja2dyb3VuZAogICAgKAogICAgICAgIGN1cmwgLWZzUyAtLW1heC10aW1lICIkY3VybF90aW1lb3V0IiAtWCBQT1NUICIkYXBpX3VybCIgXAogICAgICAgICAgICAtSCAiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uIiBcCiAgICAgICAgICAgIC1kICIkcGF5bG9hZCIgPiAiJHRtcF9yZXNwb25zZSIgMj4mMQogICAgKSAmICAgIGxvY2FsIHBpZD0kIQogICAgCiAgICBfZnVja19zcGlubmVyICIkcGlkIgogICAgaWYgd2FpdCAiJHBpZCI7IHRoZW4KICAgICAgICBleGl0X2NvZGU9MAogICAgZWxzZQogICAgICAgIGV4aXRfY29kZT0kPwogICAgZmkKICAgIAogICAgZWNobyAiIiAjIE5ld2xpbmUgYWZ0ZXIgc3Bpbm5lcgoKICAgIGxvY2FsIHJlc3BvbnNlCiAgICBpZiBbIC1mICIkdG1wX3Jlc3BvbnNlIiBdOyB0aGVuCiAgICAgICAgcmVzcG9uc2U9JChjYXQgIiR0bXBfcmVzcG9uc2UiKQogICAgICAgIHJtIC1mICIkdG1wX3Jlc3BvbnNlIgogICAgZWxzZQogICAgICAgIHJlc3BvbnNlPSIiCiAgICBmaQoKICAgIGlmIFsgJGV4aXRfY29kZSAtbmUgMCBdIHx8IFsgLXogIiRyZXNwb25zZSIgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR9Q291bGRuJ3QgcmVhY2ggdGhlIEFJIHNlcnZpY2Ugb3IgZ290IGVtcHR5IHJlc3BvbnNlLiR7Q19SRVNFVH0iID4mMgogICAgICAgIFsgLW4gIiRyZXNwb25zZSIgXSAmJiBlY2hvIC1lICIke0NfRElNfSRyZXNwb25zZSR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgICMgLS0tIFVzZXIgQ29uZmlybWF0aW9uIChhcyByZXF1ZXN0ZWQpIC0tLQogICAgZWNobyAtZSAiJHtDX0NZQU59SGVyZSBpcyB3aGF0IEkgY2FtZSB1cCB3aXRoOiR7Q19SRVNFVH0iCiAgICBlY2hvIC1lICIke0NfRElNfS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0ke0NfUkVTRVR9IgogICAgZWNobyAtZSAiJHtDX0dSRUVOfSR7cmVzcG9uc2V9JHtDX1JFU0VUfSIKICAgIGVjaG8gLWUgIiR7Q19ESU19LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSR7Q19SRVNFVH0iCiAgICAKICAgICMgQ2hlY2sgaWYgYXV0by1leGVjIG1vZGUgaXMgZW5hYmxlZAogICAgbG9jYWwgc2hvdWxkX2V4ZWM9ZmFsc2UKICAgIGlmIF9mdWNrX3RydXRoeSAiJGF1dG9fbW9kZSI7IHRoZW4KICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfeKaoSBBdXRvLWV4ZWMgZW5hYmxlZC4gUnVubmluZy4uLiR7Q19SRVNFVH0iCiAgICAgICAgc2hvdWxkX2V4ZWM9dHJ1ZQogICAgZWxzZQogICAgICAgICMgSW50ZXJhY3RpdmUgY29uZmlybWF0aW9uCiAgICAgICAgd2hpbGUgdHJ1ZTsgZG8KICAgICAgICAgICAgcHJpbnRmICIke0NfQk9MRH1FeGVjdXRlPyBbWS9uXSAke0NfUkVTRVR9IgogICAgICAgICAgICBsb2NhbCBjb25maXJtYXRpb24KICAgICAgICAgICAgaWYgWyAtciAvZGV2L3R0eSBdOyB0aGVuCiAgICAgICAgICAgICAgICByZWFkIC1yIC1uIDEgY29uZmlybWF0aW9uIDwgL2Rldi90dHkKICAgICAgICAgICAgICAgIGVjaG8gIiIgIyBOZXdsaW5lCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgZm9yIG5vIFRUWQogICAgICAgICAgICAgICAgcmVhZCAtciBjb25maXJtYXRpb24KICAgICAgICAgICAgZmkKCiAgICAgICAgICAgIGNhc2UgIiRjb25maXJtYXRpb24iIGluCiAgICAgICAgICAgICAgICBbeVldfCIiKQogICAgICAgICAgICAgICAgICAgIHNob3VsZF9leGVjPXRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgICAgICBbbk5dKQogICAgICAgICAgICAgICAgICAgIHNob3VsZF9leGVjPWZhbHNlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAgICAgKikKICAgICAgICAgICAgICAgICAgICAjIExvb3AgYWdhaW4KICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICBlc2FjCiAgICAgICAgZG9uZQogICAgZmkKCiAgICBpZiBbICIkc2hvdWxkX2V4ZWMiID0gInRydWUiIF07IHRoZW4KICAgICAgICAjIEV4ZWN1dGUgdGhlIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlciBhbmQgY2hlY2sgaXRzIGV4aXQgY29kZQogICAgICAgIGlmIGV2YWwgIiRyZXNwb25zZSI7IHRoZW4KICAgICAgICAgICAgZWNobyAtZSAiJHtDX0dSRUVOfURvbmUuJHtDX1JFU0VUfSIKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxvY2FsIGV4aXRfY29kZT0kPwogICAgICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfUNvbW1hbmQgZmFpbGVkIHdpdGggZXhpdCBjb2RlICRleGl0X2NvZGUuJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgICAgIHJldHVybiAkZXhpdF9jb2RlCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfUFib3J0ZWQuJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCn0KCiMgRGVmaW5lIHRoZSBhbGlhcyBmb3IgaW50ZXJhY3RpdmUgdXNlIChzdXBwb3J0cyBjdXN0b20gYWxpYXNlcykKX2Z1Y2tfZGVmaW5lX2FsaWFzZXMoKSB7CiAgICBsb2NhbCBkZWZhdWx0X2FsaWFzPSJmdWNrIgoKICAgIGlmICEgX2Z1Y2tfdHJ1dGh5ICIke0ZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTOi0wfSI7IHRoZW4KICAgICAgICBhbGlhcyAiJGRlZmF1bHRfYWxpYXMiPSdfZnVja19leGVjdXRlX3Byb21wdCcKICAgIGZpCgogICAgaWYgWyAtbiAiJHtGVUNLX0FMSUFTOi19IiBdICYmIFsgIiRGVUNLX0FMSUFTIiAhPSAiJGRlZmF1bHRfYWxpYXMiIF07IHRoZW4KICAgICAgICBhbGlhcyAiJEZVQ0tfQUxJQVMiPSdfZnVja19leGVjdXRlX3Byb21wdCcKICAgIGZpCn0KCl9mdWNrX2RlZmluZV9hbGlhc2VzCgojIC0tLSBFbmQgQ29yZSBMb2dpYyAtLS0KRU9GCgojIC0tLSBFbmQgb2YgQ29yZSBMb2dpYyBIZXJlZG9jIC0tLQoKCiMgLS0tIEluc3RhbGxlciBGdW5jdGlvbnMgKFJ1biBieSB0aGUgb3V0ZXIgc2NyaXB0KSAtLS0KCiMgSGVscGVyIHRvIGZpbmQgdGhlIHVzZXIncyBzaGVsbCBwcm9maWxlIGZpbGUKX2luc3RhbGxlcl9kZXRlY3RfcHJvZmlsZSgpIHsKICAgIGlmIFsgLW4gIiR7U0hFTEw6LX0iIF0gJiYgZWNobyAiJFNIRUxMIiB8IGdyZXAgLXEgInpzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uenNocmMiCiAgICBlbGlmIFsgLW4gIiR7U0hFTEw6LX0iIF0gJiYgZWNobyAiJFNIRUxMIiB8IGdyZXAgLXEgImJhc2giOyB0aGVuCiAgICAgICAgZWNobyAiJEhPTUUvLmJhc2hyYyIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLnByb2ZpbGUiIF07IHRoZW4KICAgICAgICAjIEZhbGxiYWNrIGZvciBzaCwga3NoLCBldGMuCiAgICAgICAgZWNobyAiJEhPTUUvLnByb2ZpbGUiCiAgICBlbGlmIFsgLWYgIiRIT01FLy56c2hyYyIgXTsgdGhlbgogICAgICAgICMgRmFsbGJhY2sgaWYgU0hFTEwgdmFyIGlzbid0IHNldAogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLmJhc2hyYyIgXTsgdGhlbgogICAgICAgICMgRmFsbGJhY2sgaWYgU0hFTEwgdmFyIGlzbid0IHNldAogICAgICAgIGVjaG8gIiRIT01FLy5iYXNocmMiCiAgICBlbHNlCiAgICAgICAgZWNobyAidW5rbm93bl9wcm9maWxlIgogICAgZmkKfQoKIyBNYWluIGluc3RhbGxhdGlvbiBmdW5jdGlvbgpfaW5zdGFsbF9zY3JpcHQoKSB7CiAgICBlY2hvIC1lICIkRkNLTiAke0NfQk9MRH1BbHJpZ2h0LCBsZXQncyBnZXQgdGhpcyBzaGl0IGluc3RhbGxlZC4uLiR7Q19SRVNFVH0iCiAgICBta2RpciAtcCAiJElOU1RBTExfRElSIgogICAgCiAgICAjIFdyaXRlIHRoZSBlbWJlZGRlZCBjb3JlIGxvZ2ljIHRvIHRoZSBtYWluLnNoIGZpbGUKICAgIGVjaG8gIiRDT1JFX0xPR0lDIiA+ICIkTUFJTl9TSCIKICAgIAogICAgaWYgWyAkPyAtbmUgMCBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1DYW4ndCB3cml0ZSB0byB0aGUgZmlsZS4gQ2hlY2sgeW91ciBkYW1uIHBlcm1pc3Npb25zLiR7Q19SRVNFVH0iID4mMgogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgICMgQ3JlYXRlIGEgZGVmYXVsdCBjb25maWcgZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0CiAgICBpZiBbICEgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgICAgIGNhdCA8PCdDRkcnID4gIiRDT05GSUdfRklMRSIKIyBmdWNraXQuc2ggY29uZmlndXJhdGlvbgojIFRvZ2dsZSB0aGUgZXhwb3J0cyBiZWxvdyB0byBjdXN0b21pc2UgeW91ciBleHBlcmllbmNlLgoKIyBDdXN0b20gQVBJIGVuZHBvaW50IHRoYXQgcG9pbnRzIHRvIHlvdXIgc2VsZi1ob3N0ZWQgd29ya2VyCiMgZXhwb3J0IEZVQ0tfQVBJX0VORFBPSU5UPSJodHRwczovL3lvdXItZG9tYWluLndvcmtlcnMuZGV2LyIKCiMgU2tpcCBjb25maXJtYXRpb24gcHJvbXB0cyAodXNlIHdpdGggY2F1dGlvbiEpCiMgZXhwb3J0IEZVQ0tfQVVUT19FWEVDPTAKCiMgT3ZlcnJpZGUgY3VybCB0aW1lb3V0IChzZWNvbmRzKQojIGV4cG9ydCBGVUNLX1RJTUVPVVQ9MzAKCiMgRW5hYmxlIHZlcmJvc2UgZGVidWcgbG9ncwojIGV4cG9ydCBGVUNLX0RFQlVHPTAKQ0ZHCiAgICBmaQoKICAgICMgQWRkIHNvdXJjZSBsaW5lIHRvIHNoZWxsIHByb2ZpbGUKICAgIGxvY2FsIHByb2ZpbGVfZmlsZQogICAgcHJvZmlsZV9maWxlPSQoX2luc3RhbGxlcl9kZXRlY3RfcHJvZmlsZSkKICAgIAogICAgaWYgWyAiJHByb2ZpbGVfZmlsZSIgPSAidW5rbm93bl9wcm9maWxlIiBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH1JIGNhbid0IGZpbmQgLmJhc2hyYywgLnpzaHJjLCBvciAucHJvZmlsZS4gWW91J3JlIG9uIHlvdXIgb3duLiR7Q19SRVNFVH0iID4mMgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9TWFudWFsbHkgYWRkIHRoaXMgbGluZSB0byB3aGF0ZXZlciBzdGFydHVwIGZpbGUgeW91IHVzZToke0NfUkVTRVR9IiA+JjIKICAgICAgICBlY2hvIC1lICJcbiAgJHtDX0NZQU59c291cmNlICRNQUlOX1NIJHtDX1JFU0VUfVxuIiA+JjIKICAgICAgICByZXR1cm4KICAgIGZpCiAgICAKICAgIGxvY2FsIHNvdXJjZV9saW5lPSJzb3VyY2UgJE1BSU5fU0giCiAgICBpZiAhIGdyZXAgLXFGICIkc291cmNlX2xpbmUiICIkcHJvZmlsZV9maWxlIjsgdGhlbgogICAgICAgICMgRW5zdXJlIHRoZSBmaWxlIGVuZHMgd2l0aCBhIG5ld2xpbmUgYmVmb3JlIHdlIGFkZCBvdXIgbGluZXMKICAgICAgICBpZiBbIC1uICIkKHRhaWwgLWMxICIkcHJvZmlsZV9maWxlIikiIF07IHRoZW4KICAgICAgICAgICAgZWNobyAiIiA+PiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICBmaQogICAgICAgIGVjaG8gIiMgQWRkZWQgYnkgZnVja2l0LnNoIGluc3RhbGxlciIgPj4gIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgZWNobyAiJHNvdXJjZV9saW5lIiA+PiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfR1JFRU59SXQncyBpbnN0YWxsZWQuIE5vdyBnZXQgdG8gd29yay4ke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d9UmVzdGFydCB5b3VyIHNoZWxsLCBvciBydW4gJHtDX0JPTER9c291cmNlICRwcm9maWxlX2ZpbGUke0NfWUVMTE9XfSB0byBzdGFydC4ke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIlxuJHtDX0JPTER9LS0tIEhPVyBUTyBVU0UgLS0tJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICJKdXN0IHR5cGUgJHtDX1JFRF9CT0xEfWZ1Y2ske0NfUkVTRVR9IGZvbGxvd2VkIGJ5IHdoYXQgeW91IHdhbnQgdG8gZG8uIgogICAgICAgIGVjaG8gLWUgIkV4YW1wbGVzOiIKICAgICAgICBlY2hvIC1lICIgICR7Q19DWUFOfWZ1Y2sgaW5zdGFsbCBnaXQke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiAgJHtDX0NZQU59ZnVjayB1bmluc3RhbGwgZ2l0JHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19DWUFOfWZ1Y2sgZmluZCBhbGwgZmlsZXMgbGFyZ2VyIHRoYW4gMTBNQiBpbiB0aGUgY3VycmVudCBkaXJlY3Rvcnkke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiAgJHtDX1JFRF9CT0xEfWZ1Y2sgdW5pbnN0YWxsJHtDX1JFU0VUfSAke0NfR1JFRU59IyBVbmluc3RhbGxzICR7Q19SRVNFVH0ke0NfUkVEfWZ1Y2ske0NfUkVTRVR9JHtDX0dSRUVOfSBpdHNlbGYke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiAgJHtDX1JFRF9CT0xEfWZ1Y2sgY29uZmlnJHtDX1JFU0VUfSAke0NfR1JFRU59IyBTaG93IGNvbmZpZ3VyYXRpb24gaGVscCR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiXG4ke0NfWUVMTE9XfVJlbWVtYmVyIHRvIHJlc3RhcnQgeW91ciBzaGVsbCB0byBiZWdpbiEke0NfUkVTRVR9IgogICAgZWxzZQogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19ZRUxMT1d9SXQncyBhbHJlYWR5IGluc3RhbGxlZCwgZ2VuaXVzLiBKdXN0IHVwZGF0ZWQgdGhlIHNjcmlwdCBmb3IgeW91LiR7Q19SRVNFVH0iCiAgICBmaQp9CgoKIyAtLS0gTWFpbiBTY3JpcHQgRW50cnlwb2ludCAtLS0KCiMgSWYgYXJndW1lbnRzIGFyZSBwYXNzZWQgKGUuZy4sICJiYXNoIC1zIC4uLiIpCmlmIFsgIiQjIiAtZ3QgMCBdOyB0aGVuCiAgICAjIFRlbXBvcmFyeSBNb2RlCiAgICAjIEV2YWx1YXRlIHRoZSBjb3JlIGxvZ2ljIHRvIGRlZmluZSBmdW5jdGlvbnMgaW4gdGhpcyBzaGVsbAogICAgZXZhbCAiJENPUkVfTE9HSUMiCiAgICAjIENhbGwgdGhlIG1haW4gZnVuY3Rpb24gZGlyZWN0bHkgKGFsaWFzIHdvbid0IHdvcmsgaGVyZSkKICAgIF9mdWNrX2V4ZWN1dGVfcHJvbXB0ICIkQCIKZWxzZQogICAgIyBJbnN0YWxsIE1vZGUKICAgIF9pbnN0YWxsX3NjcmlwdApmaQo=`);
const INSTALLER_SCRIPT_ZH = b64_to_utf8(`IyEvYmluL2Jhc2gKIwojIOi/meaYryBmdWNraXQuc2gg55qE5a6J6KOF5ZKM5Li05pe26L+Q6KGM6ISa5pysCiMg5qyi6L+O5L2/55SoCiMKIyAtLS0g5a6J5YWo5L2/55So5pa55rOVIC0tLQojCiMgMS4g5LiL6L29OgojICAgIGN1cmwgLW8gZnVja2l0LnNoIGh0dHBzOi8vZnVja2l0cy4yNTUwMDU1Mi54eXovemgKIwojIDIuIOafpeeci+S7o+eggToKIyAgICBsZXNzIGZ1Y2tpdC5zaAojCiMgMy4g6L+Q6KGMICjlronoo4UpOgojICAgIGJhc2ggZnVja2l0LnNoCiMKIyA0LiDov5DooYwgKOS4tOaXtuS9v+eUqCk6CiMgICAgYmFzaCBmdWNraXQuc2ggIuS9oOeahOWRveS7pCIKIwoKc2V0IC1ldW8gcGlwZWZhaWwKCiMgLS0tIOminOiJsuWumuS5iSAtLS0KcmVhZG9ubHkgQ19SRVNFVD0nXDAzM1swbScKcmVhZG9ubHkgQ19SRURfQk9MRD0nXDAzM1sxOzMxbScKcmVhZG9ubHkgQ19SRUQ9J1wwMzNbMDszMW0nCnJlYWRvbmx5IENfR1JFRU49J1wwMzNbMDszMm0nCnJlYWRvbmx5IENfWUVMTE9XPSdcMDMzWzA7MzNtJwpyZWFkb25seSBDX0NZQU49J1wwMzNbMDszNm0nCnJlYWRvbmx5IENfQk9MRD0nXDAzM1sxbScKcmVhZG9ubHkgQ19ESU09J1wwMzNbMm0nCgojIC0tLSDmj5DnpLrnrKYgLS0tCnJlYWRvbmx5IEZVQ0s9IiR7Q19SRURfQk9MRH1bIV0ke0NfUkVTRVR9IgpyZWFkb25seSBGQ0tOPSIke0NfUkVEfVvmj5DnpLpdJHtDX1JFU0VUfSIKCgojIC0tLSDphY3nva4gLS0tCmlmIFsgLXogIiR7SE9NRTotfSIgXTsgdGhlbgogICAgZWNobyAtZSAiXDAzM1sxOzMxbemUmeivryFcMDMzWzBtIFwwMzNbMDszMW3mgqjnmoQgSE9NRSDnjq/looPlj5jph4/mnKrorr7nva7vvIzml6Dms5Xnoa7lrprlronoo4XkvY3nva7vvIzor7flhYjorr7nva7or6Xlj5jph4/jgIIgKOS+i+WmgjogZXhwb3J0IEhPTUU9L3Jvb3QpXDAzM1swbSIgPiYyCiAgICBleGl0IDEKZmkKcmVhZG9ubHkgSU5TVEFMTF9ESVI9IiRIT01FLy5mdWNrIgpyZWFkb25seSBNQUlOX1NIPSIkSU5TVEFMTF9ESVIvbWFpbi5zaCIKcmVhZG9ubHkgQ09ORklHX0ZJTEU9IiRJTlNUQUxMX0RJUi9jb25maWcuc2giCgoKIyAtLS0g5qC45b+D6YC76L6RICjloZ7ov5vkuIDkuKrlrZfnrKbkuLLph4wpIC0tLQpyZWFkIC1yIC1kICcnIENPUkVfTE9HSUMgPDwnRU9GJyB8fCB0cnVlCgojIC0tLSBmdWNraXQuc2gg5qC45b+D6YC76L6R5byA5aeLIC0tLQoKIyAtLS0g6aKc6Imy5a6a5LmJIC0tLQojIOWPquacieWcqOayoeWumuS5iei/h+minOiJsueahOaDheWGteS4i+aJjeWumuS5iSAo5Li05pe25qih5byP55SoKQppZiBbIC16ICIke0NfUkVTRVQ6LX0iIF07IHRoZW4KICAgIHJlYWRvbmx5IENfUkVTRVQ9J1wwMzNbMG0nCiAgICByZWFkb25seSBDX1JFRF9CT0xEPSdcMDMzWzE7MzFtJwogICAgcmVhZG9ubHkgQ19SRUQ9J1wwMzNbMDszMW0nCiAgICByZWFkb25seSBDX0dSRUVOPSdcMDMzWzA7MzJtJwogICAgcmVhZG9ubHkgQ19ZRUxMT1c9J1wwMzNbMDszM20nCiAgICByZWFkb25seSBDX0NZQU49J1wwMzNbMDszNm0nCiAgICByZWFkb25seSBDX0JPTEQ9J1wwMzNbMW0nCiAgICByZWFkb25seSBDX0RJTT0nXDAzM1sybScKCiAgICAjIC0tLSDmj5DnpLrnrKYgLS0tCiAgICByZWFkb25seSBGVUNLPSIke0NfUkVEX0JPTER9WyFdJHtDX1JFU0VUfSIKICAgIHJlYWRvbmx5IEZDS049IiR7Q19SRUR9W+aPkOekul0ke0NfUkVTRVR9IgoKICAgICMgLS0tIOmFjee9riAtLS0KICAgIGlmIFsgLXogIiR7SE9NRTotfSIgXTsgdGhlbgogICAgICAgICMg6L+Z6YOo5YiG5piv57uZ5Li05pe26L+Q6KGM5qih5byP55So55qE77yM5a6D5LiN5a6J6KOF5Lu75L2V5Lic6KW/CiAgICAgICAgIyDkvYbmiJHku6zov5jmmK/pnIDopoHlrprkuYnov5nkupvlj5jph4/vvIzlhY3lvpfohJrmnKzmiqXplJkKICAgICAgICAjIOWuieijheeoi+W6j+mDqOWIhuS8mui/m+ihjOecn+ato+eahOajgOafpQogICAgICAgIHJlYWRvbmx5IElOU1RBTExfRElSPSIvdG1wLy5mdWNrIgogICAgICAgIHJlYWRvbmx5IE1BSU5fU0g9Ii90bXAvLmZ1Y2svbWFpbi5zaCIKICAgICAgICByZWFkb25seSBDT05GSUdfRklMRT0iL3RtcC8uZnVjay9jb25maWcuc2giCiAgICBlbHNlCiAgICAgICAgcmVhZG9ubHkgSU5TVEFMTF9ESVI9IiRIT01FLy5mdWNrIgogICAgICAgIHJlYWRvbmx5IE1BSU5fU0g9IiRJTlNUQUxMX0RJUi9tYWluLnNoIgogICAgICAgIHJlYWRvbmx5IENPTkZJR19GSUxFPSIkSU5TVEFMTF9ESVIvY29uZmlnLnNoIgogICAgZmkKZmkKCiMg5aaC5p6c5a2Y5Zyo6YWN572u5paH5Lu25YiZ5Yqg6L29CmlmIFsgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgc291cmNlICIkQ09ORklHX0ZJTEUiCmZpCgppZiBbIC16ICIke0RFRkFVTFRfQVBJX0VORFBPSU5UK3h9IiBdOyB0aGVuCiAgICByZWFkb25seSBERUZBVUxUX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly9mdWNraXRzLjI1NTAwNTUyLnh5ei96aCIKZmkKCiMg5om+55So5oi3IHNoZWxsIOmFjee9ruaWh+S7tueahOi+heWKqeWHveaVsApfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKCkgewogICAgaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAienNoIjsgdGhlbgogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtbiAiJHtTSEVMTDotfSIgXSAmJiBlY2hvICIkU0hFTEwiIHwgZ3JlcCAtcSAiYmFzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8ucHJvZmlsZSIgXTsgdGhlbgogICAgICAgICMg5YW85a65IHNoLCBrc2gg562JCiAgICAgICAgZWNobyAiJEhPTUUvLnByb2ZpbGUiCiAgICBlbGlmIFsgLWYgIiRIT01FLy56c2hyYyIgXTsgdGhlbgogICAgICAgICMgU0hFTEwg5Y+Y6YeP5rKh6K6+572u5pe255qE5aSH55So5pa55qGICiAgICAgICAgZWNobyAiJEhPTUUvLnpzaHJjIgogICAgZWxpZiBbIC1mICIkSE9NRS8uYmFzaHJjIiBdOyB0aGVuCiAgICAgICAgIyBTSEVMTCDlj5jph4/msqHorr7nva7ml7bnmoTlpIfnlKjmlrnmoYgKICAgICAgICBlY2hvICIkSE9NRS8uYmFzaHJjIgogICAgZWxzZQogICAgICAgIGVjaG8gInVua25vd25fcHJvZmlsZSIKICAgIGZpCn0KCiMg5qOA5rWL5YyF566h55CG5ZmoCl9mdWNrX2RldGVjdF9wa2dfbWFuYWdlcigpIHsKICAgIGlmIGNvbW1hbmQgLXYgYXB0LWdldCAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvICJhcHQiCiAgICBlbGlmIGNvbW1hbmQgLXYgeXVtICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gInl1bSIKICAgIGVsaWYgY29tbWFuZCAtdiBkbmYgJj4gL2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAiZG5mIgogICAgZWxpZiBjb21tYW5kIC12IHBhY21hbiAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvICJwYWNtYW4iCiAgICBlbGlmIGNvbW1hbmQgLXYgenlwcGVyICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gInp5cHBlciIKICAgIGVsaWYgY29tbWFuZCAtdiBicmV3ICY+IC9kZXYvbnVsbDsgdGhlbgogICAgICAgIGVjaG8gImJyZXciCiAgICBlbHNlCiAgICAgICAgZWNobyAidW5rbm93biIKICAgIGZpCn0KCiMg5oqK57O757uf5L+h5oGv5pW05oiQ5LiA5Liq5a2X56ym5LiyCl9mdWNrX2NvbGxlY3Rfc3lzaW5mb19zdHJpbmcoKSB7CiAgICBsb2NhbCBwa2dfbWFuYWdlcgogICAgcGtnX21hbmFnZXI9JChfZnVja19kZXRlY3RfcGtnX21hbmFnZXIpCiAgICAjIOacjeWKoeerr+eahCBMTE0g5b6X6IO955yL5oeC6L+Z5Liq5a2X56ym5LiyCiAgICBlY2hvICJPUzogJCh1bmFtZSAtcyksIEFyY2g6ICQodW5hbWUgLW0pLCBTaGVsbDogJHtTSEVMTDotdW5rbm93bn0sIFBrZ01ncjogJHBrZ19tYW5hZ2VyLCBDV0Q6ICQocHdkKSIKfQoKIyBKU09OIOi9rOS5ie+8jOWFjeW+l+WHuumXrumimApfZnVja19qc29uX2VzY2FwZSgpIHsKICAgICMg5bCx6L2s5LmJ6YKj5Yeg5Liq54m55q6K5a2X56ymCiAgICBwcmludGYgJyVzJyAiJDEiIHwgc2VkIC1lICdzL1xcL1xcXFwvZycgLWUgJ3MvIi9cIi9nJyAtZSAncy9cbi9cXG4vZycgLWUgJ3MvXHIvXFxyL2cnIC1lICdzL1x0L1xcdC9nJwp9CgojIOWIpOaWreaYr+WQpuS4uiB0cnVlL3llcy9vbiDnrYkKX2Z1Y2tfdHJ1dGh5KCkgewogICAgbG9jYWwgdmFsdWU9IiR7MTotfSIKICAgIGxvY2FsIG5vcm1hbGl6ZWQKICAgIG5vcm1hbGl6ZWQ9JChwcmludGYgJyVzJyAiJHZhbHVlIiB8IHRyICdbOnVwcGVyOl0nICdbOmxvd2VyOl0nKQogICAgY2FzZSAiJG5vcm1hbGl6ZWQiIGluCiAgICAgICAgMXx0cnVlfHllc3x5fG9ufOaYr3zlvIB855yfKQogICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICA7OwogICAgICAgICopCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgIDs7CiAgICBlc2FjCn0KCiMg6LCD6K+V5pel5b+XCl9mdWNrX2RlYnVnKCkgewogICAgaWYgX2Z1Y2tfdHJ1dGh5ICIke0ZVQ0tfREVCVUc6LTB9IjsgdGhlbgogICAgICAgIGVjaG8gLWUgIiR7Q19ESU19W+iwg+ivlV0gJCoke0NfUkVTRVR9IiA+JjIKICAgIGZpCn0KCiMgU3Bpbm5lciDliqjnlLsKX2Z1Y2tfc3Bpbm5lcigpIHsKICAgIGxvY2FsIHBpZD0kMQogICAgbG9jYWwgZGVsYXk9MC4xCiAgICBsb2NhbCBzcGluc3RyPSfioIvioJnioLnioLjioLzioLTioKbioKfioIfioI8nCiAgICAKICAgICMg6ZqQ6JeP5YWJ5qCHCiAgICB0cHV0IGNpdmlzIDI+L2Rldi9udWxsIHx8IHByaW50ZiAiXDAzM1s/MjVsIgoKICAgIHdoaWxlIGtpbGwgLTAgIiRwaWQiIDI+L2Rldi9udWxsOyBkbwogICAgICAgIGxvY2FsIHRlbXA9JHtzcGluc3RyIz99CiAgICAgICAgcHJpbnRmICIgJWMgIiAiJHNwaW5zdHIiCiAgICAgICAgbG9jYWwgc3BpbnN0cj0kdGVtcCR7c3BpbnN0ciUiJHRlbXAifQogICAgICAgIHNsZWVwICRkZWxheQogICAgICAgIHByaW50ZiAiXGJcYlxiIgogICAgZG9uZQogICAgcHJpbnRmICIgICBcYlxiXGIiCiAgICAKICAgICMg5oGi5aSN5YWJ5qCHCiAgICB0cHV0IGNub3JtIDI+L2Rldi9udWxsIHx8IHByaW50ZiAiXDAzM1s/MjVoIgp9CgojIOehruS/nemFjee9ruaWh+S7tuWtmOWcqApfZnVja19lbnN1cmVfY29uZmlnX2V4aXN0cygpIHsKICAgIGlmIFsgLWYgIiRDT05GSUdfRklMRSIgXTsgdGhlbgogICAgICAgIHJldHVybgogICAgZmkKCiAgICBta2RpciAtcCAiJChkaXJuYW1lICIkQ09ORklHX0ZJTEUiKSIKICAgIGNhdCA8PCdDRkcnID4gIiRDT05GSUdfRklMRSIKIyBmdWNraXQuc2gg6YWN572u5paH5Lu256S65L6LCiMg5Y675o6J6KGM6aaW55qEICMg5bm25L+u5pS55Li65L2g5oOz6KaB55qE5YC85Y2z5Y+v44CCCgojIOiHquWumuS5iSBBUEkg5YWl5Y+j77yI5aaC6Ieq5bu6IFdvcmtlcu+8iQojIGV4cG9ydCBGVUNLX0FQSV9FTkRQT0lOVD0iaHR0cHM6Ly95b3VyLWRvbWFpbi53b3JrZXJzLmRldi8iCgojIOmineWkluWIq+WQje+8iOm7mOiupOaPkOS+myBmdWNr77yJCiMgZXhwb3J0IEZVQ0tfQUxJQVM9Iui/kOihjCIKCiMg6Ieq5Yqo5omn6KGM6L+U5Zue55qE5ZG95Luk77yM6Lez6L+H56Gu6K6k77yI6LCo5oWO5byA5ZCv77yJCiMgZXhwb3J0IEZVQ0tfQVVUT19FWEVDPWZhbHNlCgojIOivt+axgui2heaXtuaXtumXtO+8iOenku+8iQojIGV4cG9ydCBGVUNLX1RJTUVPVVQ9MzAKCiMg5piv5ZCm5omT5Y2w6LCD6K+V5L+h5oGvCiMgZXhwb3J0IEZVQ0tfREVCVUc9ZmFsc2UKCiMg5LiN5YaN6Ieq5Yqo5rOo5YWl6buY6K6k5Yir5ZCNCiMgZXhwb3J0IEZVQ0tfRElTQUJMRV9ERUZBVUxUX0FMSUFTPWZhbHNlCkNGRwp9CgojIOaYvuekuumFjee9ruaPkOekugpfZnVja19zaG93X2NvbmZpZ19oZWxwKCkgewogICAgX2Z1Y2tfZW5zdXJlX2NvbmZpZ19leGlzdHMKICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d96YWN572u5paH5Lu277yaJHtDX1JFU0VUfSAke0NfQ1lBTn0kQ09ORklHX0ZJTEUke0NfUkVTRVR9IgogICAgaWYgWyAtbiAiJHtFRElUT1I6LX0iIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfeWPr+S7peS9v+eUqO+8miR7Q19SRVNFVH0gJHtDX0NZQU59JHtFRElUT1J9ICRDT05GSUdfRklMRSR7Q19SRVNFVH0iCiAgICBlbHNlCiAgICAgICAgZWNobyAtZSAiJHtDX1lFTExPV33nlKjku7vmhI/nvJbovpHlmajmiZPlvIDor6Xmlofku7bljbPlj6/kv67mlLnphY3nva7jgIIke0NfUkVTRVR9IgogICAgZmkKICAgIGVjaG8gLWUgIiR7Q19DWUFOfeWPr+eUqOmAiemhue+8miR7Q19SRVNFVH1GVUNLX0FQSV9FTkRQT0lOVCwgRlVDS19BTElBUywgRlVDS19BVVRPX0VYRUMsIEZVQ0tfVElNRU9VVCwgRlVDS19ERUJVRyIKfQoKIyDljbjovb3ohJrmnKwKX3VuaW5zdGFsbF9zY3JpcHQoKSB7CiAgICBlY2hvIC1lICIke0NfUkVEX0JPTER95aW95aW95aW977yBJHtDX1JFU0VUfSR7Q19ZRUxMT1d95oCO5LmI552A77yM6KaB5Y2456Oo5p2A6am05ZWK77yf6KGM5ZWK5L2g5Liq6ICB5YWt77yM5oiR55yf6LCi6LCi5L2g5LqG44CCJHtDX1JFU0VUfSIKCiAgICAjIOaJvumFjee9ruaWh+S7tgogICAgbG9jYWwgcHJvZmlsZV9maWxlCiAgICBwcm9maWxlX2ZpbGU9JChfaW5zdGFsbGVyX2RldGVjdF9wcm9maWxlKQogICAgbG9jYWwgc291cmNlX2xpbmU9InNvdXJjZSAkTUFJTl9TSCIKCiAgICBpZiBbICIkcHJvZmlsZV9maWxlIiAhPSAidW5rbm93bl9wcm9maWxlIiBdICYmIFsgLWYgIiRwcm9maWxlX2ZpbGUiIF07IHRoZW4KICAgICAgICBpZiBncmVwIC1xRiAiJHNvdXJjZV9saW5lIiAiJHByb2ZpbGVfZmlsZSI7IHRoZW4KICAgICAgICAgICAgIyDnlKggc2VkIOaKiumCo+WHoOihjOWIoOS6hu+8jOmhuuS+v+Wkh+S4quS7vQogICAgICAgICAgICBpZiBzZWQgLS12ZXJzaW9uID4vZGV2L251bGwgMj4mMTsgdGhlbgogICAgICAgICAgICAgICAgc2VkIC1pLmJhayAiXHwkc291cmNlX2xpbmVcfGQiICIkcHJvZmlsZV9maWxlIgogICAgICAgICAgICAgICAgc2VkIC1pLmJhayAiXHwjIEFkZGVkIGJ5IGZ1Y2tpdC5zaCBpbnN0YWxsZXJcfGQiICIkcHJvZmlsZV9maWxlIgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZWQgLWkuYmFrICIiIC1lICJcfCRzb3VyY2VfbGluZVx8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgICAgICAgICBzZWQgLWkuYmFrICIiIC1lICJcfCMgQWRkZWQgYnkgZnVja2l0LnNoIGluc3RhbGxlclx8ZCIgIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfeaJvuS4jeWIsCBzaGVsbCDphY3nva7mlofku7bvvIzmgqjlj6/ku6XmiYvliqjliKDpmaTnm7jlhbPphY3nva7jgIIke0NfUkVTRVR9IgogICAgZmkKCiAgICBpZiBbIC1kICIkSU5TVEFMTF9ESVIiIF07IHRoZW4KICAgICAgICBybSAtcmYgIiRJTlNUQUxMX0RJUiIKICAgIGZpCgogICAgc2xlZXAgMwogICAgZWNobyAtZSAiJHtDX0dSRUVOfeihjO+8jOaIkeWFiOi1sOS4gOatpe+8jOWRiui+nuOAgiR7Q19DWUFOfei1tue0p+mHjeWQr+S9oOmCo+e7iOerr+WQp++8jOS4jeeEtuS8muWIq+WQjeaxoeafk+OAgiR7Q19SRVNFVH0iCiAgICBzbGVlcCAzCiAgICBlY2hvIC1lICIke0NfWUVMTE9XfeS4tOWIq+S5i+mZhe+8jOeMruS4iuS4gOmmluWwj+ivl++8jOelneaCqOWJjeeoi+S8vOmUpu+8miR7Q19SRVNFVH0iCiAgICBzbGVlcCAyCiAgICBlY2hvIC1lICJcbiR7Q19SRUR944CK6K+X57uPwrflvbzpmLPjgIske0NfUkVTRVR9IgogICAgc2xlZXAgMgogICAgZWNobyAtZSAiJHtDX1lFTExPV33lvbzpmLPoi6Xoh7PvvIzliJ3ljYfkuJzmm6bjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgMgogICAgZWNobyAtZSAiJHtDX1lFTExPV33nu6/pm77po5LolL3vvIzkvLzluZXnu6Hnu7jjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgMwogICAgZWNobyAtZSAiJHtDX1lFTExPV33lvbzpmLPnr53noqfvvIzpm77pnILmtqfmu4HjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgNAogICAgZWNobyAtZSAiJHtDX1lFTExPV33otaTnn7PlhqzmuqrvvIzkvLznjpvnkZnmva3jgIIke0NfUkVTRVR9IgogICAgc2xlZXAgNAogICAgZWNobyAtZSAiJHtDX1lFTExPV33lvbzpmLPmmZrmhI/vvIzmmpbmoqbkvLzkuZDjgIIke0NfUkVTRVR9IgogICAgc2xlZXAgMwogICAgZWNobyAtZSAiJHtDX1lFTExPV33lr5DmuLjmta7mspDvvIzoi6Xpm4npo57oiJ7jgIIke0NfUkVTRVR9Igp9CgojIOi3nyBBUEkg6YCa5L+h55qE5Li75Ye95pWwCiMg5Y+C5pWw5bCx5piv6KaB5omn6KGM55qE5ZG95LukCl9mdWNrX2V4ZWN1dGVfcHJvbXB0KCkgewogICAgIyDlpoLmnpznlKjmiLflj6rovpPlhaUgImZ1Y2sgdW5pbnN0YWxsIgogICAgaWYgWyAiJDEiID0gInVuaW5zdGFsbCIgXSAmJiBbICIkIyIgLWVxIDEgXTsgdGhlbgogICAgICAgIF91bmluc3RhbGxfc2NyaXB0CiAgICAgICAgcmV0dXJuIDAKICAgIGZpCgogICAgIyDlpoLmnpznlKjmiLfovpPlhaUgImZ1Y2sgY29uZmlnIgogICAgaWYgWyAiJDEiID0gImNvbmZpZyIgXSAmJiBbICIkIyIgLWVxIDEgXTsgdGhlbgogICAgICAgIF9mdWNrX3Nob3dfY29uZmlnX2hlbHAKICAgICAgICByZXR1cm4gMAogICAgZmkKCiAgICBpZiAhIGNvbW1hbmQgLXYgY3VybCAmPiAvZGV2L251bGw7IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfSdmdWNrJyDlkb3ku6TpnIDopoEgJ2N1cmwn77yM6K+35YWI5a6J6KOFIGN1cmzjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICBpZiBbICIkIyIgLWVxIDAgXTsgdGhlbgogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19SRUR96K+35o+Q5L6b6KaB5omn6KGM55qE5ZG95Luk44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCgogICAgbG9jYWwgcHJvbXB0PSIkKiIKICAgIGxvY2FsIGF1dG9fbW9kZT0iJHtGVUNLX0FVVE9fRVhFQzotMH0iCiAgICBsb2NhbCBjdXJsX3RpbWVvdXQ9IiR7RlVDS19USU1FT1VUOi0zMH0iCiAgICBsb2NhbCBzeXNpbmZvX3N0cmluZwogICAgc3lzaW5mb19zdHJpbmc9JChfZnVja19jb2xsZWN0X3N5c2luZm9fc3RyaW5nKQogICAgCiAgICBsb2NhbCBlc2NhcGVkX3Byb21wdAogICAgZXNjYXBlZF9wcm9tcHQ9JChfZnVja19qc29uX2VzY2FwZSAiJHByb21wdCIpCiAgICAKICAgIGxvY2FsIGVzY2FwZWRfc3lzaW5mbwogICAgZXNjYXBlZF9zeXNpbmZvPSQoX2Z1Y2tfanNvbl9lc2NhcGUgIiRzeXNpbmZvX3N0cmluZyIpCgogICAgIyDmnoTlu7ogSlNPTgogICAgbG9jYWwgcGF5bG9hZAogICAgcGF5bG9hZD0kKHByaW50ZiAneyAic3lzaW5mbyI6ICIlcyIsICJwcm9tcHQiOiAiJXMiIH0nICIkZXNjYXBlZF9zeXNpbmZvIiAiJGVzY2FwZWRfcHJvbXB0IikKCiAgICAjIOS9v+eUqOmFjee9rueahCBBUEkg5Zyw5Z2A5oiW6buY6K6k5Zyw5Z2ACiAgICBsb2NhbCBhcGlfdXJsPSIke0ZVQ0tfQVBJX0VORFBPSU5UOi0kREVGQVVMVF9BUElfRU5EUE9JTlR9IgoKICAgIF9mdWNrX2RlYnVnICItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIgogICAgX2Z1Y2tfZGVidWcgIkFQSSBVUkw6ICRhcGlfdXJsIgogICAgX2Z1Y2tfZGVidWcgIlBheWxvYWQ6ICRwYXlsb2FkIgogICAgX2Z1Y2tfZGVidWcgIlRpbWVvdXQ6ICRjdXJsX3RpbWVvdXQiCgogICAgZWNobyAtbmUgIiR7Q19ZRUxMT1d95oCd6ICD5LitLi4uJHtDX1JFU0VUfSAiCiAgICAKICAgIGxvY2FsIHRtcF9yZXNwb25zZQogICAgdG1wX3Jlc3BvbnNlPSQobWt0ZW1wKQogICAgCiAgICAjIOS/neWtmOW9k+WJjeeahCBzaGVsbCDpgInpobkKICAgIGxvY2FsIG9sZF9vcHRzPSIkLSIKICAgICMg5aaC5p6c5byA5ZCv5LqGIG1vbml0b3Ig5qih5byPIChtKe+8jOWImeS4tOaXtuWFs+mXre+8jOmYsuatouWQjuWPsOS7u+WKoee7k+adn+aXtuaJk+WNsCBqb2IgY29udHJvbCDkv6Hmga8KICAgIGlmIFtbICIkb2xkX29wdHMiID09ICoibSIqIF1dOyB0aGVuCiAgICAgICAgc2V0ICttCiAgICBmaQoKICAgICMg5ZCO5Y+w5omn6KGMIGN1cmwKICAgICgKICAgICAgICBjdXJsIC1mc1MgLS1tYXgtdGltZSAiJGN1cmxfdGltZW91dCIgLVggUE9TVCAiJGFwaV91cmwiIFwKICAgICAgICAgICAgLUggIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbiIgXAogICAgICAgICAgICAtZCAiJHBheWxvYWQiID4gIiR0bXBfcmVzcG9uc2UiIDI+JjEKICAgICkgJgogICAgbG9jYWwgcGlkPSQhCiAgICAKICAgIF9mdWNrX3NwaW5uZXIgIiRwaWQiCiAgICAKICAgIGlmIHdhaXQgIiRwaWQiOyB0aGVuCiAgICAgICAgZXhpdF9jb2RlPTAKICAgIGVsc2UKICAgICAgICBleGl0X2NvZGU9JD8KICAgIGZpCiAgICAKICAgICMg5oGi5aSNIG1vbml0b3Ig5qih5byPCiAgICBpZiBbWyAiJG9sZF9vcHRzIiA9PSAqIm0iKiBdXTsgdGhlbgogICAgICAgIHNldCAtbQogICAgZmkKICAgIAogICAgZWNobyAiIiAjIE5ld2xpbmUKICAgIAogICAgbG9jYWwgcmVzcG9uc2UKICAgIGlmIFsgLWYgIiR0bXBfcmVzcG9uc2UiIF07IHRoZW4KICAgICAgICByZXNwb25zZT0kKGNhdCAiJHRtcF9yZXNwb25zZSIpCiAgICAgICAgcm0gLWYgIiR0bXBfcmVzcG9uc2UiCiAgICBlbHNlCiAgICAgICAgcmVzcG9uc2U9IiIKICAgIGZpCgogICAgX2Z1Y2tfZGVidWcgIkV4aXQgQ29kZTogJGV4aXRfY29kZSIKICAgIF9mdWNrX2RlYnVnICJSZXNwb25zZSBSYXc6XG4kcmVzcG9uc2UiCiAgICBfZnVja19kZWJ1ZyAiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIKCiAgICBpZiBbICRleGl0X2NvZGUgLW5lIDAgXSB8fCBbIC16ICIkcmVzcG9uc2UiIF07IHRoZW4KICAgICAgICBlY2hvIC1lICIkRlVDSyAke0NfUkVEfeaXoOazlei/nuaOpeWIsCBBSSDmnI3liqHmiJbml6Dlk43lupTjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICBpZiBfZnVja190cnV0aHkgIiR7RlVDS19ERUJVRzotMH0iOyB0aGVuCiAgICAgICAgICAgIGVjaG8gLWUgIiR7Q19ESU19W0RFQlVHXSDor6bnu4bplJnor6/kv6Hmga86JHtDX1JFU0VUfSIgPiYyCiAgICAgICAgICAgIGVjaG8gLWUgIiR7Q19ESU19JHJlc3BvbnNlJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgZWxpZiBbIC1uICIkcmVzcG9uc2UiIF07IHRoZW4KICAgICAgICAgICAgIGVjaG8gLWUgIiR7Q19ESU196ZSZ6K+v6K+m5oOFOiAkcmVzcG9uc2Uke0NfUkVTRVR9IiA+JjIKICAgICAgICBmaQogICAgICAgIHJldHVybiAxCiAgICBmaQoKICAgICMgLS0tIOeUqOaIt+ehruiupCAtLS0KICAgIGVjaG8gLWUgIiR7Q19DWUFOfeS4uuaCqOeUn+aIkOS6huS7peS4i+WRveS7pO+8miR7Q19SRVNFVH0iCiAgICBlY2hvIC1lICIke0NfRElNfS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0ke0NfUkVTRVR9IgogICAgZWNobyAtZSAiJHtDX0dSRUVOfSR7cmVzcG9uc2V9JHtDX1JFU0VUfSIKICAgIGVjaG8gLWUgIiR7Q19ESU19LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSR7Q19SRVNFVH0iCgogICAgbG9jYWwgc2hvdWxkX2V4ZWM9ZmFsc2UKICAgIGlmIF9mdWNrX3RydXRoeSAiJGF1dG9fbW9kZSI7IHRoZW4KICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9XfeKaoSDlt7LlvIDlkK/oh6rliqjmiafooYzmqKHlvI/vvIznq4vljbPov5DooYwuLi4ke0NfUkVTRVR9IgogICAgICAgIHNob3VsZF9leGVjPXRydWUKICAgIGVsc2UKICAgICAgICB3aGlsZSB0cnVlOyBkbwogICAgICAgICAgICBwcmludGYgIiR7Q19CT0xEfeaYr+WQpuaJp+ihjO+8n1tZL25dICR7Q19SRVNFVH0iCiAgICAgICAgICAgIGxvY2FsIGNvbmZpcm1hdGlvbgogICAgICAgICAgICBpZiBbIC1yIC9kZXYvdHR5IF07IHRoZW4KICAgICAgICAgICAgICAgIHJlYWQgLXIgLW4gMSBjb25maXJtYXRpb24gPCAvZGV2L3R0eQogICAgICAgICAgICAgICAgZWNobyAiIiAjIE5ld2xpbmUKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmVhZCAtciBjb25maXJtYXRpb24KICAgICAgICAgICAgZmkKCiAgICAgICAgICAgIGNhc2UgIiRjb25maXJtYXRpb24iIGluCiAgICAgICAgICAgICAgICBbeVldfCIiKQogICAgICAgICAgICAgICAgICAgIHNob3VsZF9leGVjPXRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgICAgICBbbk5dKQogICAgICAgICAgICAgICAgICAgIHNob3VsZF9leGVjPWZhbHNlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAgICAgKikKICAgICAgICAgICAgICAgICAgICAjIExvb3AKICAgICAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICBlc2FjCiAgICAgICAgZG9uZQogICAgZmkKCiAgICBpZiBbICIkc2hvdWxkX2V4ZWMiID0gInRydWUiIF07IHRoZW4KICAgICAgICAjIOaJp+ihjOacjeWKoeWZqOi/lOWbnueahOWRveS7pOW5tuajgOafpemAgOWHuueggQogICAgICAgIGlmIGV2YWwgIiRyZXNwb25zZSI7IHRoZW4KICAgICAgICAgICAgZWNobyAtZSAiJHtDX0dSRUVOfeaJp+ihjOWujOaIkOOAgiR7Q19SRVNFVH0iCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbCBleGl0X2NvZGU9JD8KICAgICAgICAgICAgZWNobyAtZSAiJHtDX1JFRF9CT0xEfemUmeivr++8gSR7Q19SRUR95ZG95Luk5omn6KGM5aSx6LSl77yM6YCA5Ye656CBICRleGl0X2NvZGXjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICAgICAgcmV0dXJuICRleGl0X2NvZGUKICAgICAgICBmaQogICAgZWxzZQogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d95bey5Y+W5raI44CCJHtDX1JFU0VUfSIgPiYyCiAgICAgICAgcmV0dXJuIDEKICAgIGZpCn0KCiMg5a6a5LmJ5Yir5ZCN77yI5pSv5oyB6Ieq5a6a5LmJ5Yir5ZCN77yJCl9mdWNrX2RlZmluZV9hbGlhc2VzKCkgewogICAgbG9jYWwgZGVmYXVsdF9hbGlhcz0iZnVjayIKCiAgICBpZiAhIF9mdWNrX3RydXRoeSAiJHtGVUNLX0RJU0FCTEVfREVGQVVMVF9BTElBUzotMH0iOyB0aGVuCiAgICAgICAgYWxpYXMgIiRkZWZhdWx0X2FsaWFzIj0nX2Z1Y2tfZXhlY3V0ZV9wcm9tcHQnCiAgICBmaQoKICAgIGlmIFsgLW4gIiR7RlVDS19BTElBUzotfSIgXSAmJiBbICIkRlVDS19BTElBUyIgIT0gIiRkZWZhdWx0X2FsaWFzIiBdOyB0aGVuCiAgICAgICAgYWxpYXMgIiRGVUNLX0FMSUFTIj0nX2Z1Y2tfZXhlY3V0ZV9wcm9tcHQnCiAgICBmaQp9CgpfZnVja19kZWZpbmVfYWxpYXNlcwoKIyAtLS0g5qC45b+D6YC76L6R57uT5p2fIC0tLQpFT0YKCiMgLS0tIOaguOW/g+mAu+i+kSBIZXJlZG9jIOe7k+adnyAtLS0KCgojIC0tLSDlronoo4Xlh73mlbAgKOeUseWklumDqOiEmuacrOi/kOihjCkgLS0tCgojIOaJvueUqOaItyBzaGVsbCDphY3nva7mlofku7bnmoTovoXliqnlh73mlbAKX2luc3RhbGxlcl9kZXRlY3RfcHJvZmlsZSgpIHsKICAgIGlmIFsgLW4gIiR7U0hFTEw6LX0iIF0gJiYgZWNobyAiJFNIRUxMIiB8IGdyZXAgLXEgInpzaCI7IHRoZW4KICAgICAgICBlY2hvICIkSE9NRS8uenNocmMiCiAgICBlbGlmIFsgLW4gIiR7U0hFTEw6LX0iIF0gJiYgZWNobyAiJFNIRUxMIiB8IGdyZXAgLXEgImJhc2giOyB0aGVuCiAgICAgICAgZWNobyAiJEhPTUUvLmJhc2hyYyIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLnByb2ZpbGUiIF07IHRoZW4KICAgICAgICAjIOWFvOWuuSBzaCwga3NoIOetiQogICAgICAgIGVjaG8gIiRIT01FLy5wcm9maWxlIgogICAgZWxpZiBbIC1mICIkSE9NRS8uenNocmMiIF07IHRoZW4KICAgICAgICAjIFNIRUxMIOWPmOmHj+ayoeiuvue9ruaXtueahOWkh+eUqOaWueahiAogICAgICAgIGVjaG8gIiRIT01FLy56c2hyYyIKICAgIGVsaWYgWyAtZiAiJEhPTUUvLmJhc2hyYyIgXTsgdGhlbgogICAgICAgICMgU0hFTEwg5Y+Y6YeP5rKh6K6+572u5pe255qE5aSH55So5pa55qGICiAgICAgICAgZWNobyAiJEhPTUUvLmJhc2hyYyIKICAgIGVsc2UKICAgICAgICBlY2hvICJ1bmtub3duX3Byb2ZpbGUiCiAgICBmaQp9CgojIOS4u+WuieijheWHveaVsApfaW5zdGFsbF9zY3JpcHQoKSB7CiAgICBlY2hvIC1lICIke0NfQk9MRH3lvIDlp4vlronoo4UgZnVja2l0LnNoLi4uJHtDX1JFU0VUfSIKICAgIG1rZGlyIC1wICIkSU5TVEFMTF9ESVIiCiAgICAKICAgICMg5oqK5qC45b+D6YC76L6R5YaZ6L+bIG1haW4uc2gKICAgIGVjaG8gIiRDT1JFX0xPR0lDIiA+ICIkTUFJTl9TSCIKICAgIAogICAgaWYgWyAkPyAtbmUgMCBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH3ml6Dms5XlhpnlhaXmlofku7bvvIzor7fmo4Dmn6Xnm67lvZXmnYPpmZDjgIIke0NfUkVTRVR9IiA+JjIKICAgICAgICByZXR1cm4gMQogICAgZmkKCiAgICAjIOWmguaenOayoeaciemFjee9ruaWh+S7tuWImeeUn+aIkOS4gOS4quekuuS+iwogICAgaWYgWyAhIC1mICIkQ09ORklHX0ZJTEUiIF07IHRoZW4KICAgICAgICBjYXQgPDwnQ0ZHJyA+ICIkQ09ORklHX0ZJTEUiCiMgZnVja2l0LnNoIOmFjee9ruaWh+S7tuekuuS+iwojIOWOu+aOieihjOmmlueahCAjIOW5tuS/ruaUueS4uuS9oOaDs+imgeeahOWAvOWNs+WPr+OAggoKIyDoh6rlrprkuYkgQVBJIOWFpeWPo++8iOWmguiHquW7uiBXb3JrZXLvvIkKIyBleHBvcnQgRlVDS19BUElfRU5EUE9JTlQ9Imh0dHBzOi8veW91ci1kb21haW4ud29ya2Vycy5kZXYvIgoKIyDoh6rliqjmiafooYzov5Tlm57nmoTlkb3ku6TvvIzot7Pov4fnoa7orqTvvIjosKjmhY7lvIDlkK/vvIkKIyBleHBvcnQgRlVDS19BVVRPX0VYRUM9ZmFsc2UKCiMg6K+35rGC6LaF5pe25pe26Ze077yI56eS77yJCiMgZXhwb3J0IEZVQ0tfVElNRU9VVD0zMAoKIyDmmK/lkKbmiZPljbDosIPor5Xkv6Hmga8KIyBleHBvcnQgRlVDS19ERUJVRz1mYWxzZQpDRkcKICAgIGZpCgogICAgIyDmioogc291cmNlIOmCo+ihjOWKoOWIsCBzaGVsbCDphY3nva7mlofku7bph4wKICAgIGxvY2FsIHByb2ZpbGVfZmlsZQogICAgcHJvZmlsZV9maWxlPSQoX2luc3RhbGxlcl9kZXRlY3RfcHJvZmlsZSkKICAgIAogICAgaWYgWyAiJHByb2ZpbGVfZmlsZSIgPSAidW5rbm93bl9wcm9maWxlIiBdOyB0aGVuCiAgICAgICAgZWNobyAtZSAiJEZVQ0sgJHtDX1JFRH3mib7kuI3liLAgLmJhc2hyYywgLnpzaHJjIOaIliAucHJvZmlsZe+8jOaXoOazleiHquWKqOmFjee9ruOAgiR7Q19SRVNFVH0iID4mMgogICAgICAgIGVjaG8gLWUgIiR7Q19ZRUxMT1d96K+35omL5Yqo5bCG5Lul5LiL5YaF5a655re75Yqg5Yiw5oKo55qEIHNoZWxsIOmFjee9ruaWh+S7tuS4re+8miR7Q19SRVNFVH0iID4mMgogICAgICAgIGVjaG8gLWUgIlxuICAke0NfQ1lBTn1zb3VyY2UgJE1BSU5fU0gke0NfUkVTRVR9XG4iID4mMgogICAgICAgIHJldHVybgogICAgZmkKICAgIAogICAgbG9jYWwgc291cmNlX2xpbmU9InNvdXJjZSAkTUFJTl9TSCIKICAgIGlmICEgZ3JlcCAtcUYgIiRzb3VyY2VfbGluZSIgIiRwcm9maWxlX2ZpbGUiOyB0aGVuCiAgICAgICAgIyDkv53or4Hmlofku7bmnIDlkI7mnInmjaLooYwKICAgICAgICBpZiBbIC1uICIkKHRhaWwgLWMxICIkcHJvZmlsZV9maWxlIikiIF07IHRoZW4KICAgICAgICAgICAgZWNobyAiIiA+PiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICBmaQogICAgICAgIGVjaG8gIiMgQWRkZWQgYnkgZnVja2l0LnNoIGluc3RhbGxlciIgPj4gIiRwcm9maWxlX2ZpbGUiCiAgICAgICAgZWNobyAiJHNvdXJjZV9saW5lIiA+PiAiJHByb2ZpbGVfZmlsZSIKICAgICAgICBlY2hvIC1lICIke0NfR1JFRU595a6J6KOF5a6M5oiQ77yBJHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIke0NfWUVMTE9Xfeivt+mHjeWQr+e7iOerr+aIluaJp+ihjCAke0NfQk9MRH1zb3VyY2UgJHByb2ZpbGVfZmlsZSR7Q19ZRUxMT1d9IOS7peS9v+abtOaUueeUn+aViOOAgiR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiXG4ke0NfQk9MRH0tLS0g5L2/55So5pa55rOVIC0tLSR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAi5L2/55SoICR7Q19SRURfQk9MRH1mdWNrJHtDX1JFU0VUfSDlkb3ku6TlkI7ot5/mgqjmg7PmiafooYznmoTmk43kvZzljbPlj6/jgIIiCiAgICAgICAgZWNobyAtZSAi56S65L6LOiIKICAgICAgICBlY2hvIC1lICIgICR7Q19DWUFOfWZ1Y2sgaW5zdGFsbCBnaXQke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiAgJHtDX0NZQU59ZnVjayB1bmluc3RhbGwgZ2l0JHtDX1JFU0VUfSIKICAgICAgICBlY2hvIC1lICIgICR7Q19DWUFOfWZ1Y2sg5om+5Ye65b2T5YmN55uu5b2V5omA5pyJ5aSn5LqOMTBNQueahOaWh+S7tiR7Q19SRVNFVH0iCiAgICAgICAgZWNobyAtZSAiICAke0NfUkVEX0JPTER9ZnVjayB1bmluc3RhbGwke0NfUkVTRVR9ICR7Q19HUkVFTn0jIOWNuOi9vSBmdWNraXQuc2gke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIiAgJHtDX1JFRF9CT0xEfWZ1Y2sgY29uZmlnJHtDX1JFU0VUfSAke0NfR1JFRU59IyDmmL7npLrphY3nva7luK7liqkke0NfUkVTRVR9IgogICAgICAgIGVjaG8gLWUgIlxuJHtDX1lFTExPV33orrDlvpfph43lkK/nu4jnq6/ku6Xkvb/nlKjmlrDlkb3ku6TvvIEke0NfUkVTRVR9IgogICAgZWxzZQogICAgICAgIGVjaG8gLWUgIiRGVUNLICR7Q19ZRUxMT1d95qOA5rWL5Yiw5bey5a6J6KOF77yM5bey5Li65oKo5pu05paw6ISa5pys44CCJHtDX1JFU0VUfSIKICAgIGZpCn0KCgojIC0tLSDkuLvohJrmnKzlhaXlj6MgLS0tCgojIOWmguaenOacieWPguaVsOS8oOi/m+adpSAo5q+U5aaCICJiYXNoIC1zIC4uLiIpCmlmIFsgIiQjIiAtZ3QgMCBdOyB0aGVuCiAgICAjIOS4tOaXtuaooeW8jwogICAgIyDov5DooYzmoLjlv4PpgLvovpHvvIzlrprkuYnlh73mlbAKICAgIGV2YWwgIiRDT1JFX0xPR0lDIgogICAgIyDnm7TmjqXosIPnlKjkuLvlh73mlbAgKOWIq+WQjeWcqOi/meWEv+S4jeWlveS9vykKICAgIF9mdWNrX2V4ZWN1dGVfcHJvbXB0ICIkQCIKZWxzZQogICAgIyDlronoo4XmqKHlvI8KICAgIF9pbnN0YWxsX3NjcmlwdApmaQo=`);

const README_URL_EN = 'https://github.com/Silentely/fuckits/blob/main/README.en.md';
const README_URL_ZH = 'https://github.com/Silentely/fuckits';
const INSTALLER_FILENAME_EN = 'fuckits.sh';
const INSTALLER_FILENAME_ZH = 'fuckits-zh.sh';

function isBrowserRequest(userAgent = '') {
  return /Mozilla|Chrome|Safari|Firefox|Edg/.test(userAgent);
}

function resolveLocale(url, headers) {
  const pathname = url.pathname.toLowerCase();
  if (pathname === '/zh' || pathname.startsWith('/zh/')) {
    return 'zh';
  }

  const langParam = (url.searchParams.get('lang') || '').toLowerCase();
  if (langParam.startsWith('zh')) {
    return 'zh';
  }

  const acceptLanguage = (headers.get('Accept-Language') || '').toLowerCase();
  if (acceptLanguage.split(',').some((token) => token.trim().startsWith('zh'))) {
    return 'zh';
  }

  return 'en';
}


export default {
  async fetch(request, env, ctx) {
    const url = new URL(request.url);

    if (request.method === 'GET' && url.pathname === '/health') {
      return handleHealthCheck(env);
    }

    if (request.method === 'GET') {
      return handleGetRequest(request);
    } else if (request.method === 'POST') {
      return handlePostRequest(request, env);
    } else {
      return new Response('Expected GET or POST', { status: 405 });
    }
  },
};

function handleHealthCheck(env) {
  const payload = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    hasApiKey: Boolean(env?.OPENAI_API_KEY),
  };

  return new Response(JSON.stringify(payload), {
    status: 200,
    headers: { 'Content-Type': 'application/json; charset=utf-8' },
  });
}

/**
 * Handles GET requests to serve the installer script or redirect browsers to GitHub.
 * @param {Request} request The incoming request.
 * @returns {Response} A response with the shell script or a redirect.
 */
function handleGetRequest(request) {
  const userAgent = request.headers.get('User-Agent') || '';
  const url = new URL(request.url);
  const locale = resolveLocale(url, request.headers);
  const isBrowser = isBrowserRequest(userAgent);

  // If the request comes from a browser, redirect to the appropriate README.
  if (isBrowser) {
    const docsUrl = locale === 'zh' ? README_URL_ZH : README_URL_EN;
    return Response.redirect(docsUrl, 302);
  }

  // Otherwise, serve the installer script based on the resolved locale.
  const script = locale === 'zh' ? INSTALLER_SCRIPT_ZH : INSTALLER_SCRIPT;
  const filename = locale === 'zh' ? INSTALLER_FILENAME_ZH : INSTALLER_FILENAME_EN;

  return new Response(script, {
    headers: {
      'Content-Type': 'text/plain; charset=utf-8',
      'Content-Disposition': `attachment; filename="${filename}"`,
    },
  });
}

/**
 * Handles POST requests by forwarding the prompt to an AI model.
 * @param {Request} request The incoming request.
 * @param {object} env The environment variables.
 * @returns {Promise<Response>} A promise that resolves to the AI's response.
 */
async function handlePostRequest(request, env) {
  try {
    const { sysinfo, prompt } = await request.json();

    if (!prompt) {
      return new Response('Missing "prompt" in request body', { status: 400 });
    }
    if (!env.OPENAI_API_KEY) {
      return new Response('Missing OPENAI_API_KEY secret', { status: 500 });
    }

    const model = env.OPENAI_API_MODEL || 'gpt-4-turbo';
    const apiBase = (env.OPENAI_API_BASE || 'https://api.openai.com/v1').replace(/\/$/, '');
    const apiUrl = `${apiBase}/chat/completions`;

    const url = new URL(request.url);
    const locale = resolveLocale(url, request.headers);
    const isChinese = locale === 'zh';

    const system_prompt = isChinese
      ? `你是一个专业的 shell 脚本生成器。用户会提供他们的系统信息和一个命令。你的任务是返回一个可执行的、原始的 shell 脚本来完成他们的目标。脚本可以是多行的。不要提供任何解释、注释、markdown 格式（比如 \`\`\`bash）或 shebang（例如 #!/bin/bash）。只需要原始的脚本内容。用户的系统信息是：${sysinfo}`
      : `You are an expert shell script generator. A user will provide their system information and a prompt. Your task is to return a raw, executable shell script that accomplishes their goal. The script can be multi-line. Do not provide any explanation, comments, markdown formatting (like \`\`\`bash), or a shebang (e.g., #!/bin/bash). Just the raw script content. The user's system info is: ${sysinfo}`;

    const aiRequestPayload = {
      model: model,
      messages: [
        {
          role: 'system',
          content: system_prompt,
        },
        {
          role: 'user',
          content: prompt,
        },
      ],
      max_tokens: 1024,
      temperature: 0.2,
    };

    const aiResponse = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${env.OPENAI_API_KEY}`,
      },
      body: JSON.stringify(aiRequestPayload),
    });

    if (!aiResponse.ok) {
      const errorText = await aiResponse.text();
      return new Response(`AI API Error: ${errorText}`, { status: aiResponse.status });
    }

    const aiJson = await aiResponse.json();
    const command = aiJson.choices[0]?.message?.content.trim();

    if (!command) {
      return new Response('The AI returned an empty command.', { status: 500 });
    }

    return new Response(command, {
      headers: { 'Content-Type': 'text/plain' },
    });
  } catch (error) {
    return new Response(`Error: ${error.message}`, { status: 500 });
  }
}
